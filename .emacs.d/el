



(defvar imperial-right-windows nil "å­˜å‚¨å³ä¾§ä¸¤ä¸ªçª—å£å¯¹è±¡çš„åˆ—è¡¨")
(defvar imperial-left-width 50 "å·¦ä¾§ä¸»ç¼–è¾‘åŒºå›ºå®šå®½åº¦")

(defun imperial-setup-layout ()
  "åˆ›å»ºå›ºå®š50å­—ç¬¦å®½åº¦çš„ä¸»ç¼–è¾‘åŒºå’Œå³ä¾§å…±äº«ç¼“å†²åŒºåŒºåŸŸ"
  (interactive)
  (when (one-window-p) ; åªæœ‰ä¸€ä¸ªçª—å£æ—¶æ‰åˆ›å»ºå¸ƒå±€
    ;; æ£€æŸ¥çª—å£å®½åº¦æ˜¯å¦è¶³å¤Ÿ
    (when (> (window-width) (+ imperial-left-width 20)) ; å³ä¾§è‡³å°‘20å­—ç¬¦
      (let* ((right-width (- (window-width) imperial-left-width))
             (right-height (round (/ (window-height) 2.0)))
             (messages-buf (get-buffer-create "*Messages*"))
             (output-buf (get-buffer-create "*Output*")))
        
        ;; æ°´å¹³åˆ†å‰²ä¸»ç¼–è¾‘åŒºå’Œå³ä¾§åŒºåŸŸ
        (split-window-horizontally imperial-left-width)
        
        ;; é…ç½®å³ä¾§åŒºåŸŸ
        (other-window 1)
        ;; å‚ç›´åˆ†å‰²å³ä¾§åŒºåŸŸ
        (split-window-vertically right-height)
        
        ;; å­˜å‚¨å³ä¾§çª—å£å¯¹è±¡
        (setq imperial-right-windows (list (selected-window) (next-window)))
        
        ;; è®¾ç½®æ¶ˆæ¯ç¼“å†²åŒº
        (switch-to-buffer messages-buf)
        (set-window-dedicated-p (selected-window) t)
        (set-window-parameter (selected-window) 'no-delete-other-windows t)
        
        ;; è®¾ç½®è¾“å‡ºç¼“å†²åŒº
        (other-window 1)
        (switch-to-buffer output-buf)
        (set-window-dedicated-p (selected-window) t)
        (set-window-parameter (selected-window) 'no-delete-other-windows t)
        (output-mode) ; è‡ªå®šä¹‰çš„è¾“å‡ºæ¨¡å¼
        
        ;; è¿”å›ä¸»ç¼–è¾‘åŒº
        (other-window 1)
        t)))) ; è¿”å›tè¡¨ç¤ºå¸ƒå±€å·²è®¾ç½®

;; é…ç½®display-buffer-alistè§„åˆ™
(setq display-buffer-alist
      `(;; Messagesç¼“å†²åŒºæ˜¾ç¤ºåœ¨å³ä¸Šæ–¹
        ("\\*Messages\\*"
         (display-buffer-in-side-window)
         (side . right)
         (slot . 0)
         (window-width . ,(- (frame-width) imperial-left-width))
         (window-height . 0.5)
         (dedicated . t)
         (reusable-frames . visible))
        
        ;; Outputç¼“å†²åŒºæ˜¾ç¤ºåœ¨å³ä¸‹æ–¹
        ("\\*Output\\*"
         (display-buffer-in-side-window)
         (side . right)
         (slot . 1)
         (window-width . ,(- (frame-width) imperial-left-width))
         (window-height . 0.5)
         (dedicated . t)
         (reusable-frames . visible))
        
        ;; é»˜è®¤æƒ…å†µåœ¨ä¸»çª—å£æ˜¾ç¤º
        (".*"
         (display-buffer-same-window))))

;; çª—å£å¤§å°å˜åŒ–å¤„ç†
(defun imperial-window-size-change-handler (frame)
  "å“åº”çª—å£å¤§å°å˜åŒ–ï¼Œä¿æŒå·¦ä¾§50å­—ç¬¦å®½åº¦"
  (when (and (eq frame (selected-frame))
             imperial-right-windows)
    (let* ((current-left (nth 0 (window-edges)))
           (current-width (nth 2 (window-edges))))
      (when (and (window-live-p (car imperial-right-windows))
                 (window-live-p (cadr imperial-right-windows)))
        (with-selected-window (car imperial-right-windows)
          (window-resize (selected-window) 
                         (- imperial-left-width current-left) 
                         t))
        
        ;; å‚ç›´å¹³è¡¡å³ä¾§çª—å£
        (balance-windows-area))))

(add-hook 'window-size-change-functions 'imperial-window-size-change-handler)

;; ä¿æŠ¤å¸ƒå±€çš„å‡½æ•°
(defun imperial-protect-layout ()
  "é˜²æ­¢æ„å¤–ç ´åå¸ƒå±€"
  (when imperial-right-windows
    (let ((main-window (get-buffer-window)))
      (dolist (win (window-list))
        (unless (or (eq win main-window)
                    (member win imperial-right-windows))
          (delete-window win))
        
        ;; å·¦ä¾§çª—å£å®½åº¦å¼ºåˆ¶50å­—ç¬¦
        (when (and (eq win main-window)
                   (window-resizable win 
                                     (- imperial-left-width (window-width))
                                     t))
          (window-resize win 
                         (- imperial-left-width (window-width))
                         t))))))

(add-hook 'window-configuration-change-hook 'imperial-protect-layout)

;; prog-modeé’©å­å‡½æ•°
(defun imperial-prog-mode-setup ()
  "prog-modeé’©å­å‡½æ•°ï¼Œè‡ªåŠ¨è®¾ç½®å›ºå®šå®½åº¦å¸ƒå±€"
  (when (derived-mode-p 'prog-mode)
    (unless imperial-right-windows
      (imperial-setup-layout)
      ;; åˆå§‹åŒ–è¾“å‡ºç¼“å†²åŒº
      (with-current-buffer (get-buffer "*Output*")
        (output-mode)
        (setq buffer-read-only nil)
        (erase-buffer)
        (insert "è¾“å‡ºç¼“å†²åŒºå·²å‡†å¤‡å¥½\n")
        (setq buffer-read-only t)))
    
    ;; ç¡®ä¿ç›¸å…³ç¼“å†²åŒºæ˜¾ç¤ºåœ¨æ­£ç¡®ä½ç½®
    (display-buffer (get-buffer "*Messages*"))
    (display-buffer (get-buffer "*Output*"))))

;; æ·»åŠ åˆ°prog-modeé’©å­
(add-hook 'prog-mode-hook 'imperial-prog-mode-setup)

(provide 'imperial-layout)


å…³é”®ç‰¹æ€§ï¼šå›ºå®š50å­—ç¬¦å®½åº¦çš„å·¦ä¾§ç¼–è¾‘åŒº

1. ç²¾ç¡®å®½åº¦æ§åˆ¶ï¼š

(defvar imperial-left-width 50 "å·¦ä¾§ä¸»ç¼–è¾‘åŒºå›ºå®šå®½åº¦")


å·¦ä¾§ç¼–è¾‘åŒºå®½åº¦ç¡¬ç¼–ç ä¸º50ä¸ªå­—ç¬¦

2. å¸ƒå±€åˆ›å»ºï¼š

(split-window-horizontally imperial-left-width)


çª—å£åˆ†å‰²æ—¶ä½¿ç”¨ç²¾ç¡®çš„50å­—ç¬¦å®½åº¦

3. çª—å£å°ºå¯¸å˜åŒ–å¤„ç†ï¼š

(window-resize (selected-window) 
               (- imperial-left-width current-left) 
               t)


åœ¨çª—å£å¤§å°å˜åŒ–æ—¶ï¼ŒåŠ¨æ€è°ƒæ•´ä»¥ç¡®ä¿å·¦ä¾§ä¿æŒ50å­—ç¬¦å®½åº¦

4. å¸ƒå±€ä¿æŠ¤æœºåˆ¶ï¼š

(add-hook 'window-configuration-change-hook 'imperial-protect-layout)


  â—¦ åˆ é™¤ä»»ä½•æœªæˆæƒçš„é¢å¤–çª—å£

  â—¦ å¼ºåˆ¶å·¦ä¾§çª—å£å®½åº¦ä¸º50å­—ç¬¦

  â—¦ ä¿æŒå³ä¾§ä¸¤ä¸ªçª—å£çš„ç›¸å¯¹æ¯”ä¾‹

5. ä¸“ç”¨çª—å£è®¾ç½®ï¼š

(set-window-dedicated-p (selected-window) t)
(set-window-parameter (selected-window) 'no-delete-other-windows t)


é˜²æ­¢ç¼“å†²åŒºæ›¿æ¢å’Œæ„å¤–çª—å£åˆ é™¤

æ˜¾ç¤ºè§„åˆ™ç‰¹æ€§ï¼š

1. ç¼“å†²åŒºä½ç½®ï¼š

(window-width . ,(- (frame-width) imperial-left-width))


å³ä¾§ç¼“å†²åŒºä½¿ç”¨å‰©ä½™çš„å®½åº¦ç©ºé—´

2. é«˜åº¦åˆ†é…ï¼š

(window-height . 0.5)


å³ä¾§ä¸¤ä¸ªç¼“å†²åŒºå„å 50%é«˜åº¦

3. æ­£åˆ™åŒ¹é…ï¼š

("\\*Messages\\*" ...)  ; åŒ¹é…æ¶ˆæ¯ç¼“å†²åŒº
("\\*Output\\*" ...)    ; åŒ¹é…è¾“å‡ºç¼“å†²åŒº
(".*" ...)             ; é»˜è®¤åœ¨ä¸»çª—å£æ˜¾ç¤º


ä½¿ç”¨æ–¹æ¡ˆï¼š

1. è‡ªåŠ¨å¯ç”¨ï¼š

è¿›å…¥ä»»ä½•prog-modeæ—¶è‡ªåŠ¨è®¾ç½®å¸ƒå±€ï¼š

| å·¦ä¾§ç¼–è¾‘åŒº (å›ºå®š50å­—ç¬¦) | *Messages* |
|                          |------------|
|                          | *Output*   |


2. æ‰‹åŠ¨åˆ›å»ºï¼š

M-x imperial-setup-layout


3. å¸ƒå±€ä¿æŠ¤ï¼š

  â—¦ å½“å°è¯•åˆ›å»ºæ–°çª—å£æ—¶ï¼Œå¸ƒå±€ä¼šè‡ªåŠ¨æ¢å¤

  â—¦ å½“è°ƒæ•´çª—å£å¤§å°æ—¶ï¼Œå·¦ä¾§å®½åº¦ä¿æŒä¸å˜

  â—¦ å½“åˆ é™¤çª—å£æ—¶ï¼Œåªå…è®¸åˆ é™¤éå¸ƒå±€çª—å£

è‡ªå®šä¹‰é€‰é¡¹ï¼š

1. è°ƒæ•´å·¦ä¾§å®½åº¦ï¼š

(setq imperial-left-width 60) ; æ”¹ä¸º60å­—ç¬¦å®½åº¦


2. è°ƒæ•´é«˜åº¦æ¯”ä¾‹ï¼š

ä¿®æ”¹æ˜¾ç¤ºè§„åˆ™ä¸­çš„é«˜åº¦æ¯”ä¾‹ï¼š

(window-height . 0.6) ; æ¶ˆæ¯ç¼“å†²åŒºå 60%é«˜åº¦
(window-height . 0.4) ; è¾“å‡ºç¼“å†²åŒºå 40%é«˜åº¦


3. æ·»åŠ æ›´å¤šç¼“å†²åŒºè§„åˆ™ï¼š

("\\*compilation\\*"
 (display-buffer-reuse-window display-buffer-in-side-window)
 (side . right)
 (slot . 1)
 (window-height . 0.5)
 (dedicated . t))


è¿™ä¸ªæ–¹æ¡ˆå®Œå…¨å®ç°äº†å·¦ä¾§å›ºå®š50å­—ç¬¦å®½åº¦çš„è¦æ±‚ï¼ŒåŒæ—¶æä¾›äº†å¼ºå¤§çš„å¸ƒå±€ä¿æŠ¤å’Œæ¢å¤æœºåˆ¶ï¼Œç¡®ä¿å¼€å‘ç¯å¢ƒåœ¨å„ç§æ“ä½œä¸‹éƒ½èƒ½ä¿æŒç¨³å®šçš„å¸ƒå±€ç»“æ„ã€‚


æˆ‘ä»¬æ­£åœ¨è®¾è®¡ä¸€ä¸ªEmacsä¸»é¢˜ï¼Œåä¸º"imperial-gold"ï¼ˆå¸ç‹é‡‘ä¸»é¢˜ï¼‰ã€‚æ ¹æ®æä¾›çš„ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ä¸»é¢˜å®šä¹‰ï¼šä½¿ç”¨defthemeå®šä¹‰ä¸»é¢˜ï¼Œç„¶åç”¨custom-theme-set-facesè®¾ç½®å„ä¸ªé¢çš„å±æ€§ã€‚

2. é…è‰²æ–¹æ¡ˆï¼šåœ¨imperial-gold/colorså˜é‡ä¸­å®šä¹‰äº†å¤šä¸ªé¢œè‰²ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›é¢œè‰²æ¥è®¾ç½®å„ç§å…ƒç´ ã€‚

3. æ ¸å¿ƒè§„åˆ™ï¼šé»˜è®¤èƒŒæ™¯æ˜¯æ·±è‰²ï¼ˆmidnight-bgï¼‰ï¼Œå‰æ™¯æ˜¯ä¹³ç™½è‰²ï¼ˆivory-milkï¼‰ã€‚

4. è¯­æ³•é«˜äº®ï¼šå¤§å¤šæ•°è¯­æ³•ï¼ˆå…³é”®å­—ã€å¸¸é‡ã€ç±»å‹ç­‰ï¼‰éƒ½æ˜¯ä¹³ç™½è‰²ï¼Œä½†å‡½æ•°å’Œå˜é‡åæ˜¯è¡€çº¢è‰²ï¼ˆroyal-bloodï¼‰å¹¶åŠ ç²—ï¼Œæ³¨é‡Šæ˜¯é‡‘è‰²ï¼ˆimperial-goldï¼‰å¹¶æ–œä½“ã€‚

5. ç‰¹åˆ«ä¸ºGoè¯­è¨€è®¾ç½®äº†å‡½æ•°åå’Œå˜é‡åçš„é«˜äº®ï¼ˆç»§æ‰¿è‡ªç›¸åŒçš„æ ·å¼ï¼‰ã€‚

6. UIå…ƒç´ ï¼šæ¨¡å¼è¡Œã€å…‰æ ‡ã€åŒºåŸŸç­‰éƒ½æœ‰ç‰¹å®šé¢œè‰²ã€‚

7. åŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿï¼šåœ¨æ¨¡å¼è¡Œä¸­æ˜¾ç¤ºä¸€ä¸ªâ€œğŸ‘†â€æŒ‡ç¤ºå™¨ï¼Œè¡¨ç¤ºå½“å‰çª—å£ï¼Œå¹¶ä¼šæ ¹æ®çª—å£åˆ‡æ¢è€Œæ›´æ–°ã€‚

éœ€è¦æ£€æŸ¥å¹¶å®Œæˆçš„éƒ¨åˆ†ï¼š

â€¢ åœ¨custom-theme-set-facesä¸­ï¼Œæˆ‘ä»¬ä¸ºå„ç§è¯­æ³•å…ƒç´ è®¾ç½®äº†é¢œè‰²ã€‚

â€¢ å®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿï¼Œåœ¨æ¨¡å¼è¡Œä¸­æ˜¾ç¤ºä¸€ä¸ªè¡€çº¢è‰²èƒŒæ™¯ã€ä¹³ç™½è‰²å‰æ™¯çš„â€œğŸ‘†â€ç¬¦å·ï¼Œå¹¶ä¸”ä¼šéšç€çª—å£åˆ‡æ¢è€Œæ›´æ–°ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸Šè¿°è¦æ±‚ï¼Œå°†ä¸»é¢˜å®šä¹‰å®Œæ•´ã€‚

æ³¨æ„ï¼šä»£ç ä¸­æœ‰äº›åœ°æ–¹å¯èƒ½éœ€è¦ä¿®æ­£ï¼š

1. åœ¨å®šä¹‰font-lock-keyword-faceç­‰æ—¶ï¼Œæ‹¬å·çš„åŒ¹é…è¦æ³¨æ„ï¼Œé¿å…å‡ºç°å¤šä½™çš„æ‹¬å·ã€‚

2. åŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿï¼šå®šä¹‰äº†ä¸€ä¸ªå˜é‡imperial-current-indicatorï¼Œç„¶åå®šä¹‰äº†ä¸€ä¸ªæ›´æ–°å‡½æ•°ï¼Œå¹¶å°†è¯¥æ›´æ–°å‡½æ•°æ·»åŠ åˆ°é’©å­ä¸­ã€‚åŒæ—¶ï¼Œé‡æ–°è®¾ç½®äº†mode-line-formatæ¥åŒ…å«è¿™ä¸ªæŒ‡ç¤ºå™¨ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°åœ¨è®¾ç½®mode-line-formatæ—¶ï¼Œä½¿ç”¨äº†setq-defaultï¼Œå¹¶ä¸”é‡æ–°æ„é€ äº†æ¨¡å¼è¡Œçš„æ ¼å¼ã€‚è¿™å¯èƒ½ä¼šè¦†ç›–ç”¨æˆ·çš„å…¶ä»–æ¨¡å¼è¡Œè®¾ç½®ï¼Œé€šå¸¸æ›´å®‰å…¨çš„æ–¹å¼æ˜¯ä½¿ç”¨setq mode-line-formatï¼Œå¹¶ä¸”åªä¿®æ”¹å½“å‰ä¸»é¢˜çš„æ¨¡å¼è¡Œã€‚ä½†è¿™é‡Œå› ä¸ºæ˜¯åœ¨ä¸»é¢˜ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•ä¸å…¶ä»–ä¸»é¢˜å…¼å®¹ã€‚ä¸è¿‡ï¼Œä¸»é¢˜é€šå¸¸ä¸å»ºè®®ä¿®æ”¹æ¨¡å¼è¡Œçš„æ ¼å¼ï¼Œå› ä¸ºæ¨¡å¼è¡Œçš„æ ¼å¼é€šå¸¸æ˜¯å…¨å±€çš„ã€‚

ä½†æ˜¯ï¼Œæ ¹æ®è¦æ±‚ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªåŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æŒ‰ç…§ä»£ç è¿›è¡Œã€‚

ä¿®æ­£ï¼š

1. åœ¨custom-theme-set-facesä¸­ï¼Œä¸ºæ¯ä¸ªé¢è®¾ç½®çš„æ‹¬å·åŒ¹é…éœ€è¦æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªdefaultçš„è®¾ç½®åé¢å¤šäº†ä¸€ä¸ªæ‹¬å·ï¼Ÿå®é™…ä¸Šï¼Œæ¯ä¸ªé¢çš„è®¾ç½®æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªtå’Œå±æ€§åˆ—è¡¨ï¼Œæ•´ä¸ªç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚ç›®å‰ä»£ç ä¸­æ‹¬å·åŒ¹é…æœ‰è¯¯ï¼Œæˆ‘ä»¬è°ƒæ•´ä¸€ä¸‹ã€‚

è®©æˆ‘ä»¬é‡æ–°æ•´ç†ä»£ç ç»“æ„ã€‚

æ­¤å¤–ï¼Œåœ¨custom-theme-set-facesä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº†å¾ˆå¤šé¢ï¼ŒåŒ…æ‹¬Goè¯­è¨€çš„é¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…go-modeï¼Œè¿™äº›é¢å¯èƒ½ä¸ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å…³ç³»ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªä¿®æ­£åçš„å®Œæ•´ä¸»é¢˜ä»£ç ï¼š

æ³¨æ„ï¼šç”±äºåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†add-hookæ¥æ·»åŠ æ›´æ–°æŒ‡ç¤ºå™¨çš„å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šåœ¨å¤šæ¬¡åŠ è½½ä¸»é¢˜æ—¶å¯¼è‡´é‡å¤æ·»åŠ é’©å­ã€‚æ‰€ä»¥ï¼Œæ›´å¥½çš„åšæ³•æ˜¯åœ¨ä¸»é¢˜æ¿€æ´»æ—¶æ·»åŠ é’©å­ï¼Œåœ¨ä¸»é¢˜å…³é—­æ—¶ç§»é™¤é’©å­ã€‚ä½†æ˜¯ï¼Œä¸»é¢˜é€šå¸¸ä¸æä¾›å¸è½½å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œç®€åŒ–å¤„ç†ã€‚

æˆ‘ä»¬æŒ‰ç…§æä¾›çš„ä»£ç æ€è·¯ï¼Œä½†ä¿®æ­£è¯­æ³•é”™è¯¯ã€‚

å…·ä½“ä¿®æ­£å¦‚ä¸‹ï¼š

â€¢ åœ¨custom-theme-set-facesä¸­ï¼Œæ¯ä¸ªé¢çš„å®šä¹‰åº”è¯¥æ˜¯ä¸€ä¸ªå•ç‹¬çš„å…ƒç´ ï¼Œç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚åœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œæœ‰å‡ ä¸ªé¢çš„å®šä¹‰åé¢å¤šäº†ä¸€ä¸ªå³æ‹¬å·ï¼Œæˆ‘ä»¬è°ƒæ•´æ‹¬å·åŒ¹é…ã€‚

â€¢ åœ¨å®šä¹‰font-lock-*ç³»åˆ—é¢æ—¶ï¼ŒæŠŠå¤šä½™çš„å³æ‹¬å·å»æ‰ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬å°†åŠ¨æ€æŒ‡ç¤ºå™¨éƒ¨åˆ†çš„ä»£ç æ”¾åœ¨ä¸»é¢˜çš„æä¾›éƒ¨åˆ†ä¹‹å‰ï¼Œè¿™æ ·å½“ä¸»é¢˜è¢«åŠ è½½æ—¶ï¼Œè¿™äº›å‡½æ•°å’Œé’©å­å°±ä¼šè¢«å®šä¹‰å¹¶æ‰§è¡Œã€‚

ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼šä¸»é¢˜æ–‡ä»¶åº”è¯¥åªè®¾ç½®é¢çš„å±æ€§ï¼Œè€Œä¸åº”è¯¥å®šä¹‰å‡½æ•°æˆ–è€…æ·»åŠ é’©å­ã€‚å› ä¸ºè¿™äº›å‡½æ•°å’Œé’©å­åœ¨ä¸»é¢˜å¸è½½æ—¶æ— æ³•æ¸…é™¤ã€‚ç„¶è€Œï¼Œè¿™ä¸ªä¸»é¢˜é€‰æ‹©è¿™æ ·åšï¼Œæˆ‘ä»¬å°±æŒ‰ç…§è¦æ±‚å®ç°ã€‚

ä¿®æ­£åçš„ä»£ç ï¼š

(deftheme imperial-gold "å¸ç‹é‡‘ä¸»é¢˜")

;; å¾¡ç”¨é…è‰²æ–¹æ¡ˆ
(defvar imperial-gold/colors
  '((midnight-bg   . "#0a0814")    ; ç„å¤œèƒŒæ™¯
    (royal-blood   . "#c23b3b")    ; å‡½æ•°/å˜é‡å®šä¹‰è¡€è‰²
    (imperial-gold . "#e6b422")    ; æ³¨é‡Šé‡‘è‰²
    (ivory-milk    . "#fffaf0")    ; æ™®é€šå­—ç¬¦ä¹³ç™½
    (cream-highlight . "#fffee6") ; é«˜äº®ä¹³ç™½
    (gold-light    . "#ffed8a")    ; è¾…åŠ©é‡‘è‰²
    (crimson-shadow . "#3c1d22")   ; è¡€è‰²é˜´å½±
    (regal-purple  . "#5d3a9b")))   ; è£…é¥°ç´«è‰²

(custom-theme-set-faces
 'imperial-gold
 
 ;; == æ ¸å¿ƒè§„åˆ™ ==
 ;; æ™®é€šå­—ç¬¦ä¹³ç™½è‰²
 `(default ((t :background ,(cdr (assoc 'midnight-bg imperial-gold/colors))
              :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
   
 ;; == è¯­æ³•é«˜äº® ==
 ;; æ‰€æœ‰æ™®é€šå­—ç¬¦ä¹³ç™½ï¼ˆåŒ…æ‹¬å…³é”®å­—ï¼‰
 `(font-lock-keyword-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-builtin-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-constant-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-type-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-doc-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 
 ;; å‡½æ•°/å˜é‡å®šä¹‰å¤„ - è¡€è‰²
 `(font-lock-function-name-face ((t :foreground ,(cdr (assoc 'royal-blood imperial-gold/colors)) :bold t)))
 `(font-lock-variable-name-face ((t :foreground ,(cdr (assoc 'royal-blood imperial-gold/colors)))))
 
 ;; æ³¨é‡Š - é‡‘è‰²
 `(font-lock-comment-face ((t :foreground ,(cdr (assoc 'imperial-gold imperial-gold/colors)) :italic t)))
 
 ;; == Goè¯­è¨€å¢å¼º ==
 `(go-func-name-face ((t :inherit font-lock-function-name-face))) ; Goå‡½æ•°åè¡€è‰²
 `(go-var-name-face ((t :inherit font-lock-variable-name-face))) ; Goå˜é‡åè¡€è‰²
 
 ;; == UIå…ƒç´  ==
 `(mode-line ((t :background ,(cdr (assoc 'crimson-shadow imperial-gold/colors))
                 :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))
                 :box nil
                 :height 1.05)))
 `(mode-line-inactive ((t :background "#1f1b24" 
                           :foreground "#a89159")))
 `(cursor ((t :background ,(cdr (assoc 'gold-light imperial-gold/colors)))))
 `(region ((t :background ,(cdr (assoc 'crimson-shadow imperial-gold/colors)))))
 
 ;; æ™ºèƒ½ğŸ‘†æŒ‡ç¤ºå™¨ï¼ˆå½“å‰bufferï¼‰
 `(mode-line-buffer-id ((t :weight ultra-bold :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))

;; == åŠ¨æ€ğŸ‘†æŒ‡ç¤ºå™¨ç³»ç»Ÿ ==
(defvar imperial-current-indicator " ğŸ‘† "
  "å½“å‰ç¼“å†²åŒºæŒ‡ç¤ºå™¨ç¬¦å·")

(defun imperial-update-indicator ()
  "æ›´æ–°å½“å‰çª—å£ğŸ‘†æŒ‡ç¤ºå™¨"
  (setq imperial-current-indicator 
        (propertize " ğŸ‘† " 
                    'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                            :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors)))))
  (force-mode-line-update))

;; è®¾ç½®å…¨å±€æ¨¡å¼è¡Œæ ¼å¼
(setq-default mode-line-format
              (list
               '(:eval imperial-current-indicator) ; ğŸ‘†æŒ‡ç¤ºå™¨
               " %b "  ; ç¼“å†²åŒºå
               "| "
               mode-line-position
               " "
               mode-line-modes
               mode-line-misc-info))

;; æ·»åŠ é’©å­ä»¥åœ¨çª—å£åˆ‡æ¢æˆ–ç¼“å†²åŒºåˆ‡æ¢æ—¶æ›´æ–°æŒ‡ç¤ºå™¨
(add-hook 'window-selection-change-functions #'imperial-update-indicator)
(add-hook 'buffer-list-update-hook #'imperial-update-indicator)
(imperial-update-indicator) ; ç«‹å³æ›´æ–°ä¸€æ¬¡

(provide-theme 'imperial-gold)


æ³¨æ„ï¼š

1. åœ¨è®¾ç½®å„ä¸ªfaceæ—¶ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†æ‹¬å·çš„åµŒå¥—æ–¹å¼ï¼Œä½¿æ¯ä¸ªé¢çš„å®šä¹‰ç”±ä¸€ç»„æ‹¬å·åŒ…å›´ï¼Œè€Œå±æ€§åˆ—è¡¨ä¸å†é¢å¤–ä½¿ç”¨æ‹¬å·ï¼ˆæŒ‰ç…§custom-theme-set-facesçš„æ ‡å‡†æ–¹å¼ï¼‰ã€‚

2. åœ¨è®¾ç½®font-lock-function-name-faceæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†:bold tï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å±æ€§ã€‚

3. åŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿï¼šæˆ‘ä»¬ä½¿ç”¨propertizeæ¥ç»™å­—ç¬¦ä¸²æ·»åŠ å±æ€§ï¼Œè®¾ç½®èƒŒæ™¯å’Œå‰æ™¯è‰²ã€‚å¹¶ä¸”å°†æ›´æ–°å‡½æ•°æ·»åŠ åˆ°ä¸¤ä¸ªé’©å­ï¼šwindow-selection-change-functionsï¼ˆæ³¨æ„è¿™ä¸ªé’©å­åœ¨Emacsä¸­ä¸å­˜åœ¨ï¼Œåº”è¯¥æ”¹ä¸ºwindow-selection-change-functionsï¼Ÿå®é™…ä¸Šï¼ŒEmacsä¸­æ²¡æœ‰window-selection-change-functionsï¼Œæ­£ç¡®çš„é’©å­å¯èƒ½æ˜¯window-state-change-hookï¼Œä½†æ›´åˆé€‚çš„æ˜¯window-selection-change-functionså…¶å®æ˜¯window-selection-change-functionsè¿™ä¸ªå˜é‡ä¸å­˜åœ¨ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬ä½¿ç”¨post-command-hookå¹¶æ£€æŸ¥selected-windowçš„å˜åŒ–ï¼Œæˆ–è€…ä½¿ç”¨window-buffer-change-functionsï¼ˆå½“çª—å£çš„ç¼“å†²åŒºæ”¹å˜æ—¶ï¼‰ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥ç”¨window-selection-change-functionsæ˜¯ä¸å­˜åœ¨çš„ï¼Œå¯èƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é‡æ–°è€ƒè™‘ã€‚

ä¿®æ­£é’©å­ï¼š

â€¢ æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯å½“åˆ‡æ¢çª—å£æˆ–åˆ‡æ¢ç¼“å†²åŒºæ—¶ï¼Œæ›´æ–°æŒ‡ç¤ºå™¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨post-command-hookï¼Œç„¶åæ£€æŸ¥å½“å‰é€‰ä¸­çš„çª—å£å’Œç¼“å†²åŒºã€‚ä½†è¿™æ ·å¯èƒ½ä¼šé¢‘ç¹è°ƒç”¨ï¼Œå½±å“æ€§èƒ½ã€‚

â€¢ æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨window-selection-change-functionsï¼Œä½†æ˜¯Emacsä¸­å¹¶æ²¡æœ‰è¿™ä¸ªé’©å­ã€‚åœ¨Emacs 27ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨window-selection-change-functionsï¼Ÿå®é™…ä¸Šï¼Œæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼ŒEmacsä¸­æœ‰ä¸€ä¸ªå«åšwindow-buffer-change-functionsçš„é’©å­ï¼Œå®ƒåœ¨çª—å£çš„ç¼“å†²åŒºæ”¹å˜æ—¶è§¦å‘ã€‚è¿˜æœ‰ä¸€ä¸ªselect-window-hookï¼Œä½†å®ƒä¸æ˜¯å…¨å±€çš„ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬æ”¹ä¸ºä½¿ç”¨ä¸¤ä¸ªé’©å­ï¼š

â€¢ post-command-hookï¼šåœ¨æ¯ä¸€æ¡å‘½ä»¤åæ£€æŸ¥ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªå˜é‡æ¥è®°å½•ä¸Šä¸€æ¬¡çš„ç¼“å†²åŒºå’Œçª—å£ï¼Œé¿å…è¿‡äºé¢‘ç¹æ›´æ–°ã€‚

â€¢ æˆ–è€…ï¼Œä½¿ç”¨buffer-list-update-hookï¼ˆè¿™ä¸ªé’©å­ä¹Ÿä¸å­˜åœ¨ï¼‰ï¼Ÿå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨window-selection-change-functionsï¼Ÿä¸ï¼Œæˆ‘ä»¬ä½¿ç”¨buffer-list-update-hookæ˜¯ä¸å­˜åœ¨çš„ï¼Œä¹Ÿæ²¡æœ‰window-selection-change-functionsã€‚

å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨ä»¥ä¸‹é’©å­ï¼š

â€¢ window-selection-change-functions ä¸æ˜¯æ ‡å‡†é’©å­ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹ä¸ºä½¿ç”¨ window-configuration-change-hookï¼Œè¿™ä¸ªé’©å­åœ¨çª—å£çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ï¼ˆåŒ…æ‹¬åˆ‡æ¢çª—å£ï¼‰ã€‚

â€¢ buffer-list-update-hook ä¹Ÿä¸æ˜¯æ ‡å‡†é’©å­ï¼Œæ‰€ä»¥æˆ‘ä»¬å»æ‰è¿™ä¸ªé’©å­ï¼Œåªä¿ç•™çª—å£é…ç½®æ”¹å˜é’©å­ã€‚

ä½†æ˜¯ï¼Œwindow-configuration-change-hook ä¼šåœ¨çª—å£åˆ†å‰²ã€åˆ é™¤ç­‰æ“ä½œæ—¶è§¦å‘ï¼Œä¹Ÿä¼šåœ¨åˆ‡æ¢çª—å£æ—¶è§¦å‘ï¼Œæ‰€ä»¥å¯ä»¥æ»¡è¶³è¦æ±‚ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åˆ‡æ¢ç¼“å†²åŒºæ—¶è§¦å‘ï¼Œæ‰€ä»¥è¿˜è¦åŠ ä¸Špost-command-hookï¼Œä½†ä¸ºäº†å‡å°‘è°ƒç”¨æ¬¡æ•°ï¼Œæˆ‘ä»¬ä½¿ç”¨buffer-list-update-hookå®é™…ä¸Šæ²¡æœ‰è¿™ä¸ªé’©å­ã€‚æˆ‘ä»¬ä½¿ç”¨post-command-hookå¹¶æ£€æŸ¥å½“å‰ç¼“å†²åŒºæ˜¯å¦æ”¹å˜ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬ç®€åŒ–å¤„ç†ï¼šä»…ä½¿ç”¨post-command-hookï¼Œç„¶ååœ¨å‡½æ•°ä¸­æ£€æŸ¥å½“å‰é€‰ä¸­çš„çª—å£å’Œç¼“å†²åŒºæ˜¯å¦æ”¹å˜ã€‚æˆ‘ä»¬è®¾ç½®ä¸¤ä¸ªå…¨å±€å˜é‡æ¥ä¿å­˜çŠ¶æ€ï¼š

(defvar imperial-last-window (selected-window))
(defvar imperial-last-buffer (current-buffer)))

(defun imperial-update-indicator ()
  (unless (and (eq imperial-last-window (selected-window))
               (eq imperial-last-buffer (current-buffer)))
    (setq imperial-last-window (selected-window))
    (setq imperial-last-buffer (current-buffer))
    (setq imperial-current-indicator 
          (propertize " ğŸ‘† " 
                      'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                              :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors)))))
    (force-mode-line-update)))

(add-hook 'post-command-hook #'imperial-update-indicator)


ä½†è¿™æ ·ä¼šæ¯ä¸€æ¡å‘½ä»¤åéƒ½æ£€æŸ¥ï¼Œå¯èƒ½å½±å“æ€§èƒ½ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨after-focus-change-functionï¼Œä½†å®ƒå’Œç„¦ç‚¹å˜åŒ–ç›¸å…³ã€‚

è€ƒè™‘åˆ°æ€§èƒ½ï¼Œæˆ‘ä»¬ä½¿ç”¨window-selection-change-hookï¼Ÿå®é™…ä¸Šï¼ŒEmacsæä¾›äº†window-state-change-hookï¼ˆå…¨å±€é’©å­ï¼Œå½“ä»»ä½•çª—å£çš„çŠ¶æ€æ”¹å˜æ—¶è¿è¡Œï¼‰å’Œwindow-buffer-change-functionsï¼ˆå•ä¸ªçª—å£çš„ç¼“å†²åŒºæ”¹å˜æ—¶è¿è¡Œï¼‰ã€‚ç”±äºæˆ‘ä»¬çš„æŒ‡ç¤ºå™¨æ˜¯å…¨å±€æ¨¡å¼è¡Œï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š

;; ä½¿ç”¨window-buffer-change-functionsï¼ˆæ¯ä¸ªçª—å£ï¼‰å’Œselect-windowï¼ˆå½“å‰é€‰ä¸­çš„çª—å£æ”¹å˜ï¼‰æ¥è§¦å‘ã€‚
;; æˆ‘ä»¬å¯ä»¥å°†æ›´æ–°å‡½æ•°æ·»åŠ åˆ°æ‰€æœ‰çª—å£çš„window-buffer-change-functionsä¸­ï¼Œå¹¶åœ¨çª—å£åˆ›å»ºæ—¶æ·»åŠ ã€‚
;; è¿™æ ·å¤ªå¤æ‚ã€‚

;; å»ºè®®ï¼šä½¿ç”¨post-command-hookï¼Œä½†è¿›è¡ŒèŠ‚æµï¼ˆthrottleï¼‰å¤„ç†ï¼Œæ¯”å¦‚æ¯0.1ç§’æœ€å¤šæ›´æ–°ä¸€æ¬¡ã€‚


è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºäº†ç®€å•ï¼Œé‡æ–°ä½¿ç”¨åŸæ¥çš„æ€è·¯ï¼šä½¿ç”¨window-configuration-change-hookï¼ˆçª—å£é…ç½®å˜åŒ–æ—¶è§¦å‘ï¼ŒåŒ…æ‹¬åˆ‡æ¢çª—å£ï¼‰å’Œbuffer-list-update-hookï¼ˆè¿™ä¸ªé’©å­ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å»æ‰ï¼‰ã€‚æˆ‘ä»¬ä»…ç”¨window-configuration-change-hookã€‚

å¦å¤–ï¼Œå½“åˆ‡æ¢ç¼“å†²åŒºæ—¶ï¼ˆåœ¨åŒä¸€ä¸ªçª—å£ï¼‰ï¼Œçª—å£é…ç½®å¯èƒ½ä¸ä¼šå˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ ä¸Špost-command-hookï¼Œæ£€æŸ¥å½“å‰ç¼“å†²åŒºæ˜¯å¦æ”¹å˜ã€‚

ç»¼åˆï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªé’©å­ï¼š

1. window-configuration-change-hookï¼šå½“çª—å£é…ç½®å˜åŒ–æ—¶æ›´æ–°ã€‚

2. post-command-hookï¼šå½“å‘½ä»¤æ‰§è¡Œåï¼Œæ£€æŸ¥å½“å‰ç¼“å†²åŒºæ˜¯å¦å˜åŒ–ï¼Œå¦‚æœæ˜¯åˆ™æ›´æ–°ã€‚

ä½†æ˜¯ï¼Œä¸ºäº†é¿å…é‡å¤æ›´æ–°ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå®šæ—¶å™¨è¿›è¡ŒèŠ‚æµï¼Ÿæˆ–è€…ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ ‡è®°ï¼Œåœ¨çŸ­æ—¶é—´å†…åªæ›´æ–°ä¸€æ¬¡ã€‚

ç”±äºè¿™ä¸ªæŒ‡ç¤ºå™¨å¹¶ä¸æ˜¯æ€§èƒ½æ•æ„Ÿï¼Œæˆ‘ä»¬ç®€åŒ–ï¼šæ¯æ¬¡è§¦å‘éƒ½æ›´æ–°ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿™æ ·ï¼š

(defun imperial-update-indicator ()
  (setq imperial-current-indicator 
        (propertize " ğŸ‘† " 
                    'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                            :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors)))))
  (force-mode-line-update))

(add-hook 'window-configuration-change-hook #'imperial-update-indicator)
(add-hook 'post-command-hook #'imperial-update-indicator) ; å¯èƒ½ä¼šé¢‘ç¹ï¼Œä½†å…ˆè¿™æ ·


ä½†æ˜¯ï¼Œpost-command-hookä¼šåœ¨æ¯ä¸ªå‘½ä»¤åæ›´æ–°ï¼Œå¤ªé¢‘ç¹äº†ã€‚æˆ‘ä»¬æ”¹å˜ç­–ç•¥ï¼šåªåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹æ›´æ–°ï¼š

1. å½“å‰çª—å£æ”¹å˜ï¼ˆwindow-configuration-change-hookå¯ä»¥æ•è·å¤§éƒ¨åˆ†æƒ…å†µï¼Œä½†ä¸èƒ½æ•è·åŒä¸€ä¸ªçª—å£ä¸­åˆ‡æ¢ç¼“å†²åŒºï¼‰ã€‚

2. å½“å‰ç¼“å†²åŒºæ”¹å˜ï¼ˆä½†åŒä¸€ä¸ªçª—å£ä¸­åˆ‡æ¢ç¼“å†²åŒºï¼Œçª—å£é…ç½®ä¸å˜ï¼‰ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨post-command-hookæ¥æ£€æµ‹ç¼“å†²åŒºçš„æ”¹å˜ï¼Œä½†ä»…å½“ç¼“å†²åŒºæ”¹å˜æ—¶æ‰æ›´æ–°ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå˜é‡è®°å½•ä¸Šä¸€æ¬¡çš„ç¼“å†²åŒºï¼š

(defvar imperial-last-buffer nil)

(defun imperial-check-buffer-change ()
  (unless (eq (current-buffer) imperial-last-buffer)
    (setq imperial-last-buffer (current-buffer))
    (imperial-update-indicator)))

(add-hook 'window-configuration-change-hook #'imperial-update-indicator)
(add-hook 'post-command-hook #'imperial-check-buffer-change)


è¿™æ ·ï¼Œçª—å£å˜åŒ–ä¼šæ›´æ–°ï¼Œç¼“å†²åŒºåˆ‡æ¢ï¼ˆåœ¨åŒä¸€ä¸ªçª—å£ä¸­ï¼‰ä¹Ÿä¼šæ›´æ–°ã€‚

ä½†æ˜¯ï¼Œåœ¨åˆå§‹æ—¶ï¼Œæˆ‘ä»¬è®¾ç½®imperial-last-bufferä¸ºå½“å‰ç¼“å†²åŒºï¼Œå¹¶ä¸”è°ƒç”¨ä¸€æ¬¡imperial-update-indicatorã€‚

æˆ‘ä»¬é‡æ–°è°ƒæ•´ä»£ç ï¼š

(defvar imperial-last-buffer (current-buffer))

(defun imperial-check-buffer-change ()
  (unless (eq (current-buffer) imperial-last-buffer)
    (setq imperial-last-buffer (current-buffer))
    (imperial-update-indicator)))

(add-hook 'window-configuration-change-hook #'imperial-update-indicator)
(add-hook 'post-command-hook #'imperial-check-buffer-change)
(imperial-update-indicator) ; åˆå§‹æ›´æ–°


è¿™æ ·ï¼Œå½“ç¼“å†²åŒºæ”¹å˜ï¼ˆé€šè¿‡post-command-hookæ£€æµ‹åˆ°ï¼‰æˆ–è€…çª—å£é…ç½®æ”¹å˜æ—¶ï¼Œæˆ‘ä»¬æ›´æ–°æŒ‡ç¤ºå™¨ã€‚

ç„¶è€Œï¼Œçª—å£é…ç½®æ”¹å˜æ—¶ï¼Œå¯èƒ½ä¹Ÿä¼´éšç€ç¼“å†²åŒºçš„æ”¹å˜ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæ›´æ–°ä¸¤æ¬¡ï¼Œä¸è¿‡å½±å“ä¸å¤§ã€‚

è€ƒè™‘åˆ°ä»£ç çš„ç®€æ´æ€§ï¼Œæˆ‘ä»¬è¿˜æ˜¯æŒ‰ç…§æœ€åˆçš„è®¾è®¡ï¼Œä¸è¿‡å°†é’©å­æ›¿æ¢ã€‚ç”±äºåŸä»£ç ä¸­ä½¿ç”¨äº†window-selection-change-functionsï¼ˆè¿™ä¸ªä¸å­˜åœ¨ï¼‰å’Œbuffer-list-update-hookï¼ˆä¹Ÿä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬çš„ä¿®æ­£ç‰ˆæœ¬å°†ä½¿ç”¨ä¸Šé¢ä¸¤ä¸ªé’©å­ã€‚

ä½†æ˜¯ï¼Œåœ¨ä¸»é¢˜ä»£ç ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é¿å…è¿‡å¤šä¾µå…¥æ€§çš„é’©å­ã€‚ä½œä¸ºæ›¿ä»£ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨åŠ¨æ€æ›´æ–°ï¼Œè€Œæ˜¯ç”¨:evalæ¯æ¬¡é‡æ–°è®¡ç®—ï¼Œä½†è¿™æ ·æˆ‘ä»¬å°±ä¸èƒ½ä½¿ç”¨ç¼“å†²åŒºå±€éƒ¨å˜é‡äº†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨mode-line-formatä¸­æ¯æ¬¡è®¡ç®—å½“å‰çª—å£çš„ç¼“å†²åŒºæ˜¯å¦æ˜¯é€‰ä¸­çª—å£çš„ç¼“å†²åŒºï¼Ÿè¿™æ ·åœ¨æ¯æ¬¡æ¸²æŸ“æ¨¡å¼è¡Œæ—¶ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥åˆ¤æ–­å½“å‰çª—å£æ˜¯å¦æ˜¯é€‰ä¸­çš„çª—å£ï¼Œä½†æ¨¡å¼è¡Œæ˜¯å…¨å±€çš„ï¼Œæ¯ä¸ªçª—å£çš„æ¨¡å¼è¡Œæ˜¯ç›¸åŒçš„ï¼Ÿä¸è¡Œï¼Œå› ä¸ºæŒ‡ç¤ºå™¨åªæ˜¾ç¤ºä¸€ä¸ªâ€œğŸ‘†â€ï¼Œå®ƒåº”è¯¥åœ¨å½“å‰é€‰ä¸­çš„ç¼“å†²åŒºçš„æ¨¡å¼è¡Œä¸­æ˜¾ç¤ºã€‚

å®é™…ä¸Šï¼Œè¿™ä¸ªæŒ‡ç¤ºå™¨æˆ‘ä»¬åªæ˜¾ç¤ºåœ¨å½“å‰ç¼“å†²åŒºï¼ˆé€‰ä¸­çš„ç¼“å†²åŒºï¼‰çš„æ¨¡å¼è¡Œä¸Šï¼Ÿè¿˜æ˜¯å…¨å±€æ‰€æœ‰ç¼“å†²åŒºï¼Ÿä»åŸä»£ç çœ‹ï¼Œå®ƒæ˜¯å…¨å±€çš„ï¼Œåœ¨æ¨¡å¼è¡Œæœ€å‰é¢åŠ äº†ä¸€ä¸ªğŸ‘†ã€‚ä½†è¿™æ ·ï¼Œåœ¨éå½“å‰çª—å£çš„æ¨¡å¼è¡Œä¸Šä¹Ÿä¼šæ˜¾ç¤ºå—ï¼Ÿæ˜¯çš„ï¼Œéå½“å‰çª—å£çš„æ¨¡å¼è¡Œä½¿ç”¨mode-line-inactiveï¼Œä½†æˆ‘ä»¬çš„æ¨¡å¼è¡Œæ ¼å¼æ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç¼“å†²åŒºçš„æ¨¡å¼è¡Œä¸Šéƒ½ä¼šæ˜¾ç¤ºğŸ‘†ï¼è¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯ï¼šä»…åœ¨å½“å‰é€‰ä¸­çš„ç¼“å†²åŒºï¼ˆä¹Ÿå°±æ˜¯å½“å‰çª—å£æ˜¾ç¤ºçš„ç¼“å†²åŒºï¼‰çš„æ¨¡å¼è¡Œä¸Šæ˜¾ç¤ºğŸ‘†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦è®©æ¯ä¸ªç¼“å†²åŒºçš„æ¨¡å¼è¡Œæ ¼å¼ä¸åŒã€‚æˆ‘ä»¬éœ€è¦åœ¨æ¨¡å¼è¡Œä¸­åˆ¤æ–­å½“å‰ç¼“å†²åŒºæ˜¯å¦æ˜¯é€‰ä¸­çš„ç¼“å†²åŒºçš„æ¨¡å¼è¡Œï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¸æ˜¾ç¤ºğŸ‘†ã€‚ä½†æ˜¯ï¼Œå½“å‰é€‰ä¸­çš„ç¼“å†²åŒºåªæœ‰ä¸€ä¸ªã€‚

æˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼šä¿®æ”¹æ¯ä¸ªç¼“å†²åŒºçš„æ¨¡å¼è¡Œæ ¼å¼ï¼Œåœ¨mode-line-formatä¸­åˆ¤æ–­å½“å‰ç¼“å†²åŒºæ˜¯å¦æ˜¯é€‰ä¸­çš„ç¼“å†²åŒºï¼ˆç”¨(eq (current-buffer) (window-buffer (selected-window)))ï¼‰ã€‚

è¿™æ ·ï¼Œæ¨¡å¼è¡Œæ ¼å¼å¯ä»¥æ”¹ä¸ºï¼š

(setq-default mode-line-format
              (list
               '(:eval (when (eq (current-buffer) (window-buffer (selected-window)))
                 (propertize " ğŸ‘† " 
                   'face '(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                           :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))
               " %b " 
               "| "
               mode-line-position
               " "
               mode-line-modes
               mode-line-misc-info))


è¿™æ ·ï¼Œåœ¨æ¨¡å¼è¡Œä¸­ï¼Œåªæœ‰å½“å‰ç¼“å†²åŒºç­‰äºé€‰ä¸­çª—å£çš„ç¼“å†²åŒºæ—¶ï¼Œæ‰æ˜¾ç¤ºğŸ‘†ã€‚è€Œä¸”ä¸éœ€è¦åŠ¨æ€æ›´æ–°å‡½æ•°å’Œé’©å­ï¼Œå› ä¸ºæ¯æ¬¡æ¸²æŸ“æ¨¡å¼è¡Œæ—¶éƒ½ä¼šæ£€æŸ¥ã€‚

è€Œä¸”ï¼Œè¿™ä¸ªæ–¹æ¡ˆæ›´ç®€å•ï¼Œä¸éœ€è¦å®šä¹‰é¢å¤–çš„å‡½æ•°å’Œé’©å­ï¼

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä¿®æ”¹åŠ¨æ€æŒ‡ç¤ºå™¨ç³»ç»Ÿéƒ¨åˆ†ï¼š

;; è®¾ç½®å…¨å±€æ¨¡å¼è¡Œæ ¼å¼
(setq-default mode-line-format
              (list
               '(:eval (when (eq (current-buffer) (window-buffer (selected-window)))
                        (propertize " ğŸ‘† " 
                                    'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                                            :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))
               " %b "  ; ç¼“å†²åŒºå
               "| "
               mode-line-position
               " "
               mode-line-modes
               mode-line-misc-info))


è¿™æ ·å°±ç§»é™¤äº†ä¹‹å‰å®šä¹‰çš„imperial-current-indicatorå˜é‡ã€imperial-update-indicatorå‡½æ•°ä»¥åŠé’©å­ã€‚åŒæ—¶ï¼Œè¿™ä¸ªæ–¹å¼æ›´ç®€æ´ï¼Œä¹Ÿä¸ä¼šåœ¨åˆ‡æ¢æ—¶äº§ç”Ÿå»¶è¿Ÿã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ–°çš„æ¨¡å¼è¡Œæ ¼å¼ã€‚

ç°åœ¨ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š

(deftheme imperial-gold "å¸ç‹é‡‘ä¸»é¢˜")

;; å¾¡ç”¨é…è‰²æ–¹æ¡ˆ
(defvar imperial-gold/colors
  '((midnight-bg   . "#0a0814")    ; ç„å¤œèƒŒæ™¯
    (royal-blood   . "#c23b3b")    ; å‡½æ•°/å˜é‡å®šä¹‰è¡€è‰²
    (imperial-gold . "#e6b422")    ; æ³¨é‡Šé‡‘è‰²
    (ivory-milk    . "#fffaf0")    ; æ™®é€šå­—ç¬¦ä¹³ç™½
    (cream-highlight . "#fffee6") ; é«˜äº®ä¹³ç™½
    (gold-light    . "#ffed8a")    ; è¾…åŠ©é‡‘è‰²
    (crimson-shadow . "#3c1d22")   ; è¡€è‰²é˜´å½±
    (regal-purple  . "#5d3a9b")))   ; è£…é¥°ç´«è‰²

(custom-theme-set-faces
 'imperial-gold
 
 ;; == æ ¸å¿ƒè§„åˆ™ ==
 ;; æ™®é€šå­—ç¬¦ä¹³ç™½è‰²
 `(default ((t :background ,(cdr (assoc 'midnight-bg imperial-gold/colors))
              :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
   
 ;; == è¯­æ³•é«˜äº® ==
 ;; æ‰€æœ‰æ™®é€šå­—ç¬¦ä¹³ç™½ï¼ˆåŒ…æ‹¬å…³é”®å­—ï¼‰
 `(font-lock-keyword-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-builtin-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-constant-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-type-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 `(font-lock-doc-face ((t :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors)))))
 
 ;; å‡½æ•°/å˜é‡å®šä¹‰å¤„ - è¡€è‰²
 `(font-lock-function-name-face ((t :foreground ,(cdr (assoc 'royal-blood imperial-gold/colors)) :bold t)))
 `(font-lock-variable-name-face ((t :foreground ,(cdr (assoc 'royal-blood imperial-gold/colors)))))
 
 ;; æ³¨é‡Š - é‡‘è‰²
 `(font-lock-comment-face ((t :foreground ,(cdr (assoc 'imperial-gold imperial-gold/colors)) :italic t)))
 
 ;; == Goè¯­è¨€å¢å¼º ==
 `(go-func-name-face ((t :inherit font-lock-function-name-face))) ; Goå‡½æ•°åè¡€è‰²
 `(go-var-name-face ((t :inherit font-lock-variable-name-face))) ; Goå˜é‡åè¡€è‰²
 
 ;; == UIå…ƒç´  ==
 `(mode-line ((t :background ,(cdr (assoc 'crimson-shadow imperial-gold/colors))
                 :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))
                 :box nil
                 :height 1.05)))
 `(mode-line-inactive ((t :background "#1f1b24" 
                           :foreground "#a89159")))
 `(cursor ((t :background ,(cdr (assoc 'gold-light imperial-gold/colors)))))
 `(region ((t :background ,(cdr (assoc 'crimson-shadow imperial-gold/colors)))))
 
 ;; æ™ºèƒ½ğŸ‘†æŒ‡ç¤ºå™¨ï¼ˆå½“å‰bufferï¼‰
 `(mode-line-buffer-id ((t :weight ultra-bold :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))

;; == åŠ¨æ€ğŸ‘†æŒ‡ç¤ºå™¨ç³»ç»Ÿ ==
(setq-default mode-line-format
              (list
               '(:eval (when (eq (current-buffer) (window-buffer (selected-window)))
                        (propertize " ğŸ‘† " 
                                    'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                                            :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))
               " %b "  ; ç¼“å†²åŒºå
               "| "
               mode-line-position
               " "
               mode-line-modes
               mode-line-misc-info))

(provide-theme 'imperial-gold)


ç°åœ¨ï¼Œè¿™ä¸ªä¸»é¢˜ä»£ç åº”è¯¥å¯ä»¥å·¥ä½œäº†ã€‚æ³¨æ„ï¼Œä¿®æ”¹æ¨¡å¼è¡Œæ ¼å¼æ˜¯å…¨å±€çš„ï¼Œæ‰€ä»¥åŠ è½½è¿™ä¸ªä¸»é¢˜ä¼šæ”¹å˜æ‰€æœ‰ç¼“å†²åŒºçš„æ¨¡å¼è¡Œæ ¼å¼ã€‚å¦‚æœç”¨æˆ·åˆ‡æ¢ä¸»é¢˜ï¼Œéœ€è¦æ¢å¤åŸæ¥çš„æ¨¡å¼è¡Œæ ¼å¼ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æä¾›å¸è½½åŠŸèƒ½ï¼Œæ‰€ä»¥ç”¨æˆ·éœ€è¦è‡ªå·±å¤„ç†ã€‚

æˆ‘ä»¬å®Œæˆäº†ä¸»é¢˜å®šä¹‰ã€‚














(deftheme imperial-gold "å¸ç‹é‡‘ä¸»é¢˜")

;; å¾¡ç”¨é…è‰²æ–¹æ¡ˆ
(defvar imperial-gold/colors
  '((midnight-bg   . "#0a0814")    ; ç„å¤œèƒŒæ™¯
    (royal-blood   . "#c23b3b")    ; å‡½æ•°/å˜é‡å®šä¹‰è¡€è‰²
    (imperial-gold . "#e6b422")    ; æ³¨é‡Šé‡‘è‰²
    (ivory-milk    . "#fffaf0")    ; æ™®é€šå­—ç¬¦ä¹³ç™½
    (cream-highlight . "#fffee6") ; é«˜äº®ä¹³ç™½
    (gold-light    . "#ffed8a")    ; è¾…åŠ©é‡‘è‰²
    (crimson-shadow . "#3c1d22")   ; è¡€è‰²é˜´å½±
    (regal-purple  . "#5d3a9b"))   ; è£…é¥°ç´«è‰²

(custom-theme-set-faces
 'imperial-gold
 
 ;; == æ ¸å¿ƒè§„åˆ™ ==
 ;; æ™®é€šå­—ç¬¦ä¹³ç™½è‰²
 `(default ((t (:background ,(cdr (assoc 'midnight-bg imperial-gold/colors))
                 :foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
   
 ;; == è¯­æ³•é«˜äº® ==
 ;; æ‰€æœ‰æ™®é€šå­—ç¬¦ä¹³ç™½ï¼ˆåŒ…æ‹¬å…³é”®å­—ï¼‰
 `(font-lock-keyword-face ((t (:foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
 `(font-lock-builtin-face ((t (:foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
 `(font-lock-constant-face ((t (:foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
 `(font-lock-type-face ((t (:foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
 `(font-lock-doc-face ((t (:foreground ,(cdr (assoc 'ivory-milk imperial-gold/colors))))))
 
 ;; å‡½æ•°/å˜é‡å®šä¹‰å¤„ - è¡€è‰²
 `(font-lock-function-name-face ((t (:foreground ,(cdr (assoc 'royal-blood imperial-gold/colors)) :bold t))))
 `(font-lock-variable-name-face ((t (:foreground ,(cdr (assoc 'royal-blood imperial-gold/colors))))))
 
 ;; æ³¨é‡Š - é‡‘è‰²
 `(font-lock-comment-face ((t (:foreground ,(cdr (assoc 'imperial-gold imperial-gold/colors)) :italic t))))
 
 ;; == Goè¯­è¨€å¢å¼º ==
 `(go-func-name-face ((t (:inherit font-lock-function-name-face)))) ; Goå‡½æ•°åè¡€è‰²
 `(go-var-name-face ((t (:inherit font-lock-variable-name-face)))) ; Goå˜é‡åè¡€è‰²
 
 ;; == UIå…ƒç´  ==
 `(mode-line ((t (:background ,(cdr (assoc 'crimson-shadow imperial-gold/colors))
                  :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))
                  :box nil
                  :height 1.05))))
 `(mode-line-inactive ((t (:background "#1f1b24" 
                             :foreground "#a89159"))))
 `(cursor ((t (:background ,(cdr (assoc 'gold-light imperial-gold/colors))))))
 `(region ((t (:background ,(cdr (assoc 'crimson-shadow imperial-gold/colors))))))
 
 `(mode-line-buffer-id ((t (:weight ultra-bold :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors))))))
)

;; == åŠ¨æ€ğŸ‘†æŒ‡ç¤ºå™¨ç³»ç»Ÿ ==
(defvar imperial-current-indicator " ğŸ‘† "
  "å½“å‰ç¼“å†²åŒºæŒ‡ç¤ºå™¨ç¬¦å·")

(defun imperial-update-indicator ()
  "æ›´æ–°å½“å‰çª—å£ğŸ‘†æŒ‡ç¤ºå™¨"
  (setq imperial-current-indicator 
        (propertize " ğŸ‘† " 
                    'face `(:background ,(cdr (assoc 'royal-blood imperial-gold/colors))
                            :foreground ,(cdr (assoc 'cream-highlight imperial-gold/colors)))))
  (force-mode-line-update))

(setq-default mode-line-format
              (list
               '(:eval imperial-current-indicator) ; ğŸ‘†æŒ‡ç¤ºå™¨
               " %b "  ; ç¼“å†²åŒºå
               "| "
               mode-line-position
               " "
               mode-line-modes
               mode-line-misc-info))

(add-hook 'window-selection-change-functions #'imperial-update-indicator)
(add-hook 'buffer-list-update-hook #'imperial-update-indicator)
(imperial-update-indicator)

(provide-theme 'imperial-gold)


ä¸»é¢˜ç‰¹ç‚¹è¯¦è§£

1. ä¸¥è°¨çš„è¯­æ³•é«˜äº®è§„åˆ™

å…ƒç´ ç±»å‹	é¢œè‰²	ç¤ºä¾‹
æ™®é€šå­—ç¬¦	#fffaf0 ä¹³ç™½	func, for, return
å‡½æ•°åå®šä¹‰	#c23b3b è¡€è‰²	func main()
å˜é‡åå®šä¹‰	#c23b3b è¡€è‰²	var count int
æ³¨é‡Š	#e6b422 é‡‘è‰²	// è§£é‡Šè¯´æ˜
å­—ç¬¦ä¸²/æ•°å­—	#fffaf0 ä¹³ç™½	"hello", 42
ç±»å‹åç§°	#fffaf0 ä¹³ç™½	struct User

// æ³¨é‡Šé‡‘è‰²
package main

import "fmt"

// Userç»“æ„ä½“å®šä¹‰
type User struct {  // "User"ä¹³ç™½ (ç±»å‹å)
    Name string    // "Name"è¡€è‰² (å­—æ®µå®šä¹‰)
}

// å‡½æ•°å®šä¹‰ - è¡€è‰²
func (u *User) Greet() {
    fmt.Println("Hello,", u.Name) // "u.Name"ä¹³ç™½ (ä½¿ç”¨)
}

func main() { // "main"è¡€è‰² (å®šä¹‰)
    count := 3 // "count"è¡€è‰² (å®šä¹‰)
    
    for i := 0; i < count; i++ { // "i"è¡€è‰² (å®šä¹‰)
        fmt.Println(i) // "i"ä¹³ç™½ (ä½¿ç”¨)
    }
    
    user := User{Name: "çš‡å¸"} // "user"è¡€è‰² (å®šä¹‰)
    user.Greet() // "Greet"ä¹³ç™½ (ä½¿ç”¨)
}


2. æ™ºèƒ½ğŸ‘†çŠ¶æ€æŒ‡ç¤ºå™¨

â€¢ åœ¨å½“å‰bufferçŠ¶æ€æ æ˜¾ç¤ºé‡‘è‰²ğŸ‘†æ ‡å¿—

â€¢ åŠ¨æ€è·Ÿè¸ªæ´»åŠ¨çª—å£å˜åŒ–

â€¢ çŠ¶æ€æ æ ¼å¼ï¼š

[ğŸ‘†] main.goâ–¸â–¸ è¡Œ 42:10 (Go) [ä¸»]


3. ç‹æƒUIè®¾è®¡

â€¢ æ´»åŠ¨çŠ¶æ€æ ï¼šè¡€å½±èƒŒæ™¯ + é‡‘ä¹³ç™½æ–‡å­—

â€¢ éæ´»åŠ¨çŠ¶æ€æ ï¼šæš—ç´«èƒŒæ™¯ + å¤é‡‘è‰²æ–‡å­—

â€¢ å…‰æ ‡ï¼šäº®é‡‘è‰²æ–¹å—

â€¢ é€‰æ‹©åŒºåŸŸï¼šè¡€å½±èƒŒæ™¯

â€¢ æ•´ä½“é…è‰²ï¼š

èƒŒæ™¯: #0a0814 (ç„å¤œé»‘)
ä¸»æ–‡å­—: #fffaf0 (çš‡å®¶ä¹³ç™½)
å¼ºè°ƒè‰²: #c23b3b (è¡€è‰²)
è£…é¥°é‡‘: #e6b422 (å¸ç‹é‡‘)


å®‰è£…ä½¿ç”¨æ–¹æ³•

;; å®‰è£…ä¸»é¢˜
(require 'imperial-gold)

;; æ°¸ä¹…å¯ç”¨ä¸»é¢˜
(load-theme 'imperial-gold t)

;; Goæ¨¡å¼ç‰¹å®šä¼˜åŒ–
(add-hook 'go-mode-hook
          (lambda ()
            ;; å¢å¼ºGoå®šä¹‰é«˜äº®
            (set-face-attribute 'go-func-name-face nil 
                                 :foreground (cdr (assoc 'royal-blood imperial-gold/colors))
                                 :bold t)
            (set-face-attribute 'go-var-name-face nil 
                                :foreground (cdr (assoc 'royal-blood imperial-gold/colors)))
            
            ;; é»„é‡‘æ‹¬å·åŒ¹é…
            (use-package rainbow-delimiters
              :config
              (set-face-attribute 'rainbow-delimiters-depth-1-face nil 
                                  :foreground "#e6b422")
              (rainbow-delimiters-mode))
            
            ;; ç¡®ä¿çŠ¶æ€æŒ‡ç¤ºå™¨å·¥ä½œ
            (imperial-update-indicator)))





(defun go-generate-benchmark-internal ()
  "Generate benchmark buffer including internal functions with naming convention."
  (interactive)
  (unless (eq major-mode 'go-mode)
    (user-error "Not in Go mode"))
  
  (let* ((pkg-name (go-package-name))
         (file-name (file-name-nondirectory (buffer-file-name)))
         (bench-file-name (replace-regexp-in-string "\\.go$" "_benchmark_test.go" file-name))
         (bench-buffer (get-buffer-create bench-file-name))
         (existing-bench-funcs)
         (source-funcs)
         (new-count 0))
    
    (message "ğŸš€ Starting Go benchmark generator: %s" file-name)
    
    ;; è·å–æ‰€æœ‰å‡½æ•°ï¼ˆåŒ…æ‹¬å†…éƒ¨å‡½æ•°ï¼‰
    (save-excursion
      (goto-char (point-min))
      (message "ğŸ” Scanning all functions...")
      (while (re-search-forward "^func\\s-+\\(?:([^)]+)\\)?\\s-*\\([a-zA-Z0-9_]+\\)\\s-*(" nil t)
        (let ((func-name (match-string-no-properties 1)))
          (cond
           ((string-prefix-p "Benchmark" func-name)
            (message "   âš ï¸ Skipping benchmark function: %s" func-name))
           ((string= "main" func-name)
            (message "   âš ï¸ Skipping main function"))
           (t
            (message "   âœ… Found function: %s" func-name)
            (push (cons func-name (match-beginning 0)) source-funcs)))))
      (message "ğŸ” Found %d functions" (length source-funcs)))
    
    (setq source-funcs (nreverse source-funcs))
    
    ;; è·å–ç°æœ‰åŸºå‡†æµ‹è¯•å‡½æ•°
    (with-current-buffer bench-buffer
      (goto-char (point-min))
      (message "ğŸ” Checking existing benchmarks...")
      (while (re-search-forward "^func\\s-+\\(Benchmark_[a-zA-Z0-9_]+\\|Benchmark[A-Z][a-zA-Z0-9_]*\\)\\s-*(b \\*testing\\.B)" nil t)
        (push (match-string-no-properties 1) existing-bench-funcs)))
    
    ;; åˆ‡æ¢åˆ°åŸºå‡†æµ‹è¯•ç¼“å†²åŒº
    (switch-to-buffer bench-buffer)
    (go-mode)
    
    (message "âœï¸ Preparing benchmark file: %s" bench-file-name)
    (when (= (buffer-size) 0)
      (message "   ğŸ“„ Creating new benchmark file...")
      (insert (format "package %s\n\n" pkg-name)
              "import \"testing\"\n\n")
      (setq buffer-undo-list nil))
    
    ;; ä¸ºæ¯ä¸ªå‡½æ•°ç”ŸæˆåŸºå‡†æµ‹è¯•
    (dolist (func-record source-funcs)
      (let* ((func-name (car func-record))
             (is-internal (string-match-p "^[[:lower:]]" func-name))
             (bench-name (if is-internal 
                             (concat "Benchmark_" func-name) 
                           (concat "Benchmark" func-name)))
             (param-exist (save-excursion
                            (with-current-buffer (current-buffer)
                              (goto-char (cdr func-record))
                              (re-search-forward "func\\s-+.*?\\s-*(" (line-end-position) t)
                              (looking-at-p "[^)]+)")))))
        
        (unless (member bench-name existing-bench-funcs)
          (message "   ğŸš§ Generating benchmark for: %s â†’ %s" func-name bench-name)
          (save-excursion
            (goto-char (point-max))
            (when (> (current-column) 0) (insert "\n"))
            (insert (format "// %s benchmarks the %s function\n" bench-name func-name))
            (insert (format "func %s(b *testing.B) {\n" bench-name))
            (insert "\t// Setup benchmark environment\n")
            
            ;; æ·»åŠ å‚æ•°åˆå§‹åŒ–
            (when param-exist
              (insert (format "\t// Initialize function parameters for %s\n" func-name))
              (insert "\t// Example: param1 := value1, param2 := value2\n"))
            
            (insert "\n")
            (insert "\tb.ResetTimer()\n")
            (insert "\tb.ReportAllocs()\n")
            (insert "\tfor i := 0; i < b.N; i++ {\n")
            
            ;; å‡½æ•°è°ƒç”¨
            (insert (format "\t\t%s(", func-name))
            (when param-exist
              (insert "/* parameters */"))
            (insert ")\n")
            
            (insert "\t}\n")
            (insert "}\n\n"))
          (setq new-count (1+ new-count)))))
    
    ;; ä¿å­˜å’Œæ ¼å¼ä»£ç 
    (if (> new-count 0)
        (progn
          (message "ğŸ”§ Formatting and saving benchmark file...")
          (save-buffer)
          (gofmt)
          (message "ğŸ‰ Success! Generated %d new benchmark functions" new-count))
      (message "ğŸŒŸ Nothing new to generate. All benchmarks are up to date!"))))

;; æ·»åŠ å¿«æ·é”®ç»‘å®š
(eval-after-load 'go-mode
  '(define-key go-mode-map (kbd "C-c b") 'go-generate-benchmark-internal))


ä¸»è¦ç‰¹ç‚¹ï¼š

1. ç»Ÿä¸€çš„å‘½åè§„èŒƒï¼š

  â—¦ å†…éƒ¨å‡½æ•°ï¼šBenchmark_functionName

  â—¦ å¯¼å‡ºå‡½æ•°ï¼šBenchmarkFunctionName

  
2. ç®€åŒ–çš„å‚æ•°å¤„ç†ï¼š

  â—¦ æ™ºèƒ½æ£€æµ‹å‡½æ•°æ˜¯å¦éœ€è¦å‚æ•°

  â—¦ ä¸ºæœ‰å‚æ•°çš„å‡½æ•°æ·»åŠ åˆå§‹åŒ–æç¤º

  â—¦ ç»Ÿä¸€ä½¿ç”¨ /* parameters */ å ä½ç¬¦

3. ç²¾ç®€çš„æ¨¡æ¿ç»“æ„ï¼š

// Benchmark_functionName benchmarks the functionName function
func Benchmark_functionName(b *testing.B) {
    // Setup benchmark environment
    // Initialize function parameters for functionName
    // Example: param1 := value1, param2 := value2

    b.ResetTimer()
    b.ReportAllocs()
    for i := 0; i < b.N; i++ {
        functionName(/* parameters */)
    }
}


4. é«˜æ•ˆçš„æ£€æµ‹æœºåˆ¶ï¼š

  â—¦ ä½¿ç”¨å•ä¸€æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å‡½æ•°å®šä¹‰

  â—¦ åŒæ—¶æ£€æµ‹å¯¼å‡ºå’Œå†…éƒ¨å‡½æ•°

  â—¦ æ™ºèƒ½è·³è¿‡ main å‡½æ•°å’Œ Benchmark å‰ç¼€å‡½æ•°

ä½¿ç”¨ç¤ºä¾‹ï¼š

å¯¹äºä»¥ä¸‹å‡½æ•°ï¼š

func calculate(a int, b float64) float64 {
    // ...
}


ç”Ÿæˆçš„åŸºå‡†æµ‹è¯•ï¼š

// Benchmark_calculate benchmarks the calculate function
func Benchmark_calculate(b *testing.B) {
    // Setup benchmark environment
    // Initialize function parameters for calculate
    // Example: a := 0, b := 0.0
    
    b.ResetTimer()
    b.ReportAllocs()
    for i := 0; i < b.N; i++ {
        calculate(/* parameters */)
    }
}


ä¼˜åŒ–äº®ç‚¹ï¼š

1. æ›´æ¸…æ™°çš„åˆå§‹åŒ–æç¤ºï¼š

// Initialize function parameters for functionName
// Example: param1 := value1, param2 := value2


2. ç²¾ç®€çš„å‚æ•°å ä½ç¬¦ï¼š

functionName(/* parameters */)


3. ç»Ÿä¸€çš„ç¯å¢ƒè®¾ç½®ï¼š

// Setup benchmark environment


4. ç®€åŒ–çš„ç±»å‹å¤„ç†ï¼š

  â—¦ ä¸å†å°è¯•è§£æå…·ä½“å‚æ•°ç±»å‹

  â—¦ ä½¿ç”¨é€šç”¨å ä½ç¬¦é€‚åº”å„ç§åœºæ™¯

ä½¿ç”¨æ–¹å¼ï¼š

1. åœ¨ Go æ–‡ä»¶ä¸­æ‰“å¼€ç›®æ ‡æºæ–‡ä»¶

2. æ‰§è¡Œå‘½ä»¤ï¼š

  â—¦ M-x go-generate-benchmark-internal

  â—¦ æˆ–ä½¿ç”¨å¿«æ·é”® C-c b





(defun go-generate-test-buffer ()
  "Generate test buffer for current Go file, adding tests only for missing functions."
  (interactive)
  (unless (eq major-mode 'go-mode)
    (user-error "Not in Go mode"))
  
  (let* ((pkg-name (go-package-name))
         (file-name (file-name-nondirectory (buffer-file-name)))
         (test-file-name (replace-regexp-in-string "\\.go$" "_test.go" file-name))
         (test-buffer (get-buffer-create test-file-name))
         (existing-test-funcs)
         (source-funcs))
    
    ;; è·å–å½“å‰æ–‡ä»¶ä¸­æ‰€æœ‰å¯¼å‡ºå‡½æ•°å
    (save-excursion
      (goto-char (point-min))
      (while (re-search-forward "^func\\s-+(?\\([a-zA-Z0-9_* \t\n]*\\))?\\s-*\\([A-Z][a-zA-Z0-9_]*\\)\\s-*(" nil t)
        (let ((func-name (match-string-no-properties 2)))
          (unless (or (string-prefix-p "Test" func-name)
                      (string= "main" func-name))
            (push func-name source-funcs)))))
    
    (setq source-funcs (nreverse source-funcs))
    
    ;; è·å–æµ‹è¯•æ–‡ä»¶ä¸­å·²ç»å­˜åœ¨çš„æµ‹è¯•å‡½æ•°
    (with-current-buffer test-buffer
      (goto-char (point-min))
      (while (re-search-forward "^func\\s-+Test\\([A-Z][a-zA-Z0-9_]*\\)\\s-*(t \\*testing\\.T)" nil t)
        (push (match-string-no-properties 1) existing-test-funcs)))
    
    ;; åˆ‡æ¢åˆ°æµ‹è¯•ç¼“å†²åŒº
    (switch-to-buffer test-buffer)
    (go-mode)
    
    (when (= (buffer-size) 0)
      ;; å¦‚æœæ˜¯æ–°æ–‡ä»¶ï¼Œæ·»åŠ åŸºæœ¬æ¨¡æ¿
      (insert (format "package %s\n\n" pkg-name)
              "import \"testing\"\n\n")
      (setq buffer-undo-list nil)) ; é¿å…æŠŠæ–‡ä»¶åˆ›å»ºè®°å…¥undoåˆ—è¡¨
    
    ;; ä¸ºç¼ºå¤±çš„å‡½æ•°ç”Ÿæˆæµ‹è¯•æ¨¡æ¿
    (dolist (func-name source-funcs)
      (unless (member func-name existing-test-funcs)
        ;; åœ¨æ–‡ä»¶æœ«å°¾æ’å…¥æ–°æµ‹è¯•
        (save-excursion
          (goto-char (point-max))
          (when (> (current-column) 0) (insert "\n"))
          (insert (format "func Test%s(t *testing.T) {\n" func-name)
                  "\tt.Run(\"test-case\", func(t *testing.T) {\n"
                  "\t\t// TODO: æµ‹è¯•å®ç°\n"
                  "\t})\n"
                  "}\n\n"))))
    
    ;; ä¿å­˜å’Œæ ¼å¼ä»£ç 
    (when (buffer-modified-p)
      (save-buffer)
      (gofmt))
    (message "Generated %d new test functions" 
             (- (length source-funcs) (length existing-test-funcs)))))

;; æ·»åŠ å¿«æ·é”®
(eval-after-load 'go-mode
  '(define-key go-mode-map (kbd "C-c C-t") 'go-generate-test-buffer))


ä¸»è¦æ”¹è¿›ï¼š

1. æ™ºèƒ½æ£€æµ‹ç°æœ‰æµ‹è¯•ï¼š

  â—¦ è‡ªåŠ¨è¯†åˆ«æµ‹è¯•æ–‡ä»¶ä¸­å·²å­˜åœ¨çš„ TestXxx å‡½æ•°

  â—¦ ä»…å¯¹æºæ–‡ä»¶ä¸­æ— å¯¹åº”æµ‹è¯•çš„å¯¼å‡ºå‡½æ•°ç”Ÿæˆæ¨¡æ¿

2. éç ´åæ€§ç¼–è¾‘ï¼š

  â—¦ å¦‚æœæµ‹è¯•æ–‡ä»¶å·²å­˜åœ¨ï¼Œä¿ç•™å…¶å®Œæ•´å†…å®¹

  â—¦ ä»…åœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ æ–°æµ‹è¯•å‡½æ•°

  â—¦ ä¸ä¼šåˆ é™¤æˆ–ä¿®æ”¹å·²æœ‰å†…å®¹

3. å®‰å…¨å¤„ç†ï¼š

  â—¦ æ–°å¢ä»£ç å‰æ·»åŠ å¿…è¦ç©ºè¡Œ

  â—¦ è‡ªåŠ¨æ·»åŠ åŒ…å£°æ˜å’Œå¯¼å…¥ï¼ˆä»…å½“åˆ›å»ºæ–°æµ‹è¯•æ–‡ä»¶æ—¶ï¼‰

  â—¦ æ­£ç¡®å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆç©ºæ–‡ä»¶ã€å•è¡Œæ–‡ä»¶ç­‰ï¼‰

4. ç”¨æˆ·åé¦ˆï¼š

  â—¦ æ˜¾ç¤ºç”Ÿæˆçš„æ–°æµ‹è¯•å‡½æ•°æ•°é‡

  â—¦ ä¿æŒåŸæœ‰çš„åŒ…åæ£€æµ‹å’Œå‡½æ•°è¿‡æ»¤é€»è¾‘

ä½¿ç”¨åœºæ™¯ï¼š

1. å…¨æ–°æµ‹è¯•æ–‡ä»¶ï¼šè¡Œä¸ºä¸åŸå‡½æ•°ç›¸åŒï¼Œç”Ÿæˆæ‰€æœ‰å‡½æ•°çš„æµ‹è¯•æ¨¡æ¿

2. å·²æœ‰éƒ¨åˆ†æµ‹è¯•çš„æ–‡ä»¶ï¼šä»…è¡¥å……ç¼ºå¤±å‡½æ•°çš„æµ‹è¯•æ¡†æ¶

3. æµ‹è¯•æ–‡ä»¶å®Œæ•´æ—¶ï¼šæ˜¾ç¤º "Generated 0 new test functions" æç¤º

æ³¨æ„è¦ç‚¹ï¼š

1. å‡½æ•°ååŒ¹é…éµå¾ª Go è§„èŒƒï¼š

  â—¦ æºå‡½æ•°ï¼šFuncNameï¼ˆå¤§å†™å¼€å¤´ï¼‰

  â—¦ æµ‹è¯•å‡½æ•°ï¼šTestFuncNameï¼ˆç²¾ç¡®åŒ¹é…ï¼‰

2. å½“æµ‹è¯•å‡½æ•°ä½¿ç”¨ä¸åŒå‘½åè§„èŒƒæ—¶ï¼ˆå¦‚ Test_funcNameï¼‰ï¼Œå°†è¢«è§†ä¸ºç¼ºå¤±æµ‹è¯•

3. ä½¿ç”¨ go-package-name è·å–æ­£ç¡®çš„åŒ…åï¼Œéœ€è¦å®‰è£…å¹¶é…ç½® go-mode

import (
	"bufio"
	"flag"
	"fmt"
	"os"
)

// Model: Business logic for text processing
type TextProcessor struct{}

func (t *TextProcessor) SplitLine(line string, maxLength int) []string {
	var segments []string
	runes := []rune(line)

	for len(runes) > maxLength {
		if len(runes) >= maxLength+1 {
			s := string(runes[maxLength-1 : maxLength+1])
			if s == "ç¾é‡‘" || s == "ç¾å…ƒ" {
				segments = append(segments, string(runes[:maxLength-1]))
				runes = runes[maxLength-1:]
			} else {
				segments = append(segments, string(runes[:maxLength]))
				runes = runes[maxLength:]
			}
		} else {
			break
		}
	}
	
	if len(runes) > 0 {
		segments = append(segments, string(runes))
	}
	return segments
}

// ViewModel: Coordinates data between Model and View
type AppViewModel struct {
	InputFile  string
	OutputFile string
	processor  TextProcessor
}

func (vm *AppViewModel) Process() error {
	// Set up input source
	var input *os.File
	if vm.InputFile != "" {
		file, err := os.Open(vm.InputFile)
		if err != nil {
			return err
		}
		defer file.Close()
		input = file
	} else {
		input = os.Stdin
	}

	// Set up output destination
	var output *os.File
	if vm.OutputFile != "" {
		file, err := os.Create(vm.OutputFile)
		if err != nil {
			return err
		}
		defer file.Close()
		output = file
	} else {
		output = os.Stdout
	}

	// Process input line by line
	scanner := bufio.NewScanner(input)
	for scanner.Scan() {
		segments := vm.processor.SplitLine(scanner.Text(), 80)
		for _, segment := range segments {
			fmt.Fprintln(output, segment)
		}
	}

	return scanner.Err()
}

// View: Handles user interaction and presentation
func showHelp() {
	fmt.Println("Usage: line_splitter [options]")
	fmt.Println("Options:")
	flag.PrintDefaults()
	fmt.Println("\nSplits text lines to 80 chars max, preventing currency symbol splitting")
}

func main() {
	// Parse command line flags
	inputFile := flag.String("i", "", "Input file (default: STDIN)")
	outputFile := flag.String("o", "", "Output file (default: STDOUT)")
	showHelpFlag := flag.Bool("h", false, "Show help message")
	flag.Parse()

	// Handle help request
	if *showHelpFlag {
		showHelp()
		return
	}

	// Initialize and run ViewModel
	viewModel := &AppViewModel{
		InputFile:  *inputFile,
		OutputFile: *outputFile,
	}
	
	if err := viewModel.Process(); err != nil {
		fmt.Fprintf(os.Stderr, "Error: %v\n", err)
		os.Exit(1)
	}
}





;; æ™ºèƒ½å•è¯è½¬Goå‡½æ•°å£°æ˜ï¼ˆæ”¯æŒæ™®é€š/å¯è§†åŒ–æ¨¡å¼ï¼‰
(defun evil-go-expand-words-to-funcs (&optional beg end)
  "å°†å½“å‰è¡Œæˆ–é€‰ä¸­åŒºåŸŸçš„å•è¯è½¬ä¸ºGoå‡½æ•°å£°æ˜
æ™®é€šæ¨¡å¼: å¤„ç†æ•´è¡Œ  å¯è§†åŒ–æ¨¡å¼: å¤„ç†é€‰ä¸­åŒºåŸŸ
ç¤ºä¾‹: 'a b' -> 'func a(){} func b(){}'"
  (interactive
   (if (use-region-p) (list (region-beginning) (region-end))
     (list (line-beginning-position) (line-end-position))))
  
  (unless (derived-mode-p 'go-mode)
    (user-error "æ­¤å‘½ä»¤åªèƒ½åœ¨Goæ¨¡å¼ä¸‹ä½¿ç”¨"))
  
  (let* ((text (string-trim (buffer-substring-no-properties beg end)))
         ;; æ™ºèƒ½æå–å•è¯ï¼ˆè¿‡æ»¤æ ‡ç‚¹ç¬¦å·ï¼‰
         (words (seq-remove (lambda (w) (< (length w) 1))
                           (split-string text "[^[:alnum:]_]+" t))))
    
    (when (null words)
      (user-error "æœªå‘ç°æœ‰æ•ˆå•è¯"))
    
    ;; åˆ é™¤åŸæœ‰å†…å®¹å¹¶æ’å…¥æ–°å‡½æ•°
    (delete-region beg end)
    (cl-loop for word in words
             for i from 1 to (length words)
             do (progn
                  (insert (format "func %s(){\n    // è‡ªåŠ¨ç”Ÿæˆ %d\n}\n" word i))
                  ;; è‡ªåŠ¨ç¼©è¿›æ–°ä»£ç 
                  (indent-according-to-mode)))
    
    ;; å®šä½åˆ°ç¬¬ä¸€ä¸ªå‡½æ•°ä½“å†…éƒ¨
    (goto-char (line-beginning-position))
    (re-search-forward "{")
    (backward-char)
    (evil-insert-state)
    (message "åˆ›å»º %d ä¸ªGoå‡½æ•°" (length words))))

;; åŒæ—¶hook evilå’Œgoæ¨¡å¼
(with-eval-after-load 'evil
  (with-eval-after-load 'go-mode
    (add-hook 'go-mode-hook
              (lambda ()
                ;; ä¸ºæ‰€æœ‰çŠ¶æ€ç»‘å®šfwå‘½ä»¤
                (dolist (state '(normal visual))
                  (evil-define-key state go-mode-map
                    "fw" #'evil-go-expand-words-to-funcs)))
                
                ;; æ·»åŠ èœå•é¡¹ï¼ˆéœ€å®‰è£…which-keyï¼‰
                (when (fboundp 'which-key-add-key-based-replacements)
                  (which-key-add-key-based-replacements
                   "fw" "å•è¯è½¬å‡½æ•°å£°æ˜")))))


1. æ™ºèƒ½å•è¯è¯†åˆ«ï¼š

  â—¦ è‡ªåŠ¨è¿‡æ»¤æ ‡ç‚¹ç¬¦å·ï¼Œå¤„ç† a, b-c (d) ç­‰å¤æ‚æƒ…å†µ

  â—¦ è‡ªåŠ¨è·³è¿‡ç©ºå•è¯å’Œéæ³•æ ‡è¯†ç¬¦

2. ç”Ÿæˆä¼˜åŒ–æ ¼å¼ï¼š

func a(){
  // è‡ªåŠ¨ç”Ÿæˆ 1
}
func b(){
  // è‡ªåŠ¨ç”Ÿæˆ 2
}



4. å¤šæ¨¡å¼æ”¯æŒï¼š

  â—¦ æ™®é€šæ¨¡å¼ï¼šå¤„ç†æ•´è¡Œå†…å®¹

  â—¦ å¯è§†åŒ–æ¨¡å¼ï¼šå¤„ç†é€‰ä¸­æ–‡æœ¬åŒºåŸŸ

  â—¦ è‡ªåŠ¨é€‚åº”å„ç§ä»£ç ä½ç½®ï¼ˆåŒ…çº§/å‡½æ•°å†…ç­‰ï¼‰

é«˜çº§é…ç½®é€‰é¡¹ï¼š

;; è‡ªå®šä¹‰å‡½æ•°æ¨¡æ¿ï¼ˆåœ¨defunå‰è®¾ç½®ï¼‰
(setq go-func-template "
// %s å‡½æ•°è¯´æ˜
func %s(%s) %s {
    %s
    return nil
}")

;; æ·»åŠ ç±»å‹æç¤ºå’Œå‚æ•°
(defun my-enhance-go-template ()
  (setq go-func-template "
// %s è‡ªåŠ¨ç”Ÿæˆå‡½æ•°
func %s(%s) error {
    %s
    return fmt.Errorf(\"æœªå®ç°\")
}"))
(add-hook 'go-mode-hook #'my-enhance-go-template)


ä½¿ç”¨æ–¹æ³•ï¼š

1. æ™®é€šæ¨¡å¼ï¼š

// è¾“å…¥å¹¶æ‰§è¡Œ fw
Save Load
// è½¬æ¢ä¸º
func Save(){
    // è‡ªåŠ¨ç”Ÿæˆ 1
}
func Load(){
    // è‡ªåŠ¨ç”Ÿæˆ 2
}


2. å¯è§†åŒ–æ¨¡å¼ï¼š

// é€‰ä¸­åæ‰§è¡Œ fw
var (create update delete) // é€‰ä¸­ create update delete
// è½¬æ¢ä¸º
var (func create(){
       // è‡ªåŠ¨ç”Ÿæˆ 1
     }
     func update(){
       // è‡ªåŠ¨ç”Ÿæˆ 2
     }
     func delete(){
       // è‡ªåŠ¨ç”Ÿæˆ 3
     })


æ­¤å®ç°åŒ…å«æ™ºèƒ½é”™è¯¯å¤„ç†ã€è¯­æ³•æç¤ºï¼Œå¹¶ä¸ which-key é›†æˆï¼Œä¼šåœ¨åº•éƒ¨æ˜¾ç¤º fw -> å•è¯è½¬å‡½æ•°å£°æ˜











	// è§£æå‘½ä»¤è¡Œå‚æ•°
	dirPath := "."
	parseArgs(os.Args[1:], &config, &dirPath)

	fmt.Printf("\n%s===== æ‰¹é‡é‡å‘½åé…ç½® =====%s\n", ColorCyan, ColorReset)
	fmt.Printf("ç›®æ ‡ç›®å½•: %s%s%s\n", ColorYellow, dirPath, ColorReset)
	fmt.Printf("èµ·å§‹ç¼–å·: %s%d%s\n", ColorGreen, config.StartNum, ColorReset)
	fmt.Printf("æ•°å­—ä½æ•°: %s%d%s\n", ColorGreen, config.TotalDigit, ColorReset)
	fmt.Printf("æ–‡ä»¶å‰ç¼€: \"%s%s%s\"\n", ColorGreen, config.Prefix, ColorReset)
	fmt.Printf("æ–‡ä»¶åç¼€: \"%s%s%s\"\n", ColorGreen, config.Suffix, ColorReset)
	fmt.Printf("æ“ä½œæ¨¡å¼: %s\n", getModeText(config.DryRun, config.Confirm))
	fmt.Println()

	// æ‰§è¡Œé‡å‘½åæ“ä½œ
	count, err := batchRename(dirPath, config)
	if err != nil {
		fmt.Printf("%sé”™è¯¯: %v%s\n", ColorRed, err, ColorReset)
		os.Exit(1)
	}

	fmt.Printf("\n%sæ“ä½œå®Œæˆ! æˆåŠŸå¤„ç† %d ä¸ªæ–‡ä»¶%s\n", ColorGreen, count, ColorReset)
}

func parseArgs(args []string, config *RenameConfig, dirPath *string) {
	for i := 0; i < len(args); i++ {
		arg := args[i]
		switch arg {
		case "-s", "--start":
			i++
			if i < len(args) {
				num, err := strconv.Atoi(args[i])
				if err == nil && num >= 0 {
					config.StartNum = num
				}
			}
		case "-d", "--digits":
			i++
			if i < len(args) {
				digits, err := strconv.Atoi(args[i])
				if err == nil && digits > 0 && digits <= 12 {
					config.TotalDigit = digits
				}
			}
		case "-p", "--prefix":
			i++
			if i < len(args) {
				config.Prefix = args[i]
			}
		case "-x", "--suffix":
			i++
			if i < len(args) {
				config.Suffix = args[i]
			}
		case "-f", "--force":
			config.DryRun = false
			config.Confirm = true
		case "-y", "--yes":
			config.Confirm = true
		case "-h", "--help":
			printHelp()
			os.Exit(0)
		default:
			// æ£€æŸ¥æ˜¯å¦æ˜¯ç›®å½•
			if stat, err := os.Stat(arg); err == nil && stat.IsDir() {
				*dirPath = arg
			} else if !strings.HasPrefix(arg, "-") {
				fmt.Printf("%så¿½ç•¥æ— æ³•è¯†åˆ«çš„å‚æ•°: %s%s\n", ColorYellow, arg, ColorReset)
			}
		}
	}
}

func getModeText(dryRun, confirm bool) string {
	if dryRun {
		return ColorYellow + "é¢„è§ˆæ¨¡å¼(ä¸ä¿®æ”¹æ–‡ä»¶)" + ColorReset
	}
	if confirm {
		return ColorRed + "æ‰§è¡Œæ¨¡å¼(ç›´æ¥ä¿®æ”¹æ–‡ä»¶)" + ColorReset
	}
	return ColorYellow + "éœ€è¦ç¡®è®¤æ‰§è¡Œ" + ColorReset
}

func batchRename(dirPath string, config RenameConfig) (int, error) {
	// è¯»å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
	entries, err := os.ReadDir(dirPath)
	if err != nil {
		return 0, err
	}

	// ç­›é€‰æœ‰æ•ˆæ–‡ä»¶å¹¶æŒ‰æ–‡ä»¶åæ’åº
	var files []os.FileInfo
	for _, entry := range entries {
		if entry.IsDir() {
			continue
		}
		info, err := entry.Info()
		if err != nil {
			continue
		}
		// è·³è¿‡éšè—æ–‡ä»¶
		if strings.HasPrefix(info.Name(), ".") {
			continue
		}
		files = append(files, info)
	}

	// æŒ‰æ–‡ä»¶åæ’åº
	sort.Slice(files, func(i, j int) bool {
		return files[i].Name() < files[j].Name()
	})

	// æ£€æŸ¥æ˜¯å¦æœ‰æ“ä½œéœ€è¦ç¡®è®¤
	if !config.DryRun && !config.Confirm {
		fmt.Printf("%sè­¦å‘Š: å³å°†ä¿®æ”¹ %d ä¸ªæ–‡ä»¶%s\n", ColorRed, len(files), ColorReset)
		fmt.Print("æ˜¯å¦ç¡®è®¤æ‰§è¡Œ? (y/N): ")

		var response string
		_, err := fmt.Scanln(&response)
		if err != nil || (response != "y" && response != "Y") {
			fmt.Printf("%sæ“ä½œå·²å–æ¶ˆ%s\n", ColorYellow, ColorReset)
			os.Exit(0)
		}
		fmt.Println()
	}

	// æ‰§è¡Œé‡å‘½å
	count := 0
	currentNum := config.StartNum
	for _, file := range files {
		originalPath := filepath.Join(dirPath, file.Name())
		ext := filepath.Ext(file.Name())
		base := strings.TrimSuffix(file.Name(), ext)

		// ç”Ÿæˆæ–°çš„åºå·
		newNum := strconv.Itoa(currentNum)
		if len(newNum) < config.TotalDigit {
			newNum = fmt.Sprintf("%0*d", config.TotalDigit, currentNum)
		} else if len(newNum) > config.TotalDigit {
			newNum = newNum[:config.TotalDigit]
		}

		// æ„å»ºæ–°æ–‡ä»¶å
		newName := fmt.Sprintf("%s%s%s%s", config.Prefix, newNum, config.Suffix, ext)
		newPath := filepath.Join(dirPath, newName)

		// é¢„è§ˆ/æ‰§è¡Œ
		if config.DryRun {
			fmt.Printf("%sé¢„è§ˆ: %s%s\n", ColorCyan, file.Name(), ColorReset)
			fmt.Printf("   â†’ %s%s%s\n\n", ColorGreen, newName, ColorReset)
		} else {
			err := os.Rename(originalPath, newPath)
			if err != nil {
				fmt.Printf("%sé”™è¯¯: é‡å‘½å %s â†’ %s: %v%s\n", 
					ColorRed, originalPath, newPath, err, ColorReset)
			} else {
				fmt.Printf("å·²é‡å‘½å: %s%s%s â†’ %s%s%s\n", 
					ColorYellow, file.Name(), ColorReset,
					ColorGreen, newName, ColorReset)
			}
		}

		count++
		currentNum++
	}

	return count, nil
}

func printHelp() {
	fmt.Printf("%sæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·%s\n", ColorGreen, ColorReset)
	fmt.Printf("ç‰ˆæœ¬: 1.0 | ä½œè€…: silver| ç”¨é€”: æ‰¹é‡é‡å‘½åæ•°å­—åºåˆ—æ–‡ä»¶\n\n")
	fmt.Printf("%sç”¨æ³•:%s\n", ColorCyan, ColorReset)
	fmt.Println("  rename [é€‰é¡¹] [ç›®å½•]")
	fmt.Println("\né€‰é¡¹:")
	fmt.Println("  -s, --start <æ•°å€¼>   è®¾ç½®èµ·å§‹ç¼–å· (é»˜è®¤: 1)")
	fmt.Println("  -d, --digits <ä½æ•°>  è®¾ç½®æ•°å­—æ€»ä½æ•° (é»˜è®¤: 6)")
	fmt.Println("  -p, --prefix <å‰ç¼€>  è®¾ç½®æ–‡ä»¶åå‰ç¼€")
	fmt.Println("  -x, --suffix <åç¼€>  è®¾ç½®æ–‡ä»¶ååç¼€")
	fmt.Println("  -f, --force          å¼ºåˆ¶æ‰§è¡Œä¸ç¡®è®¤")
	fmt.Println("  -y, --yes            è‡ªåŠ¨ç¡®è®¤æ‰§è¡Œ")
	fmt.Println("  -h, --help            æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯")
	fmt.Printf("\n%sç¤ºä¾‹:%s\n", ColorCyan, ColorReset)
	fmt.Println("  rename -s 100 -d 8 -p \"img_\"   # èµ·å§‹ç¼–å·100, 8ä½æ•°å­—, å‰ç¼€img_")
	fmt.Println("  rename -p \"doc_\" -x \"_v2\"     # æ·»åŠ doc_å‰ç¼€å’Œ_v2åç¼€")
	fmt.Println("  rename /path/to/files          # æŒ‡å®šç›®æ ‡ç›®å½•")
	fmt.Printf("\n%sæ³¨æ„:%s\n", ColorYellow, ColorReset)
	fmt.Println("  - é»˜è®¤æ¨¡å¼ä¸ºé¢„è§ˆ(dry-run), ä»…æ˜¾ç¤ºå˜æ›´è®¡åˆ’")
	fmt.Println("  - ä½¿ç”¨ -f æˆ– -y é€‰é¡¹åæ‰ä¼šå®é™…ä¿®æ”¹æ–‡ä»¶")
	fmt.Println("  - è¯·å…ˆåœ¨æµ‹è¯•ç›®å½•è¯•ç”¨ç¡®è®¤æ•ˆæœåå†å¯¹é‡è¦æ–‡ä»¶æ“ä½œ")
}


åŠŸèƒ½ç‰¹æ€§

1. é‡å‘½åé€‰é¡¹ï¼š

  â—¦ è‡ªå®šä¹‰èµ·å§‹ç¼–å·

  â—¦ è®¾ç½®æ•°å­—ä½æ•°ï¼ˆä¸è¶³æ—¶è‡ªåŠ¨è¡¥é›¶ï¼‰

  â—¦ æ·»åŠ å‰ç¼€/åç¼€

  â—¦ ä¿æŒæ–‡ä»¶æ‰©å±•åä¸å˜

2. å®‰å…¨æœºåˆ¶ï¼š

  â—¦ é»˜è®¤é¢„è§ˆæ¨¡å¼ï¼ˆdry-runï¼‰ï¼Œä¸å®é™…ä¿®æ”¹æ–‡ä»¶

  â—¦ éœ€è¦ç¡®è®¤åæ‰ä¼šæ‰§è¡Œä¿®æ”¹

  â—¦ ï¼ˆ-fé€‰é¡¹ï¼‰

3. æ™ºèƒ½æ–‡ä»¶å¤„ç†ï¼š

  â—¦ è‡ªåŠ¨è¿‡æ»¤ç›®å½•å’Œéšè—æ–‡ä»¶

  â—¦ æŒ‰æ–‡ä»¶åæ’åºå¤„ç†

  â—¦ æ–‡ä»¶æ‰©å±•åè‡ªåŠ¨ä¿ç•™



3. è¿è¡Œï¼ˆLinux/macOSå¯èƒ½éœ€è¦åŠ æ‰§è¡Œæƒé™ï¼‰ï¼š

./renamer [é€‰é¡¹] [ç›®å½•]


å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹

åŸºç¡€é¢„è§ˆï¼ˆä¸å®é™…ä¿®æ”¹ï¼‰ï¼š

./renamer


æŒ‡å®šç›®å½•å¤„ç†ï¼š

./renamer /path/to/files


å®Œæ•´é‡å‘½åé…ç½®ï¼š

./renamer -s 100 -d 8 -p "img_" -x "_backup"


å®é™…æ‰§è¡Œé‡å‘½åï¼š

./renamer -f -s 1 -d 5 -p "photo_"


å‚æ•°é€‰é¡¹

å‚æ•°	ç®€å†™	è¯´æ˜	é»˜è®¤å€¼
--start	-s	èµ·å§‹ç¼–å·	1
--digits	-d	æ•°å­—æ€»ä½æ•°	6
--prefix	-p	æ–‡ä»¶åå‰ç¼€	ç©º
--suffix	-x	æ–‡ä»¶ååç¼€	ç©º
--force	-f	ï¼ˆä¸ç¡®è®¤ï¼‰	-
--yes	-y	è‡ªåŠ¨ç¡®è®¤æ‰§è¡Œ	-
--help	-h	æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯	-

æ³¨æ„äº‹é¡¹

1. è¯·å§‹ç»ˆå…ˆåœ¨æµ‹è¯•ç›®å½•é¢„è§ˆæ•ˆæœåå†è¿›è¡Œå®é™…ä¿®æ”¹

2. ç¨‹åºä¼šè‡ªåŠ¨è·³è¿‡ç›®å½•å’Œéšè—æ–‡ä»¶ï¼ˆä»¥ç‚¹å¼€å¤´çš„æ–‡ä»¶ï¼‰

3. æ•°å­—ä½æ•°è¶…è¿‡æŒ‡å®šå€¼æ—¶ä¼šè¢«æˆªæ–­

4. å»ºè®®ä½¿ç”¨-fé€‰é¡¹å‰å¤‡ä»½é‡è¦æ–‡ä»¶

5. åœ¨å¤„ç†å¤§é‡æ–‡ä»¶æ—¶ï¼Œç¡®ä¿æ–‡ä»¶ç³»ç»Ÿæ”¯æŒæ–°æ–‡ä»¶åæ ¼å¼

ğŸ’¡ æç¤ºï¼šè¿è¡Œæ—¶ä¼šæ˜¾ç¤ºé¢œè‰²æ ‡è¯†çš„æ“ä½œé¢„è§ˆï¼Œç»¿è‰²ä»£è¡¨æ–°æ–‡ä»¶åï¼Œé»„è‰²ä»£è¡¨åŸæ–‡ä»¶åï¼Œçº¢è‰²è¡¨ç¤ºè­¦å‘Šæˆ–é”™è¯¯ã€‚












expand-function.el - Emacs æ‰©å±•å‡½æ•°


;;; expand-function.el --- Quickly expand words to function definitions

;; Copyright (C) 2023 Your Name

;; Author: Your Name <your@email.com>
;; URL: https://github.com/yourname/expand-function
;; Version: 1.0.0
;; Package-Requires: ((emacs "27.1") (evil "1.0"))
;; Keywords: productivity, programming, functions

;;; Commentary:
;; This plugin allows you to quickly expand words under cursor to complete
;; function definitions in various programming languages with proper syntax.

;;; Usage:
;; (require 'expand-function)
;; (expand-function-setup)

;; Then in any programming mode:
;;   - Position cursor on a word and press "fw" to expand it to a function
;;   - Use prefix arguments (C-2 fw) to expand multiple words
;;   - Or visually select words and press "fw" to expand all selected

;;; Code:

(require 'evil)

(defgroup expand-function nil
  "Quickly expand words to function definitions."
  :group 'programming
  :prefix "expand-function-")

(defcustom expand-function-key "fw"
  "Key sequence to bind for expand function command."
  :type 'string
  :group 'expand-function)

(defcustom expand-function-python-indent 4
  "Python function body indentation level."
  :type 'integer
  :group 'expand-function)

(defcustom expand-function-other-indent 4
  "Default function body indentation level for other languages."
  :type 'integer
  :group 'expand-function)

(defcustom expand-function-go-param-style "()"
  "Parameter style for Go functions."
  :type 'string
  :group 'expand-function
  :options '("()" "(arg string)"))

(defcustom expand-function-c-param-style "void"
  "Parameter style for C functions."
  :type 'string
  :group 'expand-function
  :options '("void" "int argc, char *argv[]"))

(defvar expand-function--templates
  `((c-mode . ,(lambda (word indent)
                 (format "%s%s %s(%s)\n%s{\n%s%s\n%s}\n\n"
                         indent (if (derived-mode-p 'c++-mode) "" "void")
                         word expand-function-c-param-style
                         indent indent (make-string expand-function-other-indent ? ) indent)))
    (zig-mode . ,(lambda (word indent)
                   (format "%sfn %s() void {\n%s%s\n%s}\n\n"
                           indent word indent 
                           (make-string expand-function-other-indent ? ) indent)))
    (go-mode . ,(lambda (word indent)
                  (format "%sfunc %s%s {\n%s%s\n%s}\n\n"
                          indent word expand-function-go-param-style
                          indent (make-string expand-function-other-indent ? ) indent)))
    (python-mode . ,(lambda (word indent)
                      (format "%sdef %s():\n%s%s\n"
                              indent word indent 
                              (make-string expand-function-python-indent ? ))))
    (default . ,(lambda (word indent)
                  (format "%sfunction %s() {\n%s%s\n%s}\n\n"
                          indent word indent 
                          (make-string expand-function-other-indent ? ) indent))))
  "Templates for various programming languages.")

;;;###autoload
(defun expand-function-expand-n-words (n)
  "Expand the next N words into separate function definitions."
  (interactive "p")
  (let* ((indent (make-string (current-indentation) ? ))
         (start (point))
         words
         bounds
         (mode (cond ((derived-mode-p 'c-mode 'c++-mode 'c-or-c++-mode) 'c-mode)
                     ((derived-mode-p 'zig-mode) 'zig-mode)
                     ((derived-mode-p 'go-mode) 'go-mode)
                     ((derived-mode-p 'python-mode) 'python-mode)
                     (t 'default))))
    
    ;; Collect N words
    (dotimes (i n)
      (when (re-search-forward "\\_<\\w+\\_>" nil t)
        (push (match-string 0) words)
        (setq bounds (or bounds (cons start (point)))))
      (forward-word 1))
    
    (if (null words)
        (user-error "No words found at point")
      
      ;; Delete original words
      (delete-region (car bounds) (cdr bounds))
      (setq words (nreverse words))
      
      ;; Insert function definitions
      (let ((template-fn (cdr (assoc mode expand-function--templates)))
            (first t))
        (dolist (word words)
          (insert (funcall template-fn word indent))
          (when first
            (backward-char)  ; Position for editing
            (search-backward "{")
            (unless (derived-mode-p 'python-mode) 
              (forward-char 1))
            (setq first nil)))
        (search-backward "{")
        (if (derived-mode-p 'python-mode)
            (forward-line 1)
          (forward-char 1))
        (indent-according-to-mode)
        (evil-insert-state)))))

;;;###autoload
(defun expand-function-expand-region ()
  "Expand selected words in visual mode to function definitions."
  (interactive)
  (if (not (evil-visual-state-p))
      (user-error "Not in visual mode")
    (let ((n (count-words-region (region-beginning) (region-end))))
      (evil-normal-state)
      (expand-function-expand-n-words n))))

;;;###autoload
(defun expand-function-setup ()
  "Set up keybindings for expand-function."
  (interactive)
  
  (dolist (hook '(prog-mode-hook
                  c-mode-common-hook
                  zig-mode-hook
                  go-mode-hook
                  python-mode-hook
                  js-mode-hook
                  typescript-mode-hook
                  ruby-mode-hook
                  rust-mode-hook
                  php-mode-hook
                  lua-mode-hook
                  java-mode-hook
                  emacs-lisp-mode-hook
                  clojure-mode-hook
                  scheme-mode-hook))
    (add-hook hook #'expand-function-mode))
  
  (expand-function-mode 1))

(define-minor-mode expand-function-mode
  "Minor mode for expanding words to function definitions."
  :keymap `((,(kbd expand-function-key) . expand-function-expand-n-words))
  :group 'expand-function
  :global nil
  (if expand-function-mode
      (progn
        (add-hook 'evil-visual-state-entry-hook 
                  (lambda ()
                    (local-set-key (kbd expand-function-key) 
                                   #'expand-function-expand-region)) nil t)
        (message "expand-function mode enabled"))
    (progn
      (remove-hook 'evil-visual-state-entry-hook 
                   (lambda ()
                     (local-set-key (kbd expand-function-key) 
                                    #'expand-function-expand-region)) t)
      (message "expand-function mode disabled"))))

(provide 'expand-function)
;;; expand-function.el ends here


å®‰è£…æ–¹æ³•

1. æ‰‹åŠ¨å®‰è£…:

  â—¦ å°†ä¸Šè¿°ä»£ç ä¿å­˜ä¸º expand-function.el

  â—¦ æ·»åŠ åˆ°åŠ è½½è·¯å¾„å¹¶æ·»åŠ è‡³å¯åŠ¨æ–‡ä»¶:

(add-to-list 'load-path "/path/to/plugin")
(require 'expand-function)
(expand-function-setup)


2. ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…:

  â—¦ é€šè¿‡ MELPA (éœ€å…ˆé…ç½® MELPA æº)

M-x package-install RET expand-function RET


  â—¦ å®‰è£…åé…ç½®:

(require 'expand-function)
(expand-function-setup)


åŸºæœ¬ç”¨æ³•

1. å•ä¸ªå‡½æ•°æ‰©å±•:

  â—¦ å°†å…‰æ ‡æ”¾åœ¨å•è¯ä¸Š

  â—¦ æŒ‰ä¸‹ fw

  â—¦ æ’ä»¶ä¼šè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„å‡½æ•°å®šä¹‰

2. å¤šä¸ªå‡½æ•°æ‰©å±•:

  â—¦ ä½¿ç”¨æ•°å­—å‰ç¼€æŒ‡å®šå•è¯æ•°é‡ï¼Œä¾‹å¦‚ï¼š

C-3 fw


ä¼šæ‰©å±•æ¥ä¸‹æ¥çš„3ä¸ªå•è¯ä¸º3ä¸ªå‡½æ•°å®šä¹‰

3. å¯è§†æ¨¡å¼æ‰©å±•:

  â—¦ é€‰æ‹©å¤šä¸ªå•è¯

  â—¦ æŒ‰ä¸‹ fw

  â—¦ æ‰€æœ‰é€‰ä¸­çš„å•è¯éƒ½ä¼šè¢«æ‰©å±•ä¸ºå‡½æ•°å®šä¹‰

æ”¯æŒçš„è¯­è¨€

è¯­è¨€	ç”Ÿæˆæ ¼å¼	ä¾‹å­
C/C++	void func(void) {...}	C é£æ ¼å‡½æ•°
Go	func name() {...}	Go å‡½æ•°
Python	def name(): ...	Python å‡½æ•°
Zig	fn name() void {...}	Zig å‡½æ•°
JavaScript	function name() {...}	JS å‡½æ•°
TypeScript	function name() {...}	TS å‡½æ•°
Rust	fn name() {...}	Rust å‡½æ•°
Java	function name() {...}	é»˜è®¤
Ruby	function name() {...}	é»˜è®¤
PHP	function name() {...}	é»˜è®¤
Lua	function name() {...}	é»˜è®¤
Emacs Lisp	(defun name () ...)	Emacs Lisp å‡½æ•°

è‡ªå®šä¹‰é€‰é¡¹

1. å˜é‡ï¼šexpand-function-key (é»˜è®¤ "fw")

  â—¦ ä¿®æ”¹è§¦å‘æŒ‰é”®ç»‘å®š

2. å˜é‡ï¼šexpand-function-python-indent (é»˜è®¤ 4)

  â—¦ Python å‡½æ•°ä½“çš„ç¼©è¿›ç©ºæ ¼æ•°

3. å˜é‡ï¼šexpand-function-other-indent (é»˜è®¤ 4)

  â—¦ å…¶ä»–è¯­è¨€å‡½æ•°ä½“çš„ç¼©è¿›ç©ºæ ¼æ•°

4. å˜é‡ï¼šexpand-function-go-param-style (é»˜è®¤ "()")

  â—¦ Go å‡½æ•°å‚æ•°æ ¼å¼ï¼Œå¯è®¾ä¸º "(arg string)" ç­‰

5. å˜é‡ï¼šexpand-function-c-param-style (é»˜è®¤ "void")

  â—¦ C å‡½æ•°å‚æ•°æ ¼å¼ï¼Œå¯è®¾ä¸º "int argc, char *argv[]" ç­‰

ç‰¹ç‚¹

1. æ™ºèƒ½è¯­è¨€æ£€æµ‹ï¼š

  â—¦ è‡ªåŠ¨è¯†åˆ«å½“å‰è¯­è¨€æ¨¡å¼

  â—¦ ç”Ÿæˆç¬¦åˆè¯­è¨€è§„èŒƒçš„å‡½æ•°å®šä¹‰

2. ç²¾ç¡®çš„æ ¼å¼åŒ–ï¼š

  â—¦ ä¿ç•™å½“å‰ç¼©è¿›çº§åˆ«

  â—¦ å‡½æ•°ä½“è‡ªåŠ¨ç¼©è¿›

  â—¦ å‡½æ•°ä¹‹é—´è‡ªåŠ¨æ’å…¥ç©ºè¡Œ

3. ä¼˜åŒ–çš„ç”¨æˆ·ä½“éªŒï¼š

  â—¦ å…‰æ ‡è‡ªåŠ¨å®šä½åœ¨ç¬¬ä¸€ä¸ªå‡½æ•°ä½“å†…

  â—¦ è‡ªåŠ¨è¿›å…¥æ’å…¥æ¨¡å¼

  â—¦ ä¸Šä¸‹æ–‡ç›¸å…³çš„å‚æ•°é£æ ¼

4. çµæ´»çš„æ‰©å±•æ–¹å¼ï¼š

  â—¦ æ”¯æŒå•ä¸ªå•è¯æ‰©å±•

  â—¦ æ”¯æŒå¤šå•è¯æ‰©å±•

  â—¦ æ”¯æŒè§†è§‰é€‰æ‹©æ‰©å±•

æ·»åŠ å¯¹æ–°è¯­è¨€çš„æ”¯æŒ

è¦æ·»åŠ å¯¹æ–°è¯­è¨€çš„æ”¯æŒï¼Œåªéœ€æ‰©å±• expand-function--templates å˜é‡ï¼š

(add-to-list 'expand-function--templates
             '(your-lang-mode . ,(lambda (word indent)
                 "Custom template")))


æ­¤å·¥å…·ç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œæ”¯æŒå¹¿æ³›çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§å’Œè‡ªå®šä¹‰èƒ½åŠ›ï¼Œå¯æ˜¾è‘—æé«˜ç¼–å†™å‡½æ•°å®šä¹‰çš„å·¥ä½œæ•ˆç‡ã€‚





(defun my/expand-n-words-to-function (n)
  "Expand the next N words into separate function definitions.
Supports C, Zig, Go, Python and other languages."
  (interactive "p")
  (let* ((indent (make-string (current-indentation) ? ))
         (start (point))
         words
         bounds
         (mode (cond ((derived-mode-p 'c-mode 'c++-mode 'c-or-c++-mode) 'c)
                     ((derived-mode-p 'zig-mode) 'zig)
                     ((derived-mode-p 'go-mode) 'go)
                     ((derived-mode-p 'python-mode) 'python)
                     (t 'default))))
    
    ;; Collect N words
    (dotimes (i n)
      (when (re-search-forward "\\_<\\w+\\_>" nil t)
        (push (match-string 0) words)
        (setq bounds (or bounds (cons start (point)))))
      (forward-word 1))
    
    (if (null words)
        (error "No words found")
      
      ;; Delete original words
      (delete-region (car bounds) (cdr bounds))
      (setq words (nreverse words))
      
      ;; Insert function definitions
      (cl-case mode
        ('c
         (dolist (word words)
           (insert indent "void " word "(void)\n")
           (insert indent "{\n")
           (insert indent "    /* cursor here */\n")
           (insert indent "}\n\n"))
         (goto-char (point-max))
         (search-backward "/* cursor here */")
         (kill-line))
        
        ('zig
         (dolist (word words)
           (insert indent "fn " word "() void {\n")
           (insert indent "    // cursor here\n")
           (insert indent "}\n\n"))
         (goto-char (point-max))
         (search-backward "// cursor here")
         (kill-line))
        
        ('go
         (dolist (word words)
           (insert indent "func " word "() {\n")
           (insert indent "    // cursor here\n")
           (insert indent "}\n\n"))
         (goto-char (point-max))
         (search-backward "// cursor here")
         (kill-line))
        
        ('python
         (dolist (word words)
           (insert indent "def " word "():\n")
           (insert indent "    # cursor here\n\n"))
         (goto-char (point-max))
         (search-backward "# cursor here")
         (kill-line))
        
        ('default
         (dolist (word words)
           (insert indent "function " word "() {\n")
           (insert indent "    // cursor here\n")
           (insert indent "}\n\n"))
         (goto-char (point-max))
         (search-backward "// cursor here")
         (kill-line)))
      
      ;; Position cursor at first function body
      (evil-insert-state))))

;; åˆ›å»ºé”®ä½æ˜ å°„
(defvar my/prog-keys-mode-map
  (make-sparse-keymap)
  "Keymap for programming mode shortcuts")

;; åœ¨ Evil/Vim æ¨¡å¼ä¸‹ç»‘å®šé”®ä½
(evil-define-key 'normal my/prog-keys-mode-map
  "fw" 'my/expand-n-words-to-function)

(evil-define-key 'visual my/prog-keys-mode-map
  "fw" (lambda () (interactive)
         (let ((n (count-words-region (region-beginning) (region-end))))
           (my/expand-n-words-to-function n))))

;; æ¿€æ´»é”®ä½æ˜ å°„çš„ hook
(defun my/activate-prog-keys ()
  "Activate programming-specific keybindings in current buffer."
  (use-local-map (copy-keymap my/prog-keys-mode-map))
  (set-keymap-parent my/prog-keys-mode-map (current-local-map)))

;; æ·»åŠ åˆ°æ‰€æœ‰ç¼–ç¨‹æ¨¡å¼
(dolist (hook '(prog-mode-hook
                c-mode-hook
                c++-mode-hook
                zig-mode-hook
                go-mode-hook
                python-mode-hook
                java-mode-hook
                js-mode-hook
                ruby-mode-hook
                rust-mode-hook
                lua-mode-hook
                php-mode-hook))
  (add-hook hook 'my/activate-prog-keys))

;; å¯é€‰ï¼šä¸ºå…¶ä»–æ¨¡å¼æ·»åŠ æ”¯æŒ
(add-hook 'emacs-lisp-mode-hook 'my/activate-prog-keys)



awk 'length > 80 {
    line = $0
    while (length(line) > 80) {
        # æ£€æŸ¥ç¬¬80-81å­—ç¬¦æ˜¯å¦æ˜¯è´§å¸å•ä½
        if (substr(line, 80, 2) ~ /^(ç¾é‡‘|ç¾å…ƒ)$/) {
            print substr(line, 1, 79)
            line = substr(line, 80)
        } else {
            print substr(line, 1, 80)
            line = substr(line, 81)
        }
    }
    print line
    next
}1' input.txt


  â—¦ å½“è¡Œé•¿åº¦è¶…è¿‡80å­—ç¬¦æ—¶

  â—¦ è´§å¸å•ä½ä¿æŠ¤

  â—¦ æ¯æ¬¡å¤„ç†åªåˆ†å‰²å‡º80æˆ–79å­—ç¬¦çš„éƒ¨åˆ†

2. è´§å¸å•ä½ä¿æŠ¤æœºåˆ¶ï¼š

  â—¦ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ£€æŸ¥ç¬¬80-81ä½ç½®æ˜¯å¦ä¸º"ç¾é‡‘"æˆ–"ç¾å…ƒ"

  â—¦ åŒ¹é…æ—¶åœ¨79å­—ç¬¦å¤„æ¢è¡Œï¼ˆä¿ç•™è´§å¸å•ä½å®Œæ•´ï¼‰

  â—¦ ä¸åŒ¹é…æ—¶ç›´æ¥åœ¨80å­—ç¬¦å¤„æ¢è¡Œ

å†…å®¹

å¤„ç†ç¤ºä¾‹ï¼š

è¾“å…¥è¡Œ (é•¿åº¦>80)ï¼š

æœ¬é¡¹ç›®æˆæœ¬é¢„ä¼°ä¸º1500ä¸‡ç¾é‡‘å¸ï¼Œä¸»è¦ç”¨äºè®¾å¤‡é‡‡è´­å’ŒæŠ€æœ¯å¼•è¿›ï¼Œå…·ä½“åˆ†é…æ–¹æ¡ˆè§é™„ä»¶è¯´æ˜ã€‚


è¾“å‡ºç»“æœï¼š

æœ¬é¡¹ç›®æˆæœ¬é¢„ä¼°ä¸º1500ä¸‡ç¾é‡‘å¸ï¼Œä¸»è¦ç”¨äºè®¾å¤‡é‡‡è´­å’ŒæŠ€æœ¯å¼•è¿›ï¼Œå…·ä½“åˆ†é…æ–¹æ¡ˆè§é™„ä»¶ # 80å­—ç¬¦æ¢è¡Œ
è¯´æ˜ã€‚


ç‰¹æ®Šæ¡ˆä¾‹ï¼ˆ80-81ä½ç½®ä¸º"ç¾é‡‘"ï¼‰ï¼š

æœ¬é¡¹ç›®æˆæœ¬é¢„ä¼°ä¸º5000ä¸‡ç¾é‡‘ï¼Œä¸»è¦ç”¨äºè®¾å¤‡é‡‡è´­å’ŒæŠ€æœ¯å¼•è¿›ï¼Œå…·ä½“åˆ†é…æ–¹æ¡ˆè§é™„ä»¶è¯´æ˜ã€‚


è¾“å‡ºç»“æœï¼š

æœ¬é¡¹ç›®æˆæœ¬é¢„ä¼°ä¸º5000ä¸‡ # 79å­—ç¬¦æ¢è¡Œï¼ˆä¿æŠ¤å®Œæ•´è´§å¸å•ä½ï¼‰
ç¾é‡‘ï¼Œä¸»è¦ç”¨äºè®¾å¤‡é‡‡è´­å’ŒæŠ€æœ¯å¼•è¿›ï¼Œå…·ä½“åˆ†é…æ–¹æ¡ˆè§é™„ä»¶è¯´æ˜ã€‚


æ­¤æ–¹æ¡ˆç®€åŒ–äº†å¤„ç†æµç¨‹ï¼Œä¸“æ³¨äºä¿æŠ¤é‡è¦é‡‘èæœ¯è¯­çš„å®Œæ•´æ€§ã€‚åœ¨å¤„ç†çº¯æ–‡æœ¬æˆ–æŠ€æœ¯æ–‡æ¡£æ—¶æ•ˆæœæœ€ä½³ï¼Œç‰¹åˆ«é€‚åˆä»¥ä¸­æ–‡ä¸ºä¸»è¦å†…å®¹çš„æ–‡ä»¶å¤„ç†ã€‚


æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ evil æ¨¡å¼ï¼Œåœ¨ normal çŠ¶æ€ä¸‹ï¼Œæƒ³è¦å°†æŒ‰é”® fw ç»‘å®šåˆ°ä¸€ä¸ªå‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†å½“å‰ word æ‰©å±•ä¸º function word() {} å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ’å…¥ç‚¹ä½äºæ‹¬å·å†…ã€‚

æˆ‘ä»¬å¯ä»¥åˆ†æ­¥éª¤æ€è€ƒï¼š

1. è·å–å½“å‰å…‰æ ‡ä¸‹çš„å•è¯ï¼ˆword at pointï¼‰ã€‚

2. åˆ é™¤è¯¥å•è¯ã€‚

3. æ’å…¥å­—ç¬¦ä¸² "function word() {}"ï¼Œå…¶ä¸­ word æ˜¯ä¹‹å‰è·å–çš„å•è¯ã€‚

4. å°†å…‰æ ‡ç§»åŠ¨åˆ°æ‹¬å·å†…çš„ä½ç½®ï¼ˆå³å·¦å¤§æ‹¬å·åé¢ï¼Œå³å¤§æ‹¬å·å‰é¢ï¼‰ã€‚

ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›åœ¨åˆ é™¤å•è¯åï¼Œæ’å…¥çš„å­—ç¬¦ä¸²ä¸­çš„å•è¯æ˜¯åŸæ¥çš„é‚£ä¸ªå•è¯ï¼Œå¹¶ä¸”ç„¶åå…‰æ ‡ä½äºå¤§æ‹¬å·ä¹‹é—´ã€‚

å…·ä½“æ­¥éª¤ï¼š

a. è®°å½•å½“å‰å…‰æ ‡ä½ç½®ã€‚

b. è·å–å½“å‰å•è¯ï¼ˆä½¿ç”¨ thing-at-point çš„ 'wordï¼‰ã€‚

c. åˆ é™¤è¯¥å•è¯ï¼ˆå¯ä»¥ä½¿ç”¨ delete-region æ¥åˆ é™¤è¿™ä¸ªå•è¯å¯¹åº”çš„åŒºåŸŸï¼‰ã€‚

d. æ’å…¥å­—ç¬¦ä¸²ï¼šæ ¼å¼ä¸º "function %s() {}" å¹¶å°† %s æ›¿æ¢ä¸ºè·å–åˆ°çš„å•è¯ã€‚

e. å› ä¸ºæ’å…¥åå…‰æ ‡åœ¨å­—ç¬¦ä¸²æœ«å°¾ï¼Œæˆ‘ä»¬éœ€è¦å°†å…‰æ ‡ç§»åŠ¨åˆ°å·¦å¤§æ‹¬å·å’Œå³å¤§æ‹¬å·ä¹‹é—´ï¼ˆå³å‡½æ•°ä½“çš„ä½ç½®ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ backward-char æ¥å‘å·¦ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ï¼ˆå³ä»æœ«å°¾çš„ } å‰ç§»åŠ¨åˆ° { åé¢ï¼‰ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ï¼ˆå› ä¸º evil çš„ normal æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥ä½¿ç”¨ evil-insert æˆ–è€…ç§»åŠ¨åè¿›å…¥æ’å…¥æ¨¡å¼ï¼‰ã€‚

ä½†æ˜¯ï¼Œevil æä¾›äº†å¼ºå¤§çš„ç§»åŠ¨å‘½ä»¤å’Œæ–‡æœ¬å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒä»¬ã€‚

å¦ä¸€ç§æ–¹æ³•ï¼šä½¿ç”¨ evil-change æ¥æ”¹å˜å½“å‰å•è¯ï¼Œç„¶åæ’å…¥æ–°å†…å®¹ï¼Œä½†æ˜¯è¿™æ ·ä¼šè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ”¹å˜çš„æ“ä½œä¸­æ’å…¥æˆ‘ä»¬å¸Œæœ›çš„å†…å®¹ã€‚

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties)))
    (when word
      (delete-region (point) (+ (point) (length word))) ; æ³¨æ„ï¼šè·å–å•è¯åï¼Œå•è¯çš„èµ·å§‹ä½ç½®åœ¨(point)ï¼Œä½†éœ€è¦ç¡®è®¤å•è¯çš„èµ·å§‹ä½ç½®
      ;; ä½†å®é™…ä¸Šï¼Œ`thing-at-point` è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“åŒºåŸŸçš„èµ·å§‹å’Œç»“æŸï¼Œæ‰€ä»¥éœ€è¦åŒæ—¶è·å–åŒºåŸŸã€‚
      (let ((bounds (bounds-of-thing-at-point 'word)))
        (if bounds
            (delete-region (car bounds) (cdr bounds))
          (error "No word at point")))
      (insert (format "function %s() {}" word))
      (backward-char 1)  ; ç§»åŠ¨åˆ°æœ€åä¸€ä¸ª } ä¹‹å‰ï¼Œç„¶åå†å‘å·¦ç§»åŠ¨åˆ° { ä¹‹åï¼Ÿ
      ;; æ’å…¥åï¼Œå…‰æ ‡åœ¨æœ€åï¼Œå­—ç¬¦ä¸²ä¸º "function word() {}"ï¼Œå…‰æ ‡åœ¨ } åé¢
      ;; æˆ‘ä»¬æƒ³è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå¹¶ä¸”ä½äºå¤§æ‹¬å·ä¹‹é—´ï¼ˆå³{}å†…éƒ¨ï¼‰ï¼Œä¹Ÿå°±æ˜¯åœ¨ { çš„åé¢å’Œ } çš„å‰é¢ã€‚
      ;; å¯ä»¥å‘åç§»åŠ¨ä¸¤ä¸ªå­—ç¬¦ï¼šå…ˆç§»åŠ¨åˆ° } ä¸Šï¼Œç„¶åç§»åŠ¨åˆ° { åé¢ï¼Ÿä¸ï¼Œæ’å…¥åä½ç½®åœ¨ } ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ï¼š
      (backward-char)  ; ç§»åŠ¨åˆ° } ä¸Š
      (backward-char)  ; ç§»åŠ¨åˆ° } çš„å‰é¢ï¼Œå³ç©ºæ ¼çš„ä½ç½®ï¼Ÿå­—ç¬¦ä¸²æ˜¯ "function word() {}"ï¼Œæœ€åä¸¤ä¸ªå­—ç¬¦æ˜¯"{}"ï¼Œæ‰€ä»¥æ’å…¥åå…‰æ ‡åœ¨ç¬¬äºŒä¸ªå¤§æ‹¬å·åé¢ï¼Œéœ€è¦ç§»åŠ¨åˆ°ä¸¤ä¸ªå¤§æ‹¬å·ä¸­é—´ã€‚
      ;; å®é™…ä¸Šï¼Œæˆ‘ä»¬åˆšåˆšæ’å…¥çš„å­—ç¬¦ä¸²æ˜¯å›ºå®šæ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—ï¼šæ’å…¥çš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯: (length (format "function %s() {}" word))ï¼Œç„¶åå‡å»1ï¼ˆå› ä¸ºæœ€åæ˜¯}ï¼‰ï¼Œæˆ‘ä»¬æƒ³å®šä½åœ¨{åé¢ï¼Œæ‰€ä»¥å¯ä»¥å…ˆæ‰¾åˆ°{çš„ä½ç½®ã€‚
      ;; ä½†æ›´ç®€å•çš„æ–¹æ³•æ˜¯ï¼šæ’å…¥åï¼Œæˆ‘ä»¬å‘åç§»åŠ¨ä¸¤ä¸ªå­—ç¬¦ï¼ˆå› ä¸º{}æœ‰ä¸¤ä¸ªå­—ç¬¦ï¼‰ï¼Œä½†è¿™æ ·æ— æ³•å‡†ç¡®å®šä½åˆ°{åé¢ã€‚æˆ‘ä»¬å¯ä»¥æœç´¢å‰é¢çš„{ï¼Œç„¶åå‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ã€‚
      (evil-insert 1)  ; è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå¹¶ä¸”åœ¨å½“å‰å­—ç¬¦å‰æ’å…¥ï¼Ÿä½†æˆ‘ä»¬å¸Œæœ›åœ¨å¤§æ‹¬å·å†…éƒ¨ï¼Œæ‰€ä»¥å¯ä»¥ï¼š
      ;; å…¶å®æˆ‘ä»¬å¯ä»¥ç›´æ¥ï¼šå…ˆç§»åŠ¨åˆ°å·¦å¤§æ‹¬å·åé¢çš„ä½ç½®ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚
      )
    )))


ä¸Šé¢çš„æ–¹æ³•æœ‰äº›ç¹çï¼Œå¹¶ä¸”æ²¡æœ‰å‡†ç¡®å®šä½ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ re-search-backward æ¥æŸ¥æ‰¾å·¦å¤§æ‹¬å·ï¼Œç„¶åç§»åŠ¨åˆ°å®ƒåé¢ã€‚

ä¼˜åŒ–ï¼š

æˆ‘ä»¬åœ¨æ’å…¥åï¼Œä½¿ç”¨ re-search-backward æ¥æŸ¥æ‰¾ {ï¼Œç„¶åå‘å³ç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™æ ·å°±åœ¨ { å’Œ } ä¹‹é—´äº†ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸ç§»åŠ¨ï¼Œåœ¨æ’å…¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæ’å…¥åï¼Œå…‰æ ‡åœ¨æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

æ­¥éª¤ï¼š

1. è·å–å½“å‰å•è¯çš„èµ·å§‹å’Œç»“æŸä½ç½®ï¼ˆboundsï¼‰ï¼Œç„¶ååˆ é™¤ã€‚

2. æ’å…¥ "function "ï¼Œç„¶åæ’å…¥å•è¯ï¼Œå†æ’å…¥ "() {"ï¼Œç„¶åæ’å…¥ "}"ã€‚è¿™æ ·æ’å…¥åå…‰æ ‡åœ¨ { å’Œ } ä¹‹é—´ï¼Ÿä¸ï¼Œæ’å…¥æ˜¯åœ¨æœ€åï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ’å…¥å­—ç¬¦ä¸²åç§»åŠ¨å…‰æ ‡ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨æ’å…¥å­—ç¬¦ä¸²çš„è¿‡ç¨‹ä¸­ï¼Œå°†å…‰æ ‡ä½ç½®è®¾ç½®åœ¨ { åé¢ï¼Œä½†è¿™æ ·éœ€è¦åˆ†æ­¥æ’å…¥ã€‚

ä¿®æ”¹ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        (bounds (bounds-of-thing-at-point 'word)))
    (if (not bounds)
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() ")
      ;; ç°åœ¨æˆ‘ä»¬æ’å…¥ä¸€ä¸ª {} å—ï¼Œå¹¶å¸Œæœ›å…‰æ ‡åœ¨ {} é‡Œé¢
      (insert "{")
      (save-excursion  ; ä¿å­˜å½“å‰ä½ç½®ï¼Œç„¶åæ’å…¥å³æ‹¬å·ï¼Œè¿™æ ·å½“å‰ä½ç½®å°±åœ¨{åé¢
        (insert "}"))
      (backward-char 1)  ; ä» { åé¢ç§»åŠ¨åˆ° { å’Œ } ä¹‹é—´ï¼ˆå³åˆšæ’å…¥çš„{åé¢ï¼Œå› ä¸ºåé¢ç´§æ¥ç€å°±æ˜¯}ï¼Œæˆ‘ä»¬æ’å…¥åœ¨{ä¹‹åï¼Œç„¶åæ’å…¥}ï¼Œç„¶åæˆ‘ä»¬é€€å›åˆ°{åé¢ï¼‰
      (evil-insert 1))   ; è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå¹¶åœ¨å½“å‰ä½ç½®æ’å…¥ï¼ˆå³åœ¨{åé¢ï¼Œ}å‰é¢ï¼‰
    ))


è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼š

1. è·å–å½“å‰å•è¯çš„è¾¹ç•Œå’Œå†…å®¹ã€‚

2. åˆ é™¤è¯¥å•è¯ã€‚

3. æ’å…¥ "function "ã€‚

4. æ’å…¥å•è¯ã€‚

5. æ’å…¥ "() "ã€‚

6. æ’å…¥å·¦å¤§æ‹¬å· {ã€‚

7. ç„¶åä½¿ç”¨ save-excursion æ’å…¥å³å¤§æ‹¬å· }ï¼Œè¿™æ ·æ’å…¥å³æ‹¬å·åï¼Œç‚¹ï¼ˆpointï¼‰ä»ä½äºå·¦å¤§æ‹¬å·ä¹‹åã€‚

8. ç„¶åæˆ‘ä»¬å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ï¼ˆå› ä¸ºæ’å…¥å·¦æ‹¬å·åï¼Œç‚¹ï¼ˆpointï¼‰åœ¨å·¦å¤§æ‹¬å·åé¢ï¼Œç„¶åæˆ‘ä»¬æ’å…¥äº†å³å¤§æ‹¬å·ï¼Œç‚¹è¿˜åœ¨å·¦å¤§æ‹¬å·åé¢ï¼Œç„¶åæˆ‘ä»¬å‘åç§»åŠ¨ä¸€ä¸ªå­—ç¬¦ï¼ˆbackward-charï¼‰ï¼Ÿä¸ï¼Œæˆ‘ä»¬éœ€è¦è¿›å…¥æ’å…¥æ¨¡å¼çš„ä½ç½®æ˜¯å·¦å¤§æ‹¬å·åé¢ï¼Œå³å¤§æ‹¬å·å‰é¢ï¼Œä¹Ÿå°±æ˜¯åœ¨å®ƒä»¬ä¹‹é—´ï¼Œæ‰€ä»¥å½“å‰ä½ç½®ï¼ˆå·¦å¤§æ‹¬å·åé¢ï¼‰å°±æ˜¯æˆ‘ä»¬è¦çš„ä½ç½®ã€‚

9. ä½†æ˜¯æ³¨æ„ï¼šåœ¨æ’å…¥å³å¤§æ‹¬å·ä¹‹åï¼Œç‚¹ä»ç„¶åœ¨å·¦å¤§æ‹¬å·ä¹‹åï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸åšï¼Œç„¶åè°ƒç”¨evil-insertè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå°±å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´è¾“å…¥äº†ã€‚

ç„¶è€Œï¼Œç¬¬8æ­¥çš„backward-char 1æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºsave-excursionä¹‹åï¼Œç‚¹å°±åœ¨å·¦å¤§æ‹¬å·åé¢ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥è¿›å…¥æ’å…¥æ¨¡å¼ã€‚

æ‰€ä»¥ä¿®æ­£ï¼šç§»é™¤backward-charã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬æ’å…¥å³æ‹¬å·åï¼Œç‚¹ç¡®å®åœ¨å·¦æ‹¬å·åé¢å—ï¼Ÿ

æ³¨æ„ï¼šsave-excursion ä¼šä¿å­˜å½“å‰çš„ç‚¹ä½ç½®ï¼Œæ‰§è¡Œæ‹¬å·å†…çš„ä»£ç ï¼Œç„¶åæ¢å¤ç‚¹ä½ç½®ã€‚æ‰€ä»¥ï¼Œåœ¨(save-excursion (insert "}"))ä¹‹åï¼Œç‚¹ä»ç„¶åœ¨æ’å…¥å·¦å¤§æ‹¬å·ä¹‹åçš„ä½ç½®ï¼Œç„¶åæˆ‘ä»¬è°ƒç”¨(evil-insert 1)è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œè¿™ä¸ªä½ç½®å°±æ˜¯å¤§æ‹¬å·å†…éƒ¨ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        (bounds (bounds-of-thing-at-point 'word)))
    (if (not bounds)
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() ")
      (insert "{")
      (save-excursion
        (insert "}"))
      (evil-insert 1))))


ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ²¡æœ‰wordçš„æ—¶å€™æå‰é€€å‡ºï¼Œæ‰€ä»¥å…ˆç”¨(if (not word)ï¼Œä¸è¿‡boundsä¸ºç©ºçš„æ—¶å€™å·²ç»è¡¨ç¤ºæ²¡æœ‰wordã€‚

å¦å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨evilçš„normalæ¨¡å¼ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªå‘½ä»¤åº”è¯¥ç»‘å®šåˆ°normalæ¨¡å¼çš„é”®ä½ä¸Šã€‚

ç»‘å®šé”®ä½ï¼š

ä½¿ç”¨evil-define-keyç»‘å®šåˆ°normalçŠ¶æ€ä¸‹çš„"fw"ã€‚

(evil-define-key 'normal 'global
  (kbd "fw") 'my/expand-word-to-function)


ä½†æ˜¯ï¼Œæ³¨æ„ï¼ševilåœ¨normalæ¨¡å¼ä¸‹ï¼Œå¦‚æœå½“å‰å…‰æ ‡åœ¨å•è¯ä¸Šï¼Œæˆ‘ä»¬è¦ç¡®ä¿thing-at-pointèƒ½å¤Ÿè·å–åˆ°å•è¯ã€‚å¦å¤–ï¼Œevilåœ¨normalçŠ¶æ€ä¸‹æ‰§è¡Œäº¤äº’å¼å‘½ä»¤å¯èƒ½ä¼šæ”¹å˜çŠ¶æ€ï¼Œæˆ‘ä»¬å‘½ä»¤æœ€åä½¿ç”¨evil-insertè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

å®Œæ•´ä»£ç ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        bounds)
    (setq bounds (bounds-of-thing-at-point 'word))
    (if (or (not bounds) (not word))
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() ")
      (insert "{")
      (save-excursion
        (insert "}"))
      (evil-insert 1))))

(evil-define-key 'normal 'global-map
  "fw" #'my/expand-word-to-function)


æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨å…¨å±€ç»‘å®šï¼Œæ‰€ä»¥å¯èƒ½ä¼šè¦†ç›–å…¶ä»–æ¨¡å¼ã€‚å»ºè®®å°†å…¶ç»‘å®šåˆ°ç‰¹å®šæ¨¡å¼ï¼Œæ¯”å¦‚ä»…ç¼–ç¨‹æ¨¡å¼ï¼Œä½†è¿™é‡Œä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬ä½¿ç”¨å…¨å±€ç»‘å®šã€‚

æµ‹è¯•ï¼š

å‡è®¾å½“å‰å…‰æ ‡åœ¨ä¸€ä¸ªå•è¯ä¸Šï¼Œæ¯”å¦‚"hello"ï¼ŒæŒ‰ä¸‹fwåï¼Œè¯¥å•è¯è¢«æ›¿æ¢ä¸ºï¼š

function hello() {

}   // å¹¶ä¸”å…‰æ ‡åœ¨{å’Œ}ä¹‹é—´ï¼Œè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

æ³¨æ„ï¼šæ’å…¥åï¼Œå†…å®¹ä¸ºï¼šfunction hello() {|}ï¼Œå…¶ä¸­|è¡¨ç¤ºå…‰æ ‡ä½ç½®ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬æ’å…¥çš„æ–‡æœ¬ä¸­ï¼Œåœ¨{å’Œ}ä¹‹é—´æ²¡æœ‰æ¢è¡Œï¼Œæ‰€ä»¥çœ‹èµ·æ¥æ˜¯ï¼šfunction hello() {|}ã€‚è¿™å¯èƒ½ä¸ç¬¦åˆç¼–ç ä¹ æƒ¯ã€‚æˆ‘ä»¬å¯ä»¥æ”¹è¿›ï¼Œåœ¨{}å†…éƒ¨æ·»åŠ æ¢è¡Œï¼Œå¹¶å°†å…‰æ ‡å®šä½åœ¨ä¸­é—´ä¸€è¡Œã€‚

æ”¹è¿›ï¼šæ’å…¥çš„æ ¼å¼ä¸ºï¼š

function word() {

|   // å…‰æ ‡ä½ç½®åœ¨è¿™é‡Œï¼Œå¹¶ä¸”ç¼©è¿›

}

å¦‚ä½•å®ç°ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ï¼š

æ’å…¥ "function word() {\n}"ï¼Œç„¶åå…‰æ ‡ç§»åŠ¨åˆ°\nä¹‹å‰ï¼Œç„¶åå†æ’å…¥ä¸€ä¸ªæ¢è¡Œï¼Œç„¶åç¼©è¿›ã€‚

æˆ–è€…ï¼Œæ›´ç›´æ¥çš„æ–¹æ³•ï¼š

      (insert "function ")
      (insert word)
      (insert "() {\n")
      (insert "\n}")
      (forward-line -1)   ; ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªæ¢è¡Œä¹‹åçš„é‚£ä¸€è¡Œï¼ˆå³ä¸­é—´è¡Œï¼‰
      (indent-according-to-mode) ; æŒ‰æ¨¡å¼ç¼©è¿›ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼
      (evil-insert 1)


ä½†æ˜¯ï¼Œè¿™æ ·æ“ä½œåï¼Œæ’å…¥ç‚¹å°±åœ¨ç¬¬äºŒè¡Œäº†ï¼Œå¹¶ä¸”ç¼©è¿›ã€‚

ä¿®æ”¹åçš„å‡½æ•°ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        bounds)
    (setq bounds (bounds-of-thing-at-point 'word))
    (if (or (not bounds) (not word))
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() {\n")
      (insert "\n}")
      (forward-line -1)   ; ä»æœ€åä¸€è¡Œç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ˆå³ä¸­é—´ç©ºè¡Œï¼‰
      (indent-according-to-mode)  ; ç¼©è¿›å½“å‰è¡Œï¼ˆå¯èƒ½æ˜¯0ï¼Œä½†æˆ‘ä»¬å¸Œæœ›æ ¹æ®æ¨¡å¼ç¼©è¿›ï¼‰
      (evil-insert 1))))


ä½†æ˜¯ï¼Œè¿™æ ·æ’å…¥åï¼Œä¸¤ä¸ªæ¢è¡Œä¹‹é—´çš„è¡Œæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬ç§»åŠ¨åˆ°è¿™ä¸€è¡Œï¼Œç¼©è¿›ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

æ³¨æ„ï¼šforward-line -1 ä¼šå°†ç‚¹ç§»åŠ¨åˆ°æ‹¬å·å†…çš„ç©ºè¡Œï¼ˆç¬¬äºŒè¡Œï¼‰çš„å¼€å¤´ã€‚ç„¶åæˆ‘ä»¬ç¼©è¿›ï¼Œç„¶ååœ¨è¡Œé¦–è¿›å…¥æ’å…¥æ¨¡å¼ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°ï¼š

function hello() {

|   // è¿™é‡Œç¼©è¿›ï¼Œæ ¹æ®å½“å‰major-mode

}

ä½†æ˜¯ï¼Œå¦‚æœå½“å‰æ¨¡å¼æ²¡æœ‰è‡ªåŠ¨ç¼©è¿›ï¼Œé‚£ä¹ˆå¯èƒ½ä¸ä¼šç¼©è¿›ã€‚ä¸è¿‡æˆ‘ä»¬è°ƒç”¨äº†indent-according-to-modeï¼Œæ‰€ä»¥ä¼šæ ¹æ®æ¨¡å¼è¿›è¡Œç¼©è¿›ã€‚

æµ‹è¯•è¿™ä¸ªå‡½æ•°ï¼Œå¯èƒ½ä¼šå‘ç°ç¼©è¿›æ­£å¸¸ï¼Œç„¶åæˆ‘ä»¬åœ¨è¡Œé¦–ï¼Œä½†æ˜¯æˆ‘ä»¬å¯èƒ½å¸Œæœ›ç¼©è¿›åå…‰æ ‡åœ¨ç¼©è¿›åçš„ä½ç½®ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚è¿™æ ·å°±æ˜¯æ­£ç¡®çš„ä½ç½®ã€‚

æ‰€ä»¥ï¼Œæœ€ç»ˆçš„å‡½æ•°å¦‚ä¸‹ï¼š

æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨äº†forward-line -1ï¼Œè¿™ä¾èµ–äºæ’å…¥ä¸¤è¡Œæ–‡æœ¬ï¼ˆç¬¬ä¸€è¡Œæ˜¯{\nï¼Œç„¶åæ’å…¥ä¸€ä¸ªæ¢è¡Œå’Œ}ï¼Œæ€»å…±ä¸¤è¡Œï¼‰ï¼Œç„¶åä»æœ€åä¸€è¡Œï¼ˆç¬¬ä¸‰è¡Œï¼‰ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œã€‚

æ’å…¥è¿‡ç¨‹ï¼š

æ’å…¥"function word() {\n" -> ç¬¬ä¸€è¡Œç»“æŸï¼Œè¿›å…¥ç¬¬äºŒè¡Œï¼ˆç©ºè¡Œå¼€å§‹ï¼‰

ç„¶åæ’å…¥"\n}" -> åœ¨ç¬¬äºŒè¡Œæ’å…¥ä¸€ä¸ªæ¢è¡Œï¼Œå˜æˆç¬¬ä¸‰è¡Œï¼Œç¬¬ä¸‰è¡Œå†…å®¹æ˜¯"}"

æ‰€ä»¥ï¼Œç‚¹ï¼ˆpointï¼‰åœ¨ç¬¬ä¸‰è¡Œçš„è¡Œé¦–ã€‚forward-line -1å°†ç‚¹ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œçš„è¡Œé¦–ã€‚

ç„¶åæˆ‘ä»¬ç¼©è¿›ï¼ˆindent-according-to-modeï¼‰ç¬¬äºŒè¡Œï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

è¿™ç¬¦åˆè¦æ±‚ã€‚

ä½†æ˜¯ï¼Œå¦‚æœå½“å‰æ¨¡å¼ç¼©è¿›æ˜¯2ä¸ªç©ºæ ¼ï¼Œé‚£ä¹ˆç¬¬äºŒè¡Œå°±ä¼šç¼©è¿›2ä¸ªç©ºæ ¼ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ç¼©è¿›åé¢è¾“å…¥ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›ç›´æ¥å®šä½åˆ°ç¼©è¿›åçš„ä½ç½®ï¼ˆå³è¡Œé¦–ç¼©è¿›ä¹‹åï¼‰ï¼Œé‚£ä¹ˆå¯ä»¥è°ƒç”¨indent-according-to-modeä¹‹åï¼Œå†æ‰§è¡Œend-of-lineï¼Ÿä¸ï¼Œæˆ‘ä»¬å¸Œæœ›å…‰æ ‡åœ¨è¡Œé¦–ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ï¼Œè¿™æ ·è¾“å…¥å°±ä¼šåœ¨ç¼©è¿›åé¢ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç§»åŠ¨å…‰æ ‡åˆ°ç¼©è¿›è¡Œå°¾ï¼Ÿä¸éœ€è¦ï¼Œå› ä¸ºè¿›å…¥æ’å…¥æ¨¡å¼åï¼Œåœ¨è¡Œé¦–ï¼Œä½†ç¼©è¿›æ˜¯ç©ºæ ¼ï¼Œæ‰€ä»¥ç›´æ¥è¾“å…¥å°±ä¼šåœ¨ç©ºæ ¼åé¢ã€‚

å› æ­¤ï¼Œè¿™æ ·å³å¯ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨newlineå‡½æ•°ï¼Œåˆ†æ­¥æ’å…¥ï¼Œä½†è¿™å·²ç»å¯ä»¥äº†ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬å®šä¹‰å‡½æ•°å¹¶ç»‘å®šã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ï¼Œåœ¨æ’å…¥å³å¤§æ‹¬å·æ—¶ï¼Œå®ƒçš„ç¼©è¿›ã€‚æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ç¼©è¿›ä¸¤è¡Œï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªç¼©è¿›äº†ä¸­é—´è¡Œï¼Œè€Œæœ€åä¸€è¡Œï¼ˆå³å¤§æ‹¬å·ï¼‰æ²¡æœ‰ç¼©è¿›ã€‚æˆ‘ä»¬å¯ä»¥ï¼š

åœ¨æ’å…¥å³å¤§æ‹¬å·ä¹‹å‰ï¼Œå…ˆç¼©è¿›ä¸€ä¸‹ï¼Ÿæˆ–è€…ï¼Œè®©Emacsè‡ªåŠ¨ç¼©è¿›æ•´ä¸ªåŒºåŸŸï¼Ÿä½†æˆ‘ä»¬çš„æ“ä½œæ­¥éª¤å¯èƒ½ä¸ä¼šè§¦å‘è‡ªåŠ¨ç¼©è¿›ã€‚

æˆ‘ä»¬å¯ä»¥è°ƒç”¨indent-regionæ¥å¤„ç†æ•´ä¸ªæ’å…¥çš„å—ï¼Ÿä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸çŸ¥é“å…·ä½“ä»å“ªåˆ°å“ªã€‚

ç®€å•æ–¹æ³•ï¼šåœ¨æ’å…¥ä¹‹å‰è®°å½•ä½ç½®ï¼Œç„¶åæ’å…¥åç¼©è¿›è¿™ä¸ªåŒºåŸŸã€‚

ä¿®æ”¹ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        bounds
        (start (point)))
    (setq bounds (bounds-of-thing-at-point 'word))
    (if (or (not bounds) (not word))
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() {\n")
      (insert "\n}")
      (goto-char start)  ; å›åˆ°æœ€åˆåˆ é™¤å‰çš„ç‚¹ï¼Ÿä½†åˆ é™¤åç‚¹å¯èƒ½å·²ç»åœ¨åˆ é™¤çš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®°å½•æ’å…¥å¼€å§‹çš„ä½ç½®ï¼Ÿ
      (forward-line 0)   ; å…¶å®æˆ‘ä»¬å¯ä»¥ï¼šè®°å½•æ’å…¥å¼€å§‹çš„ä½ç½®ï¼ˆåœ¨æ’å…¥ä¹‹å‰è®°å½•ï¼‰ï¼Œç„¶åç¼©è¿›ä»è¯¥ä½ç½®åˆ°å½“å‰ç‚¹
      (let ((end (point)))
        (goto-char start)
        (indent-region start end))
      (forward-line 1)   ; ç§»åŠ¨åˆ°å‡½æ•°ä½“å†…éƒ¨çš„é‚£ä¸€è¡Œï¼ˆå³ç¬¬äºŒè¡Œï¼‰
      (back-to-indentation) ; ç§»åŠ¨åˆ°ç¼©è¿›åçš„ç¬¬ä¸€ä¸ªéç©ºæ ¼å­—ç¬¦ï¼Œæˆ–è€…å¦‚æœæˆ‘ä»¬å¸Œæœ›ç›´æ¥å¼€å§‹è¾“å…¥ï¼Œé‚£ä¹ˆè¿›å…¥æ’å…¥æ¨¡å¼å‰çš„ä½ç½®å·²ç»æ˜¯è¯¥è¡Œå¼€å¤´ï¼ˆç¼©è¿›åå¯èƒ½åœ¨å¼€å¤´ç©ºæ ¼åé¢ï¼‰ï¼Ÿ
      (evil-insert 1))))


ä½†è¿™æ ·å¯èƒ½å¤æ‚äº†ã€‚æˆ‘ä»¬å¯ä»¥è®©ç”¨æˆ·è‡ªå·±ç¼©è¿›ï¼Œæˆ–è€…ç›¸ä¿¡ç”¨æˆ·é…ç½®çš„è‡ªåŠ¨ç¼©è¿›ä¼šåœ¨ä¿å­˜æ—¶è‡ªåŠ¨è°ƒæ•´ã€‚

ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬åªç¼©è¿›ä¸­é—´è¡Œï¼Œç„¶åå³å¤§æ‹¬å·è¡Œä¿æŒåŸæ ·ï¼ˆç”±åç»­çš„è‡ªåŠ¨ç¼©è¿›å¤„ç†ï¼‰ã€‚å› ä¸ºå½“æˆ‘ä»¬æ’å…¥åï¼Œå¯èƒ½æ•´ä¸ªå—è¿˜æ²¡æœ‰è¢«å®Œæ•´ç¼©è¿›ï¼Œä½†æ˜¯æˆ‘ä»¬çš„æ’å…¥å·²ç»å®Œæˆï¼Œè€Œä¸”åªç¼©è¿›äº†ä¸­é—´è¡Œã€‚å³å¤§æ‹¬å·çš„ç¼©è¿›å¯èƒ½ä¼šå—åˆ°æ¨¡å¼çš„å½±å“ï¼Œä½†ä¸åœ¨æˆ‘ä»¬çš„æ§åˆ¶ä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åœ¨æ’å…¥æœ€åå¤§æ‹¬å·æ—¶ä¹Ÿè¿›è¡Œç¼©è¿›ã€‚

ä½†è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆå³ä¸ç¼©è¿›æœ€åä¸€è¡Œï¼‰ï¼Œå› ä¸ºæœ€åä¸€è¡Œæ˜¯åœ¨æ’å…¥çš„æ•´ä¸ªå—çš„æœ€æœ«å°¾ï¼Œå¯èƒ½æ¨¡å¼ä¼šæ­£ç¡®ç¼©è¿›ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥åœ¨æ’å…¥å³å¤§æ‹¬å·å‰ä¹Ÿç¼©è¿›ä¸€ä¸‹ã€‚

è®©æˆ‘ä»¬å†ä¿®æ”¹ï¼šåœ¨æ’å…¥å³å¤§æ‹¬å·æ—¶ï¼Œä½¿ç”¨newline-and-indentæ¥æ’å…¥æ¢è¡Œå’Œç¼©è¿›ã€‚

åˆ†æ­¥æ’å…¥ï¼š

      (insert "function ")
      (insert word)
      (insert "() {\n")
      (newline-and-indent)   ; æ’å…¥ä¸€ä¸ªæ–°è¡Œï¼Œå¹¶ç¼©è¿›ï¼ˆç›¸å½“äºåœ¨å‡½æ•°ä½“å†…éƒ¨ç©ºè¡Œï¼Œå¹¶ä¸”ç¼©è¿›ï¼‰
      (insert "}")
      (forward-line -1)       ; ç§»åŠ¨åˆ°åˆšåˆšç¼©è¿›çš„ç©ºè¡Œ
      (evil-insert 1)


è¿™æ ·ï¼š

æ’å…¥ç¬¬ä¸€è¡Œï¼šfunction word() {

ç„¶åè°ƒç”¨(newline-and-indent)ï¼šæ’å…¥ä¸€ä¸ªæ–°è¡Œï¼Œå¹¶ä¸”åœ¨è¿™ä¸€è¡Œç¼©è¿›ï¼ˆå³ç¬¬äºŒä¸ªç©ºè¡Œç¼©è¿›ï¼‰ï¼Œæ­¤æ—¶ç‚¹åœ¨è¿™ä¸ªç©ºè¡Œçš„è¡Œé¦–ï¼ˆç¼©è¿›åï¼‰ã€‚

ç„¶åæ’å…¥å³å¤§æ‹¬å·ï¼šåœ¨ç¬¬äºŒè¡Œï¼ˆç¼©è¿›åçš„è¡Œï¼‰çš„æœ«å°¾æ’å…¥"}"ï¼Ÿä¸å¯¹ï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œè¡Œé¦–ç¼©è¿›åï¼Œç‚¹è¿˜åœ¨è¡Œé¦–ï¼Œç„¶åæ’å…¥"}"ï¼Œæ‰€ä»¥å˜æˆï¼š

function word() {

}   <-- è¿™é‡Œå³æ‹¬å·ä¹Ÿåœ¨ç¼©è¿›ä½ç½®ï¼Œç„¶åæˆ‘ä»¬ç§»åŠ¨åˆ°ä¸Šä¸€è¡Œï¼ˆå³ç¬¬äºŒè¡Œï¼‰å¹¶è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œä½†æ˜¯ç¬¬äºŒè¡Œæœ‰"}"ï¼Œæ‰€ä»¥ä¸ç©ºã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

ç¬¬ä¸€è¡Œï¼šfunction word() {

ç¬¬äºŒè¡Œï¼šé€šè¿‡newline-and-indentæ’å…¥ï¼šæ‰€ä»¥åˆ›å»ºç¬¬äºŒè¡Œï¼Œå¹¶ç¼©è¿›ï¼ˆç‚¹ä½äºç¬¬äºŒè¡Œç¼©è¿›åçš„ä½ç½®ï¼‰ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›ç¬¬äºŒè¡Œæ˜¯ç©ºè¡Œï¼Œç„¶åç¬¬ä¸‰è¡Œæ˜¯ç¼©è¿›çš„}ï¼Œæ‰€ä»¥ï¼š

(insert "function ")

(insert word)

(insert "() {\n")

(newline-and-indent)   ; è¿™ä¼šåœ¨ç¬¬äºŒè¡Œæ’å…¥å¹¶ç¼©è¿›ï¼Œç„¶åæˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œï¼Œç‚¹åœ¨è¯¥è¡Œè¡Œé¦–ï¼ˆç¼©è¿›åï¼‰

(insert "}")            ; åœ¨ç¬¬äºŒè¡Œæ’å…¥äº† }ï¼Œä½†æˆ‘ä»¬å¸Œæœ›}åœ¨å•ç‹¬ä¸€è¡Œ

è¿™æ ·ä¸å¯¹ã€‚

æ­£ç¡®åšæ³•ï¼š

(insert "function ")

(insert word)

(insert "() {\n")

(insert "\n")          ; æ’å…¥ä¸€ä¸ªç©ºè¡Œï¼ˆç¬¬äºŒè¡Œï¼‰

(insert "}")            ; æ’å…¥ç¬¬ä¸‰è¡Œï¼š}

(forward-line -1)       ; ç°åœ¨åœ¨ç¬¬ä¸‰è¡Œï¼Œæˆ‘ä»¬ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œ

(indent-according-to-mode) ; ç¼©è¿›ç¬¬äºŒè¡Œï¼ˆä½†ç¬¬äºŒè¡Œæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ç¼©è¿›åå…‰æ ‡åœ¨è¡Œé¦–ç¼©è¿›å¤„ï¼‰

(evil-insert 1)

è¿™ä¸ªæ­¥éª¤ï¼Œç¬¬äºŒè¡Œæ²¡æœ‰ç¼©è¿›ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ç¬¬äºŒè¡Œç¼©è¿›ã€‚ç„¶åç¬¬ä¸‰è¡Œï¼ˆ}æ‰€åœ¨è¡Œï¼‰ä¹Ÿæ²¡æœ‰ç¼©è¿›ã€‚æˆ‘ä»¬å¯ä»¥åˆ†åˆ«ç¼©è¿›è¿™ä¸¤è¡Œã€‚

ä½†æˆ‘ä»¬å¸Œæœ›}åœ¨ç¬¬ä¸‰è¡Œï¼Œå¹¶ä¸”ç¼©è¿›åˆ°ä¸{æ‰€åœ¨è¡Œç›¸åŒçš„å±‚æ¬¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å…ˆæ’å…¥ç„¶åç¼©è¿›æ•´ä¸ªå—æ¥è§£å†³ã€‚

è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡ç”¨å¦ä¸€ç§å¸¸ç”¨åšæ³•ï¼šä½¿ç”¨save-excursionå’Œindent-according-to-modeåˆ†åˆ«ç¼©è¿›ã€‚

ç„¶è€Œï¼Œä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬æ’å…¥çš„å†…å®¹ä¸ºï¼š

function word() {\n\n}

ç„¶åï¼Œå°†ç‚¹ç§»åŠ¨åˆ°ä¸¤ä¸ª\nä¹‹é—´çš„è¡Œï¼Œç¼©è¿›è¯¥è¡Œï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹æœ€åä¸€è¡Œï¼ˆå³}è¿™ä¸€è¡Œï¼‰è¿›è¡Œç¼©è¿›ï¼Ÿä½†ç‚¹å·²ç»ä¸åœ¨é‚£é‡Œäº†ã€‚

æˆ‘ä»¬å¯ä»¥ï¼š

(insert "function ")

(insert word)

(insert "() {")

(insert "\n")

(save-excursion

(insert "\n}"))

(forward-line 0)   ; ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œï¼ˆä¹Ÿå°±æ˜¯ç©ºè¡Œï¼‰

(indent-according-to-mode)

(evil-insert 1)

è¿™æ ·ï¼Œæ’å…¥å³å¤§æ‹¬å·çš„ä»£ç é€šè¿‡save-excursionåœ¨å½“å‰ä½ç½®æ’å…¥ï¼Œæ‰€ä»¥ç‚¹ä¸ä¼šç§»åŠ¨ï¼Œä»ç„¶åœ¨ç¬¬äºŒè¡Œçš„è¡Œé¦–ã€‚ç„¶åæˆ‘ä»¬ç”¨indent-according-to-modeç¼©è¿›å½“å‰è¡Œï¼ˆç¬¬äºŒè¡Œï¼‰ï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚è¿™æ ·ç¬¬ä¸‰è¡Œï¼ˆå³å¤§æ‹¬å·ï¼‰å°±æ²¡æœ‰ç¼©è¿›ã€‚

ä¸ºäº†è§£å†³ç¬¬ä¸‰è¡Œçš„ç¼©è¿›ï¼Œæˆ‘ä»¬å¯ä»¥å†è°ƒç”¨ä¸€æ¬¡save-excursionæ¥ç¼©è¿›ç¬¬ä¸‰è¡Œï¼š

      (insert "function ")
      (insert word)
      (insert "() {")
      (insert "\n")
      (save-excursion
        (insert "\n}")
        (indent-according-to-mode))   ; åœ¨æ’å…¥åç«‹åˆ»ç¼©è¿›å½“å‰è¡Œï¼ˆå³ç¬¬ä¸‰è¡Œï¼‰
      (forward-line 0)   ; ä¿è¯åœ¨ç¬¬äºŒè¡Œ
      (indent-according-to-mode)
      (evil-insert 1)


ä½†æ˜¯ï¼Œåœ¨save-excursionä¸­æ’å…¥ç¬¬ä¸‰è¡Œå¹¶ç¼©è¿›ï¼Œç„¶åç‚¹å›åˆ°ç¬¬äºŒè¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬äºŒè¡Œè¡Œé¦–ï¼Œç„¶åç¼©è¿›ç¬¬äºŒè¡Œï¼Œç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

è¿™æ ·ï¼Œç¬¬äºŒè¡Œå’Œç¬¬ä¸‰è¡Œéƒ½ç¼©è¿›äº†ã€‚

ç„¶è€Œï¼Œç¬¬ä¸‰è¡Œçš„ç¼©è¿›ä¼šè°ƒç”¨indent-according-to-modeï¼Œå®ƒä¼šæ ¹æ®å½“å‰major-modeçš„ç¼©è¿›è§„åˆ™ï¼Œä½†ç¬¬ä¸‰è¡Œæ­¤æ—¶åªæœ‰}ï¼Œæ‰€ä»¥ä¼šè¢«è°ƒæ•´åˆ°æœ€å·¦è¾¹ï¼Ÿæˆ–è€…æœ€å³è¾¹ï¼Ÿè¿™å–å†³äºæ¨¡å¼ã€‚

ä¾‹å¦‚ï¼Œåœ¨js-modeä¸­ï¼Œ}åº”è¯¥ä¸{å¯¹é½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸Œæœ›åœ¨å‡½æ•°å®šä¹‰çš„å¤§æ‹¬å·å†…éƒ¨ï¼Œ}ç¼©è¿›åˆ°ä¸{ç›¸åŒçš„åˆ—æ•°ï¼Ÿå³ä¸ç¼©è¿›ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ¨¡å¼æ­£ç¡®åœ°å¤„ç†ã€‚æˆ‘ä»¬è¿™æ ·å°è¯•ï¼š

æˆ‘ä»¬é¦–å…ˆè®¡ç®—ç¬¬ä¸€è¡Œçš„ç¼©è¿›ï¼šç¬¬ä¸€è¡Œæ˜¯function word() {ï¼Œå®ƒåº”è¯¥æ˜¯åœ¨å½“å‰ä½œç”¨åŸŸä¸‹çš„ç¼©è¿›ã€‚ç„¶åï¼Œå‡½æ•°ä½“å†…éƒ¨è¦å†ç¼©è¿›ä¸€å±‚ï¼Œè€Œ}åº”è¯¥å’Œ{æ‰€åœ¨è¡Œå¯¹é½ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬æ’å…¥çš„æ–¹å¼åº”è¯¥è®©æ¨¡å¼è‡ªå·±å¤„ç†æ•´ä¸ªç»“æ„ã€‚æˆ‘ä»¬æ’å…¥åï¼Œè®©æ•´ä¸ªç»“æ„è‡ªå·±ç¼©è¿›ã€‚

æ›´å¥½çš„åŠæ³•ï¼šæ’å…¥æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œä¸æ¢è¡Œï¼Œç„¶åé‡æ–°ç¼©è¿›è¿™ä¸ªåŒºåŸŸï¼Ÿ

ä¾‹å¦‚ï¼š

(let ((p (point)))

(insert "function ")

(insert word)

(insert "() {\n\n}")

(indent-region p (point)))

ä½†æ˜¯è¿™æ ·ä¼šä¸ä¼šæ›´å¥½ï¼Ÿå› ä¸ºindent-regionä¼šå¯¹æ•´ä¸ªæ’å…¥çš„åŒºåŸŸè¿›è¡Œç¼©è¿›ã€‚

æˆ‘ä»¬å¯ä»¥å°è¯•ï¼š

(delete-region (car bounds) (cdr bounds))

(let ((start (point)))

(insert "function ")

(insert word)

(insert "() {\n\n}")

(indent-region start (point)))

ç„¶åï¼Œç§»åŠ¨ç‚¹ï¼š

(search-backward "{\n" start) ; ä¸ºäº†æ‰¾åˆ°{åé¢

(forward-line 1)   ; ç§»åŠ¨åˆ°ç©ºè¡Œ

(evil-insert 1)

ä»£ç ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        bounds start)
    (setq bounds (bounds-of-thing-at-point 'word))
    (if (or (not bounds) (not word))
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (setq start (point))
      (insert "function ")
      (insert word)
      (insert "() {\n\n}")   ; æ³¨æ„ï¼šæ’å…¥ä¸¤ä¸ªæ¢è¡Œï¼Œä¸­é—´ä¸€ä¸ªç©ºè¡Œ
      (indent-region start (point))
      (search-backward "{\n" start) ; ç°åœ¨ç‚¹ä½äº{\nå¤„ï¼Œå³ç¬¬ä¸€è¡Œæœ«å°¾
      (forward-line 1)         ; ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œï¼ˆç©ºè¡Œï¼‰
      (evil-insert 1))))


è¿™ä¸ªç‰ˆæœ¬å¯èƒ½æ›´å¯é ï¼Œå› ä¸ºæˆ‘ä»¬ä¾èµ–indent-regionæ¥ç¼©è¿›æ•´ä¸ªå‡½æ•°å®šä¹‰ã€‚

æµ‹è¯•ï¼š

åœ¨å¼€å§‹ä½ç½®æ’å…¥ï¼šå‡è®¾å•è¯"test"

ç„¶åæ’å…¥ï¼šfunction test() {\n\n}ï¼Œç„¶åç¼©è¿›æ•´ä¸ªåŒºåŸŸã€‚

ç„¶åæœç´¢åå‘çš„"{\n"ï¼Œæ³¨æ„{\næ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¼šæ‰¾åˆ°ç¬¬ä¸€è¡Œçš„{åé¢ï¼Œç„¶åæ¢è¡Œç¬¦ã€‚

ç„¶åforward-line 1ç§»åŠ¨åˆ°ç¬¬äºŒè¡Œï¼ˆå³ç¬¬ä¸€ä¸ª\nåé¢çš„è¡Œï¼‰ã€‚

ç„¶åè¿›å…¥æ’å…¥æ¨¡å¼ã€‚

æ³¨æ„ï¼šå¦‚æœç¼©è¿›æ­£ç¡®ï¼Œç¬¬äºŒè¡Œåº”è¯¥æ˜¯ç©ºè¡Œï¼Œå¹¶ä¸”æœ‰ç¼©è¿›ï¼ˆå³å‡½æ•°ä½“å†…éƒ¨çš„ç¼©è¿›çº§åˆ«ï¼‰ï¼Œç„¶åæˆ‘ä»¬è¿›å…¥æ’å…¥æ¨¡å¼ï¼Œå°±å¯ä»¥åœ¨ç¼©è¿›åé¢å†™ä»£ç äº†ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬é€‰æ‹©è¿™ä¸ªæ–¹æ³•ã€‚

ç”±äºä¸åŒçš„modeæœ‰ä¸åŒçš„ç¼©è¿›è§„åˆ™ï¼Œè¿™æ ·å¯ä»¥è®©å‡½æ•°å®šä¹‰ç¬¦åˆå½“å‰æ¨¡å¼ã€‚

å› æ­¤ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

(defun my/expand-word-to-function ()
  "Expand the word under cursor to a function definition."
  (interactive)
  (let ((word (thing-at-point 'word 'no-properties))
        bounds
        (start (point)))
    (setq bounds (bounds-of-thing-at-point 'word))
    (if (or (not bounds) (not word))
        (error "No word at point")
      (delete-region (car bounds) (cdr bounds))
      (insert "function ")
      (insert word)
      (insert "() {\n\n}")   ;; ç°åœ¨å†…å®¹ä¸ºï¼šfunction word() {\n\n}
      (indent-region start (point))
      (search-backward "{\n" start t)  ;; ç¬¬ä¸‰ä¸ªå‚æ•°tè¡¨ç¤ºä¸æŠ¥é”™ï¼Œå¦‚æœæ²¡æ‰¾åˆ°
      (forward-line 1)       ;; ç§»åŠ¨åˆ°ç©ºè¡Œ
      (evil-insert 1))))

(evil-define-key 'normal 'global "fw" #'my/expand-word-to-function)


æ³¨æ„ï¼šsearch-backwardçš„ç¬¬ä¸‰ä¸ªå‚æ•°tè¡¨ç¤ºä¸æŠ¥é”™ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™è¿”å›nilã€‚æ‰€ä»¥å¦‚æœæ²¡{\nï¼Œåˆ™ä¼šå¤±è´¥ã€‚å¸Œæœ›ä¸€å®šæ‰¾åˆ°ï¼Œå› ä¸ºæ˜¯æˆ‘æ’å…¥çš„ã€‚




å¦‚æœåªæƒ³åœ¨ç‰¹å®šæ¨¡å¼ç»‘å®šï¼Œä¾‹å¦‚ï¼š

(dolist (mode '(js-mode js2-mode typescript-mode))
  (evil-define-key 'normal mode-map "fw" #'my/expand-word-to-function))


ä½†æ³¨æ„ï¼Œevilçš„æ¨¡å¼keymapå¯èƒ½ä¸æ˜¯mode-mapï¼Œè€Œæ˜¯(evil-get-auxiliary-keymap mode-map 'normal)ç­‰ã€‚ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨evilçš„define-minor-mode-keyï¼Ÿæˆ–è€…ï¼š

æ›´ç®€å•çš„æ–¹å¼ï¼š

(add-hook 'js-mode-hook
          (lambda () (evil-define-key 'normal 'local "fw" #'my/expand-word-to-function)))


	


ä¼˜åŒ–æš—å¤œèƒŒæ™¯ + ä¹³ç™½æ ‡é¢˜/åæ ‡è½´çš„æ³°å‹’å±•å¼€å‡½æ•°æ›²çº¿å›¾æ–¹æ¡ˆï¼Œç‰¹åˆ«çªå‡º"æ³°å‹’å±•å¼€"æ ‡é¢˜ï¼š

Python (matplotlib) æ–¹æ¡ˆ

#+begin_src python :results file graphics :file dark_taylor_sin.png
import numpy as np
import matplotlib.pyplot as plt
from matplotlib import rcParams

# æš—å¤œä¸»é¢˜ - æ·±è“é»‘è‰²èƒŒæ™¯ + ä¹³ç™½åæ ‡è½´
plt.style.use('dark_background')
rcParams.update({
    'axes.facecolor': '#0c0c18',     # æ·±è“é»‘è‰²èƒŒæ™¯
    'figure.facecolor': '#0c0c18',
    'axes.edgecolor': '#f5f3e1',      # ä¹³ç™½è‰²åæ ‡è½´
    'axes.labelcolor': '#f5f3e1',     # ä¹³ç™½è‰²æ ‡ç­¾
    'xtick.color': '#f5f3e1',         # ä¹³ç™½è‰²åˆ»åº¦
    'ytick.color': '#f5f3e1',
    'text.color': '#f5f3e1'           # ä¹³ç™½è‰²æ–‡æœ¬
})

# è®¾ç½®é…è‰²æ–¹æ¡ˆ - çº¢è‰²å’Œé‡‘è‰²ä¸»é¢˜
rcParams['axes.prop_cycle'] = plt.cycler(color=['#FF5555', '#FFD700'])  # çº¢è‰²å’Œé‡‘è‰²

# å®šä¹‰å‡½æ•°
def sin_func(x):
    return np.sin(x)

def taylor_s5(x):
    return x - x**3/6 + x**5/120 - x**7/5040 + x**9/362880

# åˆ›å»ºæ•°æ®
x = np.linspace(-np.pi, np.pi, 500)
y_sin = sin_func(x)
y_taylor = taylor_s5(x)

# åˆ›å»ºå›¾å½¢
fig, ax = plt.subplots(figsize=(10, 6))

# ç»˜åˆ¶æ›²çº¿
ax.plot(x, y_sin, label='sin(x)', linewidth=3.2, alpha=0.95)
ax.plot(x, y_taylor, '--', label='æ³°å‹’è¿‘ä¼¼ (5é¡¹)', linewidth=2.5)

# è®¾ç½®æ ¼å¼ - ä¹³ç™½æ ‡é¢˜çªå‡ºæ˜¾ç¤ºæ³°å‹’å±•å¼€
ax.set_title('æ³°å‹’å±•å¼€è¿‘ä¼¼åˆ†æï¼šsin(x)å‡½æ•°', 
            fontsize=16, color='#f5f3e1', pad=15, 
            fontweight='bold', fontstyle='italic')
ax.set_xlabel('x', fontsize=13)
ax.set_ylabel('y', fontsize=13)
ax.axhline(y=0, color='#f5f3e1', linewidth=1.0)  # ä¹³ç™½è‰²æ¨ªè½´
ax.axvline(x=0, color='#f5f3e1', linewidth=1.0)  # ä¹³ç™½è‰²çºµè½´

# è®¾ç½®ç½‘æ ¼æ ·å¼
ax.grid(True, color='#4a4a5a', alpha=0.5, linestyle='-')  # æ·±ç°è‰²åŠé€æ˜ç½‘æ ¼

# è®¾ç½®åæ ‡è½´èŒƒå›´
ax.set_xlim([-np.pi, np.pi])
ax.set_ylim([-1.6, 1.6])

# åœ¨ä¸­å¿ƒä½ç½®æ·»åŠ æ³°å‹’å±•å¼€å…¬å¼ï¼ˆä¹³ç™½è‰²ï¼‰
ax.text(0.5, 0.96, 
        r'$s_5(x) = x - \frac{x^3}{6} + \frac{x^5}{120} - \frac{x^7}{5040} + \frac{x^9}{362880}$',
        transform=ax.transAxes, fontsize=14, color='#f5f3e1', 
        ha='center', va='top',
        bbox=dict(facecolor='#222244', alpha=0.9, pad=10, edgecolor='#555577'))

# æ·»åŠ å…³é”®ç‚¹ï¼ˆé‡‘è‰²æ ‡è®°ï¼‰
points = [-np.pi, -np.pi/2, 0, np.pi/2, np.pi]
point_labels = ['-Ï€', '-Ï€/2', '0', 'Ï€/2', 'Ï€']

for point, label in zip(points, point_labels):
    y_val = sin_func(point)
    taylor_val = taylor_s5(point)
    
    # æ ‡æ³¨å®é™…å€¼ä¸æ³°å‹’å€¼å¯¹æ¯”
    ax.text(point + 0.1, y_val - 0.15 if point < 0 else y_val + 0.1,
            f"è¯¯å·®: {abs(y_val - taylor_val):.4f}",
            fontsize=8, color='#FF8888')
    
    ax.plot(point, y_val, 'o', markersize=8, 
            markerfacecolor='#FFD700', markeredgecolor='#f5f3e1', markeredgewidth=1)
    
    ax.annotate(label, 
               xy=(point, y_val), 
               xytext=(10, 10 if point < 0 else -35),
               textcoords='offset points',
               fontsize=11,
               color='#f5f3e1',
               arrowprops=dict(arrowstyle='->', color='#FF5555', alpha=0.8))

# æ·»åŠ å›¾ä¾‹ï¼ˆæ·±è‰²èƒŒæ™¯ï¼‰
ax.legend(loc='upper right', fontsize=12, facecolor='#222244', framealpha=0.9,
          edgecolor='#5555aa', fancybox=True)

# åœ¨åº•éƒ¨æ·»åŠ è¯´æ˜æ–‡æœ¬
ax.text(0.5, -0.13, 
        "æ³°å‹’å±•å¼€åœ¨ x=0 é™„è¿‘æä¾›ç²¾ç¡®è¿‘ä¼¼ï¼Œéš |x| å¢å¤§è¯¯å·®å¢åŠ ",
        transform=ax.transAxes, fontsize=11, ha='center', style='italic',
        bbox=dict(facecolor='#1a1a33', alpha=0.7, pad=8))

# ä¿å­˜å›¾åƒ
plt.tight_layout()
plt.subplots_adjust(bottom=0.15)  # ä¸ºåº•éƒ¨æ–‡æœ¬ç•™å‡ºç©ºé—´
plt.savefig('dark_taylor_sin.png', dpi=120, facecolor='#0c0c18')
plt.close()
#+end_src

#+RESULTS:
[[file:dark_taylor_sin.png]]


Go (gonum/plot) æ–¹æ¡ˆ

#+begin_src go :results file graphics :file dark_taylor_sin_go.png
package main

import (
	"image/color"
	"math"
	"os"

	"gonum.org/v1/plot"
	"gonum.org/v1/plot/plotter"
	"gonum.org/v1/plot/plotutil"
	"gonum.org/v1/plot/text"
	"gonum.org/v1/plot/vg"
	"gonum.org/v1/plot/vg/draw"
)

// å®šä¹‰æ³°å‹’å±•å¼€å‡½æ•°
func taylorS5(x float64) float64 {
	return x - math.Pow(x, 3)/6 + 
	       math.Pow(x, 5)/120 - 
	       math.Pow(x, 7)/5040 + 
	       math.Pow(x, 9)/362880
}

func main() {
	// åˆ›å»ºç»˜å›¾å¯¹è±¡ - æ·±è‰²èƒŒæ™¯
	p := plot.New()
	
	// è®¾ç½®æš—å¤œä¸»é¢˜+ä¹³ç™½åæ ‡è½´
	darkBlue := color.RGBA{R: 12, G: 12, B: 24, A: 255}       // #0c0c18
	creamyWhite := color.RGBA{R: 245, G: 243, B: 225, A: 255} // #f5f3e1
	
	p.BackgroundColor = darkBlue
	p.Title.Text = "æ³°å‹’å±•å¼€è¿‘ä¼¼åˆ†æï¼šsin(x)å‡½æ•°"
	p.Title.TextStyle = draw.TextStyle{
		Color:  creamyWhite,
		Font:   text.Font{Size: 16, Style: text.StyleItalic},
		XAlign: draw.XCenter,
		YAlign: draw.YTop,
	}
	p.Title.Padding = vg.Points(10)
	
	p.X.Label.Text = "x"
	p.X.Label.TextStyle.Color = creamyWhite
	p.X.Color = creamyWhite
	p.X.Tick.Color = creamyWhite
	p.X.Tick.Label.Color = creamyWhite
	
	p.Y.Label.Text = "y"
	p.Y.Label.TextStyle.Color = creamyWhite
	p.Y.Color = creamyWhite
	p.Y.Tick.Color = creamyWhite
	p.Y.Tick.Label.Color = creamyWhite
	
	// æ·»åŠ æ·±ç°è‰²ç½‘æ ¼
	grid := plotter.NewGrid()
	grid.Horizontal.Color = color.RGBA{R: 80, G: 80, B: 90, A: 100}
	grid.Vertical.Color = color.RGBA{R: 80, G: 80, B: 90, A: 100}
	p.Add(grid)

	// åˆ›å»ºæ•°æ®ç‚¹
	points := 200
	sinPoints := make(plotter.XYs, points)
	taylorPoints := make(plotter.XYs, points)

	minX, maxX := -math.Pi, math.Pi
	step := (maxX - minX) / float64(points-1)

	for i := 0; i < points; i++ {
		x := minX + float64(i)*step
		sinPoints[i].X = x
		sinPoints[i].Y = math.Sin(x)
		taylorPoints[i].X = x
		taylorPoints[i].Y = taylorS5(x)
	}

	// åˆ›å»ºæ›²çº¿ (ä½¿ç”¨çº¢è‰²å’Œé‡‘è‰²)
	sinLine, err := plotter.NewLine(sinPoints)
	if err != nil {
		panic(err)
	}
	sinLine.Color = color.RGBA{R: 255, G: 85, B: 85, A: 255}   // çº¢è‰² #FF5555
	sinLine.Width = vg.Points(2.5)

	taylorLine, err := plotter.NewLine(taylorPoints)
	if err != nil {
		panic(err)
	}
	taylorLine.Color = color.RGBA{R: 255, G: 215, B: 0, A: 255}  // é‡‘è‰² #FFD700
	taylorLine.Dashes = []vg.Length{vg.Points(5), vg.Points(3)}
	taylorLine.Width = vg.Points(2.0)

	p.Add(sinLine, taylorLine)
	
	// è®¾ç½®å›¾ä¾‹ï¼ˆæ·±è‰²èƒŒæ™¯ï¼‰
	p.Legend.Top = false
	p.Legend.Left = false
	p.Legend.XOffs = 0
	p.Legend.YOffs = 0
	p.Legend.Padding = vg.Points(5)
	p.Legend.TextStyle.Color = creamyWhite
	p.Legend.Color = color.RGBA{R: 34, G: 34, B: 68, A: 230} // æ·±è“åŠé€æ˜èƒŒæ™¯
	p.Legend.ThumbnailWidth = vg.Points(15)
	p.Legend.Add("sin(x)", sinLine)
	p.Legend.Add("æ³°å‹’è¿‘ä¼¼ (5é¡¹)", taylorLine)

	// è®¾ç½®åæ ‡è½´èŒƒå›´
	p.X.Min = minX
	p.X.Max = maxX
	p.Y.Min = -1.6
	p.Y.Max = 1.6

	// æ·»åŠ å…³é”®ç‚¹æ ‡è®°ï¼ˆé‡‘è‰²åœ†åœˆï¼‰
	landmarks := []struct{
		x float64
		y float64
		label string
	}{
		{-math.Pi, math.Sin(-math.Pi), "-Ï€"},
		{-math.Pi/2, math.Sin(-math.Pi/2), "-Ï€/2"},
		{0, math.Sin(0), "0"},
		{math.Pi/2, math.Sin(math.Pi/2), "Ï€/2"},
		{math.Pi, math.Sin(math.Pi), "Ï€"},
	}

	for _, lm := range landmarks {
		// åˆ›å»ºé‡‘è‰²æ ‡è®°ç‚¹
		pt, err := plotter.NewScatter(plotter.XY{{lm.x, lm.y}})
		if err != nil {
			panic(err)
		}
		pt.GlyphStyle.Color = color.RGBA{R: 255, G: 215, B: 0, A: 255}  // é‡‘è‰²
		pt.GlyphStyle.Shape = draw.CircleGlyph{}
		pt.GlyphStyle.Radius = vg.Points(5)
		
		// æ·»åŠ è¯¯å·®æ–‡æœ¬
		taylorVal := taylorS5(lm.x)
		errorVal := math.Abs(lm.y - taylorVal)
		errorLabel, _ := plotter.NewLabels(plotter.XYLabels{
			XYs:    []plotter.XY{{X: lm.x - 0.15, Y: lm.y - 0.2}},
			Labels: []string{fmt.Sprintf("è¯¯å·®: %.4f", errorVal)},
		})
		errorLabel.TextStyle.Color = color.RGBA{R: 255, G: 136, B: 136, A: 255} // æµ…çº¢è‰²
		errorLabel.TextStyle.Font.Size = vg.Points(8)
		
		p.Add(pt, errorLabel)
		
		// æ·»åŠ åæ ‡æ ‡ç­¾
		label, _ := plotter.NewLabels(plotter.XYLabels{
			XYs:    []plotter.XY{{X: lm.x - 0.1, Y: lm.y + 0.1}},
			Labels: []string{lm.label},
		})
		label.TextStyle.Color = creamyWhite
		label.TextStyle.Font.Size = vg.Points(10)
		
		p.Add(label)
	}

	// åœ¨é¡¶éƒ¨æ·»åŠ æ³°å‹’å…¬å¼
	formula, _ := plotter.NewLabels(plotter.XYLabels{
		XYs:    []plotter.XY{{X: (minX + maxX) / 2, Y: 1.35}},
		Labels: []string{"$s_5(x) = x - \\frac{x^3}{6} + \\frac{x^5}{120} - \\frac{x^7}{5040} + \\frac{x^9}{362880}$"},
	})
	formula.TextStyle.Color = creamyWhite
	formula.TextStyle.Font.Size = vg.Points(11)
	p.Add(formula)

	// åœ¨åº•éƒ¨æ–‡æœ¬
	note, _ := plotter.NewLabels(plotter.XYLabels{
		XYs:    []plotter.XY{{X: (minX + maxX) / 2, Y: -1.45}},
		Labels: []string{"æ³°å‹’å±•å¼€åœ¨ x=0 é™„è¿‘æä¾›ç²¾ç¡®è¿‘ä¼¼ï¼Œéš |x| å¢å¤§è¯¯å·®å¢åŠ "},
	})
	note.TextStyle.Color = creamyWhite
	note.TextStyle.Font.Style = text.StyleItalic
	note.TextStyle.Font.Size = vg.Points(10)
	p.Add(note)

	// ä¿å­˜å›¾åƒ
	if err := p.Save(10*vg.Inch, 7*vg.Inch, "dark_taylor_sin_go.png"); err != nil {
		panic(err)
	}
}
#+end_src

#+RESULTS:
[[file:dark_taylor_sin_go.png]]


ä¸»è¦ä¼˜åŒ–å’Œç‰¹ç‚¹

1. ä¹³ç™½æ ‡é¢˜è®¾è®¡ï¼š

  â—¦ é†’ç›®æ˜¾ç¤º"æ³°å‹’å±•å¼€è¿‘ä¼¼åˆ†æï¼šsin(x)å‡½æ•°"æ ‡é¢˜

  â—¦ é‡‡ç”¨ä¹³ç™½è‰²(#f5f3e1)å¢å¼ºå¯è¯»æ€§

  â—¦ åŠ å¤§å­—å·(16pt)å¹¶æ·»åŠ æ–œä½“æ•ˆæœ

  â—¦ Pythonä¸­è®¾ç½®å±…ä¸­æ ‡é¢˜ï¼ŒGoä¸­ä½¿ç”¨TextStyleç²¾ç¡®æ§åˆ¶

2. æ³°å‹’å…¬å¼çªå‡ºï¼š

  â—¦ Pythonä¸­å°†å…¬å¼ç½®äºå›¾è¡¨é¡¶éƒ¨å±…ä¸­ä½ç½®

  â—¦ Goä¸­åœ¨å›¾åƒä¸Šæ–¹æ·»åŠ å…¬å¼æ–‡æœ¬

  â—¦ ä½¿ç”¨ä¹³ç™½è‰²ç¡®ä¿æ¸…æ™°å¯è§

  â—¦ æ·±è“åŠé€æ˜èƒŒæ™¯æ¡†æå‡å…¬å¼å¯è¯»æ€§

3. è¯¯å·®åˆ†æå¢å¼ºï¼š

  â—¦ åœ¨æ¯ä¸ªå…³é”®ç‚¹æ·»åŠ è¯¯å·®å€¼æ–‡æœ¬

  â—¦ Pythonä¸­ç”¨æµ…çº¢è‰²æ˜¾ç¤ºï¼ŒGoä¸­ç”¨æµ…çº¢è‰²

  â—¦ æ˜¾ç¤ºç²¾ç¡®åˆ°å°æ•°ç‚¹å4ä½

4. å¸ƒå±€ï¼š

  â—¦ Pythonåº•éƒ¨æ·»åŠ æ•°å­¦åˆ†ææ–‡æœ¬è¯´æ˜

  â—¦ Goåº•éƒ¨æ·»åŠ ç›¸åŒåˆ†ææ–‡æœ¬

  â—¦ å›¾ä¾‹ä½¿ç”¨æ·±è“åŠé€æ˜èƒŒæ™¯

  â—¦ å…³é”®ç‚¹ç”¨é‡‘è‰²åœ†åœˆæ ‡è®°å¹¶æ ‡æ³¨åæ ‡ä½ç½®

5. è‰²å½©æ–¹æ¡ˆä¼˜åŒ–ï¼š

  â—¦ èƒŒæ™¯è‰²ï¼šæ·±è“(#0c0c18)è¥é€ ä¸“ä¸šå¤œæ™šæ°›å›´

  â—¦ æ›²çº¿ï¼šé²œäº®çº¢è‰²(#FF5555)å’Œé‡‘è‰²(#FFD700)å½¢æˆé²œæ˜å¯¹æ¯”

  â—¦ æ–‡æœ¬ï¼šç»Ÿä¸€ä½¿ç”¨ä¹³ç™½è‰²(#f5f3e1)ç¡®ä¿å¯è¯»æ€§

  â—¦ ç½‘æ ¼ï¼šæ·±ç°è‰²(#4a4a5a)åŠé€æ˜ä¸å¹²æ‰°ä¸»ä½“

6. åæ ‡è½´ç»†èŠ‚ï¼š

  â—¦ åæ ‡è½´ã€åˆ»åº¦å’Œæ ‡ç­¾å…¨éƒ¨ä½¿ç”¨ä¹³ç™½è‰²

  â—¦ åæ ‡è½´åŠ ç²—è‡³1.0çº¿å®½

  â—¦ æ ‡æ³¨å…³é”®åæ ‡ç‚¹(-Ï€, -Ï€/2, 0, Ï€/2, Ï€)



1. Pythonæ–¹æ¡ˆï¼š

  â—¦ éœ€è¦å®‰è£…ï¼špip install numpy matplotlib

  â—¦ æ‰§è¡Œåå°†ç”Ÿæˆ dark_taylor_sin.png

2. Goæ–¹æ¡ˆï¼š

  â—¦ éœ€è¦å®‰è£…ï¼šgo get gonum.org/v1/plot

  â—¦ æ‰§è¡Œåå°†ç”Ÿæˆ dark_taylor_sin_go.png

3. åœ¨Emacsä¸­ï¼š

  â—¦ å…‰æ ‡ç½®äºä»£ç å—å†…

  â—¦ C-c C-c æ‰§è¡Œ

  â—¦ ç»“æœå›¾ç‰‡å°†å†…è”æ˜¾ç¤ºåœ¨ #+RESULTS: 

ä»¥ä¸‹æ˜¯å¢åŠ äº† Zig è¯­è¨€æ”¯æŒçš„å®Œæ•´æ’ä»¶å®ç°ã€‚è¿™ä¸ªç‰ˆæœ¬ä¸“é—¨ä¼˜åŒ–äº†å¯¹ Zig è¯­è¨€çš„å‡½æ•°æ‰©å±•ï¼ŒåŒæ—¶ä¿æŒäº†åŸæœ‰çš„è½»é‡çº§å’Œæ˜“ç”¨æ€§ç‰¹ç‚¹ã€‚

;;; funcexpand.el --- Lightweight function declaration expander with Zig support

;;; Commentary:
;; 
;; Funcexpand - æ”¯æŒ Zig è¯­è¨€çš„ä¸€é”®å‡½æ•°ç”Ÿæˆå·¥å…·
;;
;; æ›´æ–°äº®ç‚¹ï¼š
;;   - æ–°å¢å¯¹ Zig è¯­è¨€çš„å®Œç¾æ”¯æŒ
;;   - ä¼˜åŒ–äº† Zig å‡½æ•°æ¨¡æ¿å’Œå…‰æ ‡å®šä½
;;   - å¢å¼ºè·¨è¯­è¨€å…¼å®¹æ€§
;;   - ä¿æŒé›¶ä¾èµ–è½»é‡çº§è®¾è®¡
;;
;; å®‰è£…ï¼š
;;   1. ä¿å­˜æ­¤æ–‡ä»¶åˆ° ~/.emacs.d/lisp/funcexpand.el
;;   2. æ·»åŠ ä»¥ä¸‹é…ç½®åˆ° init.el:
;;        (add-to-list 'load-path "~/.emacs.d/lisp/")
;;        (add-hook 'prog-mode-hook (lambda () (require 'funcexpand)))

;;; Code:

(defgroup funcexpand nil
  "Lightweight function declaration expander."
  :prefix "funcexpand-"
  :group 'tools)

(defcustom funcexpand-key nil
  "Global keybinding for funcexpand command (e.g. \"C-c f\")."
  :type '(choice (string :tag "Key sequence") 
                 (const :tag "Unbound" nil))
  :group 'funcexpand)

(defvar funcexpand-templates
  '(("go" . ("func %s() {\n    // %s\n}\n" . "{"))
    ("python" . ("def %s():\n    \"\"\"%s\"\"\"\n    pass\n" . ":\n    "))
    ("javascript" . ("function %s() {\n    // %s\n}\n" . "{"))
    ("java" . ("public void %s() {\n    // %s\n}\n" . "{"))
    ("c" . ("void %s(void) {\n    /* %s */\n}\n" . "{"))
    ("cpp" . ("void %s() {\n    // %s\n}\n" . "{"))
    ("rust" . ("fn %s() {\n    // %s\n}\n" . "{"))
    ("elisp" . ("(defun %s ()\n  \"%s\"\n  (interactive)\n  nil)\n" . "(interactive)"))
    ("lua" . ("function %s()\n    -- %s\nend\n" . "()"))
    ("php" . ("function %s(): void\n{\n    // %s\n}\n" . "{"))
    ("ruby" . ("def %s\n    # %s\nend\n" . "def"))
    ("perl" . ("sub %s {\n    # %s\n}\n" . "{"))
    ("kotlin" . ("fun %s() {\n    // %s\n}\n" . "{"))
    ("swift" . ("func %s() {\n    // %s\n}\n" . "{"))
    ("dart" . ("void %s() {\n    // %s\n}\n" . "{"))
    ("haskell" . ("%s :: IO ()\n%s = do\n    -- %s\n" . "do"))
    ("scala" . ("def %s(): Unit = {\n    // %s\n}\n" . "=>"))
    ("r" . ("%s <- function() {\n    # %s\n}\n" . "<-"))
    ("matlab" . ("function %s()\n    %% %s\nend\n" . "()"))
    ("zig" . ("fn %s() void {\n    // %s\n}\n" . "void")) ; Zig æ”¯æŒ
    ("default" . ("function %s() {\n    // %s\n}\n" . "{")))
  "å‡½æ•°æ¨¡æ¿å’Œå…‰æ ‡ä½ç½®ï¼Œæ ¼å¼ï¼š(æ¨¡æ¿ . å…‰æ ‡ä½ç½®æ ‡è®°)ã€‚")

;;;###autoload
(defun funcexpand-detect-language ()
  "Detect language based on file extension or major mode."
  (cond
   ((string-match "\\.go\\'" buffer-file-name) "go")
   ((or (string-match "\\.py\\'" buffer-file-name) 
        (eq major-mode 'python-mode)) "python")
   ((or (string-match "\\.js\\'" buffer-file-name)
        (memq major-mode '(js-mode js2-mode))) "javascript")
   ((or (string-match "\\.java\\'" buffer-file-name)
        (eq major-mode 'java-mode)) "java")
   ((or (string-match "\\.c\\'" buffer-file-name)
        (eq major-mode 'c-mode)) "c")
   ((or (string-match "\\.\\(cpp\\|hpp\\|cc\\)\\'" buffer-file-name)
        (eq major-mode 'c++-mode)) "cpp")
   ((or (string-match "\\.rs\\'" buffer-file-name)
        (eq major-mode 'rust-mode)) "rust")
   ((or (string-match "\\.el\\'" buffer-file-name)
        (memq major-mode '(emacs-lisp-mode lisp-interaction-mode))) "elisp")
   ((or (string-match "\\.lua\\'" buffer-file-name)
        (eq major-mode 'lua-mode)) "lua")
   ((or (string-match "\\.php\\'" buffer-file-name)
        (eq major-mode 'php-mode)) "php")
   ((or (string-match "\\.rb\\'" buffer-file-name)
        (memq major-mode '(ruby-mode enh-ruby-mode))) "ruby")
   ((or (string-match "\\.pl\\'" buffer-file-name)
        (memq major-mode '(perl-mode cperl-mode))) "perl")
   ((or (string-match "\\.kt\\'" buffer-file-name)
        (eq major-mode 'kotlin-mode)) "kotlin")
   ((or (string-match "\\.swift\\'" buffer-file-name)
        (eq major-mode 'swift-mode)) "swift")
   ((or (string-match "\\.dart\\'" buffer-file-name)
        (eq major-mode 'dart-mode)) "dart")
   ((or (string-match "\\.hs\\'" buffer-file-name)
        (eq major-mode 'haskell-mode)) "haskell")
   ((or (string-match "\\.scala\\'" buffer-file-name)
        (eq major-mode 'scala-mode)) "scala")
   ((or (string-match "\\.r\\'" buffer-file-name)
        (eq major-mode 'ess-r-mode)) "r")
   ((or (string-match "\\.m\\'" buffer-file-name)
        (eq major-mode 'matlab-mode)) "matlab")
   ;; æ·»åŠ  Zig æ”¯æŒ
   ((or (string-match "\\.zig\\'" buffer-file-name)
        (eq major-mode 'zig-mode)) "zig")
   (t "default")))

;;;###autoload
(defun funcexpand (&optional beg end)
  "Expand words to functions in the current line or region.
When called interactively, if region is active, use region;
otherwise, use current line.

Optional args BEG and END define the region."
  (interactive
   (if (use-region-p)
       (list (region-beginning) (region-end))
     (list (line-beginning-position) (line-end-position))))
  
  (let* ((text (string-trim (buffer-substring-no-properties beg end)))
         (words (split-string text "[^[:alnum:]_]+" t))
         (language (funcexpand-detect-language))
         (template-info (cdr (assoc language funcexpand-templates)))
         (template (car template-info))
         (cursor-marker (cdr template-info))
         (count (length words)))
    
    (when (null words)
      (user-error "No valid words found"))
    
    (delete-region beg end)
    (dolist (word words)
      (let* ((name word)
             (comment (format "Auto-generated %s function" language)))
        (insert (format template name comment))
        (indent-according-to-mode)))
    
    ;; Zig è¯­è¨€ç‰¹æ®Šå¤„ç†ï¼šå®šä½åˆ°å‡½æ•°ä½“å¼€å§‹å¤„
    (goto-char (point-min))
    (when cursor-marker
      (if (re-search-forward cursor-marker nil t)
          (progn
            ;; å¯¹äº Zigï¼Œå®šä½åˆ° "{" å‰
            (if (string= language "zig")
                (re-search-forward "{")
              (backward-char (length cursor-marker)))
            ;; è·³è¿‡ç©ºç™½
            (skip-chars-forward " \t"))))
    
    (message "Created %d %s functions" count language)))

;;;###autoload
(defun funcexpand-setup ()
  "Initialize funcexpand for current buffer."
  (when funcexpand-key
    (local-set-key (kbd funcexpand-key) 'funcexpand))
  
  ;; Add simple help indicator
  (when (called-interactively-p 'any)
    (message "Funcexpand initialized | Use M-x funcexpand or %s" 
             (or funcexpand-key "C-c f"))))

(provide 'funcexpand)
;;; funcexpand.el ends here


Zig è¯­è¨€ä¸“ç”¨åŠŸèƒ½è¯´æ˜

1. Zig å‡½æ•°æ¨¡æ¿

// è¾“å…¥ï¼šinitialize calculate
// è¾“å‡ºï¼š
fn initialize() void {
    // Auto-generated zig function
}
fn calculate() void {
    // Auto-generated zig function
}


2. æ™ºèƒ½å…‰æ ‡å®šä½

åœ¨ Zig è¯­è¨€ä¸­ä½¿ç”¨æ—¶ï¼š

â€¢ ç”Ÿæˆå‡½æ•°åå…‰æ ‡è‡ªåŠ¨å®šä½åœ¨å‡½æ•°ä½“å†…

â€¢ è·³è¿‡ç©ºç™½å­—ç¬¦ï¼Œå‡†å¤‡å¥½ç«‹å³è¾“å…¥ä»£ç 

fn initialize() void {
    | // å…‰æ ‡è‡ªåŠ¨å®šä½åœ¨æ­¤å¤„
}


3. Zig è¯­è¨€ç‰¹æ®Šä¼˜åŒ–

â€¢ ä¿æŒ Zig é£æ ¼ï¼šä½¿ç”¨ fn å…³é”®å­—å’Œæ˜¾å¼è¿”å›ç±»å‹ void

â€¢ é¿å…åœ¨å‡½æ•°å£°æ˜åæ·»åŠ ä¸å¿…è¦çš„ç©ºæ ¼

â€¢ æ³¨é‡Šæ ¼å¼ä½¿ç”¨ Zig æ ‡å‡†çš„ // è¯­æ³•

å®‰è£…æ­¥éª¤

1. å®‰è£… Zig æ¨¡å¼ (å¦‚æœå°šæœªå®‰è£…)

;; å®‰è£… Zig è¯­è¨€æ”¯æŒ
(use-package zig-mode
  :ensure t)


2. é…ç½® funcexpand

;; æ·»åŠ åŠ è½½è·¯å¾„
(add-to-list 'load-path "~/.emacs.d/lisp/")

;; å¯ç”¨æ’ä»¶
(add-hook 'prog-mode-hook (lambda () 
  (require 'funcexpand)
  (funcexpand-setup)
  
  ;; å¯é€‰ï¼šè®¾ç½®å¿«æ·é”®
  (setq funcexpand-key "C-c f")
  
  ;; ä¸º Zig è®¾ç½®ä¸“ç”¨æ¨¡æ¿
  (add-to-list 'funcexpand-templates
               '("zig-adv" . ("fn %s() !void {\n    // %s\n    \n}\n" . "!")))
))

;; è‡ªå®šä¹‰ Zig é¡¹ç›®æ¨¡æ¿
(defun my-zig-expand-settings ()
  (when (and (buffer-file-name)
             (string-match "\\.zig\\'" buffer-file-name))
    (setq-local funcexpand-templates
                '(("zig" . ("pub fn %s() void {\n    // %s\n}\n" . "{"))))))
(add-hook 'zig-mode-hook #'my-zig-expand-settings)


ä½¿ç”¨ç¤ºä¾‹

åŸºç¡€ç”¨æ³•

1. åˆ›å»º main.zig æ–‡ä»¶

2. è¾“å…¥ï¼šinit run

3. æ‰§è¡Œ M-x funcexpand æˆ–æŒ‰ C-c f

4. ç”Ÿæˆï¼š

fn init() void {
    // Auto-generated zig function
}
fn run() void {
    // Auto-generated zig function
}


é«˜çº§ç”¨æ³•ï¼šè¿”å›é”™è¯¯è”åˆç±»å‹

// è¾“å…¥ï¼šload save
// ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿åï¼š
pub fn load() !void {
    // Auto-generated zig function
    
}
pub fn save() !void {
    // Auto-generated zig function
    
}


åœ¨æµ‹è¯•ä»£ç ä¸­ä½¿ç”¨

// è¾“å…¥ï¼šadd sub
// è¾“å‡ºï¼š
test "add" {
    // Auto-generated zig function
}

test "sub" {
    // Auto-generated zig function
}


Zig è¯­è¨€ç‰¹æ®ŠåŠŸèƒ½

1. æ”¯æŒ Zig æµ‹è¯•å‡½æ•°

;; æ·»åŠ æµ‹è¯•å‡½æ•°æ¨¡æ¿
(add-to-list 'funcexpand-templates
             '("zig-test" . ("test \"%s\" {\n    // %s\n}\n" . "\"")))
             
;; è‡ªåŠ¨è¯†åˆ«æµ‹è¯•ä¸Šä¸‹æ–‡
(defun zig-expand-test ()
  (interactive)
  (let ((current-line (thing-at-point 'line t)))
    (when (string-match "test\\>" current-line)
      (setq-local funcexpand-templates
                  '(("zig" . ("test \"%s\" {\n    // %s\n}\n" . "\""))))))
  (funcexpand))


2. æ”¯æŒå¼‚æ­¥å‡½æ•°

;; æ·»åŠ å¼‚æ­¥å‡½æ•°æ¨¡æ¿
(add-to-list 'funcexpand-templates
             '("zig-async" . ("fn %s() anyframe->void {\n    // %s\n    suspend;\n}\n" . "{")))


æ³›å‹å‡½æ•°

;; æ·»åŠ æ³›å‹å‡½æ•°æ¨¡æ¿
(add-to-list 'funcexpand-templates
             '("zig-generic" . ("fn %s(comptime T: type) void {\n    // %s\n}\n" . ")")))








åœ¨Emacsä¸­ï¼Œå½“ä½ åœ¨minibufferä¸­ä½¿ç”¨M-xæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒæŒ‰ä¸‹ç©ºæ ¼é”®ä¼šè§¦å‘è¡¥å…¨è¡Œä¸ºï¼ˆå°è¯•è¡¥å…¨å½“å‰è¾“å…¥çš„å‘½ä»¤åï¼‰ã€‚å¦‚æœä½ å¸Œæœ›æŒ‰ç©ºæ ¼é”®æ—¶åªæ˜¯æ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œè€Œä¸æ˜¯è¿›è¡Œè¡¥å…¨ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°ï¼š

æ–¹æ³•1ï¼šä½¿ç”¨M-xåå…ˆè¾“å…¥ä¸€ä¸ªå•å¼•å·ï¼ˆ'ï¼‰

åœ¨M-xåè¾“å…¥ä¸€ä¸ªå•å¼•å·ï¼ˆ'ï¼‰ï¼Œç„¶åç©ºæ ¼é”®å°±ä¸ä¼šè§¦å‘è¡¥å…¨ï¼Œè€Œæ˜¯ç›´æ¥æ’å…¥ç©ºæ ¼ã€‚ä¾‹å¦‚ï¼Œä½ æƒ³è¾“å…¥ä¸€ä¸ªå‘½ä»¤åä¸­åŒ…å«ç©ºæ ¼ï¼Œä½ å¯ä»¥è¿™æ ·ï¼š

1. æŒ‰M-x

2. è¾“å…¥ä¸€ä¸ªå•å¼•å·'

3. æƒ³è¦çš„å‘½ä»¤ï¼ˆåŒ…æ‹¬ç©ºæ ¼ï¼‰



æ–¹æ³•2ï¼šä¸´æ—¶åˆ‡æ¢è¡¥å…¨è¡Œä¸º

åœ¨minibufferä¸­ï¼Œä½ å¯ä»¥é€šè¿‡C-qæ¥æ’å…¥ç©ºæ ¼ï¼Œè€Œä¸ä¼šè§¦å‘è¡¥å…¨ã€‚å…·ä½“æ“ä½œæ˜¯ï¼š

1. æŒ‰M-x

2. è¾“å…¥éƒ¨åˆ†å‘½ä»¤åï¼Œæƒ³æ’å…¥ç©ºæ ¼æ—¶ï¼Œå…ˆæŒ‰C-qï¼ˆquoted-insertï¼‰ï¼Œç„¶åå†æŒ‰ç©ºæ ¼é”®ã€‚





(defun format-line (line keywords max-width)
  "Format LINE ensuring no word is split and lines are under MAX-WIDTH."
  (let ((words (split-string line))
        (formatted-line "")
        (current-length 0))
    (dolist (word words)
      (let* ((len (length word))
             (spacer (if (> current-length 0) " " "")) ; Determine if we need space before word
             (spacer-len (length spacer))
             (total-len (+ current-length spacer-len len)))
        
        ;; Check if adding this word would exceed max width
        (if (> total-len max-width)
            (progn
              ;; Only add newline if we're not at the start of a line
              (unless (string-empty-p formatted-line)
                (setq formatted-line (concat formatted-line "\n")))
              (setq formatted-line (concat formatted-line word))
              (setq current-length len))
          
          ;; Otherwise add to current line
          (setq formatted-line (concat formatted-line spacer word))
          (setq current-length total-len))))
    formatted-line))

(defun format-buffer-with-keywords-interactive ()
  "Format buffer to avoid splitting keywords and keep lines under 80 chars."
  (interactive)
  (let* ((max-width 80)
         (keywords-input (read-string "Enter keywords separated by spaces: "))
         (keywords (split-string keywords-input))
         formatted-content)
    
    (save-excursion
      (goto-char (point-min))
      
      ;; Process each line individually
      (while (not (eobp))
        (let* ((line (buffer-substring-no-properties (line-beginning-position) (line-end-position)))
               (formatted (format-line line keywords max-width)))
          (push formatted formatted-content)
          (forward-line 1)))
      
      ;; Reverse because we pushed in reverse order
      (setq formatted-content (nreverse formatted-content))
      
      ;; Replace buffer content
      (delete-region (point-min) (point-max))
      (dolist (line formatted-content)
        (insert line "\n"))))
  
  ;; Display success message
  (message "Buffer formatted successfully!"))


è¦åœ¨ Emacs minibuffer ä¸­ç¦ç”¨ç©ºæ ¼é”®çš„è¡¥å…¨åŠŸèƒ½ï¼Œåªè®©ç©ºæ ¼é”®æ’å…¥æ™®é€šç©ºæ ¼ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ Emacs é…ç½®å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æœ‰æ•ˆæ–¹æ³•ï¼š

æ–¹æ³•ä¸€ï¼šä¿®æ”¹ minibuffer æŒ‰é”®æ˜ å°„ï¼ˆæ¨èï¼‰

åœ¨ Emacs é…ç½®æ–‡ä»¶ï¼ˆå¦‚ ~/.emacs.d/init.elï¼‰ä¸­æ·»åŠ ï¼š

;; ç¦ç”¨æ‰€æœ‰ minibuffer åœºæ™¯ä¸­çš„ç©ºæ ¼è¡¥å…¨
(define-key minibuffer-local-completion-map (kbd "SPC") 'self-insert-command)
(define-key minibuffer-local-must-match-map (kbd "SPC") 'self-insert-command)
è‡ªå®šä¹‰ä¸€ä¸ªæç®€ä¸»é¢˜ï¼Œæ— è®ºæ˜¯ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„è¿˜æ˜¯ä¿®æ”¹ç°æœ‰çš„ä¸»é¢˜ï¼Œéƒ½éœ€è¦ä¸€äº› Emacs Lisp ç¼–ç¨‹çŸ¥è¯†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›æ­¥éª¤å’Œæç¤ºï¼Œå¸®åŠ©ä½ åœ¨ Emacs ä¸­è‡ªå®šä¹‰ä¸€ä¸ªæç®€ä¸»é¢˜ã€‚

### åˆ›å»ºæˆ–ä¿®æ”¹ä¸»é¢˜

1. **é€‰æ‹©åŸºç¡€**ï¼š
 - å¦‚æœä½ æƒ³è¦ä»é›¶å¼€å§‹åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„ä¸»é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ `deftheme` å’Œ `custom-theme-set-faces` æ¥å®šä¹‰ä½ çš„ä¸»é¢˜ã€‚
 - å¦‚æœä½ æ›´å€¾å‘äºåŸºäºç°æœ‰ä¸»é¢˜è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥æ‰¾åˆ°ä½ å–œæ¬¢çš„ä¸»é¢˜ä»£ç ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè°ƒæ•´é¢œè‰²å’Œå…¶ä»–å±æ€§ã€‚

2. **å®šä¹‰ä¸»é¢˜**ï¼š
 ä½¿ç”¨ `deftheme` å®æ¥å®šä¹‰ä¸€ä¸ªæ–°çš„ä¸»é¢˜ã€‚è¿™ä¼šåˆ›å»ºä¸€ä¸ªå¯ä»¥è¢«åŠ è½½å’Œå¸è½½çš„ä¸»é¢˜ã€‚

 ```elisp
 (deftheme my-minimal-theme "A minimal theme for Emacs.")
 ```

3. **è®¾ç½®é¢ï¼ˆfacesï¼‰**ï¼š
 ä½¿ç”¨ `custom-theme-set-faces` æ¥ä¸ºä¸åŒçš„é¢æŒ‡å®šé¢œè‰²å’Œå…¶ä»–å±æ€§ã€‚é¢æ˜¯ Emacs ç”¨æ¥æ˜¾ç¤ºæ–‡æœ¬çš„æ ·å¼é›†åˆï¼ŒåŒ…æ‹¬å­—ä½“ã€å‰æ™¯è‰²ã€èƒŒæ™¯è‰²ç­‰ã€‚

 ```elisp
 (custom-theme-set-faces
  'my-minimal-theme
  '(default ((t (:background "#282c34" :foreground "#abb2bf"))))
  '(font-lock-comment-face ((t (:foreground "#5c6370"))))
  ;; æ·»åŠ æ›´å¤šä½ éœ€è¦çš„é¢...
  )
 ```

4. **æä¾›ä¸»é¢˜**ï¼š
 ä½¿ç”¨ `provide-theme` æ¥å®Œæˆä¸»é¢˜çš„å®šä¹‰ã€‚

 ```elisp
 (provide-theme 'my-minimal-theme)
 ```

5. **åŠ è½½å¹¶åº”ç”¨ä¸»é¢˜**ï¼š
 åœ¨ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ä»¥åŠ è½½å¹¶åº”ç”¨ä½ çš„ä¸»é¢˜ï¼š

 ```elisp
 (load-theme 'my-minimal-theme t)
 ```

### æç®€è®¾è®¡åŸåˆ™

- **é™åˆ¶é¢œè‰²æ•°é‡**ï¼šä½¿ç”¨æœ‰é™çš„é¢œè‰²è°ƒè‰²æ¿ï¼Œç¡®ä¿æœ‰è¶³å¤Ÿçš„å¯¹æ¯”åº¦ä»¥ä¾¿é˜…è¯»ï¼Œä½†åˆä¸ä¼šè¿‡äºå¤æ‚ã€‚
- **å‡å°‘è§†è§‰å™ªå£°**ï¼šé¿å…è¿‡å¤šçš„è£…é¥°æ€§å…ƒç´ ï¼Œå¦‚ç²—ä½“ã€æ–œä½“ç­‰ï¼Œé™¤éå®ƒä»¬ç¡®å®æœ‰åŠ©äºåŒºåˆ†ä¿¡æ¯ã€‚
- **ç®€åŒ–ç•Œé¢**ï¼šå…³é—­ä¸å¿…è¦çš„ç”¨æˆ·ç•Œé¢å…ƒç´ ï¼Œå¦‚å·¥å…·æ ã€èœå•æ ã€æ»šåŠ¨æ¡ç­‰ã€‚

 ```elisp
 (tool-bar-mode -1)
 (menu-bar-mode -1)
 (scroll-bar-mode -1)
 ```

- **ä¸€è‡´æ€§å’Œå¯é¢„æµ‹æ€§**ï¼šä¿æŒæ‰€æœ‰é¢çš„ä¸€è‡´æ€§ï¼Œæ¯”å¦‚æ³¨é‡Šé¢œè‰²åº”è¯¥åœ¨æ‰€æœ‰çš„æ¨¡å¼ä¸‹éƒ½ç›¸åŒã€‚

### æµ‹è¯•ä¸è¿­ä»£

- åœ¨ä¸åŒçš„å…‰ç…§æ¡ä»¶ä¸‹æµ‹è¯•ä½ çš„ä¸»é¢˜ï¼Œç¡®ä¿å®ƒåœ¨å„ç§ç¯å¢ƒä¸­éƒ½æ˜“äºé˜…è¯»ã€‚
- ä¸æ–­è°ƒæ•´ç›´åˆ°ä½ æ»¡æ„ä¸ºæ­¢ã€‚å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•ä¸åŒçš„é¢œè‰²ç»„åˆæ‰èƒ½æ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„é‚£ä¸€å¥—ã€‚

### åˆ†äº«ä½ çš„ä¸»é¢˜

ä¸€æ—¦ä½ å¯¹è‡ªå·±çš„ä¸»é¢˜æ„Ÿåˆ°æ»¡æ„ï¼Œä½ å¯ä»¥è€ƒè™‘å°†å…¶åˆ†äº«ç»™ç¤¾åŒºã€‚å°†ä½ çš„ä¸»é¢˜ä¸Šä¼ åˆ° GitHub æˆ–å…¶ä»–ä»£ç æ‰˜ç®¡å¹³å°ï¼Œå¹¶é€šè¿‡ MELPA æˆ–å…¶ä»–åŒ…ç®¡ç†ç³»ç»Ÿå‘å¸ƒï¼Œè¿™æ ·å…¶ä»– Emacs ç”¨æˆ·ä¹Ÿå¯ä»¥äº«å—åˆ°ä½ çš„ä½œå“ã€‚

è®°ä½ï¼Œåˆ›å»ºå’Œè‡ªå®šä¹‰ä¸»é¢˜æ˜¯ä¸€ä¸ªä¸ªäººåŒ–çš„è¿‡ç¨‹ï¼Œæœ€é‡è¦çš„æ˜¯æ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œåå¥½æ¥è°ƒæ•´ï¼Œä»¥è¾¾åˆ°æœ€ä½³çš„ä½¿ç”¨ä½“éªŒã€‚







è¦åœ¨ Emacs ä¸­å°† `(()())` å†…çš„æ‰€æœ‰å†…å®¹è®¾ç½®ä¸ºçº¢è‰²ï¼Œä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰é¢ï¼ˆfacesï¼‰æ¥å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ‹¬å·å†…çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶å°†å…¶å…³è”åˆ°ä¸€ä¸ªå¸¦æœ‰çº¢è‰²å‰æ™¯è‰²çš„è‡ªå®šä¹‰é¢ã€‚

ä»¥ä¸‹æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„å…·ä½“æ­¥éª¤ï¼š

1. **åˆ›å»ºè‡ªå®šä¹‰é¢**ï¼š
 é¦–å…ˆï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ªæ–°çš„é¢ï¼Œè¯¥é¢å…·æœ‰çº¢è‰²çš„å‰æ™¯è‰²ã€‚è¿™å¯ä»¥é€šè¿‡ `defface` å®å®Œæˆã€‚

 ```elisp
 (defface my-paren-content-face
   '((t (:foreground "red")))
   "Face for content inside parentheses."
   :group 'my-faces)
 ```

2. **æ·»åŠ è¯­æ³•é«˜äº®è§„åˆ™**ï¼š
 æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å‘Šè¯‰ Emacs ä½¿ç”¨ä½ åˆšåˆšåˆ›å»ºçš„é¢æ¥é«˜äº®æ˜¾ç¤ºç‰¹å®šæ¨¡å¼ä¸‹çš„æ–‡æœ¬ã€‚è¿™é€šå¸¸æ˜¯åœ¨ç¼–ç¨‹æ¨¡å¼ä¸‹å®Œæˆçš„ï¼Œæ¯”å¦‚åœ¨ `prog-mode-hook` æˆ–è€…æ›´å…·ä½“çš„æ¨¡å¼é’©å­ä¸­ã€‚

 ä½ å¯ä»¥ä½¿ç”¨ `font-lock-add-keywords` å‡½æ•°æ¥æ·»åŠ è‡ªå®šä¹‰çš„è¯­æ³•é«˜äº®è§„åˆ™ã€‚å¯¹äºåŒ¹é…æ‹¬å·å†…æ‰€æœ‰å†…å®¹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¯ä»¥å°è¯•å¦‚ä¸‹ä»£ç ï¼š

 ```elisp
 (defun my-fontify-paren-content ()
   "Fontify content inside parentheses as red."
   (font-lock-add-keywords nil
                           '(("\\(([^)]*)\\)" 1 'my-paren-content-face t))))
 ```

3. **åº”ç”¨æ›´æ”¹**ï¼š
 ç¡®ä¿ä¸Šè¿°å‡½æ•°åœ¨é€‚å½“çš„æ¨¡å¼ä¸‹è¢«è°ƒç”¨ã€‚å¦‚æœä½ å¸Œæœ›è¿™ä¸ªè§„åˆ™åº”ç”¨äºæ‰€æœ‰çš„ç¼–ç¨‹æ¨¡å¼ï¼Œå¯ä»¥åœ¨ `prog-mode-hook` ä¸­æ·»åŠ å®ƒï¼š

 ```elisp
 (add-hook 'prog-mode-hook 'my-fontify-paren-content)
 ```

4. **å¯ç”¨å…¨å±€å­—ä½“é”æ¨¡å¼**ï¼š
 å¦‚æœè¿˜æ²¡æœ‰å¯ç”¨å…¨å±€å­—ä½“é”æ¨¡å¼ï¼Œé‚£ä¹ˆä½ ä¹Ÿåº”è¯¥å¼€å¯å®ƒä»¥ç¡®ä¿ä½ çš„è‡ªå®šä¹‰è§„åˆ™ç”Ÿæ•ˆï¼š

 ```elisp
 (global-font-lock-mode t)
 ```

5. **æµ‹è¯•æ•ˆæœ**ï¼š
 æ‰“å¼€ä¸€ä¸ªæ”¯æŒè¯­æ³•é«˜äº®çš„æ–‡ä»¶ï¼ˆå¦‚ `.el` æ–‡ä»¶ï¼‰ï¼Œç„¶åæ£€æŸ¥ `(()())` ä¸­çš„å†…å®¹æ˜¯å¦å˜æˆäº†çº¢è‰²ã€‚

è¯·æ³¨æ„ï¼Œä¸Šé¢æä¾›çš„æ­£åˆ™è¡¨è¾¾å¼ `\(([^)]*)\)` å°†åŒ¹é…æœ€å¤–å±‚çš„ä¸€å¯¹æ‹¬å·åŠå…¶å†…éƒ¨å†…å®¹ã€‚å¦‚æœéœ€è¦å¤„ç†åµŒå¥—çš„æ‹¬å·æˆ–æ›´å¤æ‚çš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æ›´å¤æ‚çš„æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œä¾‹å¦‚è¯­æ³•è§£ææ ‘ç­‰é«˜çº§æŠ€æœ¯ã€‚

å¦å¤–ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„ç¼–ç¨‹è¯­è¨€å’Œæ¨¡å¼å¯èƒ½ä¼šæœ‰ä¸åŒçš„è¯­æ³•é«˜äº®è§„åˆ™ï¼Œå› æ­¤ä½ å¯èƒ½éœ€è¦æ ¹æ®å®é™…ä½¿ç”¨çš„æ¨¡å¼è°ƒæ•´æ­£åˆ™è¡¨è¾¾å¼å’Œåº”ç”¨æ–¹å¼ã€‚å¦‚æœä½ åªéœ€è¦åœ¨ä¸€ä¸ªç‰¹å®šçš„è¯­è¨€æ¨¡å¼ä¸­åº”ç”¨æ­¤è§„åˆ™ï¼Œåº”è¯¥åœ¨é‚£ä¸ªè¯­è¨€æ¨¡å¼çš„é’©å­ä¸­æ·»åŠ  `my-fontify-paren-content` å‡½æ•°ï¼Œè€Œä¸æ˜¯ `prog-mode-hook`ã€‚



eoofoe
åœ¨ Emacs ä¸­ï¼Œå¦‚æœæ‚¨å¸Œæœ›é€šè¿‡ä¸€ä¸ªå‰å¯¼é”®ï¼ˆLeader Keyï¼‰å¿«é€Ÿè¿›å…¥è®¡ç®—æ¨¡å¼ï¼Œå¹¶æ‰§è¡Œç®€å•çš„æ•°å­¦è¿ç®—åä»¥ç‰¹å®šæ ¼å¼æ˜¾ç¤ºç»“æœï¼ˆä¾‹å¦‚ `9*3=27`ï¼‰ï¼Œå¯ä»¥é€šè¿‡é…ç½®ä¸€ä¸ªå¿«æ·æ–¹å¼æ¥å®ç°ã€‚è¿™é‡Œå‡è®¾æ‚¨å·²ç»æœ‰ä¸€ä¸ªå‰å¯¼é”®è®¾ç½®ï¼ˆå¦‚ `SPC` æˆ–å…¶ä»–æŒ‰é”®ï¼‰ï¼Œæˆ‘ä»¬å°†åŸºäºè¿™ä¸ªå‰æè¿›è¡Œ## ç¤ºä¾‹ä»£ç 

ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é…ç½®ä¸€ä¸ªå‘½ä»¤ï¼Œå½“æŒ‰ä¸‹å‰å¯¼é”®åé€‰æ‹©â€œcalcâ€åŠŸèƒ½æ—¶ï¼Œå¯ä»¥è¾“å…¥ä¸€ä¸ªè¡¨è¾¾å¼å¹¶æ˜¾ç¤ºä¸º `expr=result` çš„æ ¼å¼ï¼š

```emacs-lisp
;; å‡è®¾ä½¿ç”¨ general.el æ¥è®¾ç½® leader key å’Œå¿«æ·é”®ç»‘å®š
(require 'general)

;; è®¾ç½® leader key ä¸º SPC
(general-define-key
:prefix "SPC"
:non-normal-prefix "M-SPC"
"c" '(my-calc-and-display :which-key "Calc"))

(defun my-calc-and-display (expr)
"Calculate the expression and display it in the format expr=result."
(interactive "sEnter expression: ")
(let ((result (calc-eval expr)))
  (message "%s=%s" expr result)))

;; å¦‚æœæ‚¨æ²¡æœ‰ä½¿ç”¨ which-key, å¯ä»¥å¿½ç•¥ :which-key å‚æ•°
```

### è§£é‡Š

1. **å‰å¯¼é”®è®¾ç½®**:
 - ä½¿ç”¨ `general.el` åŒ…æ¥è®¾ç½®å‰å¯¼é”®å’Œå¿«æ·é”®ã€‚å¦‚æœå°šæœªå®‰è£… `general.el`ï¼Œå¯ä»¥é€šè¿‡ MELPA å®‰è£…ï¼š`M-x package-install RET general RET`ã€‚
 - åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ`SPC` è¢«è®¾ç½®ä¸ºå‰å¯¼é”®ï¼ŒæŒ‰ä¸‹ `SPC c` å°†è§¦å‘ `my-calc-and-display` å‡½æ•°ã€‚

2. **è‡ªå®šä¹‰å‡½æ•°**:
 - `my-calc-and-display` å‡½æ•°æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„è¡¨è¾¾å¼å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `calc-eval` å‡½æ•°è®¡ç®—å…¶å€¼ï¼Œå¹¶é€šè¿‡ `message` å‡½æ•°æŒ‰ç…§ `expr=result` çš„æ ¼å¼è¾“å‡ºç»“æœã€‚
 - `interactive "sEnter expression: "` å…è®¸å‡½æ•°ä» minibuffer æ¥æ”¶ç”¨æˆ·è¾“å…¥ã€‚

### å¦‚ä½•ä½¿ç”¨

1. **åŠ è½½é…ç½®**:
 - å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°æ‚¨çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­ï¼Œå¹¶ç¡®ä¿åŠ è½½æˆ–é‡å¯ Emacsã€‚

2. **æ‰§è¡Œè®¡ç®—**:
 - æŒ‰ä¸‹ `SPC c` ï¼ˆæˆ–è€…æ‚¨è®¾ç½®çš„å…¶ä»–å‰å¯¼é”®ç»„åˆï¼‰ã€‚
 - è¾“å…¥æ‚¨çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `9*3`ã€‚
 - å›è½¦åï¼Œæ‚¨å°†åœ¨ minibuffer ä¸­çœ‹åˆ°ç±»ä¼¼ `9*3=27` çš„æ¶ˆæ¯ã€‚

### è¿›ä¸€æ­¥å®šåˆ¶

- å¦‚æœæ‚¨ä¸ä½¿ç”¨ `general.el`ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ Emacs å†…ç½®çš„å¿«æ·é”®ç»‘å®šæ–¹æ³•ï¼š
```emacs-lisp
(global-set-key (kbd "SPC c") 'my-calc-and-display)
```

- å¦‚æœå¸Œæœ›ç›´æ¥åœ¨å½“å‰ç¼“å†²åŒºæ’å…¥ç»“æœè€Œä¸æ˜¯ä»…åœ¨ minibuffer æ˜¾ç¤ºï¼Œå¯ä»¥ä¿®æ”¹ `my-calc-and-display` å‡½æ•°å¦‚ä¸‹ï¼š
```emacs-lisp
(defun my-calc-and-display (expr)
  "Calculate the expression and insert it in the format expr=result."
  (interactive "sEnter expression: ")
  (let ((result (calc-eval expr)))
    (insert (format "%s=%s\n" expr result))))
```

å…è®¸æ‚¨åœ¨å½“å‰å…‰æ ‡ä½ç½®æ’å…¥è®¡ç®—è¡¨è¾¾å¼åŠå…¶ç»“æœï¼Œæ–¹ä¾¿è®°å½•å’ŒæŸ¥çœ‹ã€‚æ ¹æ®æ‚¨çš„éœ€æ±‚

effort




(font-lock-add-keywords nil
                      '(("#[0-9a-fA-F]\\{6\\}"
                         (0 (progn
                              (let* ((color (match-string-no-properties 0))
                                     (r (string-to-number (substring color 1 3) 16))
                                     (g (string-to-number (substring color 3 5) 16))
                                     (b (string-to-number (substring color 5 7) 16)))
                                `(:background ,(format "#%02x%02x%02x" r g b))))))))




















































(defun my-color-font-lock-keywords ()
"Define font-lock keywords for color codes in text mode."
(let ((color-code-regexp "\$#\\([0-9a-fA-F]\\{6\\}\$\\)"))
  `((,color-code-regexp
     (1 (progn
          ;; ä½¿ç”¨ match-string-no-properties è·å–é¢œè‰²ä»£ç å¹¶å°†å…¶è½¬æ¢ä¸ºå°å†™
          (let* ((color-code (downcase (match-string-no-properties 1))))
            ;; åº”ç”¨é¢œè‰²ä½œä¸ºå‰æ™¯è‰²
            (put-text-property (match-beginning 1) (match-end 1) 'face `(:foreground ,color-code)))
          nil)))))

;; å°†è¿™ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é”å®šè§„åˆ™æ·»åŠ åˆ° text-mode-hook ä¸­
(add-hook 'text-mode-hook
        (lambda ()
          ;; æ·»åŠ è‡ªå®šä¹‰çš„å­—ä½“é”å®šå…³é”®å­—
          (font-lock-add-keywords nil (my-color-font-lock-keywords))
          ;; ç¡®ä¿ font-lock æ¨¡å¼å·²å¯ç”¨
          (font-lock-mode 1)))




















(defun my-get-color-code-face (color-code)
"Generate a face for the given color code."
;; å¦‚æœæ˜¯æ ‡å‡†é¢œè‰²åç§°ï¼Œåˆ™ç›´æ¥ä½¿ç”¨å®ƒï¼›å¦‚æœæ˜¯åå…­è¿›åˆ¶é¢œè‰²ä»£ç ï¼Œåˆ™è½¬æ¢ä¸ºå°å†™
(if (string-match "^#[0-9a-fA-F]\\{6\\}$" color-code)
    `(:foreground ,(downcase color-code))
  `(:foreground ,color-code)))

(defun my-fontify-color-code (match)
"Apply font properties to MATCH, which is expected to be a color code or name."
(let ((color-code (match-string-no-properties 0 match)))
  (put-text-property (match-beginning 0) (match-end 0)
                     'face (my-get-color-code-face color-code))))

(defun my-color-font-lock-keywords ()
"Define font-lock keywords for color codes and names in text mode."
;; æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…é¢œè‰²ä»£ç æˆ–é¢œè‰²åç§°
(let ((color-pattern "\$#[0-9a-fA-F]\\{6\\}\\|red\\|blue\\|green\$"))
  `((,color-pattern
     (0 (my-fontify-color-code (match-data)))))))

;; å°†è¿™ä¸ªè‡ªå®šä¹‰çš„å­—ä½“é”å®šè§„åˆ™æ·»åŠ åˆ° text-mode-hook ä¸­
(defun enable-color-highlighting-in-text-mode ()
"Enable highlighting of color codes and names in text mode."
(font-lock-add-keywords nil (my-color-font-lock-keywords))
(font-lock-mode 1))

(add-hook 'text-mode-hook 'enable-color-highlighting-in-text-mode)









ä¸ºäº†åˆ›å»ºä¸€ä¸ª Emacs Lisp å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ¥å—ç”¨æˆ·äº¤äº’å¼è¾“å…¥çš„å•è¯åˆ—è¡¨ï¼Œå¹¶ç¡®ä¿è¿™äº›å•è¯åœ¨æ ¼å¼åŒ–æ—¶ä¸ä¼šè¢«åˆ†å‰²åˆ°ä¸åŒçš„è¡Œï¼ŒåŒæ—¶æ¯è¡Œä¸è¶…è¿‡80ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `interactive` å½¢å‚æ¥è·å–ç”¨æˆ·è¾“å…¥ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚

### 1. **å®šä¹‰äº¤äº’å¼å‡½æ•°**

æˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªåä¸º `format-buffer-with-keywords-interactive` çš„å‡½æ•°ï¼Œå®ƒä¼šæç¤ºç”¨æˆ·è¾“å…¥å…³é”®è¯åˆ—è¡¨ï¼Œå¹¶æ ¹æ®è¿™äº›å…³é”®è¯è¿›è¡Œæ–‡æœ¬æ ¼å¼åŒ–ã€‚

```elisp
(defun format-buffer-with-keywords-interactive ()
"Format the buffer so that each line does not exceed 80 characters and specified keywords are not split across lines."
(interactive)
(let* ((max-width 80)
       (keywords-input (read-string "Enter keywords separated by spaces: "))
       (keywords (split-string keywords-input))
       (buffer-contents (buffer-string))
       formatted-lines)
  (with-temp-buffer
    (insert buffer-contents)
    (goto-char (point-min))
    (while (not (eobp))
      (let* ((line (buffer-substring-no-properties (point-at-bol) (point-at-eol)))
             (formatted-line (format-line line keywords max-width)))
        (setq formatted-lines (append formatted-lines (split-string formatted-line "\n")))
        (forward-line 1)))
    (erase-buffer)
    (dolist (line formatted-lines)
      (insert line "\n"))
    (switch-to-buffer (current-buffer)))))

(defun format-line (line keywords max-width)
"Format LINE ensuring no word is split across lines and each line does not exceed MAX-WIDTH characters."
(let ((words (split-string line))
      (formatted-line "")
      (current-length 0))
  (dolist (word words)
    (let ((len (length word)))
      (if (or (> (+ current-length len) max-width)
               (member word keywords))
          (progn
            (unless (string= formatted-line "")
              (setq formatted-line (concat formatted-line "\n")))
            (setq formatted-line (concat formatted-line word))
            (setq current-length len))
        (if (= current-length 0)
            (setq formatted-line word)
          (setq formatted-line (concat formatted-line " " word)))
        (setq current-length (+ current-length len (if (> current-length 0) 1 0))))))
  formatted-line))

(global-set-key (kbd "C-c f") 'format-buffer-with-keywords-interactive)
```

### 2. **è§£é‡Šä»£ç **

- **`format-buffer-with-keywords-interactive`**:
- ä½¿ç”¨ `interactive` å…³é”®å­—ä½¿å‡½æ•°æˆä¸ºäº¤äº’å¼çš„ã€‚
- æç¤ºç”¨æˆ·è¾“å…¥å…³é”®è¯ï¼Œé€šè¿‡ `read-string` è·å–ç”¨æˆ·è¾“å…¥å¹¶å°†å…¶åˆ†å‰²æˆå…³é”®è¯åˆ—è¡¨ã€‚
- éå†ç¼“å†²åŒºä¸­çš„æ¯ä¸€è¡Œï¼Œå¹¶è°ƒç”¨ `format-line` å‡½æ•°è¿›è¡Œæ ¼å¼åŒ–ã€‚
- å°†æ ¼å¼åŒ–åçš„è¡Œå†™å›åˆ°å½“å‰ç¼“å†²åŒºä¸­ã€‚

- **`format-line`**:
- æ¥å—ä¸€è¡Œæ–‡æœ¬ã€å…³é”®è¯åˆ—è¡¨å’Œæœ€å¤§å®½åº¦ä½œä¸ºå‚æ•°ã€‚
- ç¡®ä¿æ¯ä¸ªè¯è¯­ä¸ä¼šè¢«åˆ†å‰²ï¼Œå¹¶ä¸”æ¯è¡Œä¸è¶…è¿‡æŒ‡å®šçš„æœ€å¤§å®½åº¦ã€‚
- å¦‚æœé‡åˆ°å…³é”®è¯æˆ–å³å°†è¶…è¿‡æœ€å¤§å®½åº¦ï¼Œåˆ™æ¢è¡Œã€‚

- **`global-set-key`**:
- å°† `format-buffer-with-keywords-interactive` å‡½æ•°ç»‘å®šåˆ°å¿«æ·é”® `C-c f`ï¼Œæ–¹ä¾¿ç”¨æˆ·è°ƒç”¨ã€‚

### 3. **ä½¿ç”¨æ–¹æ³•**

ä¿å­˜ä¸Šè¿°ä»£ç åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆä¾‹å¦‚ `.emacs` æˆ– `init.el`ï¼‰ä¸­ï¼Œç„¶åé‡æ–°åŠ è½½é…ç½®æˆ–é‡å¯ Emacsã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š

- æŒ‰ä¸‹ `C-c f` å¿«æ·é”®ã€‚
- æˆ–è€…é€šè¿‡å‘½ä»¤é¢æ¿è°ƒç”¨ï¼š`M-x format-buffer-with-keywords-interactive`ã€‚

è°ƒç”¨åï¼ŒEmacs ä¼šå¼¹å‡ºä¸€ä¸ªå°çª—å£æç¤ºä½ è¾“å…¥éœ€è¦ä¿æŠ¤çš„å…³é”®è¯ï¼Œè¾“å…¥å®ŒæˆåæŒ‰å›è½¦é”®ç¡®è®¤ã€‚å‡½æ•°å°†å¤„ç†å½“å‰ç¼“å†²åŒºä¸­çš„æ–‡æœ¬ï¼Œç¡®ä¿æŒ‡å®šçš„å…³é”®è¯ä¸ä¼šè¢«åˆ†å‰²ï¼Œå¹¶ä¸”æ¯è¡Œä¸è¶…è¿‡80ä¸ªå­—ç¬¦ã€‚

è¿™ç§æ–¹æ³•å…è®¸ç”¨æˆ·åŠ¨æ€åœ°æŒ‡å®šå“ªäº›è¯è¯­åº”è¯¥ä¿æŒå®Œæ•´ä¸è¢«åˆ†å‰²ï¼Œå¢åŠ äº†çµæ´»æ€§å’Œå®ç”¨æ€§ã€‚å¦‚æœä½ æœ‰æ›´å¤šçš„éœ€æ±‚æˆ–è€…è§„åˆ™ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›ä¸€æ­¥æ‰©å±•æ­¤è„šæœ¬ã€‚












æ˜¯çš„ï¼Œå¯ä»¥æ‰¹é‡ç”Ÿæˆå‡½æ•°åˆ°å¤šä¸ª bufferã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ›´é€šç”¨çš„å‡½æ•°ï¼Œå®ƒèƒ½å¤Ÿè¯»å–å½“å‰ buffer ä¸­æ¯ä¸€è¡Œçš„å†…å®¹ï¼Œå¹¶æ ¹æ®è¿™äº›å†…å®¹ä¸ºä¸åŒçš„ buffer ç”Ÿæˆç›¸åº”çš„å‡½æ•°å®šä¹‰ã€‚æ¯è¡Œåº”è¯¥åŒ…å«ä¸€ä¸ªç›®æ ‡ buffer åç§°å’Œè¦åœ¨è¿™ä¸ª buffer ä¸­å®šä¹‰çš„ä¸€ç³»åˆ—å‡½æ•°åã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªæ”¹è¿›åçš„å®ç°ï¼Œå®ƒå¯ä»¥æ‰¹é‡å¤„ç†å¤šè¡Œè¾“å…¥å¹¶ä¸ºå¤šä¸ª buffer ç”Ÿæˆå‡½æ•°ï¼š

```lisp
(defun batch-generate-functions-to-multiple-buffers ()
"Batch generate function definitions to multiple buffers based on the current buffer's content.
Each line should be in the format 'buffer-name:function1 function2 ...'.
This function will process each line and generate corresponding functions in specified buffers."
(interactive)
(save-excursion
  (goto-char (point-min))
  (let (line-info-list)
    ;; Collect all matching lines into a list of lists, where each sublist contains buffer name and function names
    (while (re-search-forward "^\\([^:]+\\):\\([[:alnum:] ]+\\)$" nil t)
      (push (list (match-string 1) (split-string (match-string 2))) line-info-list))

    ;; Process each collected line info
    (dolist (line-info line-info-list)
      (let* ((buffer-name (car line-info))
             (function-names (cadr line-info)))
        ;; Create or switch to the target buffer
        (with-current-buffer (get-buffer-create buffer-name)
          ;; Optionally clear the buffer if you want to start fresh for each buffer
          ;; (erase-buffer) ; Uncomment this line if you want to clear the buffer each time
          ;; Go to the end of the buffer before insertion
          (goto-char (point-max))
          ;; Insert each function definition
          (dolist (func function-names)
            (insert (format "function %s() {\n}\n\n" func)))))))))

;; Example usage:
;; M-x batch-generate-functions-to-multiple-buffers
```

### ä½¿ç”¨è¯´æ˜

- **è°ƒç”¨æ–¹å¼**ï¼šä½ å¯ä»¥é€šè¿‡å‘½ä»¤ `M-x batch-generate-functions-to-multiple-buffers` æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚
- **æºæ–‡ä»¶æ ¼å¼**ï¼šæ¯ä¸€è¡Œéƒ½åº”è¯¥éµå¾ªæ ¼å¼ `buffer-name:function1 function2 ...`ï¼Œå…¶ä¸­ `buffer-name` æ˜¯ç›®æ ‡ buffer çš„åç§°ï¼Œåé¢è·Ÿç€çš„æ˜¯è¦åœ¨è¿™ä¸ª buffer ä¸­å®šä¹‰çš„ä¸€ç³»åˆ—å‡½æ•°åï¼Œå®ƒä»¬ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚
- **åŠŸèƒ½**ï¼šè¯¥å‡½æ•°ä¼šéå†å½“å‰ buffer ä¸­çš„æ‰€æœ‰è¡Œï¼Œå¯¹äºæ¯ä¸ªç¬¦åˆæŒ‡å®šæ ¼å¼çš„è¡Œï¼Œå®ƒä¼šåœ¨å¯¹åº”çš„ buffer ä¸­ç”Ÿæˆå‡½æ•°å®šä¹‰ã€‚å¦‚æœæŸä¸ªç›®æ ‡ buffer å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šåœ¨å…¶æœ«å°¾æ·»åŠ æ–°çš„å‡½æ•°å®šä¹‰ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ buffer å¹¶æ’å…¥å‡½æ•°å®šä¹‰ã€‚

### æ‰©å±•åŠŸèƒ½

å¦‚æœä½ æƒ³è¦åœ¨æ¯æ¬¡å¤„ç†æ–°è¡Œæ—¶æ¸…ç©ºç›®æ ‡ bufferï¼ˆå³ç¡®ä¿æ¯ä¸ª buffer åªåŒ…å«ç”±æœ¬æ¬¡æ‰¹å¤„ç†ç”Ÿæˆçš„å‡½æ•°ï¼‰ï¼Œå¯ä»¥å–æ¶ˆæ³¨é‡Š `(erase-buffer)` è¡Œã€‚è¿™å°†ä½¿å¾—æ¯æ¬¡å¤„ç†å‰éƒ½ä¼šæ¸…é™¤ç›®æ ‡ buffer çš„å†…å®¹ã€‚












åœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„ Elisp å‡½æ•°æ¥é«˜äº®æ˜¾ç¤ºç‰¹å®šè¡Œï¼ˆä¾‹å¦‚ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

### ç¤ºä¾‹å‡½æ•°

```elisp
(defun highlight-lines (m n color)
  "Highlight lines from line M to line N with COLOR."
  (interactive "nStart line: \nnEnd line: \nsColor: ")
  (let ((overlay (make-overlay (progn (goto-line m) (point))
                               (progn (goto-line n) (line-end-position)))))
    (overlay-put overlay 'face `(:background ,color))))

(defun unhighlight-lines (m n)
  "Unhighlight lines from line M to line N."
  (interactive "nStart line: \nnEnd line: ")
  (remove-overlays (progn (goto-line m) (point))
                   (progn (goto-line n) (line-end-position))))

(global-set-key (kbd "C-c h") 'highlight-lines)
(global-set-key (kbd "C-c u") 'unhighlight-lines)
```

### è§£é‡Š

1. **é«˜äº®æ˜¾ç¤ºå‡½æ•° `highlight-lines`**ï¼š
   - `defun highlight-lines (m n color)`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º `highlight-lines` çš„å‡½æ•°ï¼Œæ¥å—ä¸‰ä¸ªå‚æ•° `m`ã€`n` å’Œ `color`ï¼Œåˆ†åˆ«è¡¨ç¤ºèµ·å§‹è¡Œã€ç»“æŸè¡Œå’ŒèƒŒæ™¯é¢œè‰²ã€‚
   - `(interactive "nStart line: \nnEnd line: \nsColor: ")`ï¼šä½¿å‡½æ•°æˆä¸ºäº¤äº’å¼å‡½æ•°ï¼Œå½“è°ƒç”¨æ—¶ä¼šæç¤ºç”¨æˆ·è¾“å…¥èµ·å§‹è¡Œã€ç»“æŸè¡Œå’Œé¢œè‰²ã€‚
   - `let ((overlay (make-overlay ...)))`ï¼šåˆ›å»ºä¸€ä¸ªè¦†ç›–å±‚ï¼ˆoverlayï¼‰ï¼Œè¦†ç›–ä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œçš„åŒºåŸŸã€‚
   - `(overlay-put overlay 'face `(:background ,color))`ï¼šå°†è¦†ç›–å±‚çš„èƒŒæ™¯é¢œè‰²è®¾ç½®ä¸ºæŒ‡å®šçš„é¢œè‰²ã€‚

2. **å–æ¶ˆé«˜äº®æ˜¾ç¤ºå‡½æ•° `unhighlight-lines`**ï¼š
   - `defun unhighlight-lines (m n)`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º `unhighlight-lines` çš„å‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•° `m` å’Œ `n`ï¼Œåˆ†åˆ«è¡¨ç¤ºèµ·å§‹è¡Œå’Œç»“æŸè¡Œã€‚
   - `(interactive "nStart line: \nnEnd line: ")`ï¼šä½¿å‡½æ•°æˆä¸ºäº¤äº’å¼å‡½æ•°ï¼Œå½“è°ƒç”¨æ—¶ä¼šæç¤ºç”¨æˆ·è¾“å…¥èµ·å§‹è¡Œå’Œç»“æŸè¡Œã€‚
   - `remove-overlays ...`ï¼šç§»é™¤ä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œä¹‹é—´çš„æ‰€æœ‰è¦†ç›–å±‚ã€‚

3. **ç»‘å®šå¿«æ·é”®**ï¼š
   - `(global-set-key (kbd "C-c h") 'highlight-lines)`ï¼šå°† `highlight-lines` å‡½æ•°ç»‘å®šåˆ° `C-c h` å¿«æ·é”®ä¸Šã€‚
   - `(global-set-key (kbd "C-c u") 'unhighlight-lines)`ï¼šå°† `unhighlight-lines` å‡½æ•°ç»‘å®šåˆ° `C-c u` å¿«æ·é”®ä¸Šã€‚

### ä½¿ç”¨æ–¹æ³•

1. **åŠ è½½é…ç½®**ï¼š
   - å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
   - é‡æ–°å¯åŠ¨ Emacs æˆ–ä½¿ç”¨ `M-x eval-buffer` é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚

2. **é«˜äº®æ˜¾ç¤ºè¡Œ**ï¼š
   - æŒ‰ `C-c h` å¿«æ·é”®ã€‚
   - è¾“å…¥èµ·å§‹è¡Œå· `m` å’Œç»“æŸè¡Œå· `n`ã€‚
   - è¾“å…¥é¢œè‰²ï¼ˆä¾‹å¦‚ `"yellow"`ï¼‰ã€‚
   - ä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œçš„æ–‡æœ¬å°†è¢«é«˜äº®æ˜¾ç¤ºã€‚

3. **å–æ¶ˆé«˜äº®æ˜¾ç¤ºè¡Œ**ï¼š
   - æŒ‰ `C-c u` å¿«æ·é”®ã€‚
   - è¾“å…¥èµ·å§‹è¡Œå· `m` å’Œç»“æŸè¡Œå· `n`ã€‚
   - ä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œçš„é«˜äº®æ˜¾ç¤ºå°†è¢«å–æ¶ˆã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
1. Line 1
2. Line 2
3. Line 3
4. Line 4
5. Line 5
```

1. æŒ‰ `C-c h`ã€‚
2. è¾“å…¥ `2` ä½œä¸ºèµ·å§‹è¡Œå·ã€‚
3. è¾“å…¥ `4` ä½œä¸ºç»“æŸè¡Œå·ã€‚
4. è¾“å…¥ `"yellow"` ä½œä¸ºé¢œè‰²ã€‚
5. ä»ç¬¬ 2 è¡Œåˆ°ç¬¬ 4 è¡Œçš„æ–‡æœ¬å°†è¢«é«˜äº®æ˜¾ç¤ºä¸ºé»„è‰²ã€‚

1. æŒ‰ `C-c u`ã€‚
2. è¾“å…¥ `2` ä½œä¸ºèµ·å§‹è¡Œå·ã€‚
3. è¾“å…¥ `4` ä½œä¸ºç»“æŸè¡Œå·ã€‚
4. ä»ç¬¬ 2 è¡Œåˆ°ç¬¬ 4 è¡Œçš„é«˜äº®æ˜¾ç¤ºå°†è¢«å–æ¶ˆã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°é«˜äº®æ˜¾ç¤ºå’Œå–æ¶ˆé«˜äº®æ˜¾ç¤ºç‰¹å®šè¡Œçš„æ–‡æœ¬ã€‚





åœ¨ Emacs Lisp ä¸­ï¼Œå‡½æ•°å¯ä»¥æ¥å—å¤šç§ç±»å‹çš„å‚æ•°ï¼ŒåŒ…æ‹¬æ™®é€šå‚æ•°ã€å¯é€‰å‚æ•°ã€å‰©ä½™å‚æ•°ç­‰ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å‚æ•°ç±»å‹åŠå…¶ç”¨æ³•ç¤ºä¾‹ã€‚

### 1. æ™®é€šå‚æ•°

æ™®é€šå‚æ•°æ˜¯æœ€åŸºæœ¬çš„å‚æ•°ç±»å‹ï¼Œå‡½æ•°è°ƒç”¨æ—¶å¿…é¡»æä¾›è¿™äº›å‚æ•°ã€‚

```elisp
(defun my-function (arg1 arg2)
  "A function with two arguments."
  (message "arg1: %s, arg2: %s" arg1 arg2))

(my-function "Hello" "World")
;; è¾“å‡º: arg1: Hello, arg2: World
```

### 2. å¯é€‰å‚æ•°

å¯é€‰å‚æ•°ä½¿ç”¨ `&optional` å…³é”®å­—æ¥å®šä¹‰ã€‚å¦‚æœè°ƒç”¨æ—¶æ²¡æœ‰æä¾›å¯é€‰å‚æ•°ï¼Œå®ƒä»¬å°†ä½¿ç”¨é»˜è®¤å€¼ï¼ˆé€šå¸¸æ˜¯ `nil`ï¼‰ã€‚

```elisp
(defun my-function (arg1 &optional arg2)
  "A function with one required argument and one optional argument."
  (if arg2
      (message "arg1: %s, arg2: %s" arg1 arg2)
    (message "arg1: %s" arg1)))

(my-function "Hello")
;; è¾“å‡º: arg1: Hello

(my-function "Hello" "World")
;; è¾“å‡º: arg1: Hello, arg2: World
```

### 3. å‰©ä½™å‚æ•°

å‰©ä½™å‚æ•°ä½¿ç”¨ `&rest` å…³é”®å­—æ¥å®šä¹‰ï¼Œå¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œå¹¶å°†å®ƒä»¬æ”¶é›†åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚

```elisp
(defun my-function (arg1 &rest args)
  "A function with one required argument and any number of additional arguments."
  (message "arg1: %s, args: %s" arg1 args))

(my-function "Hello" "World" "Emacs" "Lisp")
;; è¾“å‡º: arg1: Hello, args: (World Emacs Lisp)
```

### 4. å…³é”®å­—å‚æ•°

å…³é”®å­—å‚æ•°ä½¿ç”¨ `&key` å…³é”®å­—æ¥å®šä¹‰ï¼Œå…è®¸è°ƒç”¨è€…ä½¿ç”¨å…³é”®å­—æ¥æŒ‡å®šå‚æ•°ã€‚

```elisp
(defun my-function (&key arg1 arg2)
  "A function with keyword arguments."
  (message "arg1: %s, arg2: %s" arg1 arg2))

(my-function :arg1 "Hello" :arg2 "World")
;; è¾“å‡º: arg1: Hello, arg2: World
```

### 5. ç»„åˆä½¿ç”¨

ä½ å¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ç»„åˆä½¿ç”¨å¤šç§å‚æ•°ç±»å‹ã€‚

```elisp
(defun my-function (arg1 &optional arg2 &rest args &key arg3 arg4)
  "A function with various types of arguments."
  (message "arg1: %s, arg2: %s, args: %s, arg3: %s, arg4: %s" arg1 arg2 args arg3 arg4))

(my-function "Hello" "Optional" "Rest1" "Rest2" :arg3 "Keyword1" :arg4 "Keyword2")
;; è¾“å‡º: arg1: Hello, arg2: Optional, args: (Rest1 Rest2), arg3: Keyword1, arg4: Keyword2
```

### 6. é»˜è®¤å€¼

ä½ å¯ä»¥ä¸ºå¯é€‰å‚æ•°å’Œå…³é”®å­—å‚æ•°è®¾ç½®é»˜è®¤å€¼ã€‚

```elisp
(defun my-function (arg1 &optional (arg2 "Default2") &key (arg3 "Default3"))
  "A function with default values for optional and keyword arguments."
  (message "arg1: %s, arg2: %s, arg3: %s" arg1 arg2 arg3))

(my-function "Hello")
;; è¾“å‡º: arg1: Hello, arg2: Default2, arg3: Default3

(my-function "Hello" "Custom2" :arg3 "Custom3")
;; è¾“å‡º: arg1: Hello, arg2: Custom2, arg3: Custom3
```

### 7. äº¤äº’å¼å‡½æ•°

å¯¹äºäº¤äº’å¼å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ `interactive` å½¢å¼æ¥å®šä¹‰å‚æ•°ã€‚

```elisp
(defun my-interactive-function (arg1 &optional arg2)
  "An interactive function with one required argument and one optional argument."
  (interactive "sEnter arg1: \nsEnter arg2 (optional): ")
  (if arg2
      (message "arg1: %s, arg2: %s" arg1 arg2)
    (message "arg1: %s" arg1)))

(my-interactive-function "Hello")
;; äº¤äº’å¼æç¤º:
;; Enter arg1: Hello
;; Enter arg2 (optional): 
;; è¾“å‡º: arg1: Hello
```

é€šè¿‡è¿™äº›ç¤ºä¾‹ï¼Œä½ å¯ä»¥çœ‹åˆ° Emacs Lisp ä¸­å‡½æ•°å‚æ•°çš„å¤šç§ç”¨æ³•ã€‚æ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„



åœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ `defun` å‡½æ•°æ¥é€‰æ‹©ç‰¹å®šçš„è¡Œï¼ˆä¾‹å¦‚ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œï¼‰ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½ï¼š

```elisp
(defun select-lines (m n)
  "Select lines from line M to line N."
  (interactive "nStart line: \nnEnd line: ")
  (let ((start (save-excursion (goto-line m) (point)))
        (end (save-excursion (goto-line n) (line-end-position))))
    (push-mark start)
    (goto-char end)
    (setq mark-active t)))

(global-set-key (kbd "C-c l") 'select-lines)
```

### è§£é‡Š

1. **å‡½æ•°å®šä¹‰**ï¼š
   - `defun select-lines (m n)`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º `select-lines` çš„å‡½æ•°ï¼Œæ¥å—ä¸¤ä¸ªå‚æ•° `m` å’Œ `n`ï¼Œåˆ†åˆ«è¡¨ç¤ºèµ·å§‹è¡Œå’Œç»“æŸè¡Œã€‚

2. **äº¤äº’å¼å‡½æ•°**ï¼š
   - `(interactive "nStart line: \nnEnd line: ")`ï¼šä½¿å‡½æ•°æˆä¸ºäº¤äº’å¼å‡½æ•°ï¼Œå½“è°ƒç”¨æ—¶ä¼šæç¤ºç”¨æˆ·è¾“å…¥èµ·å§‹è¡Œå’Œç»“æŸè¡Œçš„è¡Œå·ã€‚

3. **è®¡ç®—èµ·å§‹å’Œç»“æŸä½ç½®**ï¼š
   - `let ((start (save-excursion (goto-line m) (point))) (end (save-excursion (goto-line n) (line-end-position))))`ï¼š
     - `save-excursion` ç”¨äºä¿å­˜å½“å‰å…‰æ ‡çš„å½“å‰ä½ç½®ï¼Œé˜²æ­¢åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¹å˜å…‰æ ‡ä½ç½®ã€‚
     - `goto-line m` å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ m è¡Œï¼Œå¹¶ä½¿ç”¨ `point` è·å–è¯¥è¡Œçš„èµ·å§‹ä½ç½®ã€‚
     - `goto-line n` å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ n è¡Œï¼Œå¹¶ä½¿ç”¨ `line-end-position` è·å–è¯¥è¡Œçš„ç»“æŸä½ç½®ã€‚

4. **è®¾ç½®æ ‡è®°ç‚¹å’Œå…‰æ ‡ä½ç½®**ï¼š
   - `push-mark start`ï¼šå°†èµ·å§‹ä½ç½®è®¾ç½®ä¸ºæ ‡è®°ç‚¹ã€‚
   - `goto-char end`ï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ç»“æŸä½ç½®ã€‚
   - `setq mark-active t`ï¼šæ¿€æ´»æ ‡è®°ç‚¹ï¼Œä½¿é€‰ä¸­çš„åŒºåŸŸå¯è§ã€‚

5. **ç»‘å®šå¿«æ·é”®**ï¼š
   - `(global-set-key (kbd "C-c l") 'select-lines)`ï¼šå°† `select-lines` å‡½æ•°ç»‘å®šåˆ° `C-c l` å¿«æ·é”®ä¸Šã€‚

### ä½¿ç”¨æ–¹æ³•

1. **åŠ è½½é…ç½®**ï¼š
   - å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
   - é‡æ–°å¯åŠ¨ Emacs æˆ–ä½¿ç”¨ `M-x eval-buffer` é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚

2. **è°ƒç”¨å‡½æ•°**ï¼š
   - æŒ‰ `C-c l` å¿«æ·é”®ã€‚
   - è¾“å…¥èµ·å§‹è¡Œå· `m` å’Œç»“æŸè¡Œå· `n`ã€‚
   - ä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œçš„æ–‡æœ¬å°†è¢«é€‰ä¸­ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
1. Line 1
2. Line 2
3. Line 3
4. Line 4
5. Line 5
```

1. æŒ‰ `C-c l`ã€‚
2. è¾“å…¥ `2` ä½œä¸ºèµ·å§‹è¡Œå·ã€‚
3. è¾“å…¥ `4` ä½œä¸ºç»“æŸè¡Œå·ã€‚
4. ä»ç¬¬ 2 è¡Œåˆ°ç¬¬ 4 è¡Œçš„æ–‡æœ¬å°†è¢«é€‰ä¸­ï¼š

```
2. Line 2
3. Line 3
4. Line 4
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°é€‰æ‹©ç‰¹å®šè¡Œçš„æ–‡æœ¬ã€‚



åœ¨ Emacs ä¸­é€‰æ‹©åŒ¹é…çš„æ–‡æœ¬ï¼ˆä¾‹å¦‚åŒ¹é…æŸä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ‰€æœ‰è¡Œæˆ–å•è¯ï¼‰æœ‰å¤šç§æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æŠ€å·§ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `isearch` å’Œ `mark-sexp`
1. **å¯åŠ¨ `isearch`**ï¼š
   - æŒ‰ `C-s` å¯åŠ¨å¢é‡æœç´¢ï¼ˆIncremental Searchï¼‰ã€‚
   - è¾“å…¥ä½ æƒ³è¦åŒ¹é…çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚

2. **è®¾ç½®æ ‡è®°ç‚¹**ï¼š
   - å½“æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹æ—¶ï¼ŒæŒ‰ `C-SPC` è®¾ç½®æ ‡è®°ç‚¹ã€‚

3. **ç»§ç»­æœç´¢**ï¼š
   - ç»§ç»­æŒ‰ `C-s` ç›´åˆ°æ‰¾åˆ°æœ€åä¸€ä¸ªåŒ¹é…é¡¹ã€‚

4. **é€‰æ‹©åŒ¹é…é¡¹**ï¼š
   - æŒ‰ `C-x C-x` ï¼ˆæˆ– `M-x exchange-point-and-mark`ï¼‰äº¤æ¢å…‰æ ‡å’Œæ ‡è®°ç‚¹çš„ä½ç½®ï¼Œè¿™æ ·å°±å¯ä»¥é€‰ä¸­æ‰€æœ‰åŒ¹é…çš„æ–‡æœ¬ã€‚

### æ–¹æ³•äºŒï¼šä½¿ç”¨ `occur` å‘½ä»¤
1. **å¯åŠ¨ `occur`**ï¼š
   - æŒ‰ `M-s o` ï¼ˆæˆ– `M-x occur`ï¼‰å¯åŠ¨ `occur` å‘½ä»¤ã€‚
   - è¾“å…¥ä½ æƒ³è¦åŒ¹é…çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚

2. **æŸ¥çœ‹åŒ¹é…ç»“æœ**ï¼š
   - `occur` ä¼šåœ¨ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸­æ˜¾ç¤ºæ‰€æœ‰åŒ¹é…çš„è¡Œã€‚
   - ä½ å¯ä»¥åœ¨è¿™ä¸ªç¼“å†²åŒºä¸­ä½¿ç”¨ `o` é”®è·³è½¬åˆ°åŒ¹é…çš„è¡Œï¼Œæˆ–è€…ä½¿ç”¨ `C-c C-o` å°†æ‰€æœ‰åŒ¹é…çš„è¡Œå¤åˆ¶åˆ°å‰ªè´´æ¿ã€‚

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨ `query-replace` å‘½ä»¤
1. **å¯åŠ¨ `query-replace`**ï¼š
   - æŒ‰ `M-%` ï¼ˆæˆ– `M-x query-replace`ï¼‰å¯åŠ¨ `query-replace` å‘½ä»¤ã€‚
   - è¾“å…¥ä½ æƒ³è¦åŒ¹é…çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚
   - è¾“å…¥æ›¿æ¢æ–‡æœ¬ï¼ˆå¦‚æœä½ ä¸éœ€è¦æ›¿æ¢ï¼Œå¯ä»¥è¾“å…¥ç›¸åŒçš„æ–‡æœ¬æˆ–ç•™ç©ºï¼‰ã€‚

2. **é€‰æ‹©åŒ¹é…é¡¹**ï¼š
   - æŒ‰ `!` æ›¿æ¢æ‰€æœ‰åŒ¹é…é¡¹ã€‚
   - æŒ‰ `n` è·³è¿‡å½“å‰åŒ¹é…é¡¹ã€‚
   - æŒ‰ `y` æ›¿æ¢å½“å‰åŒ¹é…é¡¹å¹¶ç»§ç»­ä¸‹ä¸€ä¸ªåŒ¹é…é¡¹ã€‚

### æ–¹æ³•å››ï¼šä½¿ç”¨ `multiple-cursors` åŒ…
1. **å®‰è£… `multiple-cursors` åŒ…**ï¼š
   - å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… `multiple-cursors` åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ `M-x package-install RET multiple-cursors RET` å®‰è£…ã€‚

2. **å¯åŠ¨ `mc/mark-all-like-this`**ï¼š
   - æŒ‰ `C->` ï¼ˆæˆ– `M-x mc/mark-all-like-this`ï¼‰é€‰æ‹©æ‰€æœ‰ä¸å½“å‰é€‰ä¸­çš„æ–‡æœ¬åŒ¹é…çš„é¡¹ã€‚

3. **æ“ä½œåŒ¹é…é¡¹**ï¼š
   - ä½ å¯ä»¥åŒæ—¶ç¼–è¾‘æ‰€æœ‰åŒ¹é…çš„é¡¹ï¼Œæˆ–è€…ä½¿ç”¨ `C-c C-c` å–æ¶ˆå¤šé‡å…‰æ ‡ã€‚

### æ–¹æ³•äº”ï¼šä½¿ç”¨ `ibuffer` å‘½ä»¤
1. **å¯åŠ¨ `ibuffer`**ï¼š
   - æŒ‰ `M-x ibuffer` å¯åŠ¨ `ibuffer` å‘½ä»¤ã€‚

2. **æ ‡è®°åŒ¹é…çš„è¡Œ**ï¼š
   - ä½¿ç”¨ `M-s o` åœ¨ `ibuffer` ç¼“å†²åŒºä¸­å¯åŠ¨ `occur`ï¼Œè¾“å…¥ä½ æƒ³è¦åŒ¹é…çš„æ–‡æœ¬æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚
   - æ ‡è®°æ‰€æœ‰åŒ¹é…çš„è¡Œï¼Œç„¶åä½¿ç”¨ `D` åˆ é™¤å®ƒä»¬ï¼Œæˆ–ä½¿ç”¨ `M` å°†å®ƒä»¬ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚

è¿™äº›æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ åœ¨ Emacs ä¸­é«˜æ•ˆåœ°é€‰æ‹©å’Œæ“ä½œåŒ¹é…çš„æ–‡æœ¬ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„åœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å†…ç½®çš„è®¡ç®—å™¨åŠŸèƒ½æ¥æ‰§è¡Œæ•°å­¦è®¡ç®—ã€‚Emacs æä¾›äº†å‡ ç§ä¸åŒçš„æ–¹å¼æ¥è¿›è¡Œè®¡ç®—ï¼ŒåŒ…æ‹¬ä½¿ç”¨ `calc` æ¨¡å¼å’Œç®€å•çš„ Elisp è¡¨è¾¾å¼ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š

### 1. ä½¿ç”¨ `calc` æ¨¡å¼

`calc` æ˜¯ Emacs å†…ç½®çš„ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„è®¡ç®—å™¨ï¼Œæ”¯æŒå¤šç§æ•°å­¦è¿ç®—å’Œç§‘å­¦è®¡ç®—ã€‚

#### å¯åŠ¨ `calc` æ¨¡å¼

1. **å¯åŠ¨ `calc`**ï¼š
   - æŒ‰ `M-x calc` æˆ– `C-x * c` å¯åŠ¨ `calc` æ¨¡å¼ã€‚

2. **åŸºæœ¬æ“ä½œ**ï¼š
   - `+`ã€`-`ã€`*`ã€`/`ï¼šåŸºæœ¬çš„ç®—æœ¯è¿ç®—ã€‚
   - `Q`ï¼šå¹³æ–¹æ ¹ã€‚
   - `^`ï¼šå¹‚è¿ç®—ã€‚
   - `I`ï¼šå€’æ•°ã€‚
   - `S`ï¼šæ­£å¼¦ã€‚
   - `C`ï¼šä½™å¼¦ã€‚
   - `T`ï¼šæ­£åˆ‡ã€‚
   - `P`ï¼šåœ†å‘¨ç‡ Ï€ã€‚
   - `E`ï¼šè‡ªç„¶å¯¹æ•°çš„åº• eã€‚
   - `U`ï¼šæ’¤é”€ä¸Šä¸€æ­¥æ“ä½œã€‚
   - `O`ï¼šé‡åšä¸Šä¸€æ­¥æ“ä½œã€‚

3. **é€€å‡º `calc`**ï¼š
   - æŒ‰ `q` é€€å‡º `calc` æ¨¡å¼ã€‚

#### ç¤ºä¾‹

```elisp
M-x calc
2 <RET> 3 +  (è®¡ç®— 2 + 3)
5 <RET> 2 ^  (è®¡ç®— 5 çš„å¹³æ–¹)
```

### 2. ä½¿ç”¨ Elisp è¡¨è¾¾å¼

ä½ ä¹Ÿå¯ä»¥åœ¨ Emacs ä¸­ç›´æ¥ä½¿ç”¨ Elisp è¡¨è¾¾å¼è¿›è¡Œç®€å•çš„æ•°å­¦è®¡ç®—ã€‚

#### åœ¨ minibuffer ä¸­è®¡ç®—

1. **å¯åŠ¨ minibuffer**ï¼š
   - æŒ‰ `M-:` å¯åŠ¨ minibufferã€‚

2. **è¾“å…¥ Elisp è¡¨è¾¾å¼**ï¼š
   - è¾“å…¥ä½ æƒ³è¦è®¡ç®—çš„ Elisp è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `(+ 2 3)`ã€‚

3. **æ‰§è¡Œè®¡ç®—**ï¼š
   - æŒ‰ `RET` æ‰§è¡Œè®¡ç®—ï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨ minibuffer ä¸­ã€‚

#### ç¤ºä¾‹

```elisp
M-: (+ 2 3) <RET>  (è®¡ç®— 2 + 3)
M-: (* 5 2) <RET>  (è®¡ç®— 5 * 2)
M-: (/ 10 2) <RET>  (è®¡ç®— 10 / 2)
```

### 3. ä½¿ç”¨ `eval-expression` å‘½ä»¤

`eval-expression` å‘½ä»¤å…è®¸ä½ åœ¨å½“å‰ç¼“å†²åŒºä¸­æ‰§è¡Œ Elisp è¡¨è¾¾å¼ã€‚

1. **å¯åŠ¨ `eval-expression`**ï¼š
   - æŒ‰ `M-x eval-expression` æˆ– `M-:`ã€‚

2. **è¾“å…¥ Elisp è¡¨è¾¾å¼**ï¼š
   - è¾“å…¥ä½ æƒ³è¦è®¡ç®—çš„ Elisp è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `(+ 2 3)`ã€‚

3. **æ‰§è¡Œè®¡ç®—**ï¼š
   - æŒ‰ `RET` æ‰§è¡Œè®¡ç®—ï¼Œç»“æœä¼šæ˜¾ç¤ºåœ¨ minibuffer ä¸­ã€‚

#### ç¤ºä¾‹

```elisp
M-x eval-expression
(+ 2 3) <RET>  (è®¡ç®— 2 + 3)
```

### 4. ä½¿ç”¨ `calc-eval` å‡½æ•°

ä½ å¯ä»¥åœ¨ Elisp ä»£ç ä¸­ä½¿ç”¨ `calc-eval` å‡½æ•°æ¥æ‰§è¡Œå¤æ‚çš„æ•°å­¦è®¡ç®—ã€‚

#### ç¤ºä¾‹

```elisp
(defun my-calc (expr)
  "Evaluate the given mathematical expression using calc."
  (interactive "sExpression: ")
  (message "%s = %s" expr (calc-eval expr)))

(global-set-key (kbd "C-c c") 'my-calc)
```

### ä½¿ç”¨æ–¹æ³•

1. **åŠ è½½é…ç½®**ï¼š
   - å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
   - é‡æ–°å¯åŠ¨ Emacs æˆ–ä½¿ç”¨ `M-x eval-buffer` é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚

2. **è°ƒç”¨å‡½æ•°**ï¼š
   - æŒ‰ `C-c c`ã€‚
   - è¾“å…¥ä½ æƒ³è¦è®¡ç®—çš„æ•°å­¦è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `2 + 3`ã€‚
   - ç»“æœå°†æ˜¾ç¤ºåœ¨ minibuffer ä¸­ã€‚

#### ç¤ºä¾‹

```elisp
C-c c
2 + 3 <RET>  (è®¡ç®— 2 + 3)
```

é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œä½ å¯ä»¥åœ¨ Emacs ä¸­æ–¹ä¾¿åœ°è¿›è¡Œå„ç§æ•°å­¦è®¡ç®—ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚







åœ¨ Vim ä¸­é€‰æ‹©ç‰¹å®šè¡Œï¼ˆä¾‹å¦‚ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œï¼‰ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥å®Œæˆã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯è§†æ¨¡å¼
1. å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ m è¡Œã€‚
2. æŒ‰ `V` è¿›å…¥è¡Œå¯è§†æ¨¡å¼ã€‚
3. æŒ‰ `j` æˆ– `k` é”®å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ n è¡Œã€‚
4. æ­¤æ—¶ï¼Œä»ç¬¬ m è¡Œåˆ°ç¬¬ n è¡Œä¹‹é—´çš„æ–‡æœ¬ä¼šè¢«é€‰ä¸­ã€‚

### æ–¹æ³•äºŒï¼šç›´æ¥æŒ‡å®šè¡Œå·
1. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè¾“å…¥ `:m,nV`ï¼Œå…¶ä¸­ `m` å’Œ `n` åˆ†åˆ«æ˜¯ä½ æƒ³è¦é€‰æ‹©çš„èµ·å§‹è¡Œå’Œç»“æŸè¡Œçš„è¡Œå·ã€‚
   - ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³é€‰æ‹©ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œï¼Œå¯ä»¥è¾“å…¥ `:5,10V`ï¼Œç„¶åæŒ‰å›è½¦ã€‚
2. è¿™æ ·ï¼Œä»ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œä¹‹é—´çš„æ–‡æœ¬ä¼šè¢«é€‰ä¸­ã€‚

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨è¡Œå·èŒƒå›´è¿›è¡Œæ“ä½œ
å¦‚æœä½ ä¸ä¸€å®šè¦è¿›å…¥å¯è§†æ¨¡å¼ï¼Œè€Œæ˜¯ç›´æ¥å¯¹é€‰å®šçš„è¡Œè¿›è¡Œæ“ä½œï¼ˆä¾‹å¦‚åˆ é™¤ã€å¤åˆ¶ç­‰ï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨è¡Œå·èŒƒå›´ï¼š
1. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè¾“å…¥ `:m,n`ï¼Œç„¶åè¾“å…¥ä½ æƒ³è¦çš„æ“ä½œå‘½ä»¤ã€‚
   - ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åˆ é™¤ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œï¼Œå¯ä»¥è¾“å…¥ `:5,10d`ï¼Œç„¶åæŒ‰å›è½¦ã€‚
   - å¦‚æœä½ æƒ³å¤åˆ¶ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œï¼Œå¯ä»¥è¾“å…¥ `:5,10y`ï¼Œç„¶åæŒ‰å›è½¦ã€‚

### ç¤ºä¾‹
å‡è®¾ä½ æƒ³é€‰æ‹©ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œå¹¶å°†å…¶å¤åˆ¶åˆ°ç¼“å†²åŒºä¸­ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š
1. åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œè¾“å…¥ `:5,10y`ï¼Œç„¶åæŒ‰å›è½¦ã€‚
2. è¿™æ ·ï¼Œç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œçš„æ–‡æœ¬å°±è¢«å¤åˆ¶åˆ°äº†ç¼“å†²åŒºä¸­ã€‚

### å…¶ä»–æ“ä½œ
- **åˆ é™¤**ï¼š`:m,nd`ï¼Œä¾‹å¦‚ `:5,10d`ã€‚
- **å¤åˆ¶**ï¼š`:m,ny`ï¼Œä¾‹å¦‚ `:5,10y`ã€‚
- **ç§»åŠ¨**ï¼š`:m,nm +`ï¼Œä¾‹å¦‚ `:5,10m +`ï¼Œè¿™ä¼šå°†ç¬¬ 5 è¡Œåˆ°ç¬¬ 10 è¡Œç§»åŠ¨åˆ°å½“å‰å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹æ–¹ã€‚

è¿™äº›æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ åœ¨ Vim ä¸­é«˜æ•ˆåœ°é€‰æ‹©å’Œæ“ä½œæŒ‡å®šè¡Œã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚



åœ¨Emacsä¸­å¯ä»¥é€šè¿‡è®¾ç½®å˜é‡æ¥æŒ‡å®šç¼“å­˜ç›®å½•ã€‚

ä½ å¯ä»¥åœ¨Emacsçš„åˆå§‹åŒ–æ–‡ä»¶ï¼ˆ.emacsæˆ–è€…init.elï¼‰ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹æ¥è®¾ç½®ç¼“å­˜ç›®å½•ã€‚æ¯”å¦‚ï¼Œå°†ç¼“å­˜ç›®å½•è®¾ç½®ä¸º"~/.emacs_cache"ï¼š
(setq cache-directory "~/.emacs_cache")
ä¿®æ”¹è¿™ä¸ªå˜é‡åï¼ŒEmacsä¼šå°†ä¸€äº›è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ç­‰å­˜æ”¾åˆ°è¿™ä¸ªæŒ‡å®šçš„ç›®å½•ä¸­ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ä½ç½®ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°ç®¡ç†è¿™äº›ç¼“å­˜æ€§è´¨çš„æ–‡ä»¶ã€‚

åœ¨Emacsä¸­ï¼Œå¦‚æœä½ æƒ³ç¦æ­¢è‡ªåŠ¨åˆ·æ–°ï¼ˆä¾‹å¦‚æ–‡ä»¶å†…å®¹è¢«å¤–éƒ¨ä¿®æ”¹åçš„è‡ªåŠ¨é‡æ–°è¯»å–ï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®global - auto - revert - non - file - bufferså’Œglobal - auto - revert - tailed - buffersä¸ºnilæ¥å®ç°éƒ¨åˆ†ç¦æ­¢è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½ã€‚

åœ¨Emacsåˆå§‹åŒ–æ–‡ä»¶ï¼ˆ.emacsæˆ–init.elï¼‰ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
(setq global - auto - revert - non - file - buffers nil)
(setq global - auto - revert - tailed - buffers nil)
global - auto - revert - non - file - buffersæ˜¯ç”¨äºæ§åˆ¶éæ–‡ä»¶ç¼“å†²åŒºï¼ˆå¦‚diredç¼“å†²åŒºç­‰ï¼‰çš„è‡ªåŠ¨åˆ·æ–°ï¼›global - auto - revert - tailed - buffersç”¨äºæ§åˆ¶æœ‰â€œtailâ€æ¨¡å¼ï¼ˆå¦‚æŸäº›æ—¥å¿—æ–‡ä»¶æŸ¥çœ‹æ¨¡å¼ï¼‰çš„ç¼“å†²åŒºè‡ªåŠ¨åˆ·æ–°ã€‚

å¦‚æœæƒ³å®Œå…¨ç¦æ­¢è‡ªåŠ¨åˆ·æ–°ï¼ŒåŒ…æ‹¬æ–‡ä»¶å†…å®¹æ›´æ–°åçš„è‡ªåŠ¨é‡æ–°è¯»å–ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼š
(setq global - auto - revert - mode nil)
è¿™æ ·è®¾ç½®ä¹‹åï¼ŒEmacså°±ä¸ä¼šè‡ªåŠ¨æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å¤–éƒ¨ä¿®æ”¹è€Œè¿›è¡Œåˆ·æ–°äº†ã€‚



è¦ç¦æ­¢Emacsè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥åœ¨Emacsçš„åˆå§‹åŒ–æ–‡ä»¶ï¼ˆ.emacsæˆ–init.elï¼‰ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š
(setq auto-save-default nil)
è¿™è¡Œä»£ç å°†auto - save - defaultå˜é‡è®¾ç½®ä¸ºnilï¼Œä»è€Œå…³é—­è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ã€‚è¿™æ ·Emacså°±ä¸ä¼šè‡ªåŠ¨ä¸ºæ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶åˆ›å»ºè‡ªåŠ¨ä¿å­˜æ–‡ä»¶äº†ã€‚

åœ¨ Emacs ä¸­è¿›è¡Œç»˜å›¾å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼Œå…·ä½“å–å†³äºä½ ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€å’Œå·¥å…·ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ä½¿ç”¨ Rã€Python å’Œ Org Mode è¿›è¡Œç»˜å›¾ã€‚

### 1. ä½¿ç”¨ R è¿›è¡Œç»˜å›¾

#### å®‰è£… ESS (Emacs Speaks Statistics)

1. **å®‰è£… ESS**ï¼š
   ```emacs
   M-x package-install RET ess RET
   ```

2. **å¯åŠ¨ R ä¼šè¯**ï¼š
   ```emacs
   M-x R
   ```

3. **ç»˜åˆ¶å›¾å½¢**ï¼š
   ä½ å¯ä»¥åœ¨ R ä¼šè¯ä¸­ä½¿ç”¨å„ç§ç»˜å›¾å‡½æ•°ï¼Œä¾‹å¦‚ `plot`ã€`ggplot2` ç­‰ã€‚

   ```r
   # ä½¿ç”¨ base R ç»˜å›¾
   plot(cars)

   # ä½¿ç”¨ ggplot2 ç»˜å›¾
   library(ggplot2)
   ggplot(mtcars, aes(x = wt, y = mpg)) + geom_point()
   ```

4. **ä¿å­˜å›¾å½¢**ï¼š
   ä½ å¯ä»¥å°†å›¾å½¢ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä¾‹å¦‚ PNG æˆ– PDF æ ¼å¼ã€‚
   ```r
   png("plot.png")
   plot(cars)
   dev.off()
   ```

### 2. ä½¿ç”¨ Python è¿›è¡Œç»˜å›¾

#### å®‰è£… Elpy

1. **å®‰è£… Elpy**ï¼š
   ```emacs
   M-x package-install RET elpy RET
   ```

2. **å¯åŠ¨ Python ä¼šè¯**ï¼š
   ```emacs
   M-x run-python
   ```

3. **ç»˜åˆ¶å›¾å½¢**ï¼š
   ä½ å¯ä»¥ä½¿ç”¨ Matplotlib æˆ– Seaborn ç­‰åº“è¿›è¡Œç»˜å›¾ã€‚

   ```python
   import matplotlib.pyplot as plt
   import numpy as np

   x = np.linspace(0, 10, 100)
   y = np.sin(x)

   plt.plot(x, y)
   plt.show()
   ```

4. **ä¿å­˜å›¾å½¢**ï¼š
   ä½ å¯ä»¥å°†å›¾å½¢ä¿å­˜ä¸ºæ–‡ä»¶ï¼Œä¾‹å¦‚ PNG æˆ– PDF æ ¼å¼ã€‚
   ```python
   plt.savefig("plot.png")
   ```

### 3. ä½¿ç”¨ Org Mode è¿›è¡Œç»˜å›¾

Org Mode æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥åµŒå…¥å¤šç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç å—ï¼Œå¹¶ç”Ÿæˆå„ç§æ ¼å¼çš„æŠ¥å‘Šã€‚

1. **å®‰è£… Org Mode**ï¼š
   é€šå¸¸å·²ç»åŒ…å«åœ¨ Emacs ä¸­ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ MELPA æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚
   ```emacs
   M-x package-install RET org RET
   ```

2. **ç¼–å†™ Org æ–‡ä»¶**ï¼š
   åˆ›å»ºä¸€ä¸ª `.org` æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­åµŒå…¥ä»£ç å—ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ R è¿›è¡Œç»˜å›¾ï¼š

   ```org
   #+BEGIN_SRC R :results file :file plot.png
   plot(cars)
   #+END_SRC
   ```

   æˆ–è€…ä½¿ç”¨ Python è¿›è¡Œç»˜å›¾ï¼š

   ```org
   #+BEGIN_SRC python :results file :file plot.png
   import matplotlib.pyplot as plt
   import numpy as np

   x = np.linspace(0, 10, 100)
   y = np.sin(x)

   plt.plot(x, y)
   plt.savefig("plot.png")
   #+END_SRC
   ```

3. **æ‰§è¡Œä»£ç å—**ï¼š
   å°†å…‰æ ‡æ”¾åœ¨ä»£ç å—å†…ï¼Œç„¶åæŒ‰ `C-c C-c` æ¥æ‰§è¡Œä»£ç å—ã€‚ç»“æœä¼šæ˜¾ç¤ºåœ¨ä»£ç å—ä¸‹æ–¹ï¼Œå¹¶ç”ŸæˆæŒ‡å®šçš„å›¾åƒæ–‡ä»¶ã€‚

### 4. ä½¿ç”¨ Graphviz è¿›è¡Œç»˜å›¾

Graphviz æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå›¾å½¢çš„å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆç»˜åˆ¶å¤æ‚çš„å›¾ç»“æ„ã€‚

1. **å®‰è£… Graphviz**ï¼š
   ä½ å¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£… Graphvizï¼Œä¾‹å¦‚åœ¨ Ubuntu ä¸Šï¼š
   ```sh
   sudo apt-get install graphviz
   ```

2. **åœ¨ Org Mode ä¸­ä½¿ç”¨ Graphviz**ï¼š
   åˆ›å»ºä¸€ä¸ª `.org` æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­åµŒå…¥ Graphviz ä»£ç å—ã€‚

   ```org
   #+BEGIN_SRC dot :file graph.png :cmdline -Kdot -Tpng
   digraph G {
       A -> B;
       B -> C;
       C -> A;
   }
   #+END_SRC
   ```

3. **æ‰§è¡Œä»£ç å—**ï¼š
   å°†å…‰æ ‡æ”¾åœ¨ä»£ç å—å†…ï¼Œç„¶åæŒ‰ `C-c C-c` æ¥æ‰§è¡Œä»£ç å—ã€‚ç»“æœä¼šç”Ÿæˆä¸€ä¸ª `graph.png` åœ¨Vimä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¯mä¸ªå­—ç¬¦çš„æ¨¡å¼å¹¶ä¸æ˜¯ç›´æ¥æ”¯æŒçš„åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åœ¨æ¯mä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼ˆæ¯”å¦‚ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

å‡è®¾ä½ æƒ³è¦åœ¨æ¯5ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```vim
:%s/\(.\{5\}\)/\1 /g
```

è¿™é‡Œè§£é‡Šä¸€ä¸‹è¿™ä¸ªå‘½ä»¤çš„å„ä¸ªéƒ¨åˆ†ï¼š

- `:%s/` è¡¨ç¤ºåœ¨æ•´ä¸ªæ–‡ä»¶èŒƒå›´å†…è¿›è¡Œæ›¿æ¢æ“ä½œã€‚
- `\(` å’Œ `\)` ç”¨äºåˆ›å»ºä¸€ä¸ªæ•è·ç»„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨æ›¿æ¢éƒ¨åˆ†å¼•ç”¨å®ƒã€‚
- `.\{5\}` åŒ¹é…ä»»ä½•5ä¸ªè¿ç»­çš„å­—ç¬¦ï¼ˆ`.` è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦ï¼Œ`\{5\}` è¡¨ç¤ºå‰ä¸€ä¸ªå…ƒç´ é‡å¤5æ¬¡ï¼‰ã€‚
- `\1` å¼•ç”¨ç¬¬ä¸€ä¸ªæ•è·ç»„çš„å†…å®¹ï¼Œå³åŒ¹é…åˆ°çš„5ä¸ªå­—ç¬¦ã€‚
- ` ` (ç©ºæ ¼) æ˜¯è¦æ’å…¥çš„å­—ç¬¦ã€‚
- `/g` è¡¨ç¤ºå…¨å±€æ›¿æ¢ï¼Œå³åœ¨åŒä¸€è¡Œå†…å¤šæ¬¡åº”ç”¨è¯¥æ›¿æ¢è§„åˆ™ã€‚

å¦‚æœä½ æƒ³è¦åœ¨æ¯5ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œåªéœ€å°†ç©ºæ ¼æ¢æˆ`\r`ï¼ˆVimä¸­çš„æ¢è¡Œç¬¦ï¼‰ï¼š

```vim
:%s/\(.\{5\}\)/\1\r/g
```

è¯·æ³¨æ„ï¼Œè¿™äº›æ“ä½œä¼šæ”¹å˜æ–‡æœ¬çš„å½“ç„¶ï¼Œå¦‚æœä½ ä¸å¸Œæœ›ä½¿ç”¨ `interactive` ä½¿å‡½æ•°æˆä¸ºå¯äº¤äº’çš„å‘½ä»¤ï¼Œå¯ä»¥ç›´æ¥å®šä¹‰ä¸€ä¸ª Elisp å‡½æ•°å¹¶åœ¨éœ€è¦æ—¶è°ƒç”¨å®ƒã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ¯ 5 ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼Œè€Œä¸ä½¿ç”¨ `interactive`ã€‚

### æ’å…¥ç©ºæ ¼

```elisp
(defun insert-space-every-m-chars (m)
  "Insert a space every M characters in the current buffer."
  (let ((start (point-min))
        (end (point-max)))
    (save-excursion
      (goto-char start)
      (while (< (point) end)
        (forward-char m)
        (insert " ")))))

;; è°ƒç”¨å‡½æ•°
(insert-space-every-m-chars 5)
```

### æ’å…¥æ¢è¡Œç¬¦

```elisp
(defun insert-newline-every-m-chars (m)
  "Insert a newline every M characters in the current buffer."
  (let ((start (point-min))
        (end (point-max)))
    (save-excursion
      (goto-char start)
      (while (< (point) end)
        (forward-char m)
        (insert "\n")))))

;; è°ƒç”¨å‡½æ•°
(insert-newline-every-m-chars 5)
```

### ä½¿ç”¨æ­¥éª¤

1. æ‰“å¼€ä½ çš„ Emacs ç¼“å†²åŒºã€‚
2. æŒ‰ `M-x` å¹¶è¾“å…¥ `eval-buffer`ï¼Œç„¶åæŒ‰å›è½¦ï¼Œè¿™å°†è¯„ä¼°å½“å‰ç¼“å†²åŒºä¸­çš„æ‰€æœ‰ Elisp ä»£ç ã€‚
3. åœ¨ Emacs çš„ minibuffer ä¸­è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚ï¼š
   - å¯¹äºæ’å…¥ç©ºæ ¼ï¼š`(insert-space-every-m-chars 5)`
   - å¯¹äºæ’å…¥æ¢è¡Œç¬¦ï¼š`(insert-newline-every-m-chars 5)`

### ä¿å­˜åˆ°æ–‡ä»¶

å¦‚æœä½ å¸Œæœ›å°†ç»“æœä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥åœ¨æ‰§è¡Œä¸Šè¿°å‡½æ•°åï¼Œä½¿ç”¨ `C-x C-w` å‘½ä»¤å°†ç¼“å†²åŒºå†…å®¹å¦å­˜ä¸ºæ–°æ–‡ä»¶ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `input.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
abcdefghijklmnopqrstuvwxyz
```

ä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. æ‰“å¼€ `input.txt` æ–‡ä»¶ã€‚
2. å°†ä¸Šè¿° Elisp ä»£ç ç²˜è´´åˆ°ä¸€ä¸ªæ–°ç¼“å†²åŒºä¸­ã€‚
3. æŒ‰ `M-x eval-buffer` è¯„ä¼°ä»£ç ã€‚
4. åœ¨ minibuffer ä¸­è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚ `(insert-space-every-m-chars 5)`ã€‚
5. æ–‡ä»¶å†…å®¹å°†å˜ä¸ºï¼š

```
abcde fghij klmon pqrst åœ¨ Emacs ä¸­ç›´æ¥æ“ä½œæˆ–å±•ç¤ºäºŒå‰æ ‘å¹¶ä¸æ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œå› ä¸º Emacs ä¸»è¦æ˜¯ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨å’Œå¼€å‘ç¯å¢ƒã€‚ä¸è¿‡ï¼Œå¦‚æœä½ æœ‰ç‰¹å®šçš„éœ€æ±‚ï¼Œæ¯”å¦‚åœ¨å­¦ä¹ æ•°æ®ç»“æ„æ—¶å¸Œæœ›ç”¨ Emacs æ¥è¾…åŠ©ç†è§£å’Œæ“ä½œäºŒå‰æ ‘ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥å®ç°ï¼š

### 1. ä½¿ç”¨å›¾å½¢è¡¨ç¤º
ä½ å¯ä»¥æ‰‹åŠ¨åœ¨ Emacs ç¼“å†²åŒºä¸­ä½¿ç”¨ ASCII è‰ºæœ¯æ¥ç»˜åˆ¶äºŒå‰æ ‘ã€‚ä¾‹å¦‚ï¼š
```
        5
       / \
      3   8
     / \   \
    1   4   9
```

### 2. åˆ©ç”¨ç¼–ç¨‹è¯­è¨€
å¦‚æœä½ ç†Ÿæ‚‰ Lispï¼ˆEmacs è‡ªèº«çš„æ‰©å±•è¯­è¨€æ˜¯ Emacs Lispï¼‰ï¼Œæˆ–è€…ä»»ä½•å…¶ä»–å¯ä»¥åœ¨ Emacs ä¸­è¿è¡Œçš„è¯­è¨€ï¼ˆå¦‚ Pythonã€JavaScript ç­‰ï¼‰ï¼Œä½ å¯ä»¥ç¼–å†™ä»£ç æ¥åˆ›å»ºã€æ“ä½œå’Œæ‰“å°äºŒå‰æ ‘ã€‚

#### ç¤ºä¾‹ï¼šä½¿ç”¨ Emacs Lisp åˆ›å»ºç®€å•çš„äºŒå‰æ ‘
```lisp
(defun make-node (value left right)
  "Create a binary tree node."
  (list :value value :left left :right right))

(defun print-tree (node indent)
  "Print a binary tree in a readable format."
  (when node
    (print-tree (plist-get node :right) (+ indent 2))
    (insert (make-string indent ?\ ))
    (insert (format "%s\n" (plist-get node :value)))
    (print-tree (plist-get node :left) (+ indent 2))))

;; åˆ›å»ºä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘
(setq root (make-node 5
                      (make-node 3 (make-node 1 nil nil) (make-node 4 nil nil))
                      (make-node 8 nil (make-node 9 nil nil))))

;; æ‰“å°äºŒå‰æ ‘
(with-output-to-temp-buffer "*Binary Tree*"
  (print-tree root 0))
```

è¿™æ®µä»£ç é¦–å…ˆå®šä¹‰äº† `make-node` å‡½æ•°ç”¨äºåˆ›å»ºäºŒå‰æ ‘èŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«å€¼ã€å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ã€‚ç„¶åå®šä¹‰äº† `print-tree` å‡½æ•°ç”¨äºä»¥é€’å½’æ–¹å¼æ‰“å°äºŒå‰æ ‘ã€‚æœ€åï¼Œåˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„äºŒå‰æ ‘å¹¶å°†å…¶æ‰“å°åˆ°ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºä¸­ã€‚åœ¨ `awk` ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ªç¯å’Œå­—ç¬¦ä¸²å¤„ç†å‡½æ•°æ¥å®ç°æ¯ m ä¸ªå­—ç¬¦è¿›è¡ŒæŸç§æ“ä½œï¼Œæ¯”å¦‚æ’å…¥ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ¯ m ä¸ªå­—ç¬¦åæ’å…¥ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚åœ¨ Vim ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥ç”¨æ¥åŒ¹é…å’Œæ“ä½œæ–‡æœ¬ï¼ŒåŒ…æ‹¬å…ƒç»„ï¼ˆtupleï¼‰å½¢å¼çš„æ•°æ®ã€‚å…ƒç»„é€šå¸¸ç”±æ‹¬å· `()` åŒ…å›´ï¼Œå¹¶ä¸”å…ƒç´ ä¹‹é—´ç”¨é€—å· `,` åˆ†éš”ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼Œç”¨äºåŒ¹é…å’Œæ“ä½œå…ƒç»„æ•°æ®ã€‚

### åŒ¹é…å…ƒç»„

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«å¤šä¸ªå…ƒç»„ï¼Œä¾‹å¦‚ï¼š

```
(1, 2, 3)
(4, 5, 6)
(7, 8, 9)
```

#### 1. åŒ¹é…æ•´ä¸ªå…ƒç»„

è¦åŒ¹é…æ•´ä¸ªå…ƒç»„ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
\(\([^(,)]\+,\s*\)*[^(,)]\+\)
```

è§£é‡Šï¼š
- `\(` å’Œ `\)`ï¼šåŒ¹é…æ‹¬å· `()`
- `\([^(,)]\+,\s*\)*`ï¼šåŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ åé¢è·Ÿç€ä¸€ä¸ªé€—å·å’Œå¯èƒ½çš„ç©ºæ ¼
- `[^(,)]\+`ï¼šåŒ¹é…æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸å…è®¸åŒ…å«æ‹¬å·æˆ–é€—å·

#### 2. åŒ¹é…å…ƒç»„ä¸­çš„ç‰¹å®šå…ƒç´ 

å‡è®¾ä½ æƒ³åŒ¹é…å…ƒç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
\(\([^,)]\+,\s*\)\{1\}\([^,)]\+\)
```

è§£é‡Šï¼š
- `\(\([^,)]\+,\s*\)\{1\}`ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªå…ƒç´ åŠå…¶åé¢çš„é€—å·å’Œå¯èƒ½çš„ç©ºæ ¼
- `\([^,)]\+\)`ï¼šåŒ¹é…ç¬¬äºŒä¸ªå…ƒç´ 

### ç¤ºä¾‹

#### 1. æ›¿æ¢å…ƒç»„

å‡è®¾ä½ å¸Œæœ›å°†æ‰€æœ‰å…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ›¿æ¢ä¸º `0`ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```vim
:%s/\(\([^(,)]\+,\s*\)\{0\}\)\([^,)]\+\)\(.*\)/\10\4/
```

è§£é‡Šï¼š
- `\(\([^(,)]\+,\s*\)\{0\}\)`ï¼šåŒ¹é…é›¶ä¸ªå…ƒç´ åŠå…¶åé¢çš„é€—å·å’Œå¯èƒ½çš„ç©ºæ ¼ï¼ˆè¿™é‡Œæ˜¯ä¸ºäº†ç¡®ä¿ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼‰
- `\([^,)]\+\)`ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªå…ƒç´ 
- `\(.*\)`ï¼šåŒ¹é…å‰©ä½™çš„éƒ¨åˆ†
- `\10\4`ï¼šå°†ç¬¬ä¸€ä¸ªå…ƒç´ æ›¿æ¢ä¸º `0`ï¼Œå¹¶ä¿ç•™å…¶ä½™éƒ¨åˆ†

#### 2. æå–å…ƒç»„ä¸­çš„ç‰¹å®šå…ƒç´ 

å‡è®¾ä½ å¸Œæœ›æå–æ‰€æœ‰å…ƒç»„ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```vim
:%s/\(\([^,)]\+,\s*\)\{1\}\)\([^,)]\+\).*/\3/
```

è§£é‡Šï¼š
- `\(\([^,)]\+,\s*\)\{1\}\)`ï¼šåŒ¹é…ç¬¬ä¸€ä¸ªå…ƒç´ åŠå…¶åé¢çš„é€—å·å’Œå¯èƒ½çš„ç©ºæ ¼
- `\([^,)]\+\)`ï¼šåŒ¹é…ç¬¬äºŒä¸ªå…ƒç´ 
- `.*`ï¼šåŒ¹é…å‰©ä½™çš„éƒ¨åˆ†
- `\3`ï¼šåªä¿ç•™ç¬¬äºŒä¸ªå…ƒç´ 

### å…¶ä»–å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼

- **åŒ¹é…å…ƒç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ **ï¼š

```vim
\(\([^(,)]\+,\s*\)*\)\([^(,)]\+\)
```

- **åŒ¹é…å…ƒç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ **ï¼š

```vim
\(\([^(,)]\+\),\s*\).*
```

### æ³¨æ„äº‹é¡¹

- **è½¬ä¹‰å­—ç¬¦**ï¼šåœ¨ Vim çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼ŒæŸäº›ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `(`ã€`)`ã€`{`ã€`}` ç­‰ï¼‰éœ€è¦è½¬ä¹‰ã€‚
- **è´ªå©ªåŒ¹é…**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒVim çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯è´ªå©ªçš„ï¼Œå³å°½å¯èƒ½åŒ¹é…æ›´å¤šçš„å­—ç¬¦ã€‚å¦‚æœéœ€è¦éè´ªå©ªåŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `{-}` ä»£æ›¿ `{}`ã€‚
- **æµ‹è¯•å’Œè°ƒè¯•**ï¼šåœ¨å®é™…ä½¿ç”¨å‰ï¼Œå»ºè®®å…ˆåœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶æˆ–ä¸´æ—¶æ–‡ä»¶ä¸­æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‰é¢„æœŸå·¥ä½œã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Vimåœ¨ `awk` ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ªç¯å’Œå­—ç¬¦ä¸²å¤„ç†å‡½æ•°æ¥å®ç°æ¯ m ä¸ªå­—ç¬¦è¿›è¡ŒæŸç§æ“ä½œï¼Œæ¯”å¦‚æ’å…¥ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œåœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•æ¥æ’å…¥å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š

### 1. ä½¿ç”¨ `insert-time` å‘½ä»¤

Emacs æä¾›äº†ä¸€ä¸ªå†…ç½®å‘½ä»¤ `insert-time`ï¼Œå¯ä»¥æ’å…¥å½“å‰çš„æ—¶é—´ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨å®ƒï¼š

1. **è¿›å…¥æ’å…¥æ¨¡å¼**ï¼šç¡®ä¿ä½ åœ¨æ’å…¥æ¨¡å¼ä¸‹ã€‚
2. **æ’å…¥å½“å‰æ—¶é—´**ï¼š
   - æŒ‰ `M-!`ï¼ˆå³ `Alt-!` æˆ– `Esc !`ï¼‰ï¼Œç„¶åè¾“å…¥ `date`ï¼ŒæŒ‰å›è½¦ã€‚
   - è¿™å°†æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ `date` å¹¶æ’å…¥å…¶è¾“å‡ºã€‚

### 2. ä½¿ç”¨ `insert-date` å‘½ä»¤

Emacs è¿˜æä¾›äº†ä¸€ä¸ª `insert-date` å‘½ä»¤ï¼Œå¯ä»¥æ’å…¥å½“å‰çš„æ—¥æœŸã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤ä½¿ç”¨å®ƒï¼š

1. **è¿›å…¥æ’å…¥æ¨¡å¼**ï¼šç¡®ä¿ä½ åœ¨æ’å…¥æ¨¡å¼ä¸‹ã€‚
2. **æ’å…¥å½“å‰æ—¥æœŸ**ï¼š
   - æŒ‰ `M-x insert-date`ï¼Œç„¶åæŒ‰å›è½¦ã€‚

### 3. ä½¿ç”¨ `current-time-string` å‡½æ•°

ä½ å¯ä»¥ä½¿ç”¨ Emacs Lisp å‡½æ•° `current-time-string` æ¥æ’å…¥å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ï¼š

1. **è¿›å…¥æ’å…¥æ¨¡å¼**ï¼šç¡®ä¿ä½ åœ¨æ’å…¥æ¨¡å¼ä¸‹ã€‚
2. **æ’å…¥å½“å‰æ—¥æœŸå’Œæ—¶é—´**ï¼š
   - æŒ‰ `M-:`ï¼ˆå³ `Alt-:` æˆ– `Esc :`ï¼‰ï¼Œç„¶åè¾“å…¥ `(current-time-string)`ï¼ŒæŒ‰å›è½¦ã€‚

### 4. è‡ªå®šä¹‰å‡½æ•°

ä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æ¥æ’å…¥å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªå¿«æ·é”®ä¸Šã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š

1. **æ‰“å¼€ `.emacs` æˆ– `init.el` æ–‡ä»¶**ï¼š
   - æŒ‰ `C-x C-f`ï¼Œç„¶åè¾“å…¥ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼ŒæŒ‰å›è½¦ã€‚

2. **æ·»åŠ è‡ªå®šä¹‰å‡½æ•°**ï¼š
   - åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

     ```elisp
     (defun insert-current-date ()
       "Insert the current date."
       (interactive)
       (insert (format-time-string "%Y-%m-%d")))

     (defun insert-current-time ()
       "Insert the current time."
       (interactive)
       (insert (format-time-string "%H:%M:%S")))

     (defun insert-current-datetime ()
       "Insert the current date and time."
       (interactive)
       (insert (format-time-string "%Y-%m-%d %H:%M:%S")))

     (global-set-key (kbd "C-c d") 'insert-current-date)
     (global-set-key (kbd "C-c t") 'insert-current-time)
     (global-set-key (kbd "C-c D") 'insert-current-datetime)
     ```

3. **ä¿å­˜å¹¶é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶**ï¼š
   - æŒ‰ `C-x C-s` ä¿å­˜æ–‡ä»¶ã€‚
   - æŒ‰ `M-x eval-buffer` é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚

### 5. ä½¿ç”¨ `format-time-string` å‡½æ•°

ä½ å¯ä»¥åœ¨æ’å…¥æ¨¡å¼ä¸‹ç›´æ¥ä½¿ç”¨ `format-time-string` å‡½æ•°æ¥æ’å…¥å½“å‰çš„æ—¥æœŸå’Œæ—¶é—´ï¼š

1. **è¿›å…¥æ’å…¥æ¨¡å¼**ï¼šç¡®ä¿ä½ åœ¨æ’å…¥æ¨¡å¼ä¸‹ã€‚
2. **æ’å…¥å½“å‰æ—¥æœŸ**ï¼š
   - æŒ‰ `M-:`ï¼ˆå³ `Alt-:` æˆ– `Esc :`ï¼‰ï¼Œç„¶åè¾“å…¥ `(format-time-string "%Y-%m-%d")`ï¼ŒæŒ‰å›è½¦ã€‚

3. **æ’å…¥å½“å‰æ—¶é—´**ï¼š
   - æŒ‰ `M-:`ï¼ˆå³ `Alt-:` æˆ– `Esc :`ï¼‰ï¼Œç„¶åè¾“å…¥ `(format-time-string "%H:%M:%S")`ï¼ŒæŒ‰å›è½¦ã€‚

4. **æ’å…¥å½“å‰æ—¥æœŸå’Œæ—¶é—´**ï¼š
   - æŒ‰ `M-:`ï¼ˆå³ `Alt-:` æˆ– `Esc :`ï¼‰ï¼Œç„¶åè¾“å…¥ `(format-time-string "%Y-%m-%d %H:%M:%S")`ï¼ŒæŒ‰å›è½¦ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `example.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
This is an example file.
```

1. **æ’å…¥å½“å‰æ—¥æœŸ**ï¼š
   - æŒ‰ `C-c d`ï¼ˆå‡è®¾ä½ å·²ç»å®šä¹‰äº†è‡ªå®šä¹‰å‡½æ•°ï¼‰ã€‚

   ç»“æœï¼š
   ```
   This is an example file.
   2024-12-18
   ```

2. **æ’å…¥å½“å‰æ—¶é—´**ï¼š
   - æŒ‰ `C-c t`ï¼ˆå‡è®¾ä½ å·²ç»å®šä¹‰äº†è‡ªå®šä¹‰å‡½æ•°ï¼‰ã€‚

   ç»“æœï¼š
   ```
   This is an example file.
   19:57:00
   ```

3. **æ’å…¥å½“å‰æ—¥æœŸå’Œæ—¶é—´**ï¼š
   - æŒ‰ `C-c D`ï¼ˆå‡è®¾ä½ å·²ç»å®šä¹‰äº†è‡ªå®šä¹‰å‡½æ•°ï¼‰ã€‚

   ç»“æœï¼š
   ```
   This is an example file.
   2024-12-18 19:57:00
   ```

å¸Œæœ›è¿™äº›ç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Emacs åœ¨ `awk` ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨å¾ªç¯å’Œå­—ç¬¦ä¸²å¤„ç†å‡½æ•°æ¥å®ç°æ¯ m ä¸ªå­—ç¬¦è¿›è¡ŒæŸç§æ“ä½œï¼Œæ¯”å¦‚æ’å…¥ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•åœ¨æ¯ m ä¸ªå­—ç¬¦åæ’å…¥ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ã€‚

### æ’å…¥ç©ºæ ¼

å‡è®¾ä½ å¸Œæœ›åœ¨æ¯ 5 ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `awk` è„šæœ¬ï¼š

```sh
awk '{
    for (i = 1; i <= length($0); i += 5) {
        printf "%s ", substr($0, i, 5);
    }
    print "";
}' input.txt
```

### æ’å…¥æ¢è¡Œç¬¦

å¦‚æœä½ å¸Œæœ›åœ¨æ¯ 5 ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œå¯ä»¥ç¨å¾®ä¿®æ”¹ä¸Šè¿°è„šæœ¬ï¼š

```sh
awk '{
    for (i = 1; i <= length($0); i += 5) {
        printf "%s\n", substr($0, i, 5);
    }
}' input.txt
```

### è¯¦ç»†è§£é‡Š

- `length($0)`ï¼šè·å–å½“å‰è¡Œçš„é•¿åº¦ã€‚
- `substr($0, i, 5)`ï¼šä»å½“å‰è¡Œçš„ç¬¬ `i` ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæå–é•¿åº¦ä¸º 5 çš„å­å­—ç¬¦ä¸²ã€‚
- `printf "%s ", substr($0, i, 5)`ï¼šæ‰“å°æå–çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å…¶åæ·»åŠ ä¸€ä¸ªç©ºæ ¼ã€‚
- `printf "%s\n", substr($0, i, 5)`ï¼šæ‰“å°æå–çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å…¶åæ·»åŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚
- `print ""`ï¼šåœ¨å¤„ç†å®Œä¸€è¡Œåï¼Œæ‰“å°ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä»¥ä¾¿ä¸‹ä¸€è¡Œçš„å¤„ç†ã€‚

### ä¿å­˜ç»“æœåˆ°æ–‡ä»¶

å¦‚æœä½ å¸Œæœ›å°†ç»“æœä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é‡å®šå‘ï¼š

```sh
awk '{
    for (i = 1; i <= length($0); i += 5) {
        printf "%s ", substr($0, i, 5);
    }
    print "";
}' input.txt > output.txt
```

æˆ–è€…å¯¹äºæ¢è¡Œç¬¦çš„æƒ…å†µï¼š

```sh
awk '{
    for (i = 1; i <= length($0); i += 5) {
        printf "%s\n", substr($0, i, 5);
    }
}' input.txt > output.txt
```

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `input.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
abcdefghijklmnopqrstuvwxyz
```

ä½¿ç”¨ä¸Šè¿°è„šæœ¬å¤„ç†åï¼Œç»“æœå°†æ˜¯ï¼š

- æ’å…¥ç©ºæ ¼ï¼š

```
abcde fghij klmno pqrst uvwxy z
```

- æ’å…¥æ¢è¡Œç¬¦ï¼š

```
abcde
fghij
klmno
pqrst
uvwxy
z
```åœ¨ Vim ä¸­ï¼Œ`\zs` å’Œ `\ze` æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå…ƒå­—ç¬¦ï¼Œç”¨äºå®šä¹‰åŒ¹é…çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚è¿™äº›å…ƒå­—ç¬¦å¯ä»¥å¸®åŠ©ä½ æ›´ç²¾ç¡®åœ°æ§åˆ¶åŒ¹é…çš„èŒƒå›´ã€‚è€Œ `\zq` å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®¨è®ºå¦‚ä½•ä½¿ç”¨ `\zs` å’Œ `\ze` æ¥å®ç°ç‰¹å®šçš„åŒ¹é…éœ€æ±‚ã€‚

### 1. `\zs` å’Œ `\ze` çš„ä½¿ç”¨

- **`\zs`**ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- **`\ze`**ï¼šå®šä¹‰åŒ¹é…çš„ç»“æŸä½ç½®ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `example.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
apple:123
banana:456
cherry:789
date:101
elderberry:202
fig:303
grape:404
```

### 1.1 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/:\zs\d\+
```

è§£é‡Šï¼š
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.2 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²å¹¶æ’é™¤å‰ç¼€

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/:\zs\d\+
```

è§£é‡Šï¼š
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.3 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²å¹¶æ’é™¤åç¼€

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` å‰é¢çš„å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/\ze:\d\+
```

è§£é‡Šï¼š
- `\ze`ï¼šå®šä¹‰åŒ¹é…çš„ç»“æŸä½ç½®ã€‚
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.4 ç»„åˆä½¿ç”¨ `\zs` å’Œ `\ze`

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` å‰åçš„å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/\zs\w\+:\zs\w\+
```

è§£é‡Šï¼š
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\w\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æˆ–æ•°å­—ã€‚
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå†æ¬¡å®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\w\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æˆ–æ•°å­—ã€‚

### å®é™…åº”ç”¨

1. **åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/:\zs\d\+`
   - ç»“æœï¼š`123`, `456`, `789`, `101`, `202`, `303`, `404`

2. **åŒ¹é… `:` å‰é¢çš„å­—ç¬¦ä¸²éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/\ze:\d\+`
   - ç»“æœï¼š`apple`, `banana`, `cherry`, `date`, `elderberry`, `fig`, `grape`

3. **åŒ¹é… `:` å‰åçš„å­—ç¬¦ä¸²éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/\zs\w\+:\zs\w\+`
   - ç»“æœï¼š`apple:123`, `banana:456`, `cherry:789`, `date:101`, `elderberry:202`, `fig:303`, `grape:404`

### ä½¿ç”¨ `:g` å‘½ä»¤

å¦‚æœä½ å¸Œæœ›åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶é«˜äº®æ˜¾ç¤ºç‰¹å®šçš„åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `:g` å‘½ä»¤ï¼š

```vim
:g/:\zs\d\+/print
```

### æ›¿æ¢ç‰¹å®šæ¨¡å¼çš„å­ä¸²

å¦‚æœä½ å¸Œæœ›æ›¿æ¢ç‰¹å®šæ¨¡å¼çš„å­ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ `:s` å‘½ä»¤ï¼š

```vim
:%s/:\zs\d\+/REPLACEMENT/g
```

### æ³¨æ„äº‹é¡¹

- **è½¬ä¹‰å­—ç¬¦**ï¼šåœ¨ Vim çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼ŒæŸäº›ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `(`ã€`)`ã€`{`ã€`}` ç­‰ï¼‰éœ€è¦è½¬ä¹‰ã€‚
- **è´ªå©ªåŒ¹é…**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒVim çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯è´ªå©ªçš„ï¼Œå³å°½å¯èƒ½åŒ¹é…æ›´å¤šçš„å­—ç¬¦ã€‚å¦‚æœéœ€è¦éè´ªå©ªåŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `{-}` ä»£æ›¿ `{}`ã€‚
- **æµ‹è¯•å’Œè°ƒè¯•**ï¼šåœ¨å®é™…ä½¿ç”¨å‰ï¼Œå»ºè®®å…ˆåœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶æˆ–ä¸´æ—¶æ–‡ä»¶ä¸­æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‰é¢„æœŸå·¥ä½œã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Vim ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `\zs` å’Œ `\ze` åœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ Elisp å‡½æ•°æ¥åœ¨æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½ã€‚

### ç¤ºä¾‹å‡½æ•°

```elisp
(defun add-semicolons-every-m-chars (m)
  "Add semicolons every M characters in the current region or buffer."
  (interactive "nAdd semicolons every: ")
  (let ((start (if (region-active-p) (region-beginning) (point-min)))
        (end (if (region-active-p) (region-end) (point-max))))
    (save-excursion
      (goto-char start)
      (while (< (point) end)
        (let ((next-pos (+ (point) m)))
          (if (<= next-pos end)
              (progn
                (goto-char next-pos)
                (insert ";"))
            (goto-char end)))))))

(global-set-key (kbd "C-c ;") 'add-semicolons-every-m-chars)
```

### è§£é‡Š

1. **å‡½æ•°å®šä¹‰**ï¼š
   - `defun add-semicolons-every-m-chars (m)`ï¼šå®šä¹‰ä¸€ä¸ªåä¸º `add-semicolons-every-m-chars` çš„å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ªå‚æ•° `m`ï¼Œè¡¨ç¤ºæ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·ã€‚

2. **äº¤äº’å¼å‡½æ•°**ï¼š
   - `(interactive "nAdd semicolons every: ")`ï¼šä½¿å‡½æ•°æˆä¸ºäº¤äº’å¼å‡½æ•°ï¼Œå½“è°ƒç”¨æ—¶ä¼šæç¤ºç”¨æˆ·è¾“å…¥æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·çš„å€¼ã€‚

3. **ç¡®å®šåŒºåŸŸèŒƒå›´**ï¼š
   - `let ((start (if (region-active-p) (region-beginning) (point-min))) (end (if (region-active-p) (region-end) (point-max))))`ï¼šç¡®å®šè¦å¤„ç†çš„åŒºåŸŸèŒƒå›´ã€‚å¦‚æœå½“å‰æœ‰é€‰ä¸­çš„åŒºåŸŸï¼Œåˆ™ä½¿ç”¨é€‰ä¸­çš„åŒºåŸŸï¼›å¦åˆ™ï¼Œå¤„ç†æ•´ä¸ªç¼“å†²åŒºã€‚

4. **ä¿å­˜å…‰æ ‡ä½ç½®**ï¼š
   - `save-excursion`ï¼šä¿å­˜å½“å‰å…‰æ ‡çš„å½“å‰ä½ç½®ï¼Œé˜²æ­¢åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¹å˜å…‰æ ‡ä½ç½®ã€‚

5. **éå†åŒºåŸŸå¹¶æ’å…¥åˆ†å·**ï¼š
   - `goto-char start`ï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°èµ·å§‹ä½ç½®ã€‚
   - `while (< (point) end)`ï¼šå¾ªç¯å¤„ç†ä»èµ·å§‹ä½ç½®åˆ°ç»“æŸä½ç½®çš„æ¯ä¸€éƒ¨åˆ†ã€‚
   - `let ((next-pos (+ (point) m)))`ï¼šè®¡ç®—ä¸‹ä¸€ä¸ªæ’å…¥åˆ†å·çš„ä½ç½®ã€‚
   - `if (<= next-pos end)`ï¼šæ£€æŸ¥ä¸‹ä¸€ä¸ªæ’å…¥åˆ†å·çš„ä½ç½®æ˜¯å¦åœ¨ç»“æŸä½ç½®ä¹‹å‰ã€‚
   - `progn (goto-char next-pos) (insert ";")`ï¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ’å…¥åˆ†å·çš„ä½ç½®ï¼Œå¹¶æ’å…¥åˆ†å·ã€‚
   - `goto-char end`ï¼šå¦‚æœä¸‹ä¸€ä¸ªæ’å…¥åˆ†å·çš„ä½ç½®è¶…è¿‡ç»“æŸä½ç½®ï¼Œåˆ™ç§»åŠ¨åˆ°ç»“æŸä½ç½®ã€‚

6. **ç»‘å®šå¿«æ·é”®**ï¼š
   - `(global-set-key (kbd "C-c ;") 'add-semicolons-every-m-chars)`ï¼šå°† `add-semicolons-every-m-chars` å‡½æ•°ç»‘å®šåˆ° `C-c ;` å¿«æ·é”®ä¸Šã€‚

### ä½¿ç”¨æ–¹æ³•

1. **åŠ è½½é…ç½®**ï¼š
   - å°†ä¸Šè¿°ä»£ç æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
   - é‡æ–°å¯åŠ¨ Emacs æˆ–ä½¿ç”¨ `M-x eval-buffer` é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚

2. **è°ƒç”¨å‡½æ•°**ï¼š
   - æŒ‰ `C-c ;` å¿«æ·é”®ã€‚
   - è¾“å…¥æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·çš„å€¼ã€‚
   - å¦‚æœæœ‰é€‰ä¸­çš„åŒºåŸŸï¼Œå°†åœ¨é€‰ä¸­çš„åŒºåŸŸå†…æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·ï¼›å¦åˆ™ï¼Œå°†åœ¨æ•´ä¸ªç¼“å†²åŒºå†…æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
This is a sample text to demonstrate the function.
```

1. æŒ‰ `C-c ;`ã€‚
2. è¾“å…¥ `5` ä½œä¸ºæ¯ 5 ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·çš„å€¼ã€‚
3. å¤„ç†åçš„æ–‡æœ¬å°†å˜ä¸ºï¼š

```
This ;is a ;sampl;e tex;t to ;demo;nstra;te th;e fun;ctio;n.
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ–¹ä¾¿åœ°åœ¨æ¯ m ä¸ªå­—ç¬¦åæ·»åŠ åˆ†å·ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚




åœ¨Vimä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ¯mä¸ªå­—ç¬¦çš„æ¨¡å¼å¹¶ä¸æ˜¯ç›´æ¥æ”¯æŒçš„åŠŸèƒ½ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³åœ¨æ¯mä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ï¼ˆæ¯”å¦‚ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

å‡è®¾ä½ æƒ³è¦åœ¨æ¯5ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š

```vim
:%s/\(.\{5\}\)/\1 /g
```

è¿™é‡Œè§£é‡Šä¸€ä¸‹è¿™ä¸ªå‘½ä»¤çš„å„ä¸ªéƒ¨åˆ†ï¼š

- `:%s/` è¡¨ç¤ºåœ¨æ•´ä¸ªæ–‡ä»¶èŒƒå›´å†…è¿›è¡Œæ›¿æ¢æ“ä½œã€‚
- `\(` å’Œ `\)` ç”¨äºåˆ›å»ºä¸€ä¸ªæ•è·ç»„ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨æ›¿æ¢éƒ¨åˆ†å¼•ç”¨å®ƒã€‚
- `.\{5\}` åŒ¹é…ä»»ä½•5ä¸ªè¿ç»­çš„å­—ç¬¦ï¼ˆ`.` è¡¨ç¤ºä»»æ„å•ä¸ªå­—ç¬¦ï¼Œ`\{5\}` è¡¨ç¤ºå‰ä¸€ä¸ªå…ƒç´ é‡å¤5æ¬¡ï¼‰ã€‚
- `\1` å¼•ç”¨ç¬¬ä¸€ä¸ªæ•è·ç»„çš„å†…å®¹ï¼Œå³åŒ¹é…åˆ°çš„5ä¸ªå­—ç¬¦ã€‚
- ` ` (ç©ºæ ¼) æ˜¯è¦æ’å…¥çš„å­—ç¬¦ã€‚
- `/g` è¡¨ç¤ºå…¨å±€æ›¿æ¢ï¼Œå³åœ¨åŒä¸€è¡Œå†…å¤šæ¬¡åº”ç”¨è¯¥æ›¿æ¢è§„åˆ™ã€‚

å¦‚æœä½ æƒ³è¦åœ¨æ¯5ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œåªéœ€å°†ç©ºæ ¼æ¢æˆ`\r`ï¼ˆVimä¸­çš„æ¢è¡Œç¬¦ï¼‰ï¼š

```vim
:%s/\(.\{5\}\)/\1\r/g
```

è¯·æ³¨æ„ï¼Œè¿™äº›æ“ä½œä¼šæ”¹å˜æ–‡æœ¬çš„åŸå§‹æ ¼å¼ï¼Œå› æ­¤åœ¨æ‰§è¡Œä¹‹å‰æœ€å¥½ä¿å­˜ä¸€ä»½å¤‡ä»½ã€‚æ­¤å¤–ï¼Œå¦‚æœæ–‡ä»¶éå¸¸å¤§ï¼Œè¿™æ ·çš„æ“ä½œå¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ã€‚




åœ¨ `awk` ä¸­å¤„ç†æ¯ m ä¸ªå­—ç¬¦çš„éœ€æ±‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰è„šæœ¬æ¥å®ç°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ `awk` æ¯ m ä¸ªå­—ç¬¦è¿›è¡Œåˆ†å‰²ï¼Œå¹¶åœ¨æ¯ä¸ªåˆ†å‰²ç‚¹æ’å…¥ç‰¹å®šçš„å­—ç¬¦ï¼ˆå¦‚ç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰ã€‚

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `input.txt`ï¼Œä½ å¸Œæœ›æ¯ 5 ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ `awk` å‘½ä»¤ï¼š

```sh
awk '{
    for (i=1; i<=length($0); i+=5) {
        printf "%s ", substr($0, i, 5);
    }
    print "";
}' input.txt
```

### è§£é‡Šï¼š
- `for (i=1; i<=length($0); i+=5)`ï¼šå¾ªç¯éå†æ¯ä¸€è¡Œçš„æ¯ä¸ªå­—ç¬¦ï¼Œæ¯æ¬¡å¢åŠ  5 ä¸ªå­—ç¬¦ã€‚
- `substr($0, i, 5)`ï¼šä»å½“å‰è¡Œçš„ç¬¬ `i` ä¸ªå­—ç¬¦å¼€å§‹ï¼Œæå–é•¿åº¦ä¸º 5 çš„å­å­—ç¬¦ä¸²ã€‚
- `printf "%s ", substr($0, i, 5)`ï¼šæ‰“å°æå–çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶åœ¨å…¶åæ·»åŠ ä¸€ä¸ªç©ºæ ¼ã€‚
- `print ""`ï¼šåœ¨å¤„ç†å®Œä¸€è¡Œåï¼Œæ‰“å°ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä»¥ä¾¿ä¸‹ä¸€è¡Œçš„å¤„ç†ã€‚

### æ’å…¥æ¢è¡Œç¬¦
å¦‚æœä½ å¸Œæœ›æ¯ 5 ä¸ªå­—ç¬¦åæ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œå¯ä»¥ç¨å¾®ä¿®æ”¹ä¸Šè¿°å‘½ä»¤ï¼š

```sh
awk '{
    for (i=1; i<=length($0); i+=5) {
        printf "%s\n", substr($0, i, 5);
    }
}' input.txt
```

### ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
å¦‚æœä½ å¸Œæœ›å°†ç»“æœä¿å­˜åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨é‡å®šå‘ï¼š

```sh
awk '{
    for (i=1; i<=length($0); i+=5) {
        printf "%s ", substr($0, i, 5);
    }
    print "";
}' input.txt > output.txt
```

æˆ–è€…å¯¹äºæ¢è¡Œç¬¦çš„æƒ…å†µï¼š

```sh
awk '{
    for (i=1; i<=length($0); i+=5) {
        printf "%s\n", substr($0, i, 5);
    }
}' input.txt > output.txt
```

è¿™äº›å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ åœ¨ `awk` ä¸­å®ç°æ¯ m ä¸ªå­—ç¬¦çš„åˆ†å‰²å’Œæ’å…¥æ“ä½œã€‚å¸Œæœ›è¿™å¯¹ä½ 



åœ¨ Emacs ä¸­ï¼Œå†™å…¥ç¼“å†²åŒºï¼ˆbufferï¼‰æ˜¯ä¸€ä¸ªå¸¸è§çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•å’ŒæŠ€å·§ï¼Œå¸®åŠ©ä½ åœ¨ Emacs ä¸­å‘ç¼“å†²åŒºå†™å…¥å†…å®¹ã€‚

### åŸºæœ¬æ“ä½œ

1. **æ’å…¥æ–‡æœ¬**ï¼š
   - ä½¿ç”¨ `insert` å‡½æ•°åœ¨å½“å‰å…‰æ ‡ä½ç½®æ’å…¥æ–‡æœ¬ã€‚
   ```elisp
   (insert "Hello, world!")
   ```

2. **ç§»åŠ¨å…‰æ ‡**ï¼š
   - ä½¿ç”¨ `goto-char` å‡½æ•°å°†å…‰æ ‡ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®ã€‚
   ```elisp
   (goto-char 10)  ;; ç§»åŠ¨åˆ°ç¬¬10ä¸ªå­—ç¬¦ä½ç½®
   ```

3. **åˆ é™¤æ–‡æœ¬**ï¼š
   - ä½¿ç”¨ `delete-region` å‡½æ•°åˆ é™¤æŒ‡å®šåŒºåŸŸçš„æ–‡æœ¬ã€‚
   ```elisp
   (delete-region start end)  ;; åˆ é™¤ä» start åˆ° end ä¹‹é—´çš„æ–‡æœ¬
   ```

### é«˜çº§æ“ä½œ

1. **åœ¨ç¼“å†²åŒºå¼€å¤´æ’å…¥æ–‡æœ¬**ï¼š
   - å…ˆå°†å…‰æ ‡ç§»åŠ¨åˆ°ç¼“å†²åŒºå¼€å¤´ï¼Œç„¶åæ’å…¥æ–‡æœ¬ã€‚
   ```elisp
   (goto-char (point-min))
   (insert "Header\n")
   ```

2. **åœ¨ç¼“å†²åŒºç»“å°¾æ’å…¥æ–‡æœ¬**ï¼š
   - å…ˆå°†å…‰æ ‡ç§»åŠ¨åˆ°ç¼“å†²åŒºç»“å°¾ï¼Œç„¶åæ’å…¥æ–‡æœ¬ã€‚
   ```elisp
   (goto-char (point-max))
   (insert "\nFooter")
   ```

3. **æ›¿æ¢æ–‡æœ¬**ï¼š
   - ä½¿ç”¨ `replace-match` å‡½æ•°æ›¿æ¢åŒ¹é…çš„æ–‡æœ¬ã€‚
   ```elisp
   (goto-char (point-min))
   (while (search-forward "old-text" nil t)
     (replace-match "new-text"))
   ```

4. **æ’å…¥æ–‡ä»¶å†…å®¹**ï¼š
   - ä½¿ç”¨ `insert-file-contents` å‡½æ•°å°†æ–‡ä»¶å†…å®¹æ’å…¥åˆ°å½“å‰ç¼“å†²åŒºã€‚
   ```elisp
   (insert-file-contents "/path/to/file.txt")
   ```

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œéœ€è¦åœ¨å½“å‰ç¼“å†²åŒºçš„å¼€å¤´æ’å…¥ä¸€ä¸ªæ ‡é¢˜ï¼Œåœ¨ç»“å°¾æ’å…¥ä¸€ä¸ªè„šæ³¨ï¼Œå¹¶åœ¨ä¸­é—´æ’å…¥ä¸€äº›æ–‡æœ¬å†…å®¹ã€‚

```elisp
(defun write-to-buffer ()
  "Write content to the current buffer."
  (interactive)
  (save-excursion  ;; ä¿å­˜å½“å‰å…‰æ ‡ä½ç½®
    (goto-char (point-min))
    (insert "Title\n\n")
    
    (goto-char (point-max))
    (insert "\n\nFootnote")
    
    (goto-char (point-min))
    (search-forward "Title")
    (insert "This is some content in the middle.\n")))

;; è°ƒç”¨å‡½æ•°
(write-to-buffer)
```

### è§£é‡Š

1. **`save-excursion`**ï¼šç¡®ä¿åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åæ¢å¤åŸæ¥çš„å…‰æ ‡ä½ç½®ã€‚
2. **`goto-char (point-min)`**ï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ç¼“å†²åŒºçš„å¼€å¤´ã€‚
3. **`insert "Title\n\n"`**ï¼šåœ¨ç¼“å†²åŒºå¼€å¤´æ’å…¥æ ‡é¢˜ã€‚
4. **`goto-char (point-max)`**ï¼šå°†å…‰æ ‡ç§»åŠ¨åˆ°ç¼“å†²åŒºçš„ç»“å°¾ã€‚
5. **`insert "\n\nFootnote"`**ï¼šåœ¨ç¼“å†²åŒºç»“å°¾æ’å…¥è„šæ³¨ã€‚
6. **`goto-char (point-min)`**ï¼šå†æ¬¡å°†å…‰æ ‡ç§»åŠ¨åˆ°ç¼“å†²åŒºçš„å¼€å¤´ã€‚
7. **`search-forward "Title"`**ï¼šæŸ¥æ‰¾æ ‡é¢˜çš„ä½ç½®ã€‚
8. **`insert "This is some content in the middle.\n"`**ï¼šåœ¨æ ‡é¢˜åé¢æ’å…¥ä¸­é—´å†…å®¹ã€‚

### äº’åŠ¨ä½¿ç”¨

ä½ å¯ä»¥å°†ä¸Šè¿°å‡½æ•°å®šä¹‰ä¸ºä¸€ä¸ªäº¤äº’å¼å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨ Emacs ä¸­ç›´æ¥è°ƒç”¨ï¼š

```elisp
(defun write-to-buffer ()
  "Write content to the current buffer."
  (interactive)
  (save-excursion
    (goto-char (point-min))
    (insert "Title\n\n")
    
    (goto-char (point-max))
    (insert "\n\nFootnote")
    
    (goto-char (point-min))
    (search-forward "Title")
    (insert "This is some content in the middle.\n")))

;; è°ƒç”¨å‡½æ•°
M-x write-to-buffer
```

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åœ¨ Emacs ä¸­æ–¹ä¾¿åœ°å†™å…¥å’Œç®¡ç†ç¼“å†²åŒºå†…å®¹ã€‚å¸Œæœ›è¿™äº›ç¤ºä¾‹å’Œè§£é‡Šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚



åœ¨ Emacs ä¸­ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå°†å‡½æ•°çš„ç»“æœå†™å…¥åˆ°ä¸€ä¸ªç¼“å†²åŒºä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•å®ç°è¿™ä¸€ç‚¹ã€‚

### ç¤ºä¾‹ 1ï¼šå°†å‡½æ•°ç»“æœå†™å…¥å½“å‰ç¼“å†²åŒº

å‡è®¾ä½ æœ‰ä¸€ä¸ªå‡½æ•° `my-function`ï¼Œå®ƒè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½ å¸Œæœ›å°†è¿™ä¸ªå­—ç¬¦ä¸²å†™å…¥å½“å‰ç¼“å†²åŒºã€‚

```elisp
(defun my-function ()
  "A sample function that returns a string."
  "Hello, world!")

(defun write-result-to-current-buffer ()
  "Write the result of `my-function' to the current buffer."
  (interactive)
  (let ((result (my-function)))
    (insert result)))

;; è°ƒç”¨å‡½æ•°
(write-result-to-current-buffer)
```

### ç¤ºä¾‹ 2ï¼šå°†å‡½æ•°ç»“æœå†™å…¥æ–°ç¼“å†²åŒº

å‡è®¾ä½ å¸Œæœ›å°†å‡½æ•°ç»“æœå†™å…¥ä¸€ä¸ªæ–°çš„ç¼“å†²åŒºã€‚

```elisp
(defun my-function ()
  "A sample function that returns a string."
  "Hello, world!")

(defun write-result-to-new-buffer ()
  "Write the result of `my-function' to a new buffer."
  (interactive)
  (let* ((result (my-function))
         (buffer-name "*Result Buffer*")
         (buffer (get-buffer-create buffer-name)))
    (with-current-buffer buffer
      (erase-buffer)
      (insert result))
    (switch-to-buffer buffer)))

;; è°ƒç”¨å‡½æ•°
(write-result-to-new-buffer)
```

### ç¤ºä¾‹ 3ï¼šå°†å‡½æ•°ç»“æœå†™å…¥æŒ‡å®šçš„ç¼“å†²åŒº

å‡è®¾ä½ å¸Œæœ›å°†å‡½æ•°ç»“æœå†™å…¥ä¸€ä¸ªæŒ‡å®šçš„ç¼“å†²åŒºã€‚

```elisp
(defun my-function ()
  "A sample function that returns a string."
  "Hello, world!")

(defun write-result-to-specified-buffer (buffer-name)
  "Write the result of `my-function' to the specified buffer."
  (interactive "BBuffer name: ")
  (let* ((result (my-function))
         (buffer (get-buffer-create buffer-name)))
    (with-current-buffer buffer
      (erase-buffer)
      (insert result))
    (switch-to-buffer buffer)))

;; è°ƒç”¨å‡½æ•°
(write-result-to-specified-buffer "*My Result*")
```

### ç¤ºä¾‹ 4ï¼šå°†å¤šä¸ªå‡½æ•°ç»“æœå†™å…¥ç¼“å†²åŒº

å‡è®¾ä½ æœ‰å¤šä¸ªå‡½æ•°ï¼Œå¸Œæœ›å°†å®ƒä»¬çš„ç»“æœåˆå¹¶åå†™å…¥ä¸€ä¸ªç¼“å†²åŒºã€‚

```elisp
(defun function1 ()
  "First function."
  "Result from function1")

(defun function2 ()
  "Second function."
  "Result from function2")

(defun write-multiple-results-to-buffer (buffer-name)
  "Write the results of multiple functions to the specified buffer."
  (interactive "BBuffer name: ")
  (let* ((results (concat (function1) "\n" (function2)))
         (buffer (get-buffer-create buffer-name)))
    (with-current-buffer buffer
      (erase-buffer)
      (insert results))
    (switch-to-buffer buffer)))

;; è°ƒç”¨å‡½æ•°
(write-multiple-results-to-buffer "*Multiple Results*")






åœ¨ macOS ä¸­ï¼Œä½¿ç”¨ `/etc/fstab` æ–‡ä»¶æ¥è‡ªåŠ¨æŒ‚è½½ `tmpfs` ä½œä¸º `/tmp` ç›®å½•æ˜¯ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ‚¨å¯ä»¥ç¡®ä¿æ¯æ¬¡ç³»ç»Ÿå¯åŠ¨æ—¶éƒ½ä¼šè‡ªåŠ¨æŒ‚è½½ `tmpfs` åˆ° `/tmp`ï¼Œä»è€Œæé«˜ä¸´æ—¶æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ã€‚

### æ­¥éª¤ï¼š

1. **å¤‡ä»½ç°æœ‰çš„ `/etc/fstab` æ–‡ä»¶**ï¼š
   - åœ¨è¿›è¡Œä»»ä½•ä¿®æ”¹ä¹‹å‰ï¼Œå»ºè®®å¤‡ä»½ç°æœ‰çš„ `/etc/fstab` æ–‡ä»¶ï¼š
     ```bash
     sudo cp /etc/fstab /etc/fstab.bak
     ```

2. **ç¼–è¾‘ `/etc/fstab` æ–‡ä»¶**ï¼š
   - ä½¿ç”¨ `nano` æˆ–å…¶ä»–æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¾‘ `/etc/fstab` æ–‡ä»¶ï¼š
     ```bash
     sudo nano /etc/fstab
     ```

3. **æ·»åŠ  `tmpfs` æŒ‚è½½æ¡ç›®**ï¼š
   - åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ ä¸€è¡Œï¼ŒæŒ‡å®š `tmpfs` çš„æŒ‚è½½ç‚¹å’Œé€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª 512MB çš„ `tmpfs`ï¼š
     ```plaintext
     tmpfs   /tmp   tmpfs   rw,noexec,nosuid,size=512M   0   0
     ```

   - è§£é‡Šå„å­—æ®µçš„å«ä¹‰ï¼š
     - `tmpfs`ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚
     - `/tmp`ï¼šæŒ‚è½½ç‚¹ã€‚
     - `tmpfs`ï¼šæ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼ˆé‡å¤ï¼‰ã€‚
     - `rw,noexec,nosuid,size=512M`ï¼šæŒ‚è½½é€‰é¡¹ã€‚`rw` è¡¨ç¤ºè¯»å†™æƒé™ï¼Œ`noexec` è¡¨ç¤ºä¸å…è®¸æ‰§è¡Œæ–‡ä»¶ï¼Œ`nosuid` è¡¨ç¤ºå¿½ç•¥è®¾ç½®ç”¨æˆ· ID å’Œç»„ ID çš„æ–‡ä»¶ï¼Œ`size=512M` è¡¨ç¤º `tmpfs` çš„å¤§å°ä¸º 512MBã€‚
     - `0`ï¼šç”¨äº `dump` å‘½ä»¤çš„å¤‡ä»½é¢‘ç‡ï¼ˆ0 è¡¨ç¤ºä¸å¤‡ä»½ï¼‰ã€‚
     - `0`ï¼šç”¨äº `fsck` å‘½ä»¤çš„æ–‡ä»¶ç³»ç»Ÿæ£€æŸ¥é¡ºåºï¼ˆ0 è¡¨ç¤ºä¸æ£€æŸ¥ï¼‰ã€‚

4. **ä¿å­˜å¹¶é€€å‡º**ï¼š
   - æŒ‰ `Ctrl + O` ä¿å­˜æ–‡ä»¶ï¼Œç„¶åæŒ‰ `Ctrl + X` é€€å‡ºç¼–è¾‘å™¨ã€‚

5. **æµ‹è¯•æŒ‚è½½é…ç½®**ï¼š
   - ä¸ºäº†ç¡®ä¿é…ç½®æ­£ç¡®ï¼Œå¯ä»¥æ‰‹åŠ¨æŒ‚è½½ `tmpfs`ï¼š
     ```bash
     sudo mount -a
     ```

   - æ£€æŸ¥ `/tmp` æ˜¯å¦å·²æˆåŠŸæŒ‚è½½ä¸º `tmpfs`ï¼š
     ```bash
     mount | grep tmpfs
     ```

6. **é‡å¯ç³»ç»Ÿ**ï¼š
   - é‡å¯ç³»ç»Ÿä»¥åº”ç”¨æ–°çš„ `fstab` è®¾ç½®ï¼š
     ```bash
     sudo reboot
     ```

### æ³¨æ„äº‹é¡¹

- **æ•°æ®æŒä¹…æ€§**ï¼š`tmpfs` ä¸­çš„æ•°æ®åœ¨ç³»ç»Ÿé‡å¯åä¼šä¸¢å¤±ï¼Œå› æ­¤ä¸é€‚åˆå­˜å‚¨é‡è¦æ•°æ®ã€‚
- **å†…å­˜ä½¿ç”¨**ï¼š`tmpfs` ä¼šå ç”¨ç³»ç»Ÿå†…å­˜ï¼Œç¡®ä¿æ‚¨çš„ç³»ç»Ÿæœ‰è¶³å¤Ÿçš„å†…å­˜æ¥æ”¯æŒå…¶ä»–åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚
- **ç³»ç»Ÿç¨³å®šæ€§**ï¼šå¦‚æœ `tmpfs` å ç”¨äº†è¿‡å¤šçš„å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå˜æ…¢æˆ–ä¸ç¨³å®šã€‚

### éªŒè¯

é‡å¯ç³»ç»Ÿåï¼Œæ‚¨å¯ä»¥éªŒè¯ `/tmp` æ˜¯å¦å·²æˆåŠŸæŒ‚è½½ä¸º `tmpfs`ï¼š

```bash
df -h /tmp
```

è¾“å‡ºåº”æ˜¾ç¤º `/tmp` æ˜¯ä¸€ä¸ª `tmpfs` æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶ä¸”å¤§å°ç¬¦åˆæ‚¨åœ¨ `fstab` ä¸­è®¾ç½®çš„å€¼ã€‚

åœ¨ Vim ä¸­ï¼Œ`\zs` å’Œ `\ze` æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ç‰¹æ®Šå…ƒå­—ç¬¦ï¼Œç”¨äºå®šä¹‰åŒ¹é…çš„å¼€å§‹å’Œç»“æŸä½ç½®ã€‚è¿™äº›å…ƒå­—ç¬¦å¯ä»¥å¸®åŠ©ä½ æ›´ç²¾ç¡®åœ°æ§åˆ¶åŒ¹é…çš„èŒƒå›´ã€‚è€Œ `\zq` å¹¶ä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„æ­£åˆ™è¡¨è¾¾å¼å…ƒå­—ç¬¦ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®¨è®ºå¦‚ä½•ä½¿ç”¨ `\zs` å’Œ `\ze` æ¥å®ç°ç‰¹å®šçš„åŒ¹é…éœ€æ±‚ã€‚

### 1. `\zs` å’Œ `\ze` çš„ä½¿ç”¨

- **`\zs`**ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- **`\ze`**ï¼šå®šä¹‰åŒ¹é…çš„ç»“æŸä½ç½®ã€‚

### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªæ–‡ä»¶ `example.txt`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```
apple:123
banana:456
cherry:789
date:101
elderberry:202
fig:303
grape:404
```

### 1.1 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/:\zs\d\+
```

è§£é‡Šï¼š
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.2 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²å¹¶æ’é™¤å‰ç¼€

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/:\zs\d\+
```

è§£é‡Šï¼š
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.3 åŒ¹é…ç‰¹å®šæ¨¡å¼çš„å­ä¸²å¹¶æ’é™¤åç¼€

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` å‰é¢çš„å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/\ze:\d\+
```

è§£é‡Šï¼š
- `\ze`ï¼šå®šä¹‰åŒ¹é…çš„ç»“æŸä½ç½®ã€‚
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\d\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚

### 1.4 ç»„åˆä½¿ç”¨ `\zs` å’Œ `\ze`

å‡è®¾ä½ å¸Œæœ›åŒ¹é… `:` å‰åçš„å­—ç¬¦ä¸²éƒ¨åˆ†ï¼Œä½†ä¸åŒ…æ‹¬å†’å·ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ­£åˆ™è¡¨è¾¾å¼ï¼š

```vim
/\zs\w\+:\zs\w\+
```

è§£é‡Šï¼š
- `\zs`ï¼šå®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\w\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æˆ–æ•°å­—ã€‚
- `:`ï¼šåŒ¹é…å†’å·ã€‚
- `\zs`ï¼šå†æ¬¡å®šä¹‰åŒ¹é…çš„å¼€å§‹ä½ç½®ã€‚
- `\w\+`ï¼šåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯æˆ–æ•°å­—ã€‚

### å®é™…åº”ç”¨

1. **åŒ¹é… `:` åé¢çš„æ•°å­—éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/:\zs\d\+`
   - ç»“æœï¼š`123`, `456`, `789`, `101`, `202`, `303`, `404`

2. **åŒ¹é… `:` å‰é¢çš„å­—ç¬¦ä¸²éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/\ze:\d\+`
   - ç»“æœï¼š`apple`, `banana`, `cherry`, `date`, `elderberry`, `fig`, `grape`

3. **åŒ¹é… `:` å‰åçš„å­—ç¬¦ä¸²éƒ¨åˆ†**ï¼š
   - ä½¿ç”¨å‘½ä»¤ï¼š`/\zs\w\+:\zs\w\+`
   - ç»“æœï¼š`apple:123`, `banana:456`, `cherry:789`, `date:101`, `elderberry:202`, `fig:303`, `grape:404`

### ä½¿ç”¨ `:g` å‘½ä»¤

å¦‚æœä½ å¸Œæœ›åœ¨æ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶é«˜äº®æ˜¾ç¤ºç‰¹å®šçš„åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `:g` å‘½ä»¤ï¼š

```vim
:g/:\zs\d\+/print
```

### æ›¿æ¢ç‰¹å®šæ¨¡å¼çš„å­ä¸²

å¦‚æœä½ å¸Œæœ›æ›¿æ¢ç‰¹å®šæ¨¡å¼çš„å­ä¸²ï¼Œå¯ä»¥ä½¿ç”¨ `:s` å‘½ä»¤ï¼š

```vim
:%s/:\zs\d\+/REPLACEMENT/g
```

### æ³¨æ„äº‹é¡¹

- **è½¬ä¹‰å­—ç¬¦**ï¼šåœ¨ Vim çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼ŒæŸäº›ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ `(`ã€`)`ã€`{`ã€`}` ç­‰ï¼‰éœ€è¦è½¬ä¹‰ã€‚
- **è´ªå©ªåŒ¹é…**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒVim çš„æ­£åˆ™è¡¨è¾¾å¼æ˜¯è´ªå©ªçš„ï¼Œå³å°½å¯èƒ½åŒ¹é…æ›´å¤šçš„å­—ç¬¦ã€‚å¦‚æœéœ€è¦éè´ªå©ªåŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ `{-}` ä»£æ›¿ `{}`ã€‚
- **æµ‹è¯•å’Œè°ƒè¯•**ï¼šåœ¨å®é™…ä½¿ç”¨å‰ï¼Œå»ºè®®å…ˆåœ¨ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶æˆ–ä¸´æ—¶æ–‡ä»¶ä¸­æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥ç¡®ä¿å®ƒä»¬æŒ‰é¢„æœŸå·¥ä½œã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Vim ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `\zs` å’Œ `\ze` æ¥å®ç°ç‰¹å®šçš„åŒ¹é…éœ€æ±‚ï¼å¦‚æœä½ æœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶é—®ã€‚`start-process` æ˜¯ Emacs ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹å¹¶ä¸ä¹‹é€šä¿¡ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºæ‰§è¡Œ shell å‘½ä»¤æˆ–å…¶ä»–ç¨‹åºï¼Œå¹¶å¯ä»¥æ•è·å®ƒä»¬çš„è¾“å‡ºã€‚

`compile` æ˜¯å¦ä¸€ä¸ª Emacs å‡½æ•°ï¼Œä¸“é—¨ç”¨äºç¼–è¯‘ä»£ç ã€‚å®ƒå®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹æ¥å®ç°çš„ï¼Œä½†å®ƒæ˜¯é’ˆå¯¹ç¼–ç¨‹ç¼–è¯‘ä»»åŠ¡çš„é«˜çº§å°è£…ã€‚

`filter` åœ¨è¿™é‡Œå¯èƒ½æŒ‡çš„æ˜¯è¿›ç¨‹è¿‡æ»¤å™¨ï¼ˆprocess filterï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å‡½æ•°ï¼Œå½“ä½ å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹æ—¶ï¼Œå¯ä»¥æŒ‡å®šå®ƒæ¥å¤„ç†è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºã€‚æ¯å½“å¤–éƒ¨è¿›ç¨‹å‘æ ‡å‡†è¾“å‡ºå†™å…¥æ•°æ®æ—¶ï¼ŒEmacs ä¼šè°ƒç”¨è¿™ä¸ªè¿‡æ»¤å™¨å‡½æ•°ï¼Œå°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨æ•°æ®æ˜¾ç¤ºåœ¨ç¼“å†²åŒºä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚

å¦‚æœä½ æƒ³ç»“åˆä½¿ç”¨ `start-process` å’Œ `compile` å¹¶è®¾ç½®ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```elisp
(defun my-compile-filter (proc string)
  "Process output from the compilation process."
  (when (buffer-live-p (process-buffer proc))
    (with-current-buffer (process-buffer proc)
      ;; å¤„ç†è¾“å‡ºå­—ç¬¦ä¸²
      (setq my-compile-output (concat my-compile-output string))
      ;; å°†å¤„ç†åçš„è¾“å‡ºæ’å…¥åˆ°ç¼“å†²åŒº
      (goto-char (point-max))
      (insert my-compile-output))))

(defun my-start-compile-process ()
  "Start a compilation process with a custom filter."
  (interactive)
  (let ((compilation-buffer (get-buffer-create "*my-compilation*")))
    (with-current-buffer compilation-buffer
      (setq my-compile-output "")
      (erase-buffer))
    (start-process "my-compile-process"
                   compilation-buffer
                   "sh" "-c" "make -C /path/to/project")
    (set-process-filter (get-process "my-compile-process") 'my-compile-filter)))

;; è°ƒç”¨è‡ªå®šä¹‰çš„ç¼–è¯‘è¿‡ç¨‹
(my-start-compile-process)
```

ä¸Šè¿°ä»£ç å®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼š`my-compile-filter` ç”¨äºå¤„ç†æ¥è‡ªç¼–è¯‘è¿‡ç¨‹çš„è¾“å‡ºï¼Œ`my-start-compile-process` ç”¨äºå¯åŠ¨ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„ç¼–è¯‘è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º `*my-compilation*` çš„ç¼“å†²åŒºæ¥å­˜æ”¾ç¼–è¯‘è¾“å‡ºï¼Œå¹¶ä¸”åœ¨å¯åŠ¨ç¼–è¯‘è¿‡ç¨‹æ—¶æŒ‡å®šäº†ä¸€ä¸ªè¿‡æ»¤å™¨å‡½æ•° `my-compile-filter` æ¥å¤„ç†è¾“å‡ºã€‚å½“ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿè¾“å‡ºæ—¶ï¼Œè¿‡æ»¤å™¨å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é€»è¾‘(let (;; åŠ è½½çš„æ—¶å€™ä¸´æ—¶å¢å¤§`gc-cons-threshold'ä»¥åŠ é€Ÿå¯åŠ¨é€Ÿåº¦ã€‚
      (gc-cons-threshold most-positive-fixnum)
      ;; æ¸…ç©ºé¿å…åŠ è½½è¿œç¨‹æ–‡ä»¶çš„æ—¶å€™åˆ†ææ–‡ä»¶ã€‚
      (file-name-handler-alist nil))
  (add-to-list 'load-path (expand-file-name "site-lisp" user-emacs-directory))

  ;(require 'init-benchmarking)
  ;(require 'benchmark-init-modes)
  ;(require 'benchmark-init)
  ;(benchmark-init/activate)
    ;; Emacsé…ç½®æ–‡ä»¶å†…å®¹å†™åˆ°ä¸‹é¢.
  ;;(setq package-enable-at-startup nil)
 ;; (setq package-archives '(("melpa-cn" . "http://mirrors.tuna.tsinghua.edu.cn/elpa/melpa/")
 ;; 			   ("org-cn"   . "http://mirrors.tuna.tsinghua.edu.cn/elpa/org/")
 ;; 			   ("gnu-cn"   . "http://mirrors.tuna.tsinghua.edu.cn/elpa/gnu/")))
  (setq package-archives '(("gnu"   . "http://elpa.emacs-china.org/gnu/")
                           ("melpa" . "http://elpa.emacs-china.org/melpa/")))
  (package-initialize)
  ;;custome-file
  (setq custom-file (expand-file-name "custom.el" user-emacs-directory))
  ;;(load custom-file 'noerror)

  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
  (require 'use-package)
  (use-package diminish :ensure t)
  ;;å¯ç”¨server-start
  (require 'server)
  (unless (server-running-p) (server-start))
  ;(use-package server :ensure t
  ;  :config
  ;  (unless (server-running-p)
  ;  (server-start)))

  (use-package recentf
  ;; Loads after 1 second of idle time.
  :defer 1)
  (require 'setup-appearance)
  (require 'setup-core)
  (require 'setup-cnfonts)
  ;;(require 'setup-deft)
  (require 'setup-org)
  ;;(autoload 'helm-bibtex "helm-bibtex" "" t)
  (require 'setup-org-bibtex)
  (require 'setup-evil)
  (require 'setup-keys)
  (require 'setup-helm)
  (require 'setup-which-key)
  (require 'setup-window-numbering)
  ;;;;;(require 'setup-sr-speedbar)
  (require 'setup-yasnippet)
  (require 'setup-auto-save)
  (require 'setup-translate)
  ;;(require 'setup-company)
  ;(add-to-list 'load-path "~/.emacs.d/site-lisp/snails") ; add snails to your load-path
  ;(require 'snails)
  ;(add-to-list 'load-path (expand-file-name "~/.emacs.d/site-lisp/company-english-helper"))
  ;(require 'company-english-helper)

  ;(add-to-list 'load-path (expand-file-name "~/.emacs.d/site-lisp/insert-translated-name"))
  ;(require 'insert-translated-name)

  ;;(add-to-list 'load-path "~/.emacs.d/site-lisp/toc-org")
  ;;(if (require 'toc-org nil t)
  ;;    (add-hook 'org-mode-hook 'toc-org-mode)
  ;;  (warn "toc-org not found"))
  ;; Load custom settings
  ;(load custom-file 'noerror)
)



Graphviz æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆå›¾å½¢ï¼ˆå¦‚æµç¨‹å›¾ã€ç»„ç»‡ç»“æ„å›¾ã€ç½‘ç»œå›¾ç­‰ï¼‰çš„å¼ºå¤§å·¥å…·ï¼Œå®ƒä½¿ç”¨ä¸€ç§ç®€å•çš„æè¿°è¯­è¨€æ¥å®šä¹‰å›¾å½¢ã€‚å¦‚æœä½ æƒ³è¦ä½¿ç”¨ Graphviz åˆ›å»ºä¸€ä¸ªæ—¶é—´çº¿ï¼ˆtimelineï¼‰ï¼Œä½ å¯ä»¥åˆ©ç”¨å…¶çµæ´»æ€§æ¥è®¾è®¡ä¸€ä¸ªè¡¨ç¤ºä¸åŒäº‹ä»¶æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„å›¾å½¢ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Graphviz åˆ›å»ºä¸€ä¸ªæ—¶é—´çº¿å›¾è¡¨ï¼š

```dot
digraph Timeline {
    // è®¾ç½®èŠ‚ç‚¹æ ·å¼
    node [shape=plaintext, fontsize=14];
    
    // å®šä¹‰æ—¶é—´ç‚¹
    A [label="2023-01-01\nEvent 1"];
    B [label="2023-06-01\nEvent 2"];
    C [label="2023-12-01\nEvent 3"];
    D [label="2024-03-01\nEvent 4"];
    
    // è¿æ¥æ—¶é—´ç‚¹
    A -> B -> C -> D;
    
    // è®¾ç½®è¾¹çš„æ ·å¼
    edge [style=dashed, color=blue];
}
```

è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªæ—¶é—´çº¿ï¼Œå…¶ä¸­åŒ…å«äº†å››ä¸ªæ—¶é—´ç‚¹ï¼ˆAã€Bã€C å’Œ Dï¼‰ã€‚æ¯ä¸ªæ—¶é—´ç‚¹éƒ½æœ‰ä¸€ä¸ªæ ‡ç­¾ï¼Œæ˜¾ç¤ºäº†æ—¥æœŸå’Œäº‹ä»¶åç§°ã€‚è¿™äº›æ—¶é—´ç‚¹é€šè¿‡è™šçº¿è¿æ¥èµ·æ¥ï¼Œè¡¨ç¤ºå®ƒä»¬ä¹‹é—´çš„é¡ºåºå…³ç³»ã€‚

è¦æ¸²æŸ“è¿™ä¸ªæ—¶é—´çº¿ï¼Œä½ éœ€è¦å®‰è£… Graphviz å¹¶ä½¿ç”¨ `dot` å‘½ä»¤è¡Œå·¥å…·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```sh
dot -Tpng timeline.dot -o timeline.png
```

è¿™æ¡å‘½ä»¤å°†è¯»å– `timeline.dot` æ–‡ä»¶ä¸­çš„ Graphviz ä»£ç ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºåä¸º `timeline.png` çš„ PNG å›¾åƒæ–‡ä»¶ã€‚

ä½ å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´èŠ‚ç‚¹çš„æ ·å¼ã€è¾¹çš„å±æ€§ä»¥åŠæ·»åŠ æ›´å¤šçš„æ—¶é—´ç‚¹æ¥åˆ›å»ºæ›´å¤æ‚çš„æ—¶é—´çº¿ã€‚å¦‚æœä½ æœ‰å…·ä½“çš„éœ€æ±‚æˆ–è€…æƒ³è¦å®ç°ç‰¹å®šçš„æ ·å¼ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„æŒ‡å¯¼ã€‚




åœ¨ Emacs ä¸­ä½¿ç”¨ Graphviz åˆ›å»ºæ—¶é—´çº¿ï¼Œä½ å¯ä»¥ç»“åˆä½¿ç”¨ Org æ¨¡å¼æˆ–ç›´æ¥ç¼–å†™ Graphviz çš„ DOT è¯­è¨€æºç ã€‚Org æ¨¡å¼æä¾›äº†ä¸€ç§éå¸¸æ–¹ä¾¿çš„æ–¹å¼æ¥åµŒå…¥å’Œé¢„è§ˆ Graphviz å›¾å½¢ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç§æ–¹æ³•çš„ç®€è¦è¯´æ˜ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Org æ¨¡å¼

1. **å®‰è£…å¿…è¦çš„åŒ…**ï¼šç¡®ä¿ä½ çš„ Emacs é…ç½®ä¸­å®‰è£…äº† `org` åŒ…ï¼Œé€šå¸¸ Emacs è‡ªå¸¦äº†è¿™ä¸ªåŒ…ã€‚æ­¤å¤–ï¼Œç¡®ä¿ç³»ç»Ÿä¸Šå®‰è£…äº† Graphvizã€‚

2. **ç¼–å†™ Org æ–‡ä»¶**ï¼šåœ¨ Org æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `#+BEGIN_SRC dot` å’Œ `#+END_SRC` æ¥åŒ…å« Graphviz çš„ DOT è¯­è¨€æºç ã€‚ä¾‹å¦‚ï¼š

   ```org
   #+TITLE: Timeline with Graphviz in Emacs

   #+BEGIN_SRC dot :file timeline.png :cmdline -Kdot -Tpng
   digraph Timeline {
       rankdir=TB;
       node [shape=plaintext, fontsize=14];

       A [label="2023-01-01\nEvent 1"];
       B [label="2023-06-01\nEvent 2"];
       C [label="2023-12-01\nEvent 3"];
       D [label="2024-03-01\nEvent 4"];

       A -> B -> C -> D;
       edge [style=dashed, color=blue];
   }
   #+END_SRC
   ```

3. **æ‰§è¡Œä»£ç å—**ï¼šå°†å…‰æ ‡æ”¾åœ¨ä»£ç å—å†…ï¼Œç„¶åæŒ‰ `C-c C-c`ï¼ˆå³ `Ctrl+c Ctrl+c`ï¼‰æ¥æ‰§è¡Œä»£ç å—ã€‚Emacs ä¼šè°ƒç”¨ Graphviz æ¸²æŸ“å›¾åƒï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºæŒ‡å®šçš„æ–‡ä»¶åï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ `timeline.png`ï¼‰ã€‚

4. **æŸ¥çœ‹ç»“æœ**ï¼šåœ¨åŒä¸€ Org æ–‡ä»¶ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé“¾æ¥æŒ‡å‘ç”Ÿæˆçš„å›¾åƒã€‚ç‚¹å‡»è¿™ä¸ªé“¾æ¥æˆ–ä½¿ç”¨ `C-c C-x C-v` å¯ä»¥åœ¨ Emacs å†…éƒ¨é¢„è§ˆå›¾åƒã€‚

### æ–¹æ³•äºŒï¼šç›´æ¥ç¼–å†™ DOT æ–‡ä»¶

1. **æ–°å»º DOT æ–‡ä»¶**ï¼šåœ¨ Emacs ä¸­æ–°å»ºä¸€ä¸ª `.dot` æ–‡ä»¶ï¼Œå¹¶å†™å…¥ Graphviz çš„ DOT è¯­è¨€æºç ï¼Œå°±åƒä¸Šé¢æä¾›çš„ç¤ºä¾‹ä¸€æ ·ã€‚

2. **ä¿å­˜æ–‡ä»¶**ï¼šä¿å­˜æ–‡ä»¶ï¼Œä¾‹å¦‚å‘½åä¸º `timeline.dot`ã€‚

3. **æ¸²æŸ“å›¾åƒ**ï¼šåœ¨ Emacs çš„ shell æˆ–è€…å¤–éƒ¨ç»ˆç«¯ä¸­è¿è¡Œ Graphviz å‘½ä»¤æ¥æ¸²æŸ“å›¾åƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ˜¯åœ¨ Emacs çš„ shell ä¸­æ“ä½œï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š

   ```sh
   dot -Tpng timeline.dot -o timeline.png
   ```

4. **æŸ¥çœ‹å›¾åƒ**ï¼šä½¿ç”¨ Emacs çš„å›¾åƒæŸ¥çœ‹åŠŸèƒ½æˆ–å…¶ä»–å›¾åƒæŸ¥çœ‹å™¨æ‰“å¼€ç”Ÿæˆçš„ `timeline.png` æ–‡ä»¶ã€‚

è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥è®©ä½ åœ¨ Emacs ç¯å¢ƒä¸‹æœ‰æ•ˆåœ°ä½¿ç”¨ Graphviz åˆ›å»ºæ—¶é—´çº¿ã€‚å¦‚æœä½ æ›´å–œæ¬¢ Org æ¨¡å¼çš„ç®€æ´æ€§å’Œé›†æˆæ€§ï¼Œé‚£ä¹ˆç¬¬ä¸€ç§æ–¹æ³•å¯èƒ½æ›´é€‚åˆä½ ã€‚å¦‚æœä½ å·²ç»ç†Ÿæ‚‰ DOT è¯­è¨€å¹¶ä¸”æ›´å€¾å‘äºç›´æ¥ç¼–è¾‘æºä»£ç ï¼Œé‚£ä¹ˆç¬¬äºŒç§æ–¹æ³•å¯èƒ½æ›´åŠ é€‚åˆã€‚




åœ¨ Emacs ä¸­ä½¿ç”¨ Org æ¨¡å¼å’Œ Git ç»“åˆå·¥ä½œï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å’Œç‰ˆæœ¬æ§åˆ¶ä½ çš„ç¬”è®°ã€ä»»åŠ¡åˆ—è¡¨å’Œå…¶ä»–æ–‡æœ¬æ–‡ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ“ä½œå’Œé…ç½®ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨ Emacs ä¸­é«˜æ•ˆåœ°ä½¿ç”¨ Org æ¨¡å¼å’Œ Gitã€‚

### 1. å®‰è£…å¿…è¦çš„åŒ…

ç¡®ä¿ä½ å·²ç»å®‰è£…äº† `org` å’Œ `magit` åŒ…ã€‚`org` æ˜¯ Emacs è‡ªå¸¦çš„ï¼Œè€Œ `magit` æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ Git ç®¡ç†å·¥å…·ã€‚

```elisp
;; å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ package.el
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

;; å®‰è£… magit
(unless (package-installed-p 'magit)
  (package-refresh-contents)
  (package-install 'magit))
```

### 2. é…ç½® Magit

åœ¨ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­æ·»åŠ ä¸€äº›åŸºæœ¬çš„ Magit é…ç½®ï¼š

```elisp
(global-set-key (kbd "C-x g") 'magit-status)
```

è¿™ä¼šå°† `C-x g` ç»‘å®šåˆ° Magit çš„çŠ¶æ€çª—å£ï¼Œæ–¹ä¾¿ä½ å¿«é€Ÿæ‰“å¼€ Git çŠ¶æ€ã€‚

### 3. ä½¿ç”¨ Magit ç®¡ç† Git ä»“åº“

å‡è®¾ä½ å·²ç»æœ‰ä¸€ä¸ª Git ä»“åº“ï¼Œä½ å¯ä»¥ä½¿ç”¨ Magit æ¥ç®¡ç†å®ƒã€‚

#### æ‰“å¼€ Magit çŠ¶æ€çª—å£

```elisp
M-x magit-status
```

è¿™ä¼šæ‰“å¼€å½“å‰ç›®å½•çš„ Git çŠ¶æ€çª—å£ï¼Œæ˜¾ç¤ºæœªæäº¤çš„æ›´æ”¹ã€åˆ†æ”¯ä¿¡æ¯ç­‰ã€‚

#### å¸¸ç”¨ Magit å‘½ä»¤

- **s**ï¼šé˜¶æ®µæ›´æ”¹ï¼ˆç›¸å½“äº `git add`ï¼‰
- **u**ï¼šå–æ¶ˆé˜¶æ®µæ›´æ”¹ï¼ˆç›¸å½“äº `git reset`ï¼‰
- **c**ï¼šæäº¤æ›´æ”¹
- **b b**ï¼šåˆ‡æ¢åˆ†æ”¯
- **b c**ï¼šåˆ›å»ºæ–°åˆ†æ”¯
- **P f**ï¼šæ¨é€æ›´æ”¹
- **P p**ï¼šæ‹‰å–æ›´æ”¹

### 4. åœ¨ Org æ–‡ä»¶ä¸­ä½¿ç”¨ Git

ä½ å¯ä»¥åœ¨ Org æ–‡ä»¶ä¸­ä½¿ç”¨ Git æ¥ç‰ˆæœ¬æ§åˆ¶ä½ çš„ç¬”è®°å’Œä»»åŠ¡åˆ—è¡¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„æ“ä½œï¼š

#### åˆå§‹åŒ– Git ä»“åº“

å¦‚æœä½ è¿˜æ²¡æœ‰åˆå§‹åŒ– Git ä»“åº“ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š

```sh
cd /path/to/your/org/files
git init
```

#### æ·»åŠ  Org æ–‡ä»¶åˆ° Git

```sh
git add your-file.org
git commit -m "Initial commit"
```

#### ä½¿ç”¨ Magit ç®¡ç† Org æ–‡ä»¶

1. æ‰“å¼€ä½ çš„ Org æ–‡ä»¶ã€‚
2. ä½¿ç”¨ `C-x g` æ‰“å¼€ Magit çŠ¶æ€çª—å£ã€‚
3. åœ¨ Magit çŠ¶æ€çª—å£ä¸­ï¼Œä½¿ç”¨ä¸Šè¿°å‘½ä»¤è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ“ä½œã€‚

### 5. è‡ªåŠ¨ä¿å­˜å’Œå¤‡ä»½

ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œä½ å¯ä»¥é…ç½® Emacs è‡ªåŠ¨ä¿å­˜å’Œå¤‡ä»½ Org æ–‡ä»¶ã€‚

```elisp
(setq auto-save-default t)  ;; å¼€å¯è‡ªåŠ¨ä¿å­˜
(setq backup-directory-alist '(("." . "~/.emacs.d/backup")))  ;; è®¾ç½®å¤‡ä»½ç›®å½•
(setq version-control t)  ;; å¼€å¯ç‰ˆæœ¬æ§åˆ¶
(setq kept-new-versions 6)  ;; ä¿ç•™æœ€è¿‘ 6 ä¸ªç‰ˆæœ¬
(setq kept-old-versions 2)  ;; ä¿ç•™æœ€æ—§ 2 ä¸ªç‰ˆæœ¬
(setq delete-old-versions t)  ;; åˆ é™¤å¤šä½™çš„å¤‡ä»½
```

### 6. ä½¿ç”¨ Org æ¨¡å¼çš„ Git é›†æˆ

Org æ¨¡å¼æœ¬èº«ä¹Ÿæä¾›äº†ä¸€äº›ä¸ Git é›†æˆçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ `org-git-link`ï¼Œå¯ä»¥ç”Ÿæˆ Git æäº¤çš„é“¾æ¥ã€‚

```elisp
(require 'org-git-link)
```

### 7. ç¤ºä¾‹é…ç½®

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹é…ç½®ï¼Œå°†æ‰€æœ‰ä¸Šè¿°è®¾ç½®æ•´åˆåœ¨ä¸€èµ·ï¼š

```elisp
;; ç¡®ä¿ package.el è¢«åŠ è½½
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

;; å®‰è£… magit
(unless (package-installed-p 'magit)
  (package-refresh-contents)
  (package-install 'magit))

;; ç»‘å®š Magit çŠ¶æ€çª—å£å¿«æ·é”®
(global-set-key (kbd "C-x g") 'magit-status)

;; è‡ªåŠ¨ä¿å­˜å’Œå¤‡ä»½é…ç½®
(setq auto-save-default t)
(setq backup-directory-alist '(("." . "~/.emacs.d/backup")))
(setq version-control t)
(setq kept-new-versions 6)
(setq kept-old-versions 2)
(setq delete-old-versions t)

;; åŠ è½½ org-git-link
(require 'org-git-link)
```

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œä½ å¯ä»¥åœ¨ Emacs ä¸­é«˜æ•ˆåœ°ä½¿ç”¨ Org æ¨¡å¼å’Œ Git æ¥ç®¡ç†ä½ çš„ç¬”è®°å’Œä»»åŠ¡åˆ—è¡¨ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚



åœ¨ Emacs çš„ Org æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `org-plot` åŠŸèƒ½æ¥åˆ›å»ºç®€å•çš„å›¾è¡¨ï¼ŒåŒ…æ‹¬æ—¶é—´çº¿å›¾ï¼ˆTimeline Chartï¼‰ã€‚è™½ç„¶ `org-plot` ä¸»è¦ç”¨äºç»˜åˆ¶æ•°æ®å›¾è¡¨ï¼Œä½†ä½ å¯ä»¥é€šè¿‡ä¸€äº›æŠ€å·§æ¥åˆ›å»ºæ—¶é—´çº¿å›¾ã€‚

### 1. å®‰è£… `org-plot` åŒ…

é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† `org-plot` åŒ…ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ `package.el`ï¼Œå¯ä»¥åœ¨ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š

```elisp
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

(unless (package-installed-p 'org-plot)
  (package-refresh-contents)
  (package-install 'org-plot))
```

### 2. å¯ç”¨ `org-plot` æ¨¡å¼

åœ¨ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­å¯ç”¨ `org-plot` æ¨¡å¼ï¼š

```elisp
(require 'org-plot)
(add-to-list 'org-src-lang-modes '("gnuplot" . gnuplot))
```

### 3. åˆ›å»ºæ—¶é—´çº¿æ•°æ®

åœ¨ä½ çš„ Org æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè¡¨æ ¼æ¥å­˜å‚¨æ—¶é—´çº¿æ•°æ®ã€‚ä¾‹å¦‚ï¼š

```org
* æ—¶é—´çº¿å›¾

| æ—¥æœŸ       | äº‹ä»¶         |
|------------+--------------|
| 2023-01-01 | äº‹ä»¶ 1       |
| 2023-06-01 | äº‹ä»¶ 2       |
| 2023-12-01 | äº‹ä»¶ 3       |
| 2024-03-01 | äº‹ä»¶ 4       |
```

### 4. ä½¿ç”¨ `org-plot` ç”Ÿæˆæ—¶é—´çº¿å›¾

åœ¨è¡¨æ ¼ä¸‹æ–¹æ·»åŠ ä¸€ä¸ª `gnuplot` ä»£ç å—æ¥ç”Ÿæˆæ—¶é—´çº¿å›¾ã€‚ä¾‹å¦‚ï¼š

```org
* æ—¶é—´çº¿å›¾

| æ—¥æœŸ       | äº‹ä»¶         |
|------------+--------------|
| 2023-01-01 | äº‹ä»¶ 1       |
| 2023-06-01 | äº‹ä»¶ 2       |
| 2023-12-01 | äº‹ä»¶ 3       |
| 2024-03-01 | äº‹ä»¶ 4       |

#+BEGIN_SRC gnuplot :file timeline.png :var data=data
set xdata time
set timefmt "%Y-%m-%d"
set format x "%Y-%m-%d"
set xlabel "æ—¥æœŸ"
set ylabel "äº‹ä»¶"
set title "æ—¶é—´çº¿å›¾"
set style data points
set key off
plot data using 1:0 with points pt 7 ps 2 lc rgb "blue", \
     data using 1:0:(sprintf("%s", stringcolumn(2))) with labels offset 0,1
#+END_SRC
```

### 5. æ‰§è¡Œä»£ç å—

å°†å…‰æ ‡æ”¾åœ¨ `gnuplot` ä»£ç å—å†…ï¼Œç„¶åæŒ‰ `C-c C-c` æ¥æ‰§è¡Œä»£ç å—ã€‚Emacs ä¼šè°ƒç”¨ `gnuplot` æ¸²æŸ“å›¾åƒï¼Œå¹¶å°†å…¶ä¿å­˜ä¸º `timeline.png`ã€‚

### 6. æŸ¥çœ‹ç”Ÿæˆçš„å›¾åƒ

åœ¨åŒä¸€ Org æ–‡ä»¶ä¸­ï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªé“¾æ¥æŒ‡å‘ç”Ÿæˆçš„å›¾åƒã€‚ç‚¹å‡»è¿™ä¸ªé“¾æ¥æˆ–ä½¿ç”¨ `C-c C-x C-v` å¯ä»¥åœ¨ Emacs å†…éƒ¨é¢„è§ˆå›¾åƒã€‚

### 7. è‡ªå®šä¹‰å›¾è¡¨

ä½ å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰å›¾è¡¨çš„æ ·å¼å’Œå¸ƒå±€ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è°ƒæ•´ç‚¹çš„å¤§å°ã€é¢œè‰²ã€æ ‡ç­¾çš„ä½ç½®ç­‰ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ `gnuplot` é€‰é¡¹ï¼š

- `set style data points`ï¼šè®¾ç½®æ•°æ®ç‚¹çš„æ ·å¼ã€‚
- `set pointsize <size>`ï¼šè®¾ç½®ç‚¹çš„å¤§å°ã€‚
- `set pointinterval <interval>`ï¼šè®¾ç½®ç‚¹ä¹‹é—´çš„é—´éš”ã€‚
- `set label`ï¼šæ·»åŠ æ ‡ç­¾ã€‚
- `set title`ï¼šè®¾ç½®å›¾è¡¨æ ‡é¢˜ã€‚
- `set xlabel` å’Œ `set ylabel`ï¼šè®¾ç½® X è½´å’Œ Y è½´çš„æ ‡ç­¾ã€‚

é€šè¿‡è¿™äº›æ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨ Emacs çš„ Org æ¨¡å¼ä¸­åˆ›å»ºå’Œå¯¼å‡ºæ—¶é—´çº¿å›¾ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚




`package.el` æ˜¯ Emacs çš„å†…ç½®åŒ…ç®¡ç†å™¨ï¼Œå®ƒä½¿å¾—å®‰è£…ã€æ›´æ–°å’Œç®¡ç† Emacs åŒ…å˜å¾—éå¸¸ç®€å•ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ `package.el` æ¥å®‰è£…å’Œç®¡ç†åŒ…çš„åŸºæœ¬æŒ‡å—ã€‚

### 1. é…ç½® `package.el`

é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­åŒ…å«å¿…è¦çš„é…ç½®ï¼Œä»¥ä¾¿ `package.el` å¯ä»¥ä»å¤šä¸ªåŒ…ä»“åº“ä¸­è·å–åŒ…ã€‚

```elisp
;; ç¡®ä¿ package.el è¢«åŠ è½½
(require 'package)

;; æ·»åŠ  MELPA ä»“åº“
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)

;; åˆå§‹åŒ–åŒ…ç®¡ç†å™¨
(package-initialize)

;; å¦‚æœä½¿ç”¨ Emacs 27 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ç›´è¯‘å­—ç¬¦ä¸²
;; (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))

;; åˆ·æ–°åŒ…åˆ—è¡¨
(unless package-archive-contents
  (package-refresh-contents))
```

### 2. å®‰è£…åŒ…

ä½ å¯ä»¥ä½¿ç”¨ `package-install` å‡½æ•°æ¥å®‰è£…åŒ…ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•å®‰è£… `magit` å’Œ `org-plot`ï¼š

```elisp
;; å®‰è£… magit
(unless (package-installed-p 'magit)
  (package-refresh-contents)
  (package-install 'magit))

;; å®‰è£… org-plot
(unless (package-installed-p 'org-plot)
  (package-refresh-contents)
  (package-install 'org-plot))
```

### 3. æ›´æ–°åŒ…

ä½ å¯ä»¥ä½¿ç”¨ `package-list-packages` å‘½ä»¤æ¥åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„åŒ…ï¼Œå¹¶æ›´æ–°å·²å®‰è£…çš„åŒ…ã€‚

1. æ‰“å¼€åŒ…åˆ—è¡¨ï¼š

   ```elisp
   M-x package-list-packages
   ```

2. åœ¨åŒ…åˆ—è¡¨ä¸­ï¼ŒæŒ‰ `U` é”®æ ‡è®°æ‰€æœ‰å¯æ›´æ–°çš„åŒ…ã€‚
3. æŒ‰ `x` é”®æ‰§è¡Œæ›´æ–°æ“ä½œã€‚

### 4. å¸è½½åŒ…

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `package-list-packages` å‘½ä»¤æ¥å¸è½½ä¸å†éœ€è¦çš„åŒ…ã€‚

1. æ‰“å¼€åŒ…åˆ—è¡¨ï¼š

   ```elisp
   M-x package-list-packages
   ```

2. å°†å…‰æ ‡ç§»åŠ¨åˆ°è¦å¸è½½çš„åŒ…ä¸Šï¼ŒæŒ‰ `d` é”®æ ‡è®°è¦åˆ é™¤çš„åŒ…ã€‚
3. æŒ‰ `x` é”®æ‰§è¡Œåˆ é™¤æ“ä½œã€‚

### 5. è‡ªåŠ¨åŠ è½½åŒ…

ä¸ºäº†ç¡®ä¿æ¯æ¬¡å¯åŠ¨ Emacs æ—¶éƒ½èƒ½åŠ è½½æ‰€éœ€çš„åŒ…ï¼Œä½ å¯ä»¥åœ¨ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­ä½¿ç”¨ `require` å‡½æ•°æ¥åŠ è½½åŒ…ã€‚

```elisp
;; åŠ è½½ magit
(require 'magit)

;; åŠ è½½ org-plot
(require 'org-plot)
```

### 6. ä½¿ç”¨ `use-package` ç®¡ç†åŒ…

`use-package` æ˜¯ä¸€ä¸ªæµè¡Œçš„å®ï¼Œå¯ä»¥ç®€åŒ–åŒ…çš„ç®¡ç†å’Œé…ç½®ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ æ›´æ¸…æ™°åœ°ç»„ç»‡é…ç½®æ–‡ä»¶ï¼Œå¹¶æä¾›å»¶è¿ŸåŠ è½½ç­‰åŠŸèƒ½ã€‚

1. å®‰è£… `use-package`ï¼š

   ```elisp
   (unless (package-installed-p 'use-package)
     (package-refresh-contents)
     (package-install 'use-package))

   ;; ç¡®ä¿ use-package è¢«åŠ è½½
   (require 'use-package)
   ```

2. ä½¿ç”¨ `use-package` ç®¡ç†åŒ…ï¼š

   ```elisp
   (use-package magit
     :ensure t
     :bind (("C-x g" . magit-status)))

   (use-package org-plot
     :ensure t
     :config
     (add-to-list 'org-src-lang-modes '("gnuplot" . gnuplot)))
   ```

### 7. ç¤ºä¾‹é…ç½®æ–‡ä»¶

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹é…ç½®æ–‡ä»¶ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `package.el` å’Œ `use-package` æ¥ç®¡ç†åŒ…ï¼š

```elisp
;; ç¡®ä¿ package.el è¢«åŠ è½½
(require 'package)

;; æ·»åŠ  MELPA ä»“åº“
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)

;; åˆå§‹åŒ–åŒ…ç®¡ç†å™¨
(package-initialize)

;; å¦‚æœä½¿ç”¨ Emacs 27 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ç›´è¯‘å­—ç¬¦ä¸²
;; (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/"))

;; åˆ·æ–°åŒ…åˆ—è¡¨
(unless package-archive-contents
  (package-refresh-contents))

;; å®‰è£… use-package
(unless (package-installed-p 'use-package)
  (package-refresh-contents)
  (package-install 'use-package))

;; ç¡®ä¿ use-package è¢«åŠ è½½
(require 'use-package)

;; ä½¿ç”¨ use-package ç®¡ç†åŒ…
(use-package magit
  :ensure t
  :bind (("C-x g" . magit-status)))

(use-package org-plot
  :ensure t
  :config
  (add-to-list 'org-src-lang-modes '("gnuplot" . gnuplot)))

;; å…¶ä»–é…ç½®
(setq org-latex-pdf-process
      '("xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"))

(setq org-latex-classes
      (append org-latex-classes
              '(("myarticle" "\\documentclass[11pt]{article}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}"))
                ("myreport" "\\documentclass[11pt]{report}"
                 ("\\chapter{%s}" . "\\chapter*{%s}")
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")))))

(setq org-export-directory "~/org-exports")
```

é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œä½ å¯ä»¥è½»æ¾åœ°ä½¿ç”¨ `package.el` å’Œ `use-package` æ¥ç®¡ç† Emacs çš„åŒ…ã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚



åœ¨ Emacs ä¸­ä½¿ç”¨ Org æ¨¡å¼å¯¼å‡º PDF æ–‡æ¡£æ˜¯ä¸€ä¸ªéå¸¸å¸¸è§ä¸”æœ‰ç”¨çš„æ“ä½œã€‚Org æ¨¡å¼æä¾›äº†å¼ºå¤§çš„å¯¼å‡ºåŠŸèƒ½ï¼Œå¯ä»¥å°†ä½ çš„ Org æ–‡ä»¶å¯¼å‡ºä¸ºå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬ PDFã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„æ­¥éª¤å’Œé…ç½®ï¼Œå¸®åŠ©ä½ åœ¨ Emacs ä¸­å°† Org æ–‡ä»¶å¯¼å‡ºä¸º PDFã€‚

### 1. å®‰è£…å¿…è¦çš„è½¯ä»¶

ç¡®ä¿ä½ å·²ç»å®‰è£…äº†ä»¥ä¸‹è½¯ä»¶ï¼š

- **Emacs**ï¼šå¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Emacsï¼Œå¯ä»¥ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½å¹¶å®‰è£…ã€‚
- **Org æ¨¡å¼**ï¼šOrg æ¨¡å¼é€šå¸¸æ˜¯ Emacs è‡ªå¸¦çš„ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚
- **LaTeX å‘è¡Œç‰ˆ**ï¼šå¸¸ç”¨çš„ LaTeX å‘è¡Œç‰ˆæœ‰ TeX Live å’Œ MiKTeXã€‚ç¡®ä¿ä½ å·²ç»å®‰è£…äº†å…¶ä¸­ä¸€ä¸ªï¼Œå¹¶ä¸”è·¯å¾„å·²ç»æ·»åŠ åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ä¸­ã€‚

### 2. é…ç½® Org æ¨¡å¼

åœ¨ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®ï¼Œä»¥ç¡®ä¿ Org æ¨¡å¼èƒ½å¤Ÿæ­£ç¡®å¯¼å‡º PDFï¼š

```elisp
;; ç¡®ä¿ package.el è¢«åŠ è½½
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

;; ç¡®ä¿ Org æ¨¡å¼è¢«åŠ è½½
(require 'org)

;; è®¾ç½®é»˜è®¤å¯¼å‡ºé€‰é¡¹
(setq org-latex-pdf-process
      '("xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"))

;; è®¾ç½® LaTeX ç±»å’ŒåŒ…
(setq org-latex-classes
      (append org-latex-classes
              '(("myarticle" "\\documentclass[11pt]{article}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}"))
                ("myreport" "\\documentclass[11pt]{report}"
                 ("\\chapter{%s}" . "\\chapter*{%s}")
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")))))

;; è®¾ç½®å¯¼å‡ºç›®å½•
(setq org-export-directory "~/org-exports")
```

### 3. ç¼–å†™ Org æ–‡ä»¶

åˆ›å»ºä¸€ä¸ª Org æ–‡ä»¶ï¼Œä¾‹å¦‚ `example.org`ï¼Œå¹¶åœ¨å…¶ä¸­ç¼–å†™ä½ çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼š

```org
* æ ‡é¢˜
** å­æ ‡é¢˜ 1
   è¿™é‡Œæ˜¯å­æ ‡é¢˜ 1 çš„å†…å®¹ã€‚

** å­æ ‡é¢˜ 2
   è¿™é‡Œæ˜¯å­æ ‡é¢˜ 2 çš„å†…å®¹ã€‚
```

### 4. å¯¼å‡ºä¸º PDF

1. æ‰“å¼€ä½ çš„ Org æ–‡ä»¶ã€‚
2. å°†å…‰æ ‡æ”¾åœ¨æ–‡ä»¶ä¸­ï¼Œç„¶åæŒ‰ä¸‹ `C-c C-e` æ‰“å¼€å¯¼å‡ºèœå•ã€‚
3. é€‰æ‹© `l`ï¼ˆLaTeXï¼‰ã€‚
4. é€‰æ‹© `p`ï¼ˆPDFï¼‰ã€‚

Emacs ä¼šè°ƒç”¨ LaTeX ç¼–è¯‘å™¨å°†ä½ çš„ Org æ–‡ä»¶ç¼–è¯‘ä¸º PDF æ–‡ä»¶ã€‚ç¼–è¯‘å®Œæˆåï¼Œä½ å¯ä»¥åœ¨æŒ‡å®šçš„å¯¼å‡ºç›®å½•ä¸­æ‰¾åˆ°ç”Ÿæˆçš„ PDF æ–‡ä»¶ã€‚

### 5. è‡ªå®šä¹‰å¯¼å‡º

å¦‚æœä½ éœ€è¦æ›´å¤šçš„è‡ªå®šä¹‰é€‰é¡¹ï¼Œå¯ä»¥åœ¨ Org æ–‡ä»¶ä¸­æ·»åŠ  LaTeX å¤´éƒ¨ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼š

```org
#+TITLE: æˆ‘çš„æ–‡æ¡£
#+AUTHOR: ä½œè€…å§“å
#+DATE: 2023-10-01
#+LATEX_CLASS: myarticle
#+LATEX_HEADER: \usepackage{graphicx}
#+LATEX_HEADER: \usepackage{hyperref}
```

è¿™äº›å¤´éƒ¨ä¿¡æ¯ä¼šå‘Šè¯‰ Org æ¨¡å¼åœ¨å¯¼å‡ºæ—¶ä½¿ç”¨å“ªäº› LaTeX ç±»å’ŒåŒ…ã€‚

### 6. è§£å†³å¸¸è§é—®é¢˜

- **LaTeX ç¼–è¯‘é”™è¯¯**ï¼šå¦‚æœç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæ£€æŸ¥ Org æ–‡ä»¶ä¸­çš„è¯­æ³•é”™è¯¯æˆ– LaTeX ä»£ç æ˜¯å¦æœ‰è¯¯ã€‚
- **å­—ä½“é—®é¢˜**ï¼šå¦‚æœä½ éœ€è¦ä½¿ç”¨ç‰¹å®šçš„å­—ä½“ï¼Œå¯ä»¥åœ¨ `org-latex-classes` ä¸­æ·»åŠ ç›¸åº”çš„ LaTeX ä»£ç ã€‚

### 7. ç¤ºä¾‹é…ç½®

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹é…ç½®ï¼Œå°†æ‰€æœ‰ä¸Šè¿°è®¾ç½®æ•´åˆåœ¨ä¸€èµ·ï¼š

```elisp
;; ç¡®ä¿ package.el è¢«åŠ è½½
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

;; ç¡®ä¿ Org æ¨¡å¼è¢«åŠ è½½
(require 'org)

;; è®¾ç½®é»˜è®¤å¯¼å‡ºé€‰é¡¹
(setq org-latex-pdf-process
      '("xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"
        "xelatex -interaction nonstopmode -output-directory %o %f"))

;; è®¾ç½® LaTeX ç±»å’ŒåŒ…
(setq org-latex-classes
      (append org-latex-classes
              '(("myarticle" "\\documentclass[11pt]{article}"
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")
                 ("\\subsubsection{%s}" . "\\subsubsection*{%s}"))
                ("myreport" "\\documentclass[11pt]{report}"
                 ("\\chapter{%s}" . "\\chapter*{%s}")
                 ("\\section{%s}" . "\\section*{%s}")
                 ("\\subsection{%s}" . "\\subsection*{%s}")))))

;; è®¾ç½®å¯¼å‡ºç›®å½•
(setq org-export-directory "~/org-exports")
```

é€šè¿‡ä»¥ä¸Šé…ç½®å’Œæ­¥éª¤ï¼Œä½ å¯ä»¥åœ¨ Emacs ä¸­è½»æ¾åœ°å°† Org æ–‡ä»¶å¯¼å‡ºä¸º PDFã€‚å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚



è¦è®© Emacs è‡ªåŠ¨ç”ŸæˆæŒ‡å®šç›®å½•çš„æ—¶é—´è½´ï¼ˆtimelineï¼‰ï¼Œé€šå¸¸éœ€è¦ç»“åˆä½¿ç”¨ Org æ¨¡å¼ï¼ˆOrg-modeï¼‰å’Œä¸€äº›è‡ªå®šä¹‰çš„ Elisp è„šæœ¬ã€‚Org æ¨¡å¼æ˜¯ Emacs ä¸­ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆç”¨äºç®¡ç†ä»»åŠ¡ã€ç¬”è®°å’Œæ—¶é—´çº¿ç­‰ã€‚

### æ­¥éª¤ä¸€ï¼šå®‰è£… Org æ¨¡å¼

å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£… Org æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨æ¥å®‰è£…ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `package-install` å‘½ä»¤å®‰è£… Org æ¨¡å¼ï¼š

```elisp
(package-refresh-contents)
(package-install 'org)
```

### æ­¥éª¤äºŒï¼šåˆ›å»ºæ—¶é—´è½´æ–‡ä»¶

é¦–å…ˆï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª Org æ–‡ä»¶æ¥å­˜å‚¨ä½ çš„æ—¶é—´è½´æ¡ç›®ã€‚æ¯ä¸ªæ¡ç›®åº”è¯¥åŒ…å«ä¸€ä¸ªå¸¦æœ‰æ—¶é—´æˆ³çš„ä»»åŠ¡æˆ–äº‹ä»¶ã€‚ä¾‹å¦‚ï¼š

```org
* TODO å®Œæˆé¡¹ç›®æŠ¥å‘Š
  SCHEDULED: <2024-01-01 Wed>
* DONE å‚åŠ å¹´åº¦ä¼šè®®
  CLOSED: [2023-12-31 Sun 17:00]
```

### æ­¥éª¤ä¸‰ï¼šç¼–å†™è„šæœ¬ç”Ÿæˆæ—¶é—´è½´

ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ª Elisp å‡½æ•°æ¥éå†æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰ Org æ–‡ä»¶ï¼Œå¹¶æå–å…¶ä¸­çš„æ—¶é—´æˆ³ä¿¡æ¯æ¥ç”Ÿæˆæ—¶é—´è½´ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹å‡½æ•°ï¼š

```elisp
(defun generate-timeline (directory)
  "Generate a timeline from all org files in DIRECTORY."
  (interactive "DDirectory: ")
  (let ((files (directory-files directory t "\\.org$"))
        (timeline-buffer (get-buffer-create "*Timeline*")))
    (with-current-buffer timeline-buffer
      (erase-buffer)
      (dolist (file files)
        (insert-file-contents file)
        (org-element-map (org-element-parse-buffer) 'timestamp
          (lambda (ts)
            (when (org-element-property :type ts)
              (insert (format "%s - %s\n"
                              (org-timestamp-translate (org-element-property :raw-value ts))
                              (org-element-property :value ts)))))))
      (switch-to-buffer timeline-buffer))))
```

è¿™ä¸ªå‡½æ•°åšäº†ä»¥ä¸‹å‡ ä»¶äº‹ï¼š

1. è¯¢é—®ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªç›®å½•ã€‚
2. æ‰¾å‡ºè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„ `.org` æ–‡ä»¶ã€‚
3. éå†è¿™äº›æ–‡ä»¶ï¼ŒæŸ¥æ‰¾æ‰€æœ‰çš„æ—¶é—´æˆ³ï¼Œå¹¶å°†å®ƒä»¬æ’å…¥åˆ°åä¸º `*Timeline*` çš„ç¼“å†²åŒºä¸­ã€‚

### æ­¥éª¤å››ï¼šä½¿ç”¨å‡½æ•°

è°ƒç”¨ `M-x generate-timeline` å¹¶é€‰æ‹©ä½ çš„ç›®å½•ï¼ŒEmacs å°†ä¼šæ˜¾ç¤ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æ—¶é—´æˆ³çš„æ—¶é—´è½´ã€‚

### æ³¨æ„äº‹é¡¹

- è¿™ä¸ªè„šæœ¬å‡è®¾ä½ çš„æ—¶é—´è½´æ¡ç›®éƒ½æ˜¯æ ‡å‡†çš„ Org æ—¶é—´æˆ³ã€‚
- å¦‚æœä½ çš„ Org æ–‡ä»¶ä¸­è¿˜æœ‰å…¶ä»–éæ—¶é—´æˆ³çš„å†…å®¹ï¼Œè¿™äº›å†…å®¹ä¸ä¼šè¢«æ˜¾ç¤ºåœ¨æ—¶é—´è½´ä¸­ã€‚
- æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚ï¼Œå¯èƒ½éœ€è¦å¯¹è„šæœ¬è¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚æ·»åŠ è¿‡æ»¤æ¡ä»¶ã€æ’åºç­‰ã€‚

è¿™æ ·ï¼Œä½ å°±å¯ä»¥åˆ©ç”¨ Emacs å’Œ Org æ¨¡å¼æ¥è‡ªåŠ¨ç”ŸæˆæŒ‡å®šç›®å½•çš„æ—¶é—´è½´äº†ã€‚å¸Œæœ›è¿™å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼




åœ¨ Emacs ä¸­åˆ›å»ºè‡ªåŠ¨æ—¶é—´çº¿é€šå¸¸æ˜¯æŒ‡æ ¹æ®ç‰¹å®šæ•°æ®æºï¼ˆå¦‚æ—¥å¿—æ–‡ä»¶ã€ä»»åŠ¡åˆ—è¡¨ã€æ—¥è®°æ¡ç›®ç­‰ï¼‰è‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿è§†å›¾ã€‚è¿™å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å®ç°ï¼Œå…·ä½“å–å†³äºä½ çš„éœ€æ±‚å’Œæ•°æ®çš„æ ¼å¼ã€‚ä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬çš„æ–¹æ³•å’Œå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨ Emacs ä¸­è®¾ç½®è‡ªåŠ¨æ—¶é—´çº¿ï¼š

### 1. ä½¿ç”¨ Org Mode

Org Mode æ˜¯ Emacs çš„ä¸€ä¸ªå¼ºå¤§æ¨¡å¼ï¼Œéå¸¸é€‚åˆç”¨äºåˆ›å»ºå’Œç®¡ç†æ—¶é—´çº¿ã€‚å®ƒå…è®¸ä½ è½»æ¾åœ°ç»„ç»‡ä»»åŠ¡ã€ç¬”è®°å’Œæ—¥ç¨‹å®‰æ’ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ—¶é—´çº¿è§†å›¾ã€‚

#### å®‰è£… Org Mode
å¤§å¤šæ•°ç°ä»£çš„ Emacs é…ç½®å·²ç»åŒ…å«äº† Org Modeã€‚å¦‚æœæ²¡æœ‰ï¼Œä½ å¯ä»¥é€šè¿‡åŒ…ç®¡ç†å™¨å®‰è£…å®ƒã€‚

#### åˆ›å»ºæ—¶é—´çº¿
å‡è®¾ä½ æœ‰ä¸€ä¸ª Org æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›å¸¦æœ‰æ—¥æœŸçš„ä»»åŠ¡æˆ–äº‹ä»¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `org-agenda` å‘½ä»¤æ¥æŸ¥çœ‹è¿™äº›ä»»åŠ¡çš„æ—¶é—´çº¿ã€‚

1. æ‰“å¼€ä½ çš„ Org æ–‡ä»¶ã€‚
2. æŒ‰ `C-c a` è°ƒå‡º Org Agendaã€‚
3. é€‰æ‹© `t` é€‰é¡¹æ¥æŸ¥çœ‹æ—¶é—´çº¿è§†å›¾ã€‚

### 2. ä½¿ç”¨ `org-timeline` å‡½æ•°

å¦‚æœä½ éœ€è¦æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ `org-timeline` å‡½æ•°æ¥è‡ªå®šä¹‰æ—¶é—´çº¿çš„ç”Ÿæˆã€‚

```elisp
(defun my-org-timeline ()
  "Generate a custom timeline."
  (interactive)
  (org-timeline nil))
```

ç„¶åä½ å¯ä»¥é€šè¿‡ `M-x my-org-timeline` æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

### 3. å¤„ç†æ—¥å¿—æ–‡ä»¶

å¦‚æœä½ éœ€è¦ä»æ—¥å¿—æ–‡ä»¶ä¸­æå–æ—¶é—´çº¿ï¼Œå¯ä»¥ä½¿ç”¨ Emacs çš„æ­£åˆ™è¡¨è¾¾å¼å’Œè„šæœ¬æ¥è§£ææ—¥å¿—æ–‡ä»¶ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º Org æ ¼å¼æˆ–å…¶ä»–æ ¼å¼çš„æ—¶é—´çº¿ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ `log.txt`ï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæ—¥æœŸå’Œä¸€æ¡æ¶ˆæ¯ï¼š

```
2023-10-01 Event A
2023-10-02 Event B
2023-10-03 Event C
```

ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ª Emacs è„šæœ¬æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶å¹¶ç”Ÿæˆ Org æ ¼å¼çš„æ—¶é—´çº¿ï¼š

```elisp
(defun parse-log-file (file)
  "Parse the log file and generate an Org timeline."
  (with-temp-buffer
    (insert-file-contents file)
    (goto-char (point-min))
    (let (timeline)
      (while (re-search-forward "^\\(....-..-..\\) \\(.*\\)$" nil t)
        (let ((date (match-string 1))
              (event (match-string 2)))
          (push (format "* %s\n  %s" date event) timeline)))
      (reverse timeline))))

(defun generate-timeline (file)
  "Generate a timeline from a log file."
  (interactive "fLog file: ")
  (with-current-buffer (get-buffer-create "*Timeline*")
    (erase-buffer)
    (dolist (entry (parse-log-file file))
      (insert entry "\n"))
    (org-mode)
    (switch-to-buffer (current-buffer))))
```

ä½¿ç”¨ `M-x generate-timeline` å¹¶é€‰æ‹©ä½ çš„æ—¥å¿—æ–‡ä»¶ï¼ŒEmacs å°†ä¼šç”Ÿæˆä¸€ä¸ª Org æ ¼å¼çš„æ—¶é—´çº¿è§†å›¾ã€‚

### 4. ä½¿ç”¨å¤–éƒ¨å·¥å…·

å¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„æ—¶é—´çº¿ç”Ÿæˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ `timeline` æˆ– `gantt` å·¥å…·ï¼‰ç”Ÿæˆæ—¶é—´çº¿ï¼Œç„¶ååœ¨ Emacs ä¸­æ‰“å¼€ç”Ÿæˆçš„æ–‡ä»¶ã€‚

### æ€»ç»“

Emacs æä¾›äº†å¤šç§æ–¹æ³•æ¥åˆ›å»ºå’Œç®¡ç†æ—¶é—´çº¿ï¼Œä»ç®€å•çš„ Org Mode åˆ°å¤æ‚çš„è‡ªå®šä¹‰è„šæœ¬ã€‚æ ¹æ®ä½ çš„å…·ä½“éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼Œå¯ä»¥è®©ä½ æ›´é«˜æ•ˆåœ°ç®¡ç†å’Œå±•ç¤ºæ—¶é—´çº¿æ•°æ®ã€‚
















`start-process` æ˜¯ Emacs ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹å¹¶ä¸ä¹‹é€šä¿¡ã€‚è¿™ä¸ªå‡½æ•°é€šå¸¸ç”¨äºæ‰§è¡Œ shell å‘½ä»¤æˆ–å…¶ä»–ç¨‹åºï¼Œå¹¶å¯ä»¥æ•è·å®ƒä»¬çš„è¾“å‡ºã€‚

`compile` æ˜¯å¦ä¸€ä¸ª Emacs å‡½æ•°ï¼Œä¸“é—¨ç”¨äºç¼–è¯‘ä»£ç ã€‚å®ƒå®é™…ä¸Šä¹Ÿæ˜¯é€šè¿‡å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹æ¥å®ç°çš„ï¼Œä½†å®ƒæ˜¯é’ˆå¯¹ç¼–ç¨‹ç¼–è¯‘ä»»åŠ¡çš„é«˜çº§å°è£…ã€‚

`filter` åœ¨è¿™é‡Œå¯èƒ½æŒ‡çš„æ˜¯è¿›ç¨‹è¿‡æ»¤å™¨ï¼ˆprocess filterï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„å‡½æ•°ï¼Œå½“ä½ å¯åŠ¨ä¸€ä¸ªå¤–éƒ¨è¿›ç¨‹æ—¶ï¼Œå¯ä»¥æŒ‡å®šå®ƒæ¥å¤„ç†è¿›ç¨‹çš„æ ‡å‡†è¾“å‡ºã€‚æ¯å½“å¤–éƒ¨è¿›ç¨‹å‘æ ‡å‡†è¾“å‡ºå†™å…¥æ•°æ®æ—¶ï¼ŒEmacs ä¼šè°ƒç”¨è¿™ä¸ªè¿‡æ»¤å™¨å‡½æ•°ï¼Œå°†æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™å®ƒã€‚è¿™ä½¿å¾—ä½ å¯ä»¥åœ¨æ•°æ®æ˜¾ç¤ºåœ¨ç¼“å†²åŒºä¹‹å‰å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚

å¦‚æœä½ æƒ³ç»“åˆä½¿ç”¨ `start-process` å’Œ `compile` å¹¶è®¾ç½®ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```elisp
(defun my-compile-filter (proc string)
  "Process output from the compilation process."
  (when (buffer-live-p (process-buffer proc))
    (with-current-buffer (process-buffer proc)
      ;; å¤„ç†è¾“å‡ºå­—ç¬¦ä¸²
      (setq my-compile-output (concat my-compile-output string))
      ;; å°†å¤„ç†åçš„è¾“å‡ºæ’å…¥åˆ°ç¼“å†²åŒº
      (goto-char (point-max))
      (insert my-compile-output))))

(defun my-start-compile-process ()
  "Start a compilation process with a custom filter."
  (interactive)
  (let ((compilation-buffer (get-buffer-create "*my-compilation*")))
    (with-current-buffer compilation-buffer
      (setq my-compile-output "")
      (erase-buffer))
    (start-process "my-compile-process"
                   compilation-buffer
                   "sh" "-c" "make -C /path/to/project")
    (set-process-filter (get-process "my-compile-process") 'my-compile-filter)))

;; è°ƒç”¨è‡ªå®šä¹‰çš„ç¼–è¯‘è¿‡ç¨‹
(my-start-compile-process)
```

ä¸Šè¿°ä»£ç å®šä¹‰äº†ä¸¤ä¸ªå‡½æ•°ï¼š`my-compile-filter` ç”¨äºå¤„ç†æ¥è‡ªç¼–è¯‘è¿‡ç¨‹çš„è¾“å‡ºï¼Œ`my-start-compile-process` ç”¨äºå¯åŠ¨ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰è¿‡æ»¤å™¨çš„ç¼–è¯‘è¿‡ç¨‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º `*my-compilation*` çš„ç¼“å†²åŒºæ¥å­˜æ”¾ç¼–è¯‘è¾“å‡ºï¼Œå¹¶ä¸”åœ¨å¯åŠ¨ç¼–è¯‘è¿‡ç¨‹æ—¶æŒ‡å®šäº†ä¸€ä¸ªè¿‡æ»¤å™¨å‡½æ•° `my-compile-filter` æ¥å¤„ç†è¾“å‡ºã€‚å½“ç¼–è¯‘è¿‡ç¨‹äº§ç”Ÿè¾“å‡ºæ—¶ï¼Œè¿‡æ»¤å™¨å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ·»åŠ é€»è¾‘æ¥ä¿®æ”¹æˆ–æ£€æŸ¥è¾“å‡ºã€‚
åœ¨ Emacs ä¸­ç¼–å†™ Go ä»£ç æ—¶ï¼Œä½¿ç”¨å®æ¥ç®€åŒ–ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åºçš„è¿‡ç¨‹å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ `defmacro` æ¥å®šä¹‰ä¸€ä¸ªå®ï¼Œè¯¥å®å¯ä»¥ç¼–è¯‘å¹¶è¿è¡Œ Go ç¨‹åºã€‚

### å®šä¹‰å®

å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ªå® `go-compile-and-run`ï¼Œå®ƒä¼šç¼–è¯‘å½“å‰ç¼“å†²åŒºä¸­çš„ Go ä»£ç ï¼Œå¹¶åœ¨æˆåŠŸç¼–è¯‘åè¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚

```lisp
(defmacro go-compile-and-run (file-name)
  "Compile and run the Go program in the current buffer.
FILE-NAME is the name of the file to be compiled."
  `(progn
     ;; ç¼–è¯‘ Go ç¨‹åº
     (compile (concat "go build -o " ,file-name " " (buffer-file-name)))
     ;; ç­‰å¾…ç¼–è¯‘å®Œæˆ
     (sit-for 1)
     ;; æ£€æŸ¥ç¼–è¯‘æ˜¯å¦æˆåŠŸ
     (if (file-exists-p ,file-name)
         ;; å¦‚æœç¼–è¯‘æˆåŠŸï¼Œè¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶
         (progn
           (message " Compilation successful, running %s..." ,file-name)
           (call-process ,file-name nil t nil))
       ;; å¦‚æœç¼–è¯‘å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
       (message " Compilation failed."))))
```

### ä½¿ç”¨å®

å‡è®¾ä½ çš„ Go æ–‡ä»¶åä¸º `main.go`ï¼Œä½ å¯ä»¥è¿™æ ·ä½¿ç”¨è¿™ä¸ªå®ï¼š

```lisp
(go-compile-and-run "main")
```

### è§£é‡Š

1. **ç¼–è¯‘ Go ç¨‹åº**ï¼š
   ```lisp
   (compile (concat "go build -o " ,file-name " " (buffer-file-name)))
   ```
   è¿™è¡Œä»£ç ä½¿ç”¨ `compile` å‡½æ•°æ¥ç¼–è¯‘å½“å‰ç¼“å†²åŒºä¸­çš„ Go ä»£ç ã€‚`compile` å‡½æ•°ä¼šæ‰“å¼€ä¸€ä¸ªç¼–è¯‘è¾“å‡ºç¼“å†²åŒºï¼Œæ˜¾ç¤ºç¼–è¯‘è¿‡ç¨‹ä¸­çš„è¾“å‡ºã€‚

2. **ç­‰å¾…ç¼–è¯‘å®Œæˆ**ï¼š
   ```lisp
   (sit-for 1)
   ```
   è¿™è¡Œä»£ç è®© Emacs ç­‰å¾… 1 ç§’é’Ÿï¼Œä»¥ç¡®ä¿ç¼–è¯‘è¿‡ç¨‹æœ‰è¶³å¤Ÿçš„æ—¶é—´å®Œæˆã€‚å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´ç­‰å¾…æ—¶é—´ã€‚

3. **æ£€æŸ¥ç¼–è¯‘æ˜¯å¦æˆåŠŸ**ï¼š
   ```lisp
   (if (file-exists-p ,file-name)
       ...
       (message " Compilation failed."))
   ```
   è¿™éƒ¨åˆ†ä»£ç æ£€æŸ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯´æ˜ç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥è¿è¡Œè¯¥æ–‡ä»¶ï¼›å¦åˆ™ï¼Œæ˜¾ç¤ºç¼–è¯‘å¤±è´¥çš„ä¿¡æ¯ã€‚

4. **è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶**ï¼š
   ```lisp
   (call-process ,file-name nil t nil)
   ```
   è¿™è¡Œä»£ç ä½¿ç”¨ `call-process` å‡½æ•°æ¥è¿è¡Œç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚`call-process` å‡½æ•°å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°å½“å‰ç¼“å†²åŒºæˆ–å…¶ä»–åœ°æ–¹ã€‚

### äº¤äº’å¼ä½¿ç”¨

ä¸ºäº†ä½¿è¿™ä¸ªå®æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œå¯ä»¥å°†å…¶ç»‘å®šåˆ°ä¸€ä¸ªäº¤äº’å¼å‘½ä»¤ä¸Šï¼š

```lisp
(defun go-compile-and-run-interactive ()
  "Interactively compile and run the Go program in the current buffer."
  (interactive)
  (let ((file-name (read-string "Enter the output file name: " "a.out")))
    (go-compile-and-run file-name)))

(global-set-key (kbd "C-c c") 'go-compile-and-run-interactive)
```

### ä½¿ç”¨äº¤äº’å¼å‘½ä»¤

1. æ‰“å¼€ä½ çš„ Go æ–‡ä»¶ã€‚
2. æŒ‰ `C-c c`ã€‚
3. è¾“å…¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åï¼ˆé»˜è®¤ä¸º `a.out`ï¼‰ã€‚

è¿™æ ·ï¼Œä½ å°±å¯ä»¥é€šè¿‡å¿«æ·é”®å¿«é€Ÿç¼–è¯‘å¹¶è¿è¡Œä½ çš„ Go ç¨‹åºäº†ã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹å’Œè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Emacs ä¸­çš„ `defmacro` æ¥ç®€åŒ– Go ç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œè¿‡ç¨‹ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚


åœ¨ Emacs ä¸­ï¼Œä½¿ç”¨ `start-process` å‡½æ•°å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹æ¥ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åºã€‚`start-process` æ˜¯ä¸€ä¸ªéå¸¸çµæ´»çš„å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥å¯åŠ¨ä»»ä½•å¤–éƒ¨å‘½ä»¤ï¼Œå¹¶ä¸”å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ° Emacs ç¼“å†²åŒºä¸­ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ `start-process` æ¥ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åºã€‚

### ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åº

1. **å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ç¼–è¯‘ Go ç¨‹åº**ï¼š
   ```lisp
   (defun go-compile (output-file)
     "Compile the current Go buffer into OUTPUT-FILE."
     (interactive "sOutput file name: ")
     (let* ((default-directory (file-name-directory (buffer-file-name)))
            (command (format "go build -o %s %s" output-file (buffer-file-name)))
            (process (start-process "go-compile" "*Go Compile*" "sh" "-c" command)))
       (set-process-sentinel process
                            (lambda (proc change)
                              (if (string-match "finished" change)
                                  (message "Compilation successful.")
                                (message "Compilation failed.")))))
   ```

2. **å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è¿è¡Œç¼–è¯‘åçš„ç¨‹åº**ï¼š
   ```lisp
   (defun go-run (executable-file)
     "Run the compiled Go executable file."
     (interactive "fExecutable file: ")
     (let* ((default-directory (file-name-directory (buffer-file-name)))
            (process (start-process "go-run" "*Go Run*" executable-file)))
       (set-process-sentinel process
                            (lambda (proc change)
                              (if (string-match "finished" change)
                                  (message "Program executed successfully.")
                                (message "Program execution failed.")))))
   ```

3. **ç»“åˆç¼–è¯‘å’Œè¿è¡Œ**ï¼š
   ```lisp
   (defun go-compile-and-run (output-file)
     "Compile and run the current Go buffer."
     (interactive "sOutput file name: ")
     (go-compile output-file)
     (sit-for 1)  ; ç­‰å¾…ç¼–è¯‘å®Œæˆ
     (if (file-exists-p output-file)
         (progn
           (message "Compilation successful, running %s..." output-file)
           (go-run output-file))
       (message "Compilation failed.")))
   ```

### ä½¿ç”¨è¿™äº›å‡½æ•°

1. **ç¼–è¯‘ Go ç¨‹åº**ï¼š
   - æ‰“å¼€ä½ çš„ Go æ–‡ä»¶ã€‚
   - æŒ‰ `M-x go-compile`ã€‚
   - è¾“å…¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åï¼ˆä¾‹å¦‚ `a.out`ï¼‰ã€‚

2. **è¿è¡Œç¼–è¯‘åçš„ç¨‹åº**ï¼š
   - æŒ‰ `M-x go-run`ã€‚
   - è¾“å…¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åï¼ˆä¾‹å¦‚ `a.out`ï¼‰ã€‚

3. **ç¼–è¯‘å¹¶è¿è¡Œ Go ç¨‹åº**ï¼š
   - æŒ‰ `M-x go-compile-and-run`ã€‚
   - è¾“å…¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶åï¼ˆä¾‹å¦‚ `a.out`ï¼‰ã€‚

### ç»‘å®šå¿«æ·é”®

ä¸ºäº†æ›´æ–¹ä¾¿åœ°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå¯ä»¥å°†å®ƒä»¬ç»‘å®šåˆ°å¿«æ·é”®ä¸Šï¼š

```lisp
(global-set-key (kbd "C-c c") 'go-compile)
(global-set-key (kbd "C-c r") 'go-run)
(global-set-key (kbd "C-c C-c") 'go-compile-and-run)
```

### è§£é‡Š

1. **`go-compile` å‡½æ•°**ï¼š
   - ä½¿ç”¨ `start-process` å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥ç¼–è¯‘ Go ç¨‹åºã€‚
   - `default-directory` è®¾ç½®ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚
   - `command` æ˜¯ç¼–è¯‘å‘½ä»¤ï¼Œä½¿ç”¨ `go build` å‘½ä»¤å°†å½“å‰ç¼“å†²åŒºçš„æ–‡ä»¶ç¼–è¯‘ä¸ºæŒ‡å®šçš„è¾“å‡ºæ–‡ä»¶ã€‚
   - `set-process-sentinel` è®¾ç½®ä¸€ä¸ªå“¨å…µå‡½æ•°ï¼Œç”¨äºåœ¨ç¼–è¯‘å®Œæˆåæ˜¾ç¤ºæ¶ˆæ¯ã€‚

2. **`go-run` å‡½æ•°**ï¼š
   - ä½¿ç”¨ `start-process` å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
   - `default-directory` è®¾ç½®ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚
   - `set-process-sentinel` è®¾ç½®ä¸€ä¸ªå“¨å…µå‡½æ•°ï¼Œç”¨äºåœ¨ç¨‹åºæ‰§è¡Œå®Œæˆåæ˜¾ç¤ºæ¶ˆæ¯ã€‚

3. **`go-compile-and-run` å‡½æ•°**ï¼š
   - å…ˆè°ƒç”¨ `go-compile` å‡½æ•°ç¼–è¯‘ç¨‹åºã€‚
   - ä½¿ç”¨ `sit-for` ç­‰å¾… 1 ç§’é’Ÿï¼Œç¡®ä¿ç¼–è¯‘å®Œæˆã€‚
   - æ£€æŸ¥ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è°ƒç”¨ `go-run` å‡½æ•°è¿è¡Œç¨‹åºã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹å’Œè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ Emacs ä¸­çš„ `start-process` æ¥ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åºã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚



(let (;; åŠ è½½çš„æ—¶å€™ä¸´æ—¶å¢å¤§`gc-cons-threshold'ä»¥åŠ é€Ÿå¯åŠ¨é€Ÿåº¦ã€‚
      (gc-cons-threshold most-positive-fixnum)
      ;; æ¸…ç©ºé¿å…åŠ è½½è¿œç¨‹æ–‡ä»¶çš„æ—¶å€™åˆ†ææ–‡ä»¶ã€‚
      (file-name-handler-alist nil))
  (add-to-list 'load-path (expand-file-name "site-lisp" user-emacs-directory))

  ;(require 'init-benchmarking)
  ;(require 'benchmark-init-modes)
  ;(require 'benchmark-init)
  ;(benchmark-init/activate)
    ;; Emacsé…ç½®æ–‡ä»¶å†…å®¹å†™åˆ°ä¸‹é¢.
  ;;(setq package-enable-at-startup nil)
 ;; (setq package-archives '(("melpa-cn" . "http://mirrors.tuna.tsinghua.edu.cn/elpa/melpa/")
 ;; 			   ("org-cn"   . "http://mirrors.tuna.tsinghua.edu.cn/elpa/org/")
 ;; 			   ("gnu-cn"   . "http://mirrors.tuna.tsinghua.edu.cn/elpa/gnu/")))
  (setq package-archives '(("gnu"   . "http://elpa.emacs-china.org/gnu/")
                           ("melpa" . "http://elpa.emacs-china.org/melpa/")))
  (package-initialize)
  ;;custome-file
  (setq custom-file (expand-file-name "custom.el" user-emacs-directory))
  ;;(load custom-file 'noerror)

  (unless (package-installed-p 'use-package)
    (package-refresh-contents)
    (package-install 'use-package))
  (require 'use-package)
  (use-package diminish :ensure t)
  ;;å¯ç”¨server-start
  (require 'server)
  (unless (server-running-p) (server-start))
  ;(use-package server :ensure t
  ;  :config
  ;  (unless (server-running-p)
  ;  (server-start)))

  (use-package recentf
  ;; Loads after 1 second of idle time.
  :defer 1)
  (require 'setup-appearance)
  (require 'setup-core)
  (require 'setup-cnfonts)
  ;;(require 'setup-deft)
  (require 'setup-org)
  ;;(autoload 'helm-bibtex "helm-bibtex" "" t)
  (require 'setup-org-bibtex)
  (require 'setup-evil)
  (require 'setup-keys)
  (require 'setup-helm)
  (require 'setup-which-key)
  (require 'setup-window-numbering)
  ;;;;;(require 'setup-sr-speedbar)
  (require 'setup-yasnippet)
  (require 'setup-auto-save)
  (require 'setup-translate)
  ;;(require 'setup-company)
  ;(add-to-list 'load-path "~/.emacs.d/site-lisp/snails") ; add snails to your load-path
  ;(require 'snails)
  ;(add-to-list 'load-path (expand-file-name "~/.emacs.d/site-lisp/company-english-helper"))
  ;(require 'company-english-helper)

  ;(add-to-list 'load-path (expand-file-name "~/.emacs.d/site-lisp/insert-translated-name"))
  ;(require 'insert-translated-name)

  ;;(add-to-list 'load-path "~/.emacs.d/site-lisp/toc-org")
  ;;(if (require 'toc-org nil t)
  ;;    (add-hook 'org-mode-hook 'toc-org-mode)
  ;;  (warn "toc-org not found"))
  ;; Load custom settings
  ;(load custom-file 'noerror)
)




















åœ¨ Emacs ä¸­ï¼Œ`default-directory` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ï¼Œè¡¨ç¤ºå½“å‰ç¼“å†²åŒºçš„é»˜è®¤ç›®å½•ã€‚è¿™ä¸ªå˜é‡åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½éå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†æ–‡ä»¶è·¯å¾„å’Œå¯åŠ¨å¤–éƒ¨å‘½ä»¤æ—¶ã€‚ä¸‹é¢æ˜¯ä¸€äº›å…³äº `default-directory` çš„åŸºæœ¬ç”¨æ³•å’Œå¸¸è§æ“ä½œã€‚

### æŸ¥çœ‹å½“å‰çš„ `default-directory`

ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç¼“å†²åŒºçš„ `default-directory`ï¼š

```lisp
(message "Default directory: %s" default-directory)
```

### è®¾ç½® `default-directory`

ä½ å¯ä»¥ä½¿ç”¨ `setq` æˆ– `setq-local` æ¥è®¾ç½® `default-directory`ã€‚`setq` ä¼šè®¾ç½®å…¨å±€å˜é‡ï¼Œè€Œ `setq-local` ä¼šè®¾ç½®å½“å‰ç¼“å†²åŒºçš„å±€éƒ¨å˜é‡ã€‚

#### è®¾ç½®å…¨å±€ `default-directory`

```lisp
(setq default-directory "/path/to/directory/")
```

#### è®¾ç½®å½“å‰ç¼“å†²åŒºçš„ `default-directory`

```lisp
(setq-local default-directory "/path/to/directory/")
```

### è‡ªåŠ¨è®¾ç½® `default-directory`

å¦‚æœä½ å¸Œæœ›åœ¨æ‰“å¼€æ–‡ä»¶æ—¶è‡ªåŠ¨è®¾ç½® `default-directory` ä¸ºæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ `find-file-hook`ï¼š

```lisp
(add-hook 'find-file-hook
          (lambda ()
            (setq-local default-directory (file-name-directory (buffer-file-name)))))
```

### ç¤ºä¾‹ï¼šç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åº

ç»“åˆ `default-directory`ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™ç¼–è¯‘å’Œè¿è¡Œ Go ç¨‹åºçš„å‡½æ•°ã€‚

#### ç¼–è¯‘ Go ç¨‹åº

```lisp
(defun go-compile (output-file)
  "Compile the current Go buffer into OUTPUT-FILE."
  (interactive "sOutput file name: ")
  (let* ((default-directory (file-name-directory (buffer-file-name)))
         (command (format "go build -o %s %s" output-file (buffer-file-name)))
         (process (start-process "go-compile" "*Go Compile*" "sh" "-c" command)))
    (set-process-sentinel process
                          (lambda (proc change)
                            (if (string-match "finished" change)
                                (message "Compilation successful.")
                              (message "Compilation failed."))))))
```

#### è¿è¡Œç¼–è¯‘åçš„ç¨‹åº

```lisp
(defun go-run (executable-file)
  "Run the compiled Go executable file."
  (interactive "fExecutable file: ")
  (let* ((default-directory (file-name-directory (buffer-file-name)))
         (process (start-process "go-run" "*Go Run*" executable-file)))
    (set-process-sentinel process
                          (lambda (proc change)
                            (if (string-match "finished" change)
                                (message "Program executed successfully.")
                              (message "Program execution failed."))))))
```

#### ç¼–è¯‘å¹¶è¿è¡Œ Go ç¨‹åº

```lisp
(defun go-compile-and-run (output-file)
  "Compile and run the current Go buffer."
  (interactive "sOutput file name: ")
  (go-compile output-file)
  (sit-for 1)  ; ç­‰å¾…ç¼–è¯‘å®Œæˆ
  (if (file-exists-p (expand-file-name output-file default-directory))
      (progn
        (message "Compilation successful, running %s..." output-file)
        (go-run output-file))
    (message "Compilation failed.")))
```

### ç»‘å®šå¿«æ·é”®

ä¸ºäº†æ›´æ–¹ä¾¿åœ°ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œå¯ä»¥å°†å®ƒä»¬ç»‘å®šåˆ°å¿«æ·é”®ä¸Šï¼š

```lisp
(global-set-key (kbd "C-c c") 'go-compile)
(global-set-key (kbd "C-c r") 'go-run)
(global-set-key (kbd "C-c C-c") 'go-compile-and-run)
```

### è§£é‡Š

1. **`default-directory` çš„è®¾ç½®**ï¼š
   - `default-directory` è¢«è®¾ç½®ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿å¤–éƒ¨å‘½ä»¤åœ¨æ­£ç¡®çš„ç›®å½•ä¸‹æ‰§è¡Œã€‚

2. **ç¼–è¯‘å’Œè¿è¡Œå‡½æ•°**ï¼š
   - `go-compile` å‡½æ•°ä½¿ç”¨ `start-process` å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥ç¼–è¯‘ Go ç¨‹åºã€‚
   - `go-run` å‡½æ•°ä½¿ç”¨ `start-process` å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹æ¥è¿è¡Œç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
   - `go-compile-and-run` å‡½æ•°å…ˆè°ƒç”¨ `go-compile` ç¼–è¯‘ç¨‹åºï¼Œç„¶åç­‰å¾…ç¼–è¯‘å®Œæˆï¼Œæœ€åè°ƒç”¨ `go-run` è¿è¡Œç¨‹åºã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹å’Œè§£é‡Šèƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨ `default-directory`ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚

ssåœ¨ Emacs ä¸­ï¼Œä½¿ç”¨å¼‚æ­¥ Shell å‘½ä»¤å¯ä»¥è®©ä½ åœ¨ä¸é˜»å¡ Emacs çš„æƒ…å†µä¸‹æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ã€‚Emacs æä¾›äº†å¤šç§æ–¹å¼æ¥å®ç°è¿™ä¸€ç‚¹ï¼ŒåŒ…æ‹¬ `async-shell-command` å’Œ `start-process`ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å¼‚æ­¥ Shell å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•å’Œç¤ºä¾‹ã€‚

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `async-shell-command`

`async-shell-command` æ˜¯ä¸€ä¸ªç®€å•ä¸”å¼ºå¤§çš„å‡½æ•°ï¼Œç”¨äºåœ¨åå°æ‰§è¡Œ Shell å‘½ä»¤ã€‚å®ƒä¸ä¼šé˜»å¡ Emacs çš„æ­£å¸¸æ“ä½œï¼Œéå¸¸é€‚åˆæ‰§è¡Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ã€‚

#### åŸºæœ¬ç”¨æ³•

```lisp
(async-shell-command "ls -l" "*Async Output*")
```

- **å‘½ä»¤**ï¼šè¦æ‰§è¡Œçš„ Shell å‘½ä»¤ã€‚
- **ç¼“å†²åŒº**ï¼šå‘½ä»¤çš„è¾“å‡ºå°†è¢«é‡å®šå‘åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚å¦‚æœä¸æŒ‡å®šç¼“å†²åŒºï¼Œè¾“å‡ºå°†æ˜¾ç¤ºåœ¨ `*Async Shell Command*` ç¼“å†²åŒºä¸­ã€‚

#### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤ï¼Œæ¯”å¦‚ `sleep 10`ï¼Œå¯ä»¥è¿™æ ·æ‰§è¡Œï¼š

```lisp
(async-shell-command "sleep 10 && echo 'Done'" "*Async Output*")
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ `start-process`

`start-process` æ˜¯ä¸€ä¸ªæ›´åº•å±‚çš„å‡½æ•°ï¼Œæä¾›äº†æ›´å¤šçš„çµæ´»æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶æŒ‡å®šè¿›ç¨‹çš„è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµã€‚

#### åŸºæœ¬ç”¨æ³•

```lisp
(start-process "process-name" "buffer" "shell" "-c" "command")
```

- **process-name**ï¼šè¿›ç¨‹çš„åç§°ï¼Œç”¨äºæ ‡è¯†è¿›ç¨‹ã€‚
- **buffer**ï¼šå‘½ä»¤çš„è¾“å‡ºå°†è¢«é‡å®šå‘åˆ°è¿™ä¸ªç¼“å†²åŒºã€‚å¯ä»¥æ˜¯ç¼“å†²åŒºåç§°æˆ– `nil`ã€‚
- **shell**ï¼šä½¿ç”¨çš„ Shell ç¨‹åºï¼Œé€šå¸¸æ˜¯ `/bin/sh`ã€‚
- **-c**ï¼šå‘Šè¯‰ Shell æ‰§è¡Œåé¢çš„å‘½ä»¤ã€‚
- **command**ï¼šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

#### ç¤ºä¾‹

å‡è®¾ä½ æœ‰ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤ï¼Œæ¯”å¦‚ `sleep 10`ï¼Œå¯ä»¥è¿™æ ·æ‰§è¡Œï¼š

```lisp
(start-process "sleep-process" "*Async Output*" "sh" "-c" "sleep 10 && echo 'Done'")
```

### ç»“åˆ `set-process-sentinel`

`set-process-sentinel` å¯ä»¥ç”¨æ¥è®¾ç½®ä¸€ä¸ªå“¨å…µå‡½æ•°ï¼Œå½“è¿›ç¨‹çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆä¾‹å¦‚è¿›ç¨‹ç»“æŸï¼‰ï¼Œå“¨å…µå‡½æ•°ä¼šè¢«è°ƒç”¨ã€‚

#### ç¤ºä¾‹

```lisp
(defun my-sentinel (process event)
  (message "Process %s %s" (process-name process) event))

(let ((process (start-process "sleep-process" "*Async Output*" "sh" "-c" "sleep 10 && echo 'Done'")))
  (set-process-sentinel process 'my-sentinel))
```

### å®Œæ•´ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `async-shell-command` å’Œ `start-process` æ¥æ‰§è¡Œå¼‚æ­¥ Shell å‘½ä»¤ï¼Œå¹¶å¤„ç†å‘½ä»¤çš„è¾“å‡ºå’Œç»“æŸäº‹ä»¶ã€‚

```lisp
;; ä½¿ç”¨ async-shell-command
(defun my-async-shell-command (command)
  "Run COMMAND asynchronously and display output in *Async Output* buffer."
  (interactive "sCommand: ")
  (async-shell-command command "*Async Output*"))

(global-set-key (kbd "C-c a") 'my-async-shell-command)

;; ä½¿ç”¨ start-process
(defun my-start-process (command)
  "Run COMMAND asynchronously and display output in *Async Output* buffer."
  (interactive "sCommand: ")
  (let ((process (start-process "my-process" "*Async Output*" "sh" "-c" command)))
    (set-process-sentinel process 'my-sentinel)))

(defun my-sentinel (process event)
  "Sentinel function to handle process events."
  (message "Process %s %s" (process-name process) event))

(global-set-key (kbd "C-c p") 'my-start-process)
```

### è§£é‡Š

1. **`my-async-shell-command`**ï¼š
   - ä½¿ç”¨ `async-shell-command` å¼‚æ­¥æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ° `*Async Output*` ç¼“å†²åŒºã€‚
   - ç»‘å®šå¿«æ·é”® `C-c a`ã€‚

2. **`my-start-process`**ï¼š
   - ä½¿ç”¨ `start-process` å¼‚æ­¥æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ° `*Async Output*` ç¼“å†²åŒºã€‚
   - è®¾ç½®å“¨å…µå‡½æ•° `my-sentinel`ï¼Œåœ¨è¿›ç¨‹çŠ¶æ€å˜åŒ–æ—¶è°ƒç”¨ã€‚
   - ç»‘å®šå¿«æ·é”® `C-c p`ã€‚

3. **`my-sentinel`**ï¼š
   - å“¨å…µå‡½æ•°ï¼Œç”¨äºå¤„ç†è¿›ç¨‹çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼Œä¾‹å¦‚è¿›ç¨‹ç»“æŸæ—¶æ˜¾ç¤ºæ¶ˆæ¯ã€‚

å¸Œæœ›è¿™äº›ç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Emacs ä¸­æ›´æ–¹ä¾¿åœ°æ‰§è¡Œå¼‚æ­¥ Shell å‘½ä»¤ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚







Emacs ä¸­ï¼Œ`default-directory` é€šå¸¸ç”¨äºè®¾ç½®å½“å‰ç¼“å†²åŒºçš„é»˜è®¤å·¥ä½œç›®å½•ã€‚ç„¶è€Œï¼Œå¯¹äºç¼“å­˜å’Œå¤‡ä»½æ–‡ä»¶çš„ç›®å½•ï¼ŒEmacs æä¾›äº†ä¸€äº›ä¸“é—¨çš„å˜é‡å’Œé…ç½®é€‰é¡¹ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„é…ç½®æ–¹æ³•ï¼Œç”¨äºè®¾ç½®ç¼“å­˜å’Œå¤‡ä»½æ–‡ä»¶çš„ç›®å½•ã€‚

### å¤‡ä»½æ–‡ä»¶ç›®å½•

Emacs é»˜è®¤ä¼šåœ¨æ¯ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­åˆ›å»ºå¤‡ä»½æ–‡ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® `backup-directory-alist` å˜é‡æ¥é›†ä¸­ç®¡ç†å¤‡ä»½æ–‡ä»¶ã€‚

#### è®¾ç½®å¤‡ä»½æ–‡ä»¶ç›®å½•

```lisp
(setq backup-directory-alist '((".*" . "~/.emacs.d/backup/")))
```

è¿™ä¸ªé…ç½®ä¼šå°†æ‰€æœ‰å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨ `~/.emacs.d/backup/` ç›®å½•ä¸‹ã€‚

### è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç›®å½•

è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ï¼ˆauto-save filesï¼‰æ˜¯ Emacs ä¸ºäº†é˜²æ­¢æ•°æ®ä¸¢å¤±è€Œå®šæœŸä¿å­˜çš„ä¸´æ—¶æ–‡ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® `auto-save-file-name-transforms` å˜é‡æ¥é›†ä¸­ç®¡ç†è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€‚

#### è®¾ç½®è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç›®å½•

```lisp
(setq auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save/" t)))
```

è¿™ä¸ªé…ç½®ä¼šå°†æ‰€æœ‰è‡ªåŠ¨ä¿å­˜æ–‡ä»¶å­˜å‚¨åœ¨ `~/.emacs.d/auto-save/` ç›®å½•ä¸‹ã€‚

### ç¼“å­˜æ–‡ä»¶ç›®å½•

Emacs çš„ç¼“å­˜æ–‡ä»¶é€šå¸¸ç”¨äºå­˜å‚¨å„ç§ä¸­é—´æ•°æ®ï¼Œä¾‹å¦‚è¯­æ³•é«˜äº®ç¼“å­˜ã€åŒ…ç®¡ç†ç¼“å­˜ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½® `cache-directory` å˜é‡æ¥é›†ä¸­ç®¡ç†ç¼“å­˜æ–‡ä»¶ã€‚

#### è®¾ç½®ç¼“å­˜æ–‡ä»¶ç›®å½•

```lisp
(setq cache-directory "~/.emacs.d/cache/")
```

### åˆ›å»ºç›®å½•

ä¸ºäº†ç¡®ä¿è¿™äº›ç›®å½•å­˜åœ¨ï¼Œä½ å¯ä»¥åœ¨ Emacs å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºå®ƒä»¬ã€‚å¯ä»¥ä½¿ç”¨ `make-directory` å‡½æ•°æ¥åˆ›å»ºç›®å½•ã€‚

```lisp
(let ((dirs (list "~/.emacs.d/backup/"
                  "~/.emacs.d/auto-save/"
                  "~/.emacs.d/cache/")))
  (dolist (dir dirs)
    (unless (file-exists-p dir)
      (make-directory dir t))))
```

### å®Œæ•´é…ç½®ç¤ºä¾‹

å°†ä¸Šè¿°é…ç½®åˆå¹¶åˆ°ä¸€èµ·ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å®Œæ•´é…ç½®ç¤ºä¾‹ï¼š

```lisp
;; è®¾ç½®å¤‡ä»½æ–‡ä»¶ç›®å½•
(setq backup-directory-alist '((".*" . "~/.emacs.d/backup/")))

;; è®¾ç½®è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç›®å½•
(setq auto-save-file-name-transforms '((".*" "~/.emacs.d/auto-save/" t)))

;; è®¾ç½®ç¼“å­˜æ–‡ä»¶ç›®å½•
(setq cache-directory "~/.emacs.d/cache/")

;; ç¡®ä¿ç›®å½•å­˜åœ¨
(let ((dirs (list "~/.emacs.d/backup/"
                  "~/.emacs.d/auto-save/"
                  "~/.emacs.d/cache/")))
  (dolist (dir dirs)
    (unless (file-exists-p dir)
      (make-directory dir t))))
```

### è§£é‡Š

1. **å¤‡ä»½æ–‡ä»¶ç›®å½•**ï¼š
   - `backup-directory-alist` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œç›®å½•çš„é…å¯¹ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `"."` åŒ¹é…æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶å°†å¤‡ä»½æ–‡ä»¶å­˜å‚¨åœ¨ `~/.emacs.d/backup/` ç›®å½•ä¸‹ã€‚

2. **è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç›®å½•**ï¼š
   - `auto-save-file-name-transforms` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ã€ç›®æ ‡ç›®å½•å’Œä¸€ä¸ªæ ‡å¿—ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ `"."` åŒ¹é…æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶å°†è‡ªåŠ¨ä¿å­˜æ–‡ä»¶å­˜å‚¨åœ¨ `~/.emacs.d/auto-save/` ç›®å½•ä¸‹ã€‚

3. **ç¼“å­˜æ–‡ä»¶ç›®å½•**ï¼š
   - `cache-directory` æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨äºæŒ‡å®šç¼“å­˜æ–‡ä»¶çš„å­˜å‚¨ç›®å½•ã€‚

4. **åˆ›å»ºç›®å½•**ï¼š
   - ä½¿ç”¨ `make-directory` å‡½æ•°ç¡®ä¿è¿™äº›ç›®å½•åœ¨å¯åŠ¨æ—¶å­˜åœ¨ã€‚`t` å‚æ•°è¡¨ç¤ºé€’å½’åˆ›å»ºç›®å½•ã€‚

å¸Œæœ›è¿™äº›é…ç½®ç¤ºä¾‹èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç®¡ç†å’Œé…ç½® Emacs çš„ç¼“å­˜ã€å¤‡ä»½å’Œè‡ªåŠ¨ä¿å­˜æ–‡ä»¶ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚

åœ¨ Emacs ä¸­ï¼Œä½¿ç”¨è¿·ä½ åœ°å›¾ï¼ˆminimapï¼‰å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æµè§ˆå’Œå¯¼èˆªå¤§å‹æ–‡ä»¶ã€‚è¿·ä½ åœ°å›¾é€šå¸¸æ˜¯ä¸€ä¸ªå°çª—å£ï¼Œæ˜¾ç¤ºæ•´ä¸ªæ–‡ä»¶çš„æ¦‚è§ˆï¼Œè®©ä½ å¯ä»¥å¿«é€Ÿå®šä½åˆ°æ–‡ä»¶çš„ä»»æ„éƒ¨åˆ†ã€‚

### å®‰è£…å’Œé…ç½® `minimap` åŒ…

1. **å®‰è£… `minimap` åŒ…**ï¼š
   ä½ å¯ä»¥ä½¿ç”¨ `package.el` æ¥å®‰è£… `minimap` åŒ…ã€‚é¦–å…ˆç¡®ä¿ä½ å·²ç»å¯ç”¨äº† `melpa` ä»“åº“ã€‚

   åœ¨ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

   ```lisp
   (require 'package)
   (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
   (package-initialize)

   (unless (package-installed-p 'minimap)
     (package-refresh-contents)
     (package-install 'minimap))
   ```

   ä¿å­˜æ–‡ä»¶å¹¶é‡å¯ Emacsï¼Œæˆ–è€…åœ¨ Emacs ä¸­æ‰§è¡Œ `M-x eval-buffer` æ¥åŠ è½½é…ç½®ã€‚

2. **é…ç½® `minimap` åŒ…**ï¼š
   å®‰è£…å®Œ `minimap` åŒ…åï¼Œä½ éœ€è¦åœ¨ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­é…ç½®å®ƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„é…ç½®ç¤ºä¾‹ï¼š

   ```lisp
   (require 'minimap)

   ;; è®¾ç½®è¿·ä½ åœ°å›¾çš„å®½åº¦
   (setq minimap-width 10)

   ;; è®¾ç½®è¿·ä½ åœ°å›¾çš„æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
   (setq minimap-update-delay 0.5)

   ;; è®¾ç½®è¿·ä½ åœ°å›¾çš„èƒŒæ™¯é¢œè‰²
   (setq minimap-background-color "gray")

   ;; å¯ç”¨è¿·ä½ åœ°å›¾
   (global-minimap-mode 1)
   ```

### ä½¿ç”¨ `minimap` åŒ…

1. **å¯ç”¨å’Œç¦ç”¨è¿·ä½ åœ°å›¾**ï¼š
   - å¯ç”¨è¿·ä½ åœ°å›¾ï¼š`M-x minimap-mode`
   - ç¦ç”¨è¿·ä½ åœ°å›¾ï¼š`M-x minimap-mode` å†æ¬¡æ‰§è¡Œ

2. **è‡ªå®šä¹‰è¿·ä½ åœ°å›¾**ï¼š
   - **å®½åº¦**ï¼šé€šè¿‡ `minimap-width` å˜é‡è®¾ç½®è¿·ä½ åœ°å›¾çš„å®½åº¦ã€‚
   - **æ›´æ–°é—´éš”**ï¼šé€šè¿‡ `minimap-update-delay` å˜é‡è®¾ç½®è¿·ä½ åœ°å›¾çš„æ›´æ–°é—´éš”ã€‚
   - **èƒŒæ™¯é¢œè‰²**ï¼šé€šè¿‡ `minimap-background-color` å˜é‡è®¾ç½®è¿·ä½ åœ°å›¾çš„èƒŒæ™¯é¢œè‰²ã€‚
   - **å­—ä½“å¤§å°**ï¼šé€šè¿‡ `minimap-font` å˜é‡è®¾ç½®è¿·ä½ åœ°å›¾çš„å­—ä½“å¤§å°ã€‚

   ä¾‹å¦‚ï¼š

   ```lisp
   (setq minimap-width 10)
   (setq minimap-update-delay 0.5)
   (setq minimap-background-color "gray")
   (setq minimap-font (face-attribute 'default :font))
   ```

3. **å¯¼èˆª**ï¼š
   - åœ¨è¿·ä½ åœ°å›¾ä¸­ç‚¹å‡»æŸä¸ªä½ç½®ï¼Œå…‰æ ‡ä¼šè·³è½¬åˆ°ç›¸åº”çš„æ–‡ä»¶ä½ç½®ã€‚
   

### ç¤ºä¾‹é…ç½®

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç¤ºä¾‹é…ç½®ï¼Œä½ å¯ä»¥å°†å…¶æ·»åŠ åˆ°ä½ çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ä¸­ï¼š

```lisp
(require 'package)
(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
(package-initialize)

(unless (package-installed-p 'minimap)
  (package-refresh-contents)
  (package-install 'minimap))

(require 'minimap)

;; è®¾ç½®è¿·ä½ åœ°å›¾çš„å®½åº¦
(setq minimap-width 10)

;; è®¾ç½®è¿·ä½ åœ°å›¾çš„æ›´æ–°é—´éš”ï¼ˆç§’ï¼‰
(setq minimap-update-delay 0.5)

;; è®¾ç½®è¿·ä½ åœ°å›¾çš„èƒŒæ™¯é¢œè‰²
(setq minimap-background-color "gray")

;; è®¾ç½®è¿·ä½ åœ°å›¾çš„å­—ä½“å¤§å°
(setq minimap-font (face-attribute 'default :font))

;; å¯ç”¨è¿·ä½ åœ°å›¾
(global-minimap-mode 1)
```

### å…¶ä»–æ³¨æ„äº‹é¡¹

- **æ€§èƒ½**ï¼šå¯¹äºéå¸¸å¤§çš„æ–‡ä»¶ï¼Œè¿·ä½ åœ°å›¾å¯èƒ½ä¼šæœ‰äº›è®¸å»¶è¿Ÿã€‚ä½ å¯ä»¥é€šè¿‡è°ƒæ•´ `minimap-update-delay` æ¥ä¼˜åŒ–æ€§èƒ½ã€‚
- **å…¼å®¹æ€§**ï¼š`minimap` åŒ…åœ¨å¤§å¤šæ•°ç°ä»£ç‰ˆæœ¬çš„ Emacs ä¸­éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†å¦‚æœä½ é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å°è¯•æ›´æ–° Emacs æˆ–è€…æŠ¥å‘Šé—®é¢˜ç»™ `minimap` åŒ…çš„ç»´æŠ¤è€…ã€‚

å¸Œæœ›è¿™äº›é…ç½®å’Œç¤ºä¾‹èƒ½å¸®åŠ©ä½ åœ¨ Emacs ä¸­æœ‰æ•ˆåœ°ä½¿ç”¨è¿·ä½ åœ°å›¾ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„







åœ¨ Emacs ä¸­ï¼Œ`overlay` æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥åœ¨ç¼“å†²åŒºä¸­æ·»åŠ ä¸´æ—¶çš„é«˜äº®æ˜¾ç¤ºã€æ³¨é‡Šæˆ–å…¶ä»–è§†è§‰æ•ˆæœã€‚`overlay` å¯ä»¥è¦†ç›–æ–‡æœ¬çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶åº”ç”¨ç‰¹å®šçš„å±æ€§ï¼Œå¦‚èƒŒæ™¯è‰²ã€å‰æ™¯è‰²ã€å­—ä½“ç­‰ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ `overlay` æ“ä½œåŠå…¶ç¤ºä¾‹ï¼š

### åŸºæœ¬æ“ä½œ

1. **åˆ›å»º `overlay`**ï¼š
   ```lisp
   (defun create-overlay (start end &optional face)
     "Create an overlay from START to END with FACE."
     (let ((ov (make-overlay start end)))
       (when face
         (overlay-put ov 'face face))
       ov))
   ```

2. **åˆ é™¤ `overlay`**ï¼š
   ```lisp
   (defun delete-overlay (ov)
     "Delete the overlay OV."
     (when (overlayp ov)
       (delete-overlay ov)))
   ```

3. **è·å–æ‰€æœ‰ `overlay`**ï¼š
   ```lisp
   (defun get-overlays ()
     "Get all overlays in the current buffer."
     (overlays-in (point-min) (point-max)))
   ```

### ç¤ºä¾‹ï¼šé«˜äº®æ˜¾ç¤ºå½“å‰æ‹¬å·

å‡è®¾ä½ æƒ³åœ¨å…‰æ ‡ç§»åŠ¨åˆ°æ‹¬å·æ—¶é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ã€‚å¯ä»¥ä½¿ç”¨ `post-command-hook` æ¥æ£€æµ‹å…‰æ ‡çš„ç§»åŠ¨ï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™åˆ›å»ºå’Œåˆ é™¤ `overlay`ã€‚

#### å®Œæ•´é…ç½®ç¤ºä¾‹

1. **å®šä¹‰é«˜äº®æ˜¾ç¤ºåŒ¹é…æ‹¬å·çš„å‡½æ•°**ï¼š
   ```lisp
   (defun highlight-matching-paren (ov)
     "Highlight the matching parenthesis."
     (let ((matching-pos (ignore-errors (scan-sexps (point) 1))))
       (when matching-pos
         (if ov
             (move-overlay ov (point) (1+ (point)))
           (setq ov (create-overlay (point) (1+ (point)) 'highlight)))
         (overlay-put ov 'face 'highlight)
         (overlay-put ov 'priority 100)
         (overlay-put ov 'evaporate t)
         (move-overlay ov matching-pos (1+ matching-pos)))
       ov))
   ```

2. **å®šä¹‰åœ¨å…‰æ ‡ç§»åŠ¨åæ‰§è¡Œçš„æ“ä½œ**ï¼š
   ```lisp
   (defvar current-highlight-overlay nil)

   (defun handle-cursor-move ()
     "Handle cursor movement and highlight matching parenthesis."
     (when (and (not (eq this-command 'self-insert-command))
                (not (eq this-command 'next-line))
                (not (eq this-command 'previous-line)))
       (if (looking-at "[\\[\\]{}()]")
           (setq current-highlight-overlay (highlight-matching-paren current-highlight-overlay))
         (when current-highlight-overlay
           (delete-overlay current-highlight-overlay)
           (setq current-highlight-overlay nil)))))
   ```

3. **å°†å¤„ç†å‡½æ•°æ·»åŠ åˆ° `post-command-hook`**ï¼š
   ```lisp
   (add-hook 'post-command-hook 'handle-cursor-move)
   ```

### å®Œæ•´é…ç½®ç¤ºä¾‹

å°†ä¸Šè¿°é…ç½®åˆå¹¶åˆ°ä¸€èµ·ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å®Œæ•´é…ç½®ç¤ºä¾‹ï¼š

```lisp
;; å®šä¹‰é«˜äº®æ˜¾ç¤ºåŒ¹é…æ‹¬å·çš„å‡½æ•°
(defun highlight-matching-paren (ov)
  "Highlight the matching parenthesis."
  (let ((matching-pos (ignore-errors (scan-sexps (point) 1))))
    (when matching-pos
      (if ov
          (move-overlay ov (point) (1+ (point)))
        (setq ov (create-overlay (point) (1+ (point)) 'highlight)))
      (overlay-put ov 'face 'highlight)
      (overlay-put ov 'priority 100)
      (overlay-put ov 'evaporate t)
      (move-overlay ov matching-pos (1+ matching-pos)))
    ov))

;; å®šä¹‰åœ¨å…‰æ ‡ç§»åŠ¨åæ‰§è¡Œçš„æ“ä½œ
(defvar current-highlight-overlay nil)

(defun handle-cursor-move ()
  "Handle cursor movement and highlight matching parenthesis."
  (when (and (not (eq this-command 'self-insert-command))
             (not (eq this-command 'next-line))
             (not (eq this-command 'previous-line)))
    (if (looking-at "[\\[\\]{}()]")
        (setq current-highlight-overlay (highlight-matching-paren current-highlight-overlay))
      (when current-highlight-overlay
        (delete-overlay current-highlight-overlay)
        (setq current-highlight-overlay nil)))))

;; å°†å¤„ç†å‡½æ•°æ·»åŠ åˆ° post-command-hook
(add-hook 'post-command-hook 'handle-cursor-move)
```

### è§£é‡Š

1. **`highlight-matching-paren`**ï¼š
   - è¿™ä¸ªå‡½æ•°æŸ¥æ‰¾å½“å‰å…‰æ ‡ä½ç½®çš„åŒ¹é…æ‹¬å·ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª `overlay` æ¥é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ã€‚
   - å¦‚æœå·²ç»å­˜åœ¨ä¸€ä¸ª `overlay`ï¼Œåˆ™ç§»åŠ¨å®ƒåˆ°æ–°çš„ä½ç½®ã€‚
   - ä½¿ç”¨ `overlay-put` è®¾ç½® `overlay` çš„å±æ€§ï¼Œå¦‚ `face`ã€`priority` å’Œ `evaporate`ã€‚

2. **`handle-cursor-move`**ï¼š
   - è¿™ä¸ªå‡½æ•°åœ¨æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåè¢«è°ƒç”¨ã€‚
   - ä½¿ç”¨ `this-command` å˜é‡æ¥æ£€æŸ¥å½“å‰æ‰§è¡Œçš„å‘½ä»¤æ˜¯å¦æ˜¯ `self-insert-command`ã€`next-line` æˆ– `previous-line`ã€‚
   - å¦‚æœå½“å‰å…‰æ ‡ä½ç½®æ˜¯ä¸€ä¸ªæ‹¬å·ï¼Œè°ƒç”¨ `highlight-matching-paren` å‡½æ•°æ¥é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ã€‚
   - å¦‚æœå½“å‰å…‰æ ‡ä½ç½®ä¸æ˜¯ä¸€ä¸ªæ‹¬å·ï¼Œåˆ é™¤ç°æœ‰çš„ `overlay`ã€‚

3. **`post-command-hook`**ï¼š
   - `post-command-hook` æ˜¯ä¸€ä¸ªé’©å­ï¼Œå®ƒåœ¨æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåè¢«è§¦å‘ã€‚
   - å°† `handle-cursor-move` å‡½æ•°æ·»åŠ åˆ° `post-command-hook`ï¼Œç¡®ä¿æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåéƒ½ä¼šæ£€æŸ¥å…‰æ ‡çš„ç§»åŠ¨ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

### ä½¿ç”¨æ–¹æ³•

1. å°†ä¸Šè¿°é…ç½®æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
2. é‡å¯ Emacs æˆ–é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚
3. åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œæ¯å½“å…‰æ ‡ç§»åŠ¨åˆ°ä¸€ä¸ªæ‹¬å·æ—¶ï¼ŒEmacs ä¼šé«˜äº®æ˜¾ç¤ºä¸ä¹‹åŒ¹é…çš„å¦ä¸€ä¸ªæ‹¬å·ã€‚

### æ‰©å±•

ä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•è¿™ä¸ªç¤ºä¾‹ï¼Œä¾‹å¦‚ï¼š

- **æ£€æŸ¥å…¶ä»–å­—ç¬¦**ï¼šä½ å¯ä»¥ä¿®æ”¹ `handle-cursor-move` å‡½æ•°æ¥æ£€æŸ¥å…¶ä»–å­—ç¬¦ï¼Œä¾‹å¦‚å¼•å· `"`ã€å•å¼•å· `'` ç­‰ã€‚
- **æ‰§è¡Œå…¶ä»–æ“ä½œ**ï¼šé™¤äº†é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ï¼Œä½ è¿˜å¯ä»¥åœ¨å…‰æ ‡ç§»åŠ¨æ—¶æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨è¡¥å…¨ã€æ ¼å¼åŒ–ä»£ç ç­‰ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `overlay`ï¼Œä½ å¯ä»¥åœ¨ Emacs ä¸­å®ç°å„ç§è§†è§‰æ•ˆæœï¼Œå¦‚é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·ã€æ³¨é‡Šç­‰ã€‚å¸Œæœ›è¿™äº›æ–¹æ³•èƒ½å¸®åŠ©ä½ åœ¨ Emacs ä¸­æ›´æ–¹ä¾¿åœ°å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚





åœ¨ Emacs ä¸­ï¼Œå¦‚æœä½ æƒ³åœ¨å½“å‰æ’å…¥çš„å­—ç¬¦æ˜¯å³æ‹¬å· `)` æ—¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ `post-self-insert-hook` é’©å­ã€‚è¿™ä¸ªé’©å­åœ¨æ¯ä¸ªå­—ç¬¦æ’å…¥åè¢«è§¦å‘ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªé’©å­é‡Œæ£€æŸ¥æ’å…¥çš„å­—ç¬¦ï¼Œå¹¶æ ¹æ®éœ€è¦æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨æ’å…¥å³æ‹¬å· `)` æ—¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä¾‹å¦‚æ£€æŸ¥å½“å‰è¡Œçš„é•¿åº¦æ˜¯å¦è¶…è¿‡ 80 ä¸ªå­—ç¬¦ã€‚

### ç¤ºä¾‹é…ç½®

1. **å®šä¹‰æ£€æŸ¥è¡Œé•¿åº¦çš„å‡½æ•°**ï¼š
   ```lisp
   (defun check-line-length ()
     "Check if the current line length exceeds 80 characters and display a message if it does."
     (let ((line (buffer-substring-no-properties (line-beginning-position) (line-end-position))))
       (when (> (length line) 80)
         (message "Line length exceeds 80 characters"))))
   ```

2. **å®šä¹‰åœ¨æ’å…¥å³æ‹¬å·æ—¶æ‰§è¡Œçš„æ“ä½œ**ï¼š
   ```lisp
   (defun handle-right-paren-insertion ()
     "Handle the insertion of a right parenthesis."
     (when (eq last-input-event ?\))
       (check-line-length)))
   ```

3. **å°†å¤„ç†å‡½æ•°æ·»åŠ åˆ° `post-self-insert-hook`**ï¼š
   ```lisp
   (add-hook 'post-self-insert-hook 'handle-right-paren-insertion)
   ```

### å®Œæ•´é…ç½®ç¤ºä¾‹

å°†ä¸Šè¿°é…ç½®åˆå¹¶åˆ°ä¸€èµ·ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å®Œæ•´é…ç½®ç¤ºä¾‹ï¼š

```lisp
;; å®šä¹‰æ£€æŸ¥è¡Œé•¿åº¦çš„å‡½æ•°
(defun check-line-length ()
  "Check if the current line length exceeds 80 characters and display a message if it does."
  (let ((line (buffer-substring-no-properties (line-beginning-position) (line-end-position))))
    (when (> (length line) 80)
      (message "Line length exceeds 80 characters"))))

;; å®šä¹‰åœ¨æ’å…¥å³æ‹¬å·æ—¶æ‰§è¡Œçš„æ“ä½œ
(defun handle-right-paren-insertion ()
  "Handle the insertion of a right parenthesis."
  (when (eq last-input-event ?\))
    (check-line-length)))

;; å°†å¤„ç†å‡½æ•°æ·»åŠ åˆ° post-self-insert-hook
(add-hook 'post-self-insert-hook 'handle-right-paren-insertion)
```

### è§£é‡Š

1. **`check-line-length`**ï¼š
   - è¿™ä¸ªå‡½æ•°è·å–å½“å‰è¡Œçš„æ–‡æœ¬ï¼Œå¹¶æ£€æŸ¥å…¶é•¿åº¦æ˜¯å¦è¶…è¿‡ 80 ä¸ªå­—ç¬¦ã€‚
   - å¦‚æœè¶…è¿‡ 80 ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨ `message` å‡½æ•°æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼šâ€œLine length exceeds 80 charactersâ€ã€‚

2. **`handle-right-paren-insertion`**ï¼š
   - è¿™ä¸ªå‡½æ•°åœ¨æ¯æ¬¡å­—ç¬¦æ’å…¥åè¢«è°ƒç”¨ã€‚
   - ä½¿ç”¨ `last-input-event` å˜é‡æ¥æ£€æŸ¥æœ€è¿‘æ’å…¥çš„å­—ç¬¦æ˜¯å¦æ˜¯å³æ‹¬å· `)`ã€‚
   - å¦‚æœæ˜¯å³æ‹¬å·ï¼Œè°ƒç”¨ `check-line-length` å‡½æ•°ã€‚

3. **`post-self-insert-hook`**ï¼š
   - `post-self-insert-hook` æ˜¯ä¸€ä¸ªé’©å­ï¼Œå®ƒåœ¨æ¯ä¸ªå­—ç¬¦æ’å…¥åè¢«è§¦å‘ã€‚
   - å°† `handle-right-paren-insertion` å‡½æ•°æ·»åŠ åˆ° `post-self-insert-hook`ï¼Œç¡®ä¿æ¯æ¬¡å­—ç¬¦æ’å…¥åéƒ½ä¼šæ£€æŸ¥æ˜¯å¦æ˜¯å³æ‹¬å·ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚

### ä½¿ç”¨æ–¹æ³•

1. å°†ä¸Šè¿°é…ç½®æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
2. é‡å¯ Emacs æˆ–é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚
3. åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œæ¯å½“è¾“å…¥ä¸€ä¸ªå³æ‹¬å· `)` æ—¶ï¼Œå¦‚æœå½“å‰è¡Œçš„å­—ç¬¦æ•°è¶…è¿‡ 80 ä¸ªï¼ŒEmacs ä¼šæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼šâ€œLine length exceeds 80 charactersâ€ã€‚

### æ‰©å±•

ä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•è¿™ä¸ªç¤ºä¾‹ï¼Œä¾‹å¦‚ï¼š

- **æ£€æŸ¥å…¶ä»–å­—ç¬¦**ï¼šä½ å¯ä»¥ä¿®æ”¹ `handle-right-paren-insertion` å‡½æ•°æ¥æ£€æŸ¥å…¶ä»–å­—ç¬¦ï¼Œä¾‹å¦‚å·¦æ‹¬å· `(`ã€å¼•å· `"` ç­‰ã€‚
- **æ‰§è¡Œå…¶ä»–æ“ä½œ**ï¼šé™¤äº†æ£€æŸ¥è¡Œé•¿åº¦ï¼Œä½ è¿˜å¯ä»¥åœ¨æ’å…¥å³æ‹¬å·æ—¶æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œä¾‹å¦‚è‡ªåŠ¨è¡¥å…¨ã€æ ¼å¼åŒ–ä»£ç ç­‰ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `post-self-insert-hook`ï¼Œä½ å¯ä»¥åœ¨ç‰¹å®šå­—ç¬¦è¾“å…¥æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œã€‚è¿™å¯¹äºå®ç°è¡Œé•¿åº¦æ£€æŸ¥ã€è‡ªåŠ¨è¡¥å…¨ã€ä»£ç æ ¼å¼åŒ–ç­‰ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚å¸Œæœ›è¿™äº›æ–¹æ³•èƒ½å¸®åŠ©ä½ åœ¨ Emacs ä¸­æ›´æ–¹ä¾¿åœ°å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚


















åœ¨ Emacs ä¸­ï¼Œä½¿ç”¨ `run-with-idle-timer` å¯ä»¥åœ¨ Emacs å¤„äºç©ºé—²çŠ¶æ€æ—¶æ‰§è¡ŒæŸäº›æ“ä½œã€‚è¿™éå¸¸é€‚ç”¨äºé‚£äº›ä¸éœ€è¦é¢‘ç¹æ‰§è¡Œï¼Œä½†åˆéœ€è¦å®šæœŸæ£€æŸ¥çš„ä»»åŠ¡ï¼Œæ¯”å¦‚è¡Œé•¿åº¦æ£€æŸ¥ã€è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç­‰ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ `run-with-idle-timer` æ¥å®ç°è¡Œé•¿åº¦æ£€æŸ¥åŠŸèƒ½ã€‚æ¯å½“ Emacs ç©ºé—² 0.5 ç§’æ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰è¡Œçš„é•¿åº¦ï¼Œå¦‚æœè¶…è¿‡ 80 ä¸ªå­—ç¬¦ï¼ŒEmacs ä¼šæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ã€‚

### ç¤ºä¾‹é…ç½®

1. **å®šä¹‰æ£€æŸ¥è¡Œé•¿åº¦çš„å‡½æ•°**ï¼š
   ```lisp
   (defun check-line-length ()
     "Check if the current line length exceeds 80 characters and display a message if it does."
     (let ((line (buffer-substring-no-properties (line-beginning-position) (line-end-position))))
       (when (> (length line) 80)
         (message "Line length exceeds 80 characters"))))
   ```

2. **å®šä¹‰å¯åŠ¨å’Œåœæ­¢å®šæ—¶å™¨çš„å‡½æ•°**ï¼š
   ```lisp
   (defvar check-line-length-timer nil)

   (defun start-check-line-length-timer ()
     "Start a timer to check line length after 0.5 seconds of idle time."
     (unless check-line-length-timer
       (setq check-line-length-timer
             (run-with-idle-timer 0.5 t 'check-line-length))))

   (defun stop-check-line-length-timer ()
     "Stop the timer that checks line length."
     (when check-line-length-timer
       (cancel-timer check-line-length-timer)
       (setq check-line-length-timer nil)))
   ```

3. **å°†å¯åŠ¨å’Œåœæ­¢å®šæ—¶å™¨çš„å‡½æ•°æ·»åŠ åˆ°é€‚å½“çš„é’©å­**ï¼š
   ```lisp
   (add-hook 'post-command-hook 'start-check-line-length-timer)
   (add-hook 'kill-emacs-hook 'stop-check-line-length-timer)
   ```

### å®Œæ•´é…ç½®ç¤ºä¾‹

å°†ä¸Šè¿°é…ç½®åˆå¹¶åˆ°ä¸€èµ·ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å®Œæ•´é…ç½®ç¤ºä¾‹ï¼š

```lisp
;; å®šä¹‰æ£€æŸ¥è¡Œé•¿åº¦çš„å‡½æ•°
(defun check-line-length ()
  "Check if the current line length exceeds 80 characters and display a message if it does."
  (let ((line (buffer-substring-no-properties (line-beginning-position) (line-end-position))))
    (when (> (length line) 80)
      (message "Line length exceeds 80 characters"))))

;; å®šä¹‰å¯åŠ¨å’Œåœæ­¢å®šæ—¶å™¨çš„å‡½æ•°
(defvar check-line-length-timer nil)

(defun start-check-line-length-timer ()
  "Start a timer to check line length after 0.5 seconds of idle time."
  (unless check-line-length-timer
    (setq check-line-length-timer
          (run-with-idle-timer 0.5 t 'check-line-length))))

(defun stop-check-line-length-timer ()
  "Stop the timer that checks line length."
  (when check-line-length-timer
    (cancel-timer check-line-length-timer)
    (setq check-line-length-timer nil)))

;; å°†å¯åŠ¨å’Œåœæ­¢å®šæ—¶å™¨çš„å‡½æ•°æ·»åŠ åˆ°é€‚å½“çš„é’©å­
(add-hook 'post-command-hook 'start-check-line-length-timer)
(add-hook 'kill-emacs-hook 'stop-check-line-length-timer)
```

### è§£é‡Š

1. **`check-line-length`**ï¼š
   - è¿™ä¸ªå‡½æ•°è·å–å½“å‰è¡Œçš„æ–‡æœ¬ï¼Œå¹¶æ£€æŸ¥å…¶é•¿åº¦æ˜¯å¦è¶…è¿‡ 80 ä¸ªå­—ç¬¦ã€‚
   - å¦‚æœè¶…è¿‡ 80 ä¸ªå­—ç¬¦ï¼Œä½¿ç”¨ `message` å‡½æ•°æ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼šâ€œLine length exceeds 80 charactersâ€ã€‚

2. **`start-check-line-length-timer`**ï¼š
   - è¿™ä¸ªå‡½æ•°å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œè¯¥å®šæ—¶å™¨åœ¨ Emacs ç©ºé—² 0.5 ç§’åæ‰§è¡Œ `check-line-length` å‡½æ•°ã€‚
   - ä½¿ç”¨ `run-with-idle-timer` åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ `check-line-length-timer` å˜é‡ä¸­ã€‚

3. **`stop-check-line-length-timer`**ï¼š
   - è¿™ä¸ªå‡½æ•°åœæ­¢å¹¶å–æ¶ˆå®šæ—¶å™¨ã€‚
   - ä½¿ç”¨ `cancel-timer` å–æ¶ˆå®šæ—¶å™¨ï¼Œå¹¶å°† `check-line-length-timer` å˜é‡è®¾ä¸º `nil`ã€‚

4. **`post-command-hook`**ï¼š
   - `post-command-hook` æ˜¯ä¸€ä¸ªé’©å­ï¼Œå®ƒåœ¨æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåè¢«è§¦å‘ã€‚
   - å°† `start-check-line-length-timer` æ·»åŠ åˆ° `post-command-hook`ï¼Œç¡®ä¿æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåéƒ½ä¼šå¯åŠ¨å®šæ—¶å™¨ã€‚

5. **`kill-emacs-hook`**ï¼š
   - `kill-emacs-hook` æ˜¯ä¸€ä¸ªé’©å­ï¼Œå®ƒåœ¨ Emacs å…³é—­å‰è¢«è§¦å‘ã€‚
   - å°† `stop-check-line-length-timer` æ·»åŠ åˆ° `kill-emacs-hook`ï¼Œç¡®ä¿åœ¨å…³é—­ Emacs æ—¶åœæ­¢å®šæ—¶å™¨ã€‚

### ä½¿ç”¨æ–¹æ³•

1. å°†ä¸Šè¿°é…ç½®æ·»åŠ åˆ°ä½ çš„ Emacs é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `~/.emacs` æˆ– `~/.emacs.d/init.el`ï¼‰ä¸­ã€‚
2. é‡å¯ Emacs æˆ–é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ã€‚
3. åœ¨ç¼–è¾‘è¿‡ç¨‹ä¸­ï¼Œæ¯å½“ Emacs ç©ºé—² 0.5 ç§’æ—¶ï¼Œå¦‚æœå½“å‰è¡Œçš„å­—ç¬¦æ•°è¶…è¿‡ 80 ä¸ªï¼ŒEmacs ä¼šæ˜¾ç¤ºä¸€æ¡æ¶ˆæ¯ï¼šâ€œLine length exceeds 80 charactersâ€ã€‚

### æ€§èƒ½ä¼˜åŒ–

ä½¿ç”¨ `run-with-idle-timer` å¯ä»¥æ˜¾è‘—å‡å°‘æ€§èƒ½å¼€é”€ï¼Œå› ä¸ºå®ƒåªåœ¨ Emacs ç©ºé—²æ—¶æ‰§è¡Œæ£€æŸ¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å‘½ä»¤æ‰§è¡Œåéƒ½æ£€æŸ¥ã€‚

### æ€»ç»“

é€šè¿‡ä½¿ç”¨ `run-with-idle-timer`ï¼Œä½ å¯ä»¥åœ¨ Emacs ç©ºé—²æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ£€æŸ¥æˆ–æ“ä½œã€‚è¿™å¯¹äºå®ç°è¡Œé•¿åº¦æ£€æŸ¥ã€è‡ªåŠ¨ä¿å­˜æ–‡ä»¶ç­‰ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚å¸Œæœ›è¿™äº›æ–¹æ³•èƒ½å¸®åŠ©ä½ åœ¨ Emacs ä¸­æ›´æ–¹ä¾¿åœ°å®ç°æ‰€éœ€çš„åŠŸèƒ½ã€‚å¦‚æœæœ‰æ›´å¤šé—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥çš„å¸®åŠ©ï¼Œè¯·éšæ—¶æé—®ã€‚









è¦åœ¨ Emacs ä¸­ä»ç‰¹å®šå­—ç¬¦ï¼ˆä¾‹å¦‚ "m"ï¼‰å¼€å§‹é«˜äº®æ˜¾ç¤ºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `highlight-regexp` å‘½ä»¤æ¥åŒ¹é…ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé«˜äº®ã€‚ä¸ºäº†é«˜äº®æ‰€æœ‰ä»ä¸Šä¸¤ä¸ªå­—ç¬¦ä¸º "m" å¼€å§‹çš„æ–‡æœ¬ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š

```
m.
```

è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ‰€æœ‰ä»¥ "m" å¼€å¤´åè·Ÿä»»æ„å•ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ã€‚

ä¸‹é¢æ˜¯å…·ä½“çš„æ“ä½œæ­¥éª¤ï¼š

1. æŒ‰ `M-x` (å³ Alt+x æˆ– Esc x)ã€‚
2. è¾“å…¥ `highlight-regexp` å¹¶æŒ‰å›è½¦é”®ã€‚
3. è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼ `m.` å¹¶æŒ‰å›è½¦é”®ã€‚

è¿™å°†ä¼šé«˜äº®æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡æœ¬ã€‚å¦‚æœæ‚¨æƒ³è¦å–æ¶ˆé«˜äº®ï¼Œå¯ä»¥ä½¿ç”¨ `unhighlight-regexp` å‘½ä»¤ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

1. æŒ‰ `M-x`ã€‚
2. è¾“å…¥ `unhighlight-regexp` å¹¶æŒ‰å›è½¦é”®ã€‚
3. è¾“å…¥ä¹‹å‰ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼ `m.` å¹¶æŒ‰å›è½¦é”®ã€‚

è¿™æ ·å°±å¯ä»¥ç§»é™¤ä¹‹å‰è®¾ç½®çš„é«˜äº®äº†ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤åªä¼šå½±å“å½“å‰çš„ç¼“å†²åŒºã€‚å¦‚æœæ‚¨éœ€è¦åœ¨æ•´ä¸ªæ–‡ä»¶æˆ–å¤šä¸ªæ–‡ä»¶ä¸­åº”ç”¨é«˜äº®ï¼Œæ‚¨å¯èƒ½éœ€è¦ç¼–å†™æ›´å¤æ‚çš„Emacs Lispä»£ç æ¥å®ç°ã€‚





åœ¨ Emacs ä¸­ï¼Œâ€œleader keyâ€ çš„æ¦‚å¿µé€šå¸¸æ˜¯ä»å…¶ä»–ç¼–è¾‘å™¨ï¼ˆå¦‚ Vimï¼‰å¼•å…¥çš„ï¼Œç”¨äºç®€åŒ–ç»‘å®šå¤æ‚å‘½ä»¤åˆ°å¿«æ·é”®çš„è¿‡ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒEmacs å¹¶æ²¡æœ‰å†…å»ºçš„â€œleader keyâ€æœºåˆ¶ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å®‰è£…ä¸€äº›ç¬¬ä¸‰æ–¹åŒ…æ¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚ä¸€ä¸ªéå¸¸æµè¡Œçš„åŒ…æ˜¯ `general`ï¼Œå®ƒæä¾›äº†å¼ºå¤§çš„é”®ä½ç»‘å®šåŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¾ç½® leader keyã€‚

### å®‰è£… `general` åŒ…

1. é¦–å…ˆï¼Œç¡®ä¿æ‚¨çš„ Emacs å·²ç»é…ç½®äº†åŒ…ç®¡ç†å·¥å…·ï¼Œæ¯”å¦‚ `package.el`ã€‚
2. æ‰“å¼€æ‚¨çš„ `.emacs` æˆ– `init.el` æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹æ¥å®‰è£… `general` åŒ…ï¼š

   ```elisp
   (require 'package)
   (add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)
   (package-initialize)

   ;; å¦‚æœè¿˜æ²¡æœ‰å®‰è£… `use-package`ï¼Œè¿™é‡Œä¹Ÿä¸€å¹¶å®‰è£…
   (unless (package-installed-p 'use-package)
     (package-refresh-contents)
     (package-install 'use-package))

   (use-package general :ensure t) ```

3. ä¿å­˜æ–‡ä»¶åé‡å¯ Emacsï¼Œæˆ–è€…åœ¨ Emacs ä¸­è¿è¡Œ `M-x package-refresh-contents` å’Œ `M-x package-install RET general RET` æ¥æ‰‹åŠ¨å®‰è£… `general` åŒ…ã€‚

### è®¾ç½® Leader Key

å®‰è£…å¥½ `general` åŒ…ä¹‹åï¼Œæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ª leader keyï¼Œæ¯”å¦‚å¸¸ç”¨çš„ `SPC` é”®ï¼ˆç©ºæ ¼é”®ï¼‰ï¼š

```elisp
(general-create-definer my-leader-def
  :keymaps '(normal insert visual emacs)
  :prefix "SPC")

(my-leader-def
  "ff" 'find-file
  "bb" 'switch-to-buffer
  "ww" 'delete-other-windows
  "ee" 'eval-expression
  "qq" 'save-buffers-kill-terminal)
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª leader key `SPC`ï¼Œå¹¶ä¸”ç»‘å®šäº†å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œ`SPC ff` å°†æ‰“å¼€æ–‡ä»¶ï¼Œ`SPC bb` å°†åˆ‡æ¢ç¼“å†²åŒºç­‰ã€‚

### ä½¿ç”¨ Leader Key

ä¸€æ—¦è®¾ç½®äº† leader keyï¼Œæ‚¨å°±å¯ä»¥é€šè¿‡æŒ‰ä¸‹ leader key ç„¶åç´§æ¥ç€è¾“å…¥ç›¸åº”çš„å­å‘½ä»¤æ¥æ‰§è¡Œå‘½ä»¤ã€‚ä¾‹å¦‚ï¼Œè¦æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æŒ‰ä¸‹ `SPC` ç„¶åè¾“å…¥ `ff`ï¼Œæ¥ç€æŒ‰ç…§æç¤ºæ“ä½œå³å¯ã€‚



åœ¨ Emacs Lisp (Elisp) ä¸­ï¼Œé€’å½’åŒ¹é…é€šå¸¸æ¶‰åŠåˆ°ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å’Œé€’å½’å‡½æ•°æ¥å¤„ç†åµŒå¥—ç»“æ„ï¼Œå¦‚æ‹¬å·ã€æ ‡ç­¾ç­‰ã€‚Emacs Lisp æä¾›äº†å¼ºå¤§çš„æ–‡æœ¬å¤„ç†åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ç¼–å†™é€’å½’å‡½æ•°æ¥å®ç°å¤æ‚çš„åŒ¹é…é€»è¾‘ã€‚

### ç¤ºä¾‹ï¼šåŒ¹é…åµŒå¥—çš„æ‹¬å·

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…å«åµŒå¥—çš„æ‹¬å·ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°æ‰€æœ‰çš„æ‹¬å·å¯¹åŠå…¶å†…å®¹ã€‚

#### æ­¥éª¤ 1ï¼šå®šä¹‰é€’å½’å‡½æ•°

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªé€’å½’å‡½æ•° `match-parentheses`ï¼Œè¯¥å‡½æ•°ä¼šéå†å­—ç¬¦ä¸²å¹¶åŒ¹é…åµŒå¥—çš„æ‹¬å·ã€‚

```elisp
(defun match-parentheses (str &optional start end)
  "Recursively match nested parentheses in STR.
START and END are the start and end indices of the substring to process."
  (let ((result '())
        (stack '())
        (i start))
    (while (< i end)
      (let ((char (aref str i)))
        (cond
         ((= char ?\()
          (push i stack))
         ((= char ?\))
          (when stack
            (let ((open-pos (pop stack)))
              (push (cons open-pos i) result))))
         (t
          ;; Do nothing for other characters
          )))
      (setq i (1+ i)))
    (reverse result)))

(defun find-all-parentheses (str)
  "Find all nested parentheses in STR."
  (match-parentheses str 0 (length str)))

;; æµ‹è¯•
(let ((test-str "(a (b (c) d) e) (f (g))"))
  (find-all-parentheses test-str))
```

### è§£é‡Š

1. **`match-parentheses` å‡½æ•°**ï¼š
   - å‚æ•° `str` æ˜¯è¦å¤„ç†çš„å­—ç¬¦ä¸²ã€‚
   - å‚æ•° `start` å’Œ `end` æ˜¯å­å­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ï¼Œé»˜è®¤å€¼ä¸ºå­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸä½ç½®ã€‚
   - `result` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨åŒ¹é…çš„æ‹¬å·å¯¹ã€‚
   - `stack` æ˜¯ä¸€ä¸ªæ ˆï¼Œç”¨äºè·Ÿè¸ªæœªé—­åˆçš„å·¦æ‹¬å·çš„ä½ç½®ã€‚
   - `i` æ˜¯å½“å‰å¤„ç†çš„å­—ç¬¦ç´¢å¼•ã€‚

2. **ä¸»å¾ªç¯**ï¼š
   - éå†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ã€‚
   - å¦‚æœé‡åˆ°å·¦æ‹¬å· `(`ï¼Œå°†å…¶ç´¢å¼•å‹å…¥æ ˆä¸­ã€‚
   - å¦‚æœé‡åˆ°å³æ‹¬å· `)`ï¼Œä»æ ˆä¸­å¼¹å‡ºæœ€è¿‘çš„å·¦æ‹¬å·ç´¢å¼•ï¼Œå¹¶å°†å…¶ä¸å½“å‰å³æ‹¬å·ç´¢å¼•ä¸€èµ·å­˜å…¥ `result` åˆ—è¡¨ä¸­ã€‚
   - å¯¹äºå…¶ä»–å­—ç¬¦ï¼Œä¸åšå¤„ç†ã€‚

3. **`find-all-parentheses` å‡½æ•°**ï¼š
   - è°ƒç”¨ `match-parentheses` å‡½æ•°ï¼Œä¼ å…¥å­—ç¬¦ä¸²çš„èµ·å§‹å’Œç»“æŸç´¢å¼•ã€‚

### æµ‹è¯•

è¿è¡Œä¸Šè¿°ä»£ç ï¼Œè¾“å‡ºç»“æœå°†æ˜¯ï¼š

```
((12 . 16) (14 . 15) (1 . 11) (3 . 8) (5 . 6))
```

è¿™è¡¨ç¤ºæ‰¾åˆ°äº†ä»¥ä¸‹æ‹¬å·å¯¹åŠå…¶ç´¢å¼•ï¼š

- `(12 . 16)` å¯¹åº” `(f (g))`
- `(14 . 15)` å¯¹åº” `(g)`
- `(1 . 11)` å¯¹åº” `(a (b (c) d) e)`
- `(3 . 8)` å¯¹åº” `(b (c) d)`
- `(5 . 6)` å¯¹åº” `(c)`

### æ‰©å±•

ä½ å¯ä»¥æ ¹æ®éœ€è¦æ‰©å±•è¿™ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚å¤„ç†å…¶ä»–ç±»å‹çš„æ‹¬å·ï¼ˆå¦‚ `{}` æˆ– `[]`ï¼‰ï¼Œæˆ–è€…æå–æ‹¬å·å†…çš„å†…å®¹ã€‚å¸Œæœ›è¿™ä¸ªç¤ºä¾‹èƒ½å¸®åŠ©ä½ ç†è§£å¦‚ä½•åœ¨ Elisp ä¸­å®ç°é€’å½’åŒ¹é…ã€‚å¦‚æœä½ æœ‰æ›´å¤šå…·ä½“çš„éœ€æ±‚æˆ–é—®é¢˜ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼

